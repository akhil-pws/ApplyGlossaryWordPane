!function(){"use strict";var e,t,n,o,a={14385:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},57030:function(e,t,n){e.exports=n.p+"cca4de5cf945742b4fdc.css"},58394:function(e,t,n){e.exports=n.p+"17c4e625aefc844934d8.css"}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return a[e](n,n.exports,s),n.exports}s.m=a,s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e}(),s.b=document.baseURI||self.location.href,function(){s.d({},{gG:function(){return S},Dd:function(){return we},ff:function(){return H},VY:function(){return ue},UH:function(){return R},P1:function(){return ee},xZ:function(){return Ie},J7:function(){return te},Gg:function(){return ve},JB:function(){return pe},LQ:function(){return Y},a$:function(){return L},st:function(){return Ee},IV:function(){return X},LV:function(){return fe},_k:function(){return T},c1:function(){return Z},w4:function(){return Q}});const e="https://plsdevapp.azurewebsites.net";async function t(t,n){const o=await fetch(`${e}/api/groupkey/update-prompt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}const n=[{name:"Plain White Table",style:"Table Grid",headerClass:"",tableClass:"background-color:#ffffff;border:1px solid #000;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!1},{name:"Plain Table with Gray Alternating Rows",style:"Plain Table 1",headerClass:"",tableClass:"background-color:#ffffff;border:1px solid #000;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Gray Alternating Rows",style:"Grid Table 2",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Blue Alternating Rows",style:"Grid Table 2 - Accent 1",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Pink Alternating Rows",style:"Grid Table 2 - Accent 2",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Green Alternating Rows",style:"Grid Table 2 - Accent 3",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Purple Alternating Rows",style:"Grid Table 2 - Accent 4",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Teal Alternating Rows",style:"Grid Table 2 - Accent 5",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#daeef3;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Orange Alternating Rows",style:"Grid Table 2 - Accent 6",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"empty",sideHeader:!0},{name:"Black Header Only Table with White Rows",style:"List Table 3",headerClass:"",tableClass:"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Blue Header Only Table with White Rows",style:"List Table 3 - Accent 1",headerClass:"",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Red Header Only Table with White Rows",style:"List Table 3 - Accent 2",headerClass:"",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Green Header Only Table with White Rows",style:"List Table 3 - Accent 3",headerClass:"",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Purple Header Only Table with White Rows",style:"List Table 3 - Accent 4",headerClass:"",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Teal Header Only Table with White Rows",style:"List Table 3 - Accent 5",headerClass:"",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Orange Header Only Table with White Rows",style:"List Table 3 - Accent 6",headerClass:"",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Black Header Table with Light Gray Alternating Rows",style:"Grid Table 4",headerClass:"",tableClass:"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"empty",sideHeader:!0},{name:"Blue Header Table with Light Blue Alternating Rows",style:"Grid Table 4 - Accent 1",headerClass:"",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"empty",sideHeader:!0},{name:"Red Header Table with Pink Alternating Rows",style:"Grid Table 4 - Accent 2",headerClass:"",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"empty",sideHeader:!0},{name:"Green Header Table with Light Green Alternating Rows",style:"Grid Table 4 - Accent 3",headerClass:"",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"empty",sideHeader:!0},{name:"Purple Header Table with Light Purple Alternating Rows",style:"Grid Table 4 - Accent 4",headerClass:"",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"empty",sideHeader:!0},{name:"Teal Header Table with Light Teal Alternating Rows",style:"Grid Table 4 - Accent 5",headerClass:"",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#daeef3;color:#000000;",format:"empty",sideHeader:!0},{name:"Orange Header Table with Light Orange Alternating Rows",style:"Grid Table 4 - Accent 6",headerClass:"",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"empty",sideHeader:!0},{name:"Black Header Table with Light Gray Alternating Rows - Side header same color",style:"Grid Table 5 Dark",headerClass:"",tableClass:"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"partial",sideHeader:!0},{name:"Blue Header Table with Light Blue Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 1",headerClass:"",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"partial",sideHeader:!0},{name:"Red Header Table with Pink Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 2",headerClass:"",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"partial",sideHeader:!0},{name:"Green Header Table with Light Green Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 3",headerClass:"",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"partial",sideHeader:!0},{name:"Purple Header Table with Light Purple Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 4",headerClass:"",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"partial",sideHeader:!0},{name:"Teal Header Table with Light Teal Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 5",headerClass:"",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#daeef3;color:#000000;",format:"partial",sideHeader:!0},{name:"Orange Header Table with Light Orange Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 6",headerClass:"",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"partial",sideHeader:!0},{name:"Black Table - Whole table is black",style:"List Table 5 Dark",headerClass:"border:1px solid #000000; border-bottom: none;",tableClass:"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"full",sideHeader:!0},{name:"Blue Table - Whole table is blue",style:"List Table 5 Dark - Accent 1",headerClass:"border:1px solid #4F81BD; border-bottom: none;",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"full",sideHeader:!0},{name:"Red Table - Whole table is red",style:"List Table 5 Dark - Accent 2",headerClass:"border:1px solid #c0504d; border-bottom: none;",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"full",sideHeader:!0},{name:"Green Table - Whole table is green",style:"List Table 5 Dark - Accent 3",headerClass:"border:1px solid #9bbb59; border-bottom: none;",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"full",sideHeader:!0},{name:"Purple Table - Whole table is purple",style:"List Table 5 Dark - Accent 4",headerClass:"border:1px solid #8064a2; border-bottom: none;",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"full",sideHeader:!0},{name:"Teal Table - Whole table is teal",style:"List Table 5 Dark - Accent 5",headerClass:"border:1px solid #4bacc6; border-bottom: none;",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#daeef3;color:#000000;",format:"full",sideHeader:!0},{name:"Orange Table - Whole table is orange",style:"List Table 5 Dark - Accent 6",headerClass:"border:1px solid #f79646; border-bottom: none;",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"full",sideHeader:!0}];function o(e,t){const n=`<div class="toast show" style="position: fixed; top: 10px; right: 10px; z-index: 1050; max-width: fit-content; background-color: #808080; color: #ffffff;">\n    <div class="toast-body">\n         <i class="fa ${"success"===t?"fa-check-circle":"fa-exclamation-circle"} me-2" style="color: #ffffff;"></i> ${e}\n    </div>\n  </div>`;document.getElementById("toastr").innerHTML=n,setTimeout((()=>{document.getElementById("toastr").innerHTML=""}),4e3)}const a='<ul class="nav nav-tabs" id="tabList" role="tablist">\n  <li class="nav-item">\n    <a class="nav-link active" id="tag-tab" data-bs-toggle="tab" href="#tag" role="tab">Tag</a>\n  </li>\n  <li class="nav-item">\n    <a class="nav-link" id="prompt-tab" data-bs-toggle="tab" href="#prompt" role="tab">Prompt builder</a>\n  </li>\n</ul>\n\n<div class="tab-content p-3 border border-top-0">\n  <div class="tab-pane fade show active" id="add-tag-body" role="tabpanel" aria-labelledby="tag-tab">\n  </div>\n  <div class="tab-pane fade" id="add-prompt-template" role="tabpanel" aria-labelledby="prompt-tab">\n  </div>\n</div>\n';function r(e,t){let n="Normal",o=t;t.startsWith("###### ")?(n="Heading 6",o=t.substring(7).trim()):t.startsWith("##### ")?(n="Heading 5",o=t.substring(6).trim()):t.startsWith("#### ")?(n="Heading 4",o=t.substring(5).trim()):t.startsWith("### ")?(n="Heading 3",o=t.substring(4).trim()):t.startsWith("## ")?(n="Heading 2",o=t.substring(3).trim()):t.startsWith("# ")&&(n="Heading 1",o=t.substring(2).trim()),e.style=n;const a=/(\*\*(.+?)\*\*)|(\*(.+?)\*)|(_(.+?)_)/g;let r,s=0;for(;null!==(r=a.exec(o));){r.index>s&&e.insertText(o.substring(s,r.index),Word.InsertLocation.end);let t="",n=!1,l=!1,i=!1;r[1]?(t=r[2],n=!0):r[3]?(t=r[4],l=!0):r[5]&&(t=r[6],i=!0);const c=e.insertText(t,Word.InsertLocation.end);c.font.bold=n,c.font.italic=l,c.font.underline=i?Word.UnderlineType.single:Word.UnderlineType.none,s=a.lastIndex}s<o.length&&e.insertText(o.substring(s),Word.InsertLocation.end)}function l(e){return e?e.replace(/^"|"$/g,"").replace(/\\n/g,"").replace(/\*\*/g,"").replace(/\\r/g,""):""}function i(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),o("Copied to clipboard successfully!","success")}function c(){document.querySelector(".nav-link.active")?.classList.remove("active"),document.querySelector(".tab-pane.show.active")?.classList.remove("show","active"),document.getElementById("tag-tab").classList.add("active"),document.getElementById("add-tag-body").classList.add("show","active")}function d(e){const t=/<TableStart>([\s\S]*?)<TableEnd>/gi;let n,o=[];for(;null!==(n=t.exec(e));)try{const e=JSON.parse(n[1]);o.push(m(e))}catch(e){console.error("Failed to parse JSON:",e,n[1])}let a=0;return e.replace(t,(()=>o[a++]||""))}function m(e){if(!e||Array.isArray(e)&&0===e.length)return"<p>No data available</p>";let t=new Set,n=[];function o(e,t="",n={}){return Object.keys(e).forEach((a=>{const r=e[a],s=t?`${t} > ${a}`:a;"object"!=typeof r||null===r||Array.isArray(r)?Array.isArray(r)?n[s]=r.map((e=>"object"==typeof e?Object.entries(e).map((([e,t])=>`<strong>${e}:</strong> ${t}`)).join("<br>"):e)).join("<br>"):n[s]=r:o(r,s,n)})),n}Array.isArray(e)||(e=Object.entries(e).map((([e,t])=>({[e]:t})))),e.forEach((e=>{let a=o(e);Object.keys(a).forEach((e=>t.add(e))),n.push(a)}));let a='<table border="1" cellspacing="0" cellpadding="5">';return a+="<tr>"+[...t].map((e=>`<th>${e}</th>`)).join("")+"</tr>",n.forEach((e=>{a+="<tr>"+[...t].map((t=>`<td>${e[t]}</td>`)).join("")+"</tr>"})),a+="</table>",a}function p(e){return` <textarea class="form-control ${"Dark"===Q?"bg-secondary text-light":"bg-white text-dark"}"\n                      rows="5"\n                      id="chatInput"\n                      ></textarea>\n            <div id="mention-dropdown" class="dropdown-menu"></div>\n            <div class="d-flex flex-column align-self-end me-3">\n              <button class="btn btn-secondary text-light ms-2 mb-2 ngb-tooltip" id="insertTagButton">\n                <span class="tooltiptext">Insert</span>\n                <i class="fa fa-plus text-light c-pointer"></i>\n              </button>\n             <div class="ngb-tooltip d-inline-block">\n                 ${e.Sources&&e.Sources.length>0?`  <span class="tooltiptext">${e.Sources}</span>`:'<span class="tooltiptext">Source</span>'}\n                <button class="btn btn-secondary ms-2 mb-2 text-white" id="changeSourceButton">\n                  <i class="fa fa-file-lines text-white"></i>\n                </button>\n              </div>\n\n              <button type="submit" class="btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip" id="sendPromptButton">\n                <span class="tooltiptext">Send</span>\n                <i class="fa fa-paper-plane text-white"></i>\n              </button>\n            </div>`}function f(e,t){const n=document.getElementById("tag-badge-wrapper");n.innerHTML="",[...new Set(e.map((e=>e.toLowerCase())))].map((t=>e.find((e=>e.toLowerCase()===t)))).forEach((e=>{let o;if(o=/^ID\d+$/i.test(e)?t.find((t=>1===t.AIFlag&&`id${t.ID}`.toLowerCase()===e.toLowerCase())):t.find((t=>1===t.AIFlag&&t.DisplayName.toLowerCase()===e.toLowerCase())),o?.DisplayName){const t=document.createElement("span");t.className="badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable",t.style.cursor="pointer",t.innerHTML=`${o.DisplayName} <i class="fa-solid fa-microchip-ai ms-2 text-muted" aria-label="AI Suggested"></i>`,t.addEventListener("click",(async()=>{if(await y(e),o){const e=document.getElementById("app-body");e.innerHTML='<div class="text-muted p-2">Loading...</div>',x(o).then((t=>{e.innerHTML=t}))}})),n.appendChild(t)}}))}function u(e){const t="Dark"===e,n="Light"===e,o=(e,o,a)=>{const r=document.querySelectorAll(e),s=o.split(" "),l=a.split(" ");r.forEach((e=>{e&&(e.classList.remove(...s),e.classList.remove(...l),t&&e.classList.add(...s),n&&e.classList.add(...l))}))};o("#app-body","bg-dark text-light","bg-white text-dark"),o("#search-box","bg-secondary text-light border-0","bg-white text-dark border"),o(".dropdown-menu","bg-dark text-light border-light","bg-white text-dark border"),o(".list-group-item","bg-dark text-light","bg-white text-dark"),o(".dropdown-toggle","bg-dark text-light border-0","bg-white text-dark border"),o(".dropdown-item","bg-dark text-light","bg-white text-dark"),o(".list-group-item-action","bg-dark text-light list-hover-dark","bg-light text-dark list-hover-light"),o("#close-ai-window","fa-solid fa-circle-xmark bg-dark text-light","fa-solid fa-circle-xmark bg-light text-dark"),o("#chatInput","bg-secondary text-light","bg-white text-dark"),o(".prompt-text","bg-secondary text-light","bg-white text-dark")}function g(){const e=document.getElementById("theme-toggle").querySelector("i");"Dark"===Q?(e.classList.remove("fa-moon"),e.classList.add("fa-sun"),sessionStorage.setItem("theme","Dark")):"Light"===Q&&(e.classList.remove("fa-sun"),e.classList.add("fa-moon"),sessionStorage.setItem("theme","Light"))}async function y(e){return Word.run((async t=>{const n=t.document.getSelection().getBookmarks();await t.sync();const o=n.value.find((t=>t.split("_Split_")[0].replace(/_/g," ").toLowerCase()===e.toLowerCase()));if(o){const e=t.document.getBookmarkRangeOrNullObject(o);e.load("isNullObject"),await t.sync(),e.isNullObject||e.select()}}))}async function b(e,t,n){t.forEach(((t,n)=>{const o=Array.from(t.querySelectorAll("td, th"));let a=0;o.forEach((t=>{const o=t.innerText.trim();e.getCell(n,a).value=o,a++}))})),await n.sync(),e.rows.load("items"),await n.sync();const o=(e,t,n)=>{let o="Normal";ee.IsHeaderBold&&0===t&&(o="Bold"),ee.IsSideHeaderBold&&0===n&&(o="Bold"),e.body.font.bold="Bold"===o},a=(e,t)=>{e.shadingColor=t;try{e.font.color=(e=>{const t=e.replace("#","");return(.299*parseInt(t.substring(0,2),16)+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16))/255<.5})(t)?"#FFFFFF":"#000000";const n="#D3D3D3";e.getBorder&&["Top","Bottom","Left","Right"].forEach((t=>{e.getBorder(t).type="Single",e.getBorder(t).color=n,e.getBorder(t).width=1}))}catch(e){}},r=Z.split(" - ")[0].trim();if("Plain Table 3"===r)e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,n)=>{let r=ee.Primary;r=0===t||0===n?ee.Header:t%2==1?ee.Primary:ee.Secondary,a(e,r),o(e,t,n)}))}));else if("Plain Table 2"===r){e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync();const t=e.rows.items.length,r=0,s=t-1;e.rows.items.forEach(((e,t)=>{t!==r&&t!==s&&(e.getBorder(Word.BorderLocation.bottom).type=Word.BorderType.none)})),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,n)=>{let r=ee.Primary;r=0===t?ee.Header:t%2==1?ee.Primary:ee.Secondary,a(e,r),o(e,t,n)}))})),await n.sync()}else if("Plain Table 5"===r)e.getBorder(Word.BorderLocation.insideVertical).type=Word.BorderType.none,e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,n)=>{let r=ee.Primary;r=0===t?ee.Header:t%2==1?ee.Primary:ee.Secondary,a(e,r),o(e,t,n)}))}));else if("Table Grid"===r)e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{const n=t%2==0?ee.Header:ee.Primary;a(e,n),e.cells.items.forEach(((e,n)=>{o(e,t,n)}))}));else if(r.startsWith("Grid Table 4")){const t=e.rows.items[0];a(t,ee.Header),e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{if(t>0){const n=t%2==0?ee.Secondary:ee.Primary;a(e,n)}e.cells.items.forEach(((e,n)=>{o(e,t,n)}))}))}else if(r.startsWith("Grid Table 5 Dark"))e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,n)=>{let r=ee.Primary;r=0===t||0===n?ee.Header:t%2==1?ee.Primary:ee.Secondary,a(e,r),o(e,t,n)}))}));else if(r.startsWith("List Table 3")){const t=e.rows.items[0];a(t,ee.Header),e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{t>0&&a(e,ee.Primary),e.cells.items.forEach(((e,n)=>{o(e,t,n)}))}))}else r.startsWith("List Table 2")?(e.rows.items.forEach((e=>e.cells.load("items"))),await n.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,n)=>{let r=ee.Primary;r=0===t?ee.Header:t%2==1?ee.Primary:ee.Secondary,a(e,r),o(e,t,n)}))}))):e.rows.items.forEach((e=>a(e,ee.Primary)));await n.sync()}function h(e){return e?[...e.Flowchart||[],...e.Graph||[],...e.Image||[]].map((e=>({Name:e.ImageName,DisplayName:e.ImageName,EditorValue:e.ImageData,UserValue:e.ImageData,ComponentKeyDataType:"IMAGE",AIFlag:0,IsImage:!0}))):[]}async function w(e){return new Promise(((t,n)=>{try{const o=new Blob([atob(e.split(",")[1])],{type:"image/svg+xml"}),a=URL.createObjectURL(o),r=new Image;r.crossOrigin="anonymous",r.onload=function(){const e=document.createElement("canvas");e.width=r.width||1200,e.height=r.height||800;const o=e.getContext("2d");if(!o)return n("Canvas unsupported.");o.drawImage(r,0,0);const s=e.toDataURL("image/png").split(",")[1];t(s),URL.revokeObjectURL(a)},r.onerror=()=>n("SVG load failed."),r.src=a}catch(e){n(e)}}))}function v(e){const t="Dark"===Q?"bg-secondary text-light":"bg-white text-dark";document.getElementById("app-body").innerHTML=`\n    <div class="container pt-3">\n        <div class="d-flex justify-content-end px-2">\n            <div class="dropdown">\n                <button class="btn btn-default dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n                    Action\n                </button>\n                <ul class="dropdown-menu">\n                    <li>\n                        <a class="dropdown-item" href="#" id="add-btn-tag">\n                            <i class="fa fa-plus me-2" aria-hidden="true"></i> Add\n                        </a>\n                    </li>\n                    <li>\n                        <a class="dropdown-item" href="#" id="apply-btn-tag">\n                            <i class="fa-solid fa-circle-check me-2"></i> Apply\n                        </a>\n                    </li>\n\n                     <li>\n                        <a class="dropdown-item" href="#" id="predefined-table">\n                            <i class="fa fa-table me-2" aria-hidden="true"></i> Default Tables\n                        </a>\n                    </li>\n                    <li>\n                        <a class="dropdown-item" href="#" id="customized-table">\n                            <i class="fa fa-brush me-2" aria-hidden="true"></i> Customized Tables\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n\n        <div class="form-group px-2 pt-2">\n            <input type="text" id="search-box" class="form-control ${t}" placeholder="Search Tags..." autocomplete="off" />\n        </div>\n\n        <ul id="suggestion-list" class="list-group mt-2 px-2"></ul>\n        \n        <div id="tags-in-selected-text" class="mt-2 px-2 selected-text-box d-none">\n            <label class="form-label mb-2 fw-bold">Tags in Selected Text</label>\n            <div class="tag-panel d-flex flex-wrap gap-2" id="tag-badge-wrapper"></div>\n        </div>\n    </div>`;const n=document.getElementById("search-box"),o=document.getElementById("suggestion-list");function a(){const t=n.value.trim().toLowerCase();if(o.replaceChildren(),""===t)return void(o.innerHTML="");const a=e.filter((e=>e.DisplayName.toLowerCase().includes(t))),r=a.filter((e=>0===e.AIFlag)),s=a.filter((e=>1===e.AIFlag)),l=r.filter((e=>"TEXT"===e.ComponentKeyDataType)),i=r.filter((e=>"IMAGE"===e.ComponentKeyDataType&&e.IsImage)),c=(e,t,n=!1,a=!1)=>{if(0===t.length)return;const r="Dark"===Q?{itemClass:"bg-dark text-light list-hover-dark",labelClass:"bg-dark text-light"}:{itemClass:"bg-light text-dark list-hover-light",labelClass:"bg-light text-dark"},s=document.createElement("li");s.className=`list-group-item fw-bold text-secondary ${r.labelClass}`,s.textContent=e,o.appendChild(s),t.forEach((e=>{const t=document.createElement("li");t.className=`list-group-item list-group-item-action ${r.itemClass}`;let s='<i class="fa-solid fa-layer-group text-muted me-2"></i>';n&&(s='<i class="fa-solid fa-microchip-ai text-muted me-2"></i>'),a&&(s='<i class="fa-solid fa-image text-muted me-2"></i>'),t.innerHTML=`${s} ${e.DisplayName}`,t.onclick=()=>{if(n){const t=document.getElementById("app-body");t.innerHTML='<div class="text-muted p-2">Loading...</div>',x(e).catch((()=>t.innerHTML='<div class="text-danger p-2">Error loading data</div>')).then((e=>{t.innerHTML=e}))}else E(e,e.ComponentKeyDataType),o.replaceChildren()},o.appendChild(t)}))};c("Properties",l),c("AI Tags",s,!0),c("Images",i,!1,!0)}if(X.length>0){const t=document.getElementById("tags-in-selected-text");t.classList.remove("d-none"),t.classList.add("d-block"),f(X,e)}let r;n.addEventListener("input",(()=>{clearTimeout(r),r=setTimeout(a,300)})),document.getElementById("add-btn-tag").addEventListener("click",(()=>{Y||we()})),document.getElementById("customized-table").addEventListener("click",(()=>{Y||ve("Custom")})),document.getElementById("predefined-table").addEventListener("click",(()=>{Y||ve("Pre")})),document.getElementById("apply-btn-tag").addEventListener("click",(()=>{Y||ue()}))}async function E(e,t){return Word.run((async n=>{try{const o=n.document.getSelection();if(await n.sync(),!o)throw new Error("Selection is invalid or not found.");let a=o;if("TABLE"===t){const t=(new DOMParser).parseFromString(e.EditorValue,"text/html"),s=Array.from(t.body.childNodes);await n.sync();for(const e of s)if(e.nodeType===Node.TEXT_NODE){let t=e.textContent?.trim();t&&(t=t.replace(/\n- /g,"\n• "),t.split("\n").forEach((e=>{e.trim()&&r(o,e)})))}else if(e.nodeType===Node.ELEMENT_NODE){const t=e;if("table"===t.tagName.toLowerCase()){const e=Array.from(t.querySelectorAll("tr"));if(0===e.length){o.insertParagraph("[Empty Table]",Word.InsertLocation.before);continue}const r=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),s=o.insertParagraph("",Word.InsertLocation.before);await n.sync();const l=s.insertTable(e.length,r,Word.InsertLocation.after);l.style=Z,await n.sync(),ee.Customize&&await b(l,e,n);const i=new Array(r).fill(0);e.forEach(((e,t)=>{const n=Array.from(e.querySelectorAll("td, th"));let o=0;n.forEach((e=>{for(;i[o]>0;)i[o]--,o++;const n=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),a=parseInt(e.getAttribute("colspan")||"1",10),s=parseInt(e.getAttribute("rowspan")||"1",10);l.getCell(t,o).value=n;for(let e=1;e<a;e++)o+e<r&&(l.getCell(t,o+e).value="");if(s>1)for(let e=0;e<a;e++)o+e<r&&(i[o+e]=s-1);o+=a}))})),a=l.getCell(0,0)}else{let e=t.innerText.trim();e&&(e=e.replace(/\n- /g,"\n• "),e.split("\n").forEach((e=>{e.trim()&&r(o,e)}))),a=o}}}else if("IMAGE"===t){let t=e.EditorValue;t.startsWith("data:image/svg+xml")?t=await w(t):t.startsWith("data:image")&&(t=t.split(",")[1]),o.insertInlinePictureFromBase64(t,Word.InsertLocation.replace),a=o}else""===e.EditorValue||e.IsApplied?o.insertParagraph(`#${e.DisplayName}#`,Word.InsertLocation.before):l(e.EditorValue).split(/\r?\n/).forEach((e=>{o.insertParagraph(e,Word.InsertLocation.before)})),a=o;const s=o.insertParagraph("",Word.InsertLocation.after);await n.sync(),a=s,o.select(),await n.sync()}catch(e){console.error("Detailed error:",e)}}))}async function x(e){e.FilteredReportHeadAIHistoryList&&0!==e.FilteredReportHeadAIHistoryList.length||await pe(e);const t=e.FilteredReportHeadAIHistoryList;if(0===t.length)return"<div>No AI history available.</div>";const n="Dark"===Q?"fa-solid fa-circle-xmark bg-dark text-light":"fa-solid fa-circle-xmark bg-light text-dark",o=`\n    <div class="chat-header sticky-top bg-white z-3">\n        <div class="d-flex justify-content-between align-items-center px-2 pt-3">\n            <div class="d-flex align-items-center ms-3">\n                <i class="fa fa-microchip-ai text-muted me-2"></i>\n                <span class="fw-bold">${e.DisplayName}</span>\n            </div>\n            <div class="d-flex justify-content-center align-items-center me-3 c-pointer" id="close-btn-tag">\n                <i class="${n}" id="close-ai-window"></i>\n            </div>\n        </div>\n        <hr class="mt-2 mb-1 mx-3">\n        </div>\n    `,a=`\n        <div class="chat-body flex-grow-1 overflow-auto">\n            ${function(e){const t="Dark"===Q?"bg-secondary text-light":"bg-white text-dark",n=S.UserRoleEntityAccessList.find((e=>"Global Prompt Update"===e.UserRoleEntity));return e.map(((e,o)=>{const a=3===n?.UserRoleAccessID,r=e.Evidences&&e.Evidences.length>0;return`\n      <div class="row chat-entry m-0 p-0">\n        <div class="col-md-12 mt-2 p-2">\n          <div class="d-flex justify-content-between align-items-start">\n            \x3c!-- Prompt Box --\x3e\n            <div class="form-control h-34 d-flex align-items-center dynamic-height prompt-text ${t}" style="width: 95%;">\n              ${e.Prompt}\n            </div>\n\n            \x3c!-- Icons Stack --\x3e\n            <div class="d-flex flex-column align-items-center ms-2">\n              <i class="fa fa-copy text-secondary c-pointer mb-2" title="Copy Prompt" id="copyPrompt-${o}"></i>\n              ${a?`<i class="fa fa-save text-secondary c-pointer" title="Save Prompt" id="savePrompt-${o}"></i>`:""}\n            </div>\n          </div>\n        </div>\n\n        <div class="col-md-12 mb-2 p-2 d-flex">\n          <span class="d-flex align-items-baseline w-100">\n            <div class="flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response" id="responseContainer-${o}">\n              <input\n                class="form-check-input c-pointer me-2 response-checkbox"\n                type="checkbox"\n                id="checkbox-${o}"\n                ${1===e.Selected?"checked":""}>\n              <span id="responseText-${o}">${e.Response}</span>\n              <i class="fa fa-copy text-secondary c-pointer ms-2"\n                title="Copy Response"\n                id="copyResponse-${o}"></i>\n              ${r?`<i class="fa fa-folder-gear text-secondary c-pointer ms-2"\n                    title="Open Reference"\n                    id="openRefferance-${o}"></i>`:""}\n            </div>\n          </span>\n        </div>\n      </div>`})).join("")}(t)}\n        </div>\n    `,r=`\n        <div class="d-flex align-items-end justify-content-end chatbox p-2" id="chatFooter">\n            ${p(e)}\n        </div>\n    `;return I(e,L,R),`${o}${a}${r}`}function k(){const e=new Date,t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}_${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}function I(n,a,s){setTimeout((()=>{n.FilteredReportHeadAIHistoryList.forEach(((r,c)=>{n.textareavalue&&(document.getElementById("chatInput").value=n.textareavalue,delete n.textareavalue);const m=document.getElementById("chatInput"),p=document.getElementById("changeSourceButton");m&&p&&(p.disabled=0===m.value.trim().length,m.addEventListener("input",(()=>{m.value.trim().length>0?p.disabled=!1:p.disabled=!0}))),document.getElementById(`copyPrompt-${c}`)?.addEventListener("click",(()=>i(r.Prompt))),document.getElementById(`savePrompt-${c}`)&&document.getElementById(`savePrompt-${c}`)?.addEventListener("click",(()=>{const e=document.getElementById("confirmation-popup");e&&(e.innerHTML=function(){const e="Dark"===Q;return`\n<div class="modal show d-block" tabindex="-1">\n  <div class="modal-dialog">\n    <div class="modal-content ${e?"bg-dark text-light":"bg-light text-dark"}">\n      <div class="modal-header border-0">\n        <h5 class="fw-bold">Confirmation</h5>\n      </div>\n\n      <div class="modal-body">\n        <p>Do you want to save the current prompt as a global default?</p>\n      </div>\n\n      <div class="modal-footer border-0">\n        <button type="button" class="btn btn-link ${e?"text-info":"text-primary"}" id="confirmation-popup-cancel">Cancel</button>\n        <button type="button" class="btn btn-primary text-white" id="confirmation-popup-confirm">Ok</button>\n      </div>\n    </div>\n  </div>\n</div>`}(),setTimeout((()=>{document.getElementById("confirmation-popup-cancel")?.addEventListener("click",(()=>{e.innerHTML=""})),document.getElementById("confirmation-popup-confirm")?.addEventListener("click",(async()=>{try{document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","true"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","true");let s=JSON.parse(JSON.stringify(n));s.Prompt=r.Prompt,(await t(s,a)).Status?(o("Updated Succesfully","success"),e.innerHTML=""):(document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),o("Something went wrong","error"))}catch(e){document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),o("Something went wrong","error")}}))}),0))})),document.getElementById(`openRefferance-${c}`)&&document.getElementById(`openRefferance-${c}`)?.addEventListener("click",(()=>{const e=document.getElementById("confirmation-popup");if(e){const s=r.SourceValue.map((e=>T.find((t=>Number(e)===t.VectorID)))).filter((e=>!!e)),l={Data:r.Evidences,Name:n.DisplayName,UserValue:r.Response,Sources:s};e.innerHTML=function(e){const t="Dark"===Q;return`\n<div class="modal show d-block" tabindex="-1">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content p-2 ${t?"bg-dark text-light":"bg-light text-dark"}">\n      <div class="modal-header flex-column align-items-start border-0">\n        <span class="fw-bold mb-3">${e?.Name||""}</span>\n        <span class="d-block list-height">${e?.UserValue||""}</span>\n        ${e?.Sources?`\n        <hr class="${t?"border-light":"border-dark"}">\n        <div class="d-flex align-items-start flex-wrap">\n          <span class="fw-bold me-2">Selected Sources :</span>\n          <div class="d-flex flex-wrap gap-1">\n            ${e.Sources.map((e=>`\n              <span class="badge ${t?"text-bg-secondary":"text-bg-info"}">${e.FileName}</span>\n            `)).join("")}\n          </div>\n        </div>`:""}\n      </div>\n\n      <div class="modal-body p-3 add-ai-gen">\n        <div class="row g-2 list-height">\n          ${e?.Data?.map((e=>`\n            <div class="col-md-12 mt-3">\n              <div class="border rounded p-2 ${t?"bg-secondary text-light":"bg-light text-dark"} shadow-sm h-100">\n                <div class="fw-bold small text-truncate" title="${e.FileName}">\n                  ${e.FileName}\n                </div>\n                <div class="text-muted small mb-1">Page: ${e.PageNumber}</div>\n                <div class="small" style="white-space: normal;">\n                  ${e.Sentence}\n                </div>\n              </div>\n            </div>\n          `)).join("")}\n        </div>\n\n        <div class="d-flex w-100 justify-content-end mt-3 align-items-center">\n          <button type="button" class="btn btn-primary text-white" id="datamodel-popup-ok">OK</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>`}(l),setTimeout((()=>{document.getElementById("confirmation-popup-cancel")?.addEventListener("click",(()=>{e.innerHTML=""})),document.getElementById("confirmation-popup-confirm")?.addEventListener("click",(async()=>{try{document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","true"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","true");let s=JSON.parse(JSON.stringify(n));s.Prompt=r.Prompt,(await t(s,a)).Status?(o("Updated Succesfully","success"),e.innerHTML=""):(document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),o("Something went wrong","error"))}catch(e){document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),o("Something went wrong","error")}})),document.getElementById("datamodel-popup-ok")?.addEventListener("click",(async()=>{e.innerHTML=""}))}),0)}})),document.getElementById(`copyResponse-${c}`)?.addEventListener("click",(()=>i(r.Response))),document.getElementById("close-btn-tag")?.addEventListener("click",(()=>v(s)));const f=document.getElementById(`checkbox-${c}`);f&&f.addEventListener("change",(async t=>{const o=t.target.checked;if(n.FilteredReportHeadAIHistoryList.forEach(((e,t)=>{const o=document.getElementById(`checkbox-${t}`),a=document.getElementById(`responseContainer-${t}`);o&&(o.checked=!1),a&&(a.classList.remove("ai-selected-response"),a.classList.add("bg-light")),n.FilteredReportHeadAIHistoryList[t].Selected=0})),o){f.checked=!0;const e=document.getElementById(`responseContainer-${c}`);e&&(e.classList.add("ai-selected-response"),e.classList.remove("bg-light")),r.Selected=1}else r.Selected=0;try{const t=await async function(t,n){const o=await fetch(`${e}/api/report/ai-history/update`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(r,a);if(t.Data){n.ReportHeadAIHistoryList=JSON.parse(JSON.stringify(t.Data)),n.FilteredReportHeadAIHistoryList=[],n.ReportHeadAIHistoryList.forEach((e=>{e.Response=l(e.Response),n.FilteredReportHeadAIHistoryList.unshift(e)}));const e=r.FormattedResponse?"\n"+d(r.FormattedResponse):r.Response;n.ComponentKeyDataType=r.FormattedResponse?"TABLE":"TEXT",n.UserValue=e,n.EditorValue=e,n.text=e;const o=n.FilteredReportHeadAIHistoryList.some((e=>1===e.Selected));n.IsApplied=!o,s.forEach((e=>{if(e.ID===n.ID){const t=""!==r.FormattedResponse,o=r.FormattedResponse?"\n"+d(r.FormattedResponse):r.Response;e.ComponentKeyDataType=t?"TABLE":"TEXT",e.UserValue=o,e.EditorValue=o,e.text=o,e.IsApplied=n.IsApplied}})),H.forEach((e=>{if(e.ID===n.ID){const t=""!==r.FormattedResponse,o=r.FormattedResponse?"\n"+d(r.FormattedResponse):r.Response;e.ComponentKeyDataType=t?"TABLE":"TEXT",e.UserValue=o,e.EditorValue=o,e.text=o,e.IsApplied=n.IsApplied}}))}}catch(e){console.error("Failed to update AI history:",e)}}))})),document.getElementById("insertTagButton")?.addEventListener("click",(()=>{n.IsApplied||async function(e){Word.run((async t=>{try{const n=t.document.getSelection();if(await t.sync(),!n)throw new Error("Invalid selection");const a=n.insertText("​",Word.InsertLocation.replace);await t.sync();let s=a.getRange(),l=null,i=null;const c=e=>{l||(l=e.getRange("Start")),i=e.getRange("End")};if("TABLE"===e.ComponentKeyDataType){const n=(new DOMParser).parseFromString(e.EditorValue,"text/html"),o=Array.from(n.body.childNodes);for(const e of o)if(e.nodeType===Node.TEXT_NODE){let t=e.textContent?.trim();if(!t)continue;t=t.replace(/\n- /g,"\n• ");for(const e of t.split("\n")){if(!e.trim())continue;const t=s.insertParagraph("",Word.InsertLocation.after);r(t,e),c(t.getRange()),s=t.getRange()}}else if(e.nodeType===Node.ELEMENT_NODE){const n=e;if("table"===n.tagName.toLowerCase()){const e=Array.from(n.querySelectorAll("tr"));if(!e.length)continue;const o=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1")),0)))),a=s.insertParagraph("",Word.InsertLocation.after).insertTable(e.length,o,Word.InsertLocation.after);a.style=Z,ee.Customize&&await b(a,e,t),c(a.getRange()),s=a.getRange()}else{let e=n.innerText?.trim();if(!e)continue;e=e.replace(/\n- /g,"\n• ");for(const t of e.split("\n")){if(!t.trim())continue;const e=s.insertParagraph("",Word.InsertLocation.after);r(e,t),c(e.getRange()),s=e.getRange()}}}}else{const t=e.EditorValue.replace(/\n- /g,"\n• ").trim();for(const e of t.split("\n")){if(!e.trim())continue;const t=s.insertParagraph("",Word.InsertLocation.after);r(t,e),c(t.getRange()),s=t.getRange()}}if(await t.sync(),l&&i){const t=`ID${e.ID}_Split_${k()}`;l.expandTo(i).insertBookmark(t)}a.delete(),await t.sync(),o("Inserted successfully","success")}catch(e){console.error(e),o("Something went wrong","error")}}))}(n)})),document.getElementById("sendPromptButton")?.addEventListener("click",(()=>{const e=document.getElementById("chatInput").value;fe(n,e)})),document.getElementById("changeSourceButton")?.addEventListener("click",(()=>{const e=document.getElementById("chatInput").value;n.textareavalue=e,Ie(n)})),Ee("chatInput","mention-dropdown","edit")}),0)}let T,C,L="",S={},A="https://akhil-pws.github.io/ApplyGlossaryWordPane",B="",D="",H=[],$=[],N=!0,R=[],F=[],P="",M=!1,O="",W=[],G=[],j=!1,V={},z=!1,q=!1,U="0",K=0,_=[],J=(new Date).getFullYear(),X=[],Y=!1,Q="Light",Z="Plain Table 5",ee={Header:"#FFFFFF",Primary:"#FFFFFF",Secondary:"#FFFFFF",Customize:!0,IsHeaderBold:!0,IsSideHeaderBold:!1},te=[];async function ne(){const e=sessionStorage.getItem("token");if(e){S=JSON.parse(sessionStorage.getItem("userRole"))||"",L=e,window.location.hash="#/dashboard";const t=sessionStorage.getItem("tableStyle");t&&(Z=t);const n=sessionStorage.getItem("colorPallete");n&&(ee=JSON.parse(n))}else oe()}function oe(){document.getElementById("logo-header").innerHTML=`\n  <img id="main-logo" src="${A}/assets/logo.png" alt="" class="logo">\n  <div class="icon-nav me-3">\n    <span id="theme-toggle"><i class="fa fa-moon c-pointer me-3"  title="Toggle Theme"></i><span>\n  </div>\n`,document.getElementById("app-body").innerHTML='\n    <div class="container pt-2">\n      <form id="login-form" class="p-4 border rounded">\n        <div class="mb-3">\n          <label for="organization" class="form-label fw-bold">Organization</label>\n          <input type="text" class="form-control" id="organization" required>\n        </div>\n        <div class="mb-3">\n          <label for="username" class="form-label fw-bold">Username</label>\n          <input type="text" class="form-control" id="username" required>\n        </div>\n        <div class="mb-3">\n          <label for="password" class="form-label fw-bold">Password</label>\n          <input type="password" class="form-control" id="password" required>\n        </div>\n        <div class="d-grid">\n          <button type="submit" class="btn btn-primary bg-primary-clr">Login</button>\n        </div>\n      <div id="login-error" class="mt-3 text-danger" style="display: none;"></div>\n\n      </form>\n    </div>\n  ',document.getElementById("theme-toggle").addEventListener("click",(()=>{Q="Light"===Q?"Dark":"Light",u(Q),document.body.classList.toggle("dark-theme","Dark"===Q),document.body.classList.toggle("light-theme","Light"===Q),g()})),document.getElementById("login-form").addEventListener("submit",ae)}async function ae(t){t.preventDefault();const n=document.getElementById("organization").value,a=document.getElementById("username").value,r=document.getElementById("password").value;if(n.toLowerCase().trim()===D.toLocaleLowerCase().trim()){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n          </div\n';try{const t=await async function(t,n,o){const a=await fetch(`${e}/api/user/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ClientName:t,Username:n,Password:o})});if(!a.ok)throw new Error("Network response was not ok");return await a.json()}(n,a,r);if(!0===t.Status&&t.Data)if(t.Data.ResponseStatus){L=t.Data.Token;const e=sessionStorage.getItem("tableStyle");e&&(Z=e);const n=sessionStorage.getItem("colorPallete");n&&(ee=JSON.parse(n)),S=t.Data.UserRole,sessionStorage.setItem("userRole",JSON.stringify(t.Data.UserRole)),sessionStorage.setItem("token",L),sessionStorage.setItem("userId",t.Data.ID),o("You are successfully logged in","success"),window.location.hash="#/dashboard"}else re("An error occurred during login. Please try again.");else re("An error occurred during login. Please try again.")}catch(e){re("An error occurred during login. Please try again."),console.error("Error during login:",e)}}else re("The organization specified is not associated with this document")}function re(e){oe();const t=document.getElementById("login-error");t.style.display="block",t.textContent=e}async function se(t){try{const t=await async function(t,n){const o=await fetch(`${e}/api/report/id/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(B,L);document.getElementById("app-body").innerHTML="",document.getElementById("logo-header").innerHTML=function(e){return`\n    <img id="main-logo" src="${e}/assets/logo.png" alt="" class="logo">\n    <div class="icon-nav me-3">\n      <i class="fa fa-home c-pointer me-3" title="Home" id="home"></i>\n      <div class="dropdown d-inline">\n        <i class="fa fa-tools c-pointer me-3" id="settingsDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Settings"></i>\n        <ul class="dropdown-menu" aria-labelledby="settingsDropdown">\n        <li>\n        <li>\n            <a class="dropdown-item" href="#" id="define-formatting">\n              <i class="fa fa-sliders-h me-2" aria-hidden="true"></i> Define Formatting\n            </a>\n          </li>\n          <li>\n            <a class="dropdown-item disabled-link" href="#" id="glossary" tabindex="-1" aria-disabled="true">\n              <i class="fa fa-book me-2" aria-hidden="true"></i> Apply Glossary\n            </a>\n          </li>\n          <li>\n            <a class="dropdown-item disabled-link" href="#" id="removeFormatting" tabindex="-1" aria-disabled="true">\n              <i class="fa fa-eraser me-2" aria-hidden="true"></i> Remove Formatting\n            </a>\n          </li>\n        </ul>\n      </div>\n\n      \x3c!-- Theme Toggle Icon --\x3e\n      <span id="theme-toggle"><i class="fa ${"Dark"===Q?"fa-sun":"fa-moon"} c-pointer me-3" title="Toggle Theme"></i></span>\n\n      <i class="fa fa-sign-out c-pointer me-3" id="logout" title="Logout"></i>\n    </div>    \n  `}(A),G=t.Data;const n=sessionStorage.getItem("tableStyle");Z=n||"Plain Table 5";const a=sessionStorage.getItem("colorPallete");ee=a?JSON.parse(a):{Header:"#FFFFFF",Primary:"#FFFFFF",Secondary:"#FFFFFF",Customize:!0,IsHeaderBold:!0,IsSideHeaderBold:!1},async function(){const t=await async function(t){const n=await fetch(`${e}/api/custom-table/all`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(L);te=t.Data;const n=te.find((e=>e.ID===G.TableCustomizationID));n&&(sessionStorage.setItem("CustomStyle",n?n.Name:""),ee={Header:n.Setting.HeaderColor,Primary:n.Setting.PrimaryColor,Secondary:n.Setting.SecondaryColor,Customize:!0,IsHeaderBold:n.Setting.IsHeaderBold,IsSideHeaderBold:n.Setting.IsSideHeaderBold},Z=n.Setting.BaseStyle)}(),T=G?.SourceTypeList?.filter((e=>""!==e.SourceValue&&1===e.AIFlag)).map((e=>({...e,SourceName:decodeURIComponent(ke(e.SourceValue))}))),U=G.ClientID;const r=t.Data.Group.find((e=>"AIGroup"===e.DisplayName));O=r?r.Name:"",H=r?r.GroupKey:[],async function(){const t=await async function(t){const n=await fetch(`${e}/api/image/general`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(L),n=G.ID;let a=h((await async function(t,n){const o=await fetch(`${e}/api/image/report-head/${t}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(n,L)).Data),r=h(t.Data);G.GroupKeyAll.push(...r),G.GroupKeyAll.push(...a),R.push(...r),R.push(...a),$=G.GroupKeyAll.filter((e=>"IMAGE"===e.ComponentKeyDataType));const s=document.getElementById("search-box"),l=document.getElementById("suggestion-list");if(!s||!l)return;function i(){const e=s.value.trim().toLowerCase();if(l.replaceChildren(),""===e)return void(l.innerHTML="");const t=R.filter((t=>t.DisplayName.toLowerCase().includes(e))),n=t.filter((e=>0===e.AIFlag)),o=t.filter((e=>1===e.AIFlag)),a=n.filter((e=>"TEXT"===e.ComponentKeyDataType)),r=n.filter((e=>"IMAGE"===e.ComponentKeyDataType&&e.IsImage)),i=(e,t,n=!1,o=!1)=>{if(0===t.length)return;const a="Dark"===Q?{itemClass:"bg-dark text-light list-hover-dark",labelClass:"bg-dark text-light"}:{itemClass:"bg-light text-dark list-hover-light",labelClass:"bg-light text-dark"},r=document.createElement("li");r.className=`list-group-item fw-bold text-secondary ${a.labelClass}`,r.textContent=e,l.appendChild(r),t.forEach((e=>{const t=document.createElement("li");t.className=`list-group-item list-group-item-action ${a.itemClass}`;let r='<i class="fa-solid fa-layer-group text-muted me-2"></i>';n&&(r='<i class="fa-solid fa-microchip-ai text-muted me-2"></i>'),o&&(r='<i class="fa-solid fa-image text-muted me-2"></i>'),t.innerHTML=`${r} ${e.DisplayName}`,t.onclick=()=>{if(n){const t=document.getElementById("app-body");t.innerHTML='<div class="text-muted p-2">Loading...</div>',x(e).catch((()=>t.innerHTML='<div class="text-danger p-2">Error loading data</div>')).then((e=>{t.innerHTML=e}))}else E(e,e.ComponentKeyDataType),l.replaceChildren()},l.appendChild(t)}))};i("Properties",a),i("AI Tags",o,!0),i("Images",r,!1,!0)}if(X.length>0){const e=document.getElementById("tags-in-selected-text");e.classList.remove("d-none"),e.classList.add("d-block"),f(X,R)}let c;s.addEventListener("input",(()=>{clearTimeout(c),c=setTimeout(i,300)})),$&&$.length>0&&o("Images are loaded and ready for use","success")}(),R=t.Data.GroupKeyAll.filter((e=>"TABLE"===e.ComponentKeyDataType||"TEXT"===e.ComponentKeyDataType||"TEXT"===e.ComponentKeyDataType)),R.forEach((e=>{if(1===e.AIFlag){let t;(t=null!==/<TableStart>([\s\S]*?)<TableEnd>/gi.exec(e.EditorValue))&&(e.EditorValue=d(e.EditorValue),e.UserValue=e.EditorValue,e.InitialTable=!0,e.ComponentKeyDataType="TABLE")}})),H.forEach(((e,t)=>{let n;(n=null!==/<TableStart>([\s\S]*?)<TableEnd>/gi.exec(e.EditorValue))&&(e.EditorValue=d(e.EditorValue),e.UserValue=e.EditorValue,e.InitialTable=!0,e.ComponentKeyDataType="TABLE")})),async function(){try{const t=sessionStorage.getItem("userId")||"",n=await async function(t,n){const o=await fetch(`${e}/api/client/all/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(t,L);n.Status&&n.Data?_=n.Data:console.warn("Failed to load clients or no clients found.")}catch(e){}}(),async function(){try{const t=await async function(t){const n=await fetch(`${e}/api/prompt-template/all`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(L);t.Status&&t.Data&&(F=t.Data)}catch(e){console.error("Error fetching prompt templates:",e)}}(),v(R),document.getElementById("home").addEventListener("click",(async()=>{Y||(M&&await he(),v(R))})),document.getElementById("glossary").addEventListener("click",(()=>{z&&async function(){j||(document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n\n        <div id="highlighted-text"></div>',ge())}()})),document.getElementById("define-formatting").addEventListener("click",(()=>{Y||le()})),document.getElementById("removeFormatting").addEventListener("click",(()=>{Object.keys(V).length>0&&async function(){if(!j){M&&await he();const e='\n      <div class="container pt-3">\n        <div class="card">\n          <div class="card-header">\n            <h5 class="card-title">Are you sure you want to remove formatted text ?</h5>\n          </div>\n          <div class="card-body">\n          <div id="format-details">\n              <h5>Selected Formatting:</h5>\n              <ul id="format-list" class="list-unstyled mb-3"></ul>\n              <small class="text-secondary font-italic" id="warning-rem-fmt"></small>\n             \n            </div>\n               \x3c!-- Buttons for Capture and Empty Format --\x3e\n\n            <div class="mt-3 d-flex justify-content-between">\n              <span id="change-ft-btn" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n              <button id="clear-ft-btn" class="btn btn-primary px-3"><i class="fa fa-check-circle me-2"></i>Yes</button>\n\n            </div>\n\n            \n          </div>\n        </div>\n      </div>\n    ';document.getElementById("app-body").innerHTML=e,ie(),null===V["Background Color"]&&"#000000"===V["Text Color"]&&(document.getElementById("warning-rem-fmt").innerHTML="Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?"),document.getElementById("clear-ft-btn").addEventListener("click",me),document.getElementById("change-ft-btn").addEventListener("click",le)}}()})),document.getElementById("theme-toggle").addEventListener("click",(()=>{Q="Light"===Q?"Dark":"Light",u(Q),document.body.classList.toggle("dark-theme","Dark"===Q),document.body.classList.toggle("light-theme","Light"===Q),g()})),document.getElementById("logout").addEventListener("click",(async()=>{Y||(M&&await he(),async function(){M&&await he(),sessionStorage.clear(),window.location.hash="#/new",N=!0,document.getElementById("logo-header").innerHTML="",ne()}())}))}catch(e){console.error("Error fetching glossary data:",e)}}async function le(){if(!j){M&&await he();const e='\n      <div class="container pt-3">\n        <div class="card">\n          <div class="card-header">\n               \x3c!-- Buttons for Capture and Empty Format --\x3e\n            <div class="d-flex justify-content-end">\n              <button id="capture-format-btn" class="btn btn-primary bg-primary-clr"><i class="fa fa-border-style me-1"></i>  Capture Format</button>\n            </div>\n            \x3c!-- <h5 class="card-title">Formatting Options</h5> --\x3e\n          </div>\n          <div class="card-body">\n          <div class="formating-checkbox">\n               <input type="checkbox" id="empty-format-checkbox" class="form-check-input">\n              <label for="empty-format-checkbox" class="form-check-label empty-format-checkbox-label" style="flex: 1;">\n                   Skip ignoring and removing format-based text\n              </label>\n            </div>\n\n            \x3c!-- Section to display captured formatting --\x3e\n            <div id="format-details">\n              <h5 class="my-3">Selected Formatting:</h5>\n              <ul id="format-list" class="list-unstyled"></ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';document.getElementById("app-body").innerHTML=e,0===Object.keys(V).length&&(document.getElementById("format-details").style.display="none");const t=document.getElementById("glossary");if(t.classList.contains("disabled-link")||t.classList.add("disabled-link"),z)ce();else if(null===V.Bold||void 0===V.Bold||"Mixed"===V.Underline||void 0===V.Underline||null===V.Size||void 0===V.Size||null===V["Font Name"]||void 0===V["Font Name"]||""===V["Background Color"]||void 0===V["Background Color"]||""===V["Text Color"]||void 0===V["Text Color"]){document.getElementById("format-list").innerHTML="<p>Multiple style values found. Try again</p>";const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}else document.getElementById("removeFormatting").classList.remove("disabled-link"),ie();document.getElementById("capture-format-btn").addEventListener("click",de);const n=document.getElementById("empty-format-checkbox");q&&(n.checked=!0,ce()),n.addEventListener("change",(()=>{if(n.checked)q=!0,ce();else{document.getElementById("capture-format-btn").disabled=!1,q=!1,z=!1;const e=document.getElementById("glossary");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}}))}}function ie(){z=!1;const e=document.getElementById("format-list");e.innerHTML="";for(const[t,n]of Object.entries(V))e.innerHTML+="Text Color"!==t&&"Background Color"!==t||!n?`<li><strong>${t}:</strong> ${n}</li>`:`\n        <li><strong>${t}:</strong>${n}\n          <span style="display:inline-block;width:15px;height:15px;background-color:${n};border:1px solid black;"></span>\n        </li>\n      `}function ce(){V={},document.getElementById("format-details").style.display="none",z=!0,document.getElementById("glossary").classList.remove("disabled-link"),document.getElementById("capture-format-btn").disabled=!0;const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link"),console.log("Captured formatting cleared.")}async function de(){try{await Word.run((async e=>{const t=e.document.getSelection().font;if(t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),V={Bold:t.bold,Italic:t.italic,Underline:t.underline,Size:t.size,"Background Color":t.highlightColor,"Font Name":t.name,"Text Color":t.color},document.getElementById("format-details").style.display="block",null===V.Bold||"Mixed"===V.Underline||null===V.Size||null===V["Font Name"]||""===V["Background Color"]||""===V["Text Color"]){document.getElementById("format-list").innerHTML="<p>Multiple style values found. Try again</p>";const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}else document.getElementById("removeFormatting").classList.remove("disabled-link"),ie()}))}catch(e){console.error("Error capturing formatting:",e)}}async function me(){try{await Word.run((async e=>{document.getElementById("clear-ft-btn").innerHTML='<i class="fa fa-spinner fa-spin text-white me-2"></i>Yes',document.getElementById("clear-ft-btn").disabled=!0,document.getElementById("change-ft-btn").disabled=!0;const t=e.document.body.paragraphs;t.load("items"),await e.sync();for(const n of t.items)if(""!==n.text.trim()){const t=n.split([" "]);t.load("items, font"),await e.sync();for(const o of t.items){const t=o.font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),t.highlightColor===V["Background Color"]&&t.color===V["Text Color"]&&t.bold===V.Bold&&t.italic===V.Italic&&t.size===V.Size&&t.underline===V.Underline&&t.name===V["Font Name"]&&(t.highlightColor="#FFFFFF",t.color="#000000",t.bold=!1,t.italic=!1,t.underline="None",n.insertText(" ",Word.InsertLocation.replace))}}await e.sync(),V={},document.getElementById("format-details").style.display="none",z=!0,q=!0,document.getElementById("glossary").classList.remove("disabled-link"),le()}))}catch(e){console.error("Error removing formatted text:",e)}}async function pe(t){try{const n=await async function(t,n){const o=await fetch(`${e}/api/report/ai-history/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(t.ID,L);if(n.Status&&n.Data){t.ReportHeadAIHistoryList=n.Data||[],t.FilteredReportHeadAIHistoryList=[],t.SourceValueID=t.ReportHeadAIHistoryList[0].SourceValue;const e=T.filter((e=>t.SourceValueID.includes(String(e.VectorID))));return t.SourceName=e.map((e=>e.SourceName)),t.Sources=t.SourceName.join(","),t.TempSourceValue=e.map((e=>e.VectorID?String(e.VectorID):e.SourceValue)),t.ReportHeadAIHistoryList.forEach(((e,n)=>{e.Response=xe(e.Response),t.FilteredReportHeadAIHistoryList.unshift(e)})),t.FilteredReportHeadAIHistoryList}console.warn("No AI history available.")}catch(e){return console.error("Error fetching AI history:",e),[]}}async function fe(t,n){if(""===n||j)console.error("No empty prompt allowed");else{j=!0;const o=document.getElementById("sendPromptButton");o.innerHTML='<i class="fa fa-spinner fa-spin text-white"></i>';const a={ReportHeadID:t.FilteredReportHeadAIHistoryList[0].ReportHeadID,DocumentID:G.NCTID,DocumentType:G.DocumentType,TextSetting:G.TextSetting,DocumentTemplate:G.ReportTemplate,ReportHeadGroupKeyID:t.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,ThreadID:t.ThreadID,AssistantID:G.AssistantID,Container:G.Container,GroupName:O,Prompt:n,PromptType:1,Response:"",VectorID:G.VectorID,Selected:0,ID:0,SourceValue:t.TempSourceValue?t.TempSourceValue:[]};try{Y=!0;const n=await async function(t,n){const o=await fetch(`${e}/api/report/ai-history/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(a,L);if(n.Data&&"false"!==n.Data){t.ReportHeadAIHistoryList=JSON.parse(JSON.stringify(n.Data)),t.FilteredReportHeadAIHistoryList=[],t.ReportHeadAIHistoryList.forEach((e=>{e.Response=xe(e.Response),t.FilteredReportHeadAIHistoryList.unshift(e)}));const e=t.ReportHeadAIHistoryList[0];H.forEach((n=>{if(n.ID===t.ID){const o=""!==e.FormattedResponse,a=e.FormattedResponse?"\n"+d(e.FormattedResponse):e.Response;n.ComponentKeyDataType=o?"TABLE":"TEXT",n.UserValue=a,n.EditorValue=a,n.text=a,n.IsApplied=t.IsApplied}})),R.forEach((n=>{if(n.ID===t.ID){const o=""!==e.FormattedResponse,a=e.FormattedResponse?"\n"+d(e.FormattedResponse):e.Response;n.ComponentKeyDataType=o?"TABLE":"TEXT",n.UserValue=a,n.EditorValue=a,n.text=a,n.IsApplied=t.IsApplied}})),document.getElementById("app-body").innerHTML=await x(t),Y=!1}o.innerHTML='<i class="fa fa-paper-plane text-white"></i>',document.getElementById("chatInput").value="",j=!1,Y=!1}catch(e){o.innerHTML='<i class="fa fa-paper-plane text-white"></i>',j=!1,Y=!1,console.error("Error sending AI prompt:",e)}}}async function ue(){return Word.run((async e=>{try{const t=e.document.body;e.load(t,"text"),await e.sync(),await async function(e,t){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n    <div class="loader" id="loader"></div>\n    <div id="highlighted-text"></div>\n  </div>',o("Please wait... applying AI tags","info");for(const n of H){if(n.EditorValue=xe(n.EditorValue),!n.EditorValue||n.IsApplied)continue;const o=e.search(`#${n.DisplayName}#`,{matchCase:!1,matchWholeWord:!1});t.load(o,"items"),await t.sync();for(const e of o.items){const o=e.getRange("Start");e.delete(),await t.sync();let a=o,s=null,l=null;const i=e=>{s||(s=e.getRange("Start")),l=e.getRange("End")};if("TABLE"===n.ComponentKeyDataType){const e=(new DOMParser).parseFromString(n.EditorValue,"text/html"),o=Array.from(e.body.childNodes);for(const e of o)if(e.nodeType===Node.TEXT_NODE){let t=e.textContent?.trim();if(!t)continue;t=t.replace(/\n- /g,"\n• ");for(const e of t.split("\n")){if(!e.trim())continue;const t=a.insertParagraph("",Word.InsertLocation.after);r(t,e),i(t.getRange()),a=t.getRange()}}else if(e.nodeType===Node.ELEMENT_NODE){const n=e;if("table"===n.tagName.toLowerCase()){const e=Array.from(n.querySelectorAll("tr"));if(!e.length)continue;const o=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),r=a.insertParagraph("",Word.InsertLocation.after).insertTable(e.length,o,Word.InsertLocation.after);r.style=Z,ee.Customize&&await b(r,e,t),i(r.getRange()),a=r.getRange()}else{let e=n.innerText?.trim();if(!e)continue;e=e.replace(/\n- /g,"\n• ");for(const t of e.split("\n")){if(!t.trim())continue;const e=a.insertParagraph("",Word.InsertLocation.after);r(e,t),i(e.getRange()),a=e.getRange()}}}}else if("IMAGE"===n.ComponentKeyDataType){let e=n.EditorValue;e.startsWith("data:image/svg+xml")?e=await w(e):e.startsWith("data:image")&&(e=e.split(",")[1]);const t=a.insertInlinePictureFromBase64(e,Word.InsertLocation.after);i(t.getRange()),a=t.getRange()}else{const e=n.EditorValue.replace(/\n- /g,"\n• ").trim();for(const t of e.split("\n")){if(!t.trim())continue;const e=a.insertParagraph("",Word.InsertLocation.after);r(e,t),i(e.getRange()),a=e.getRange()}}if(await t.sync(),s&&l){const e=`ID${n.ID}_Split_${k()}`;s.expandTo(l).insertBookmark(e)}}}0===$.length&&v(R),o("AI tag application completed!","success")}(t,e),await async function(e,t){for(let n=0;n<$.length;n++){const o=$[n],a=e.search(`$${o.DisplayName}$`,{matchCase:!1,matchWholeWord:!1});t.load(a,"items"),await t.sync();for(const e of a.items)if(""!==o.EditorValue){let n=o.EditorValue;if(!n)continue;n.startsWith("data:image/svg+xml")?n=await w(n):n.startsWith("data:image")&&(n=n.split(",")[1]),e.getRange().insertInlinePictureFromBase64(n,Word.InsertLocation.replace),await t.sync()}}await t.sync(),o("AI tag application completed!","success"),v(R)}(t,e)}catch(e){o("Something went wrong","error"),console.error("Error during tag application:",e),v(R)}}))}function ge(){document.getElementById("app-body").innerHTML='\n        <div id="button-container">\n          <button class="btn btn-secondary me-2 mark-glossary btn-sm" id="applyglossary">Apply Glossary</button>\n        </div>\n  ',document.getElementById("applyglossary").addEventListener("click",ye)}async function ye(){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n\n        <div id="highlighted-text"></div>';try{await Word.run((async t=>{const n=t.document.body;n.load("text"),await t.sync();const o={Content:n.text.replace(/[\n\r]/g," ")};try{const t=await async function(t,n,o){const a=await fetch(`${e}/api/glossary-template/client-id/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(n)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(G?.ClientID,o,L);W=t.Data,t.Data.length>0?(P=t.Data[0].GlossaryTemplate,ge()):document.getElementById("app-body").innerHTML='\n            <p class="text-center">Data not available</p>\n          '}catch(e){console.error("Error fetching glossary data:",e)}W.sort(((e,t)=>t.ClinicalTerm.length-e.ClinicalTerm.length));const a=new Set,r=W.filter((e=>{for(const t of a)if("string"==typeof t&&t.includes(e.ClinicalTerm.toLowerCase()))return console.log(`Skipping "${e.ClinicalTerm}" because it's part of "${t}"`),!1;return a.add(e.ClinicalTerm.toLowerCase()),!0}));C=r,await he();const s=new Map,l=C.map((e=>{const t=n.search(e.ClinicalTerm,{matchCase:!1,matchWholeWord:!1});return t.load("items"),t}));await t.sync();for(const e of l)for(const n of e.items){if(!n||!n.text){console.log("Invalid range. Skipping...");continue}const e=n.font;if(e.load(["bold","italic","underline","size","highlightColor","name","color"]),n.load("contentControls"),await t.sync(),n.contentControls.items.length>0)console.log(`Skipping "${n.text}" because it already has a content control.`);else if(s.has(n.text))console.log(`Skipping duplicate occurrence of "${n.text}"`);else{if(s.set(n.text,!0),n.contentControls&&n.contentControls.items.length>0){console.log(`Removing existing content control from: "${n.text}"`);for(const e of n.contentControls.items)e.delete(!1);await t.sync()}try{const o=n.insertContentControl();o.title=`${n.text}`,null!==e.highlightColor&&(o.tag=`${e.highlightColor}`),o.font.highlightColor="yellow",o.appearance=Word.ContentControlAppearance.boundingBox,await t.sync()}catch(e){console.error(`Error inserting content control for term "${n.text}":`,e)}}}M=!0,document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <button class="btn btn-secondary me-2 clear-glossary btn-sm" id="clearGlossary">Clear Glossary</button>\n      </div>\n\n      <div id="highlighted-text"></div>\n      <div class="d-flex justify-content-center box-loader">\n       <div class="loader" id="loader"></div></div>\n      \n',document.getElementById("loader").style.display="none",await t.sync(),document.getElementById("clearGlossary").addEventListener("click",he),Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,be)})),console.log("Glossary applied successfully")}catch(e){console.error("Error applying glossary:",e),console.log("Error applying glossary. Please try again.")}}async function be(){await async function(){try{await Word.run((async e=>{const t=e.document.getSelection();if(t.load("text, font.highlightColor"),await e.sync(),t.text){const n=document.getElementById("loader");n&&(n.style.display="block");const o=W.map((e=>{const n=t.search(e.ClinicalTerm,{matchCase:!1,matchWholeWord:!1});return n.load("items"),n}));await e.sync();const a=[];for(const t of o)for(const n of t.items){const t=n.font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),t.highlightColor===V["Background Color"]&&t.color===V["Text Color"]&&t.bold===V.Bold&&t.italic===V.Italic&&t.size===V.Size&&t.underline===V.Underline&&t.name===V["Font Name"]||a.push(n.text)}!function(e){const t=document.getElementById("highlighted-text");if(t){t.innerHTML="";const n=document.getElementById("loader");n.style.display="block";const o={};e.forEach((e=>{W.forEach((t=>{t.ClinicalTerm.toLowerCase()===e.toLowerCase()&&(o[t.ClinicalTerm]||(o[t.ClinicalTerm]=[]),o[t.ClinicalTerm].includes(t.LayTerm)||o[t.ClinicalTerm].push(t.LayTerm))}))})),Object.keys(o).forEach((e=>{const n=document.createElement("div");n.className="box";const a=document.createElement("h3");a.textContent=`${e} (${P})`,n.appendChild(a),o[e].forEach((t=>{const o=document.createElement("div");o.className="sub-box",o.textContent=t,o.addEventListener("click",(async()=>{await async function(e,t){const n=document.getElementById("loader");n.style.display="block";try{await Word.run((async o=>{const a=o.document.getSelection();if(a.load("text"),await o.sync(),a.text.toLowerCase().includes(e.toLowerCase())){const r=a.search(e,{matchCase:!1,matchWholeWord:!1});r.load("items"),await o.sync();for(const e of r.items)e.font.load(["bold","italic","underline","color","highlightColor","size","name"]),await o.sync(),e.insertText(t,"replace"),e.font.bold=e.font.bold,e.font.italic=e.font.italic,e.font.underline=e.font.underline,e.font.color=e.font.color,e.font.highlightColor="#c7c7c7",e.font.size=e.font.size,e.font.name=e.font.name;await o.sync(),n.style.display="none",console.log(`Replaced '${e}' with '${t}' and preserved the original formatting.`)}else n.style.display="none",console.log(`Selected text does not contain '${e}'.`)}))}catch(e){n.style.display="none",console.error("Error replacing term:",e)}}(e,t),n.remove()})),n.appendChild(o)})),t.appendChild(n)})),n.style.display="none"}}(a),await e.sync()}else console.log("No text is selected.")}))}catch(e){console.error("Error displaying glossary:",e)}}()}async function he(){try{await Word.run((async e=>{document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <div class="loader" id="loader"></div>\n        <div id="highlighted-text"></div>';const t=e.document.body.contentControls;if(t.load("items"),await e.sync(),0!==t.items.length){for(const n of t.items)if(n.title&&C.some((e=>e.ClinicalTerm.toLowerCase()===n.title.toLowerCase()))){const t=n.getRange();t.load("text"),await e.sync(),n.tag&&/^#[0-9A-Fa-f]{6}$/.test(n.tag)?t.font.highlightColor=n.tag:t.font.highlightColor=null,await e.sync(),n.delete(!0)}document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <button class="btn btn-secondary me-2 mark-glossary btn-sm" id="applyglossary">Apply Glossary</button>\n      </div>\n      ',await e.sync(),M=!1,document.getElementById("applyglossary").addEventListener("click",ye)}else console.log("No content controls found.")}))}catch(e){console.error("Error removing content controls:",e)}}async function we(){if(!j){M&&await he();let t=_.filter((e=>e.ID===U)),n=[...new Map(G.SourceTypeList.filter((e=>e.VectorID>0)).map((e=>[e.SourceTypeID,{Name:e.SourceType,ID:e.SourceTypeID}]))).values()].map((e=>`\n        <li class="source-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n          <div class="form-check">\n            <input class="form-check-input" type="checkbox" value="${e.ID}" id="source${e.ID}">\n            <label class="form-check-label text-prewrap" for="source${e.ID}">${e.Name}</label>\n          </div>\n        </li>`)).join(""),r=_.map((e=>{const n=t.some((t=>t.ID===e.ID));return`\n        <li class="sponsor-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n          <div class="form-check">\n            <input class="form-check-input" type="checkbox" value="${e.ID}" id="sponsor${e.ID}" ${n?"checked disabled":""}>\n            <label class="form-check-label text-prewrap" for="sponsor${e.ID}">${e.Name}</label>\n          </div>\n        </li>`})).join("");document.getElementById("app-body").innerHTML=a,document.getElementById("add-tag-body").innerHTML=function(e,t){return`<div class="modal-dialog">\n  <div class="modal-content">\n    <div class="modal-body p-3 pt-0">\n      <form id="genai-form" autocomplete="off" novalidate>\n        \x3c!-- Name Field --\x3e\n        <div class="mb-3">\n          <label for="name" class="form-label"><span class="text-danger">*</span> Name</label>\n          <input type="text" class="form-control" id="name" required>\n          <div class="invalid-feedback">Name is required.</div>\n          <div id="submition-error" class="invalid-feedback" style="display: none;"></div>\n\n        </div>\n\n        \x3c!-- Description Field --\x3e\n        <div class="mb-3">\n          <label for="description" class="form-label">Description</label>\n          <textarea class="form-control" id="description" rows="6"></textarea>\n        </div>\n\n      \n\n        <div class="mb-3">\n          <label for="source" class="form-label"><span class="text-danger">*</span> Primary Source Type</label>\n          <div class="dropdown w-100">\n            <button \n              class="btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle" \n              type="button" \n              id="sourceDropdown" \n              data-bs-toggle="dropdown" \n              aria-expanded="false" \n              >\n              <span id="sponsorDropdownLabel">Select Source</span>\n              <span class="dropdown-toggle-icon"></span>\n            </button>\n            <ul class="dropdown-menu w-100 p-2" aria-labelledby="sourceDropdown" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1);">\n              <li class="source-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n                <div class="form-check">\n                  <input class="form-check-input" type="checkbox" value="selectAll" id="sourceSelectAll">\n                  <label class="form-check-label" for="sourceSelectAll">Select All</label>\n                </div>\n              </li>\n              ${t}\n            </ul>\n          </div>\n          <div class="invalid-feedback" id="primarySourceError" style="display:none;">\n            Primary Source is required.\n          </div>\n\n        </div>\n\n        \x3c!-- Prompt Field --\x3e\n        <div class="mb-3 prompt-box">\n          <label for="prompt" class="form-label"><span class="text-danger">*</span> Prompt \n            <small class="text-secondary">(Note: Use # tag for content suggestions)</small>\n          </label>\n          <textarea class="form-control" id="prompt" rows="6"  required></textarea>\n          <div class="invalid-feedback">Prompt is required.</div>\n          <div id="mention-dropdown" class="dropdown-menu"></div>\n        </div>\n\n        \x3c!-- Save Globally Checkbox --\x3e\n        <div class="form-check mb-3">\n          <input type="checkbox" class="form-check-input" id="saveGlobally">\n          <label class="form-check-label" for="saveGlobally">Save Globally</label>\n        </div>\n\n        \x3c!-- Available to All Sponsors Checkbox --\x3e\n        <div class="form-check mb-3">\n          <input type="checkbox" class="form-check-input" id="isAvailableForAll" disabled>\n          <label class="form-check-label" for="isAvailableForAll">Available to All Sponsors</label>\n        </div>\n\n        \x3c!-- Sponsor Dropdown --\x3e\n        <div class="mb-3">\n          <label for="sponsor" class="form-label"><span class="text-danger">*</span> Sponsor</label>\n          <div class="dropdown w-100">\n            <button \n              class="btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle" \n              type="button" \n              id="sponsorDropdown" \n              data-bs-toggle="dropdown" \n              aria-expanded="false" \n              disabled>\n              <span id="sponsorDropdownLabel">Select Sponsors</span>\n              <span class="dropdown-toggle-icon"></span>\n            </button>\n            <ul class="dropdown-menu w-100 p-2" aria-labelledby="sponsorDropdown" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1);">\n              <li class="sponsor-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n                <div class="form-check">\n                  <input class="form-check-input" type="checkbox" value="selectAll" id="sponsorSelectAll">\n                  <label class="form-check-label" for="sponsorSelectAll">Select All</label>\n                </div>\n              </li>\n              ${e}\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="mt-3 d-flex justify-content-between">\n          <span id="cancel-btn-gen-ai" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n          <button type="submit" class="btn btn-primary" id="text-gen-save">Save</button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>`}(r,n),async function(t,n){let o="",a="",r=[];t.innerHTML='\n  <div class="form-group mb-3 p-3 pt-0">\n    <label class=\'form-label\'><span class="text-danger">*</span> Prompt Builder Template</label>\n    <select id="promptBuilderTemplate" class="form-control">\n      <option value="" disabled selected>Select a template</option>\n    </select>\n    <div id="templateError" class="invalid-feedback d-none">Type is required.</div>\n  </div>\n\n  <div id="fieldsContainer"></div>\n\n  <div class="form-group mb-3 p-3 pt-0" id="previewContainer" style="display: none;">\n    <label class="mb-2">Preview</label>\n    <div id="preview" class="form-control"></div>\n  </div>\n\n  <div class="d-flex justify-content-between px-3 align-items-center mt-3">\n    <span id="resetBtn" class="text-primary fw-bold" style="cursor: pointer;">Reset</span>\n    <button id="applyBtn" class="btn btn-primary text-white" disabled>Apply Prompt</button>\n  </div>\n';const s=t.querySelector("#promptBuilderTemplate"),l=t.querySelector("#applyBtn"),i=t.querySelector("#resetBtn"),d=t.querySelector("#preview"),m=t.querySelector("#fieldsContainer"),p=t.querySelector("#previewContainer"),f=t.querySelector("#templateError");function u(){const e={};r.forEach((t=>{const n=t.Label,o=`#${n}#`;let a="";const r=document.getElementById(n);r&&(a=r instanceof HTMLInputElement||r instanceof HTMLSelectElement?r.value:""),e[o]=a||o}));let t=a;for(const[n,o]of Object.entries(e))t=t.replace(new RegExp(n,"g"),o);o=t,d.textContent=o,p.style.display=o?"block":"none",l.disabled=""===o}n.forEach((e=>{const t=document.createElement("option");t.value=e.ID.toString(),t.textContent=e.Name,s.appendChild(t)})),s.addEventListener("change",(async()=>{const t=s.value,l=sessionStorage.getItem("token")||"",i=await async function(t,n){const o=await fetch(`${e}/api/prompt-template/${t}/data`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(t,l);i.Status&&i.Data&&(r=i.Data,o=n.find((e=>e.ID.toString()===t)).Template,a=n.find((e=>e.ID.toString()===t)).Template),t?(f.classList.add("d-none"),m.innerHTML="",r.forEach((e=>{const t=document.createElement("div");t.className="form-group mb-3 p-3 pt-0";const n=document.createElement("label");if(n.textContent=e.Label,t.appendChild(n),1===e.Type){const n=document.createElement("input");n.type="text",n.className="form-control",n.id=e.Label,n.addEventListener("input",u),t.appendChild(n)}else if(2===e.Type){const n=document.createElement("select");n.className="form-control",n.id=e.Label,e.PromptTemplateOptionList.forEach((e=>{const t=document.createElement("option");t.value=e.Text,t.textContent=e.Option,n.appendChild(t)})),n.addEventListener("change",u),t.appendChild(n)}m.appendChild(t)})),u()):f.classList.remove("d-none")})),i.addEventListener("click",(function(){r.forEach((e=>{const t=document.getElementById(e.Label);t&&(t instanceof HTMLInputElement?t.value="":t instanceof HTMLSelectElement&&(t.selectedIndex=0))})),d.textContent=a,o=a})),l.addEventListener("click",(function(){if(!o)return;const e=document.getElementById("prompt");e&&(e.value=o,c())}))}(document.getElementById("add-prompt-template"),F),document.getElementById("tag-tab").addEventListener("click",(()=>c())),document.getElementById("prompt-tab").addEventListener("click",(()=>(document.querySelector(".nav-link.active")?.classList.remove("active"),document.querySelector(".tab-pane.show.active")?.classList.remove("show","active"),document.getElementById("prompt-tab").classList.add("active"),void document.getElementById("add-prompt-template").classList.add("show","active")))),Ee("prompt","mention-dropdown","add");const s=document.getElementById("genai-form"),l=document.getElementById("name"),i=document.getElementById("description"),d=document.getElementById("prompt"),m=document.getElementById("saveGlobally"),p=document.getElementById("isAvailableForAll"),f=document.getElementById("sponsorDropdown"),u=document.querySelectorAll(".sponsor-dropdown-item .form-check-input"),g=document.getElementById("sourceDropdown"),y=document.querySelectorAll(".source-dropdown-item .form-check-input");if(document.getElementById("cancel-btn-gen-ai").addEventListener("click",(()=>{Y||v(R)})),s&&l&&d&&u.length>0&&y.length>0){const n=()=>{if(p.checked)f.textContent=_.map((e=>e.Name)).join(", ");else{const e=Array.from(u).filter((e=>e.checked&&"sponsorSelectAll"!==e.id)).map((e=>e.parentElement.textContent.trim()));f.textContent=e.length?e.join(", "):"Select Sponsors"}},a=()=>{const e=Array.from(y).filter((e=>e.checked&&"sourceSelectAll"!==e.id)).map((e=>e.parentElement.textContent.trim()));g.textContent=e.length?e.join(", "):"Select Source Types"};s.addEventListener("submit",(async t=>{t.preventDefault(),s.querySelectorAll(".is-invalid").forEach((e=>e.classList.remove("is-invalid")));let n=!0;l.value.trim()||(l.classList.add("is-invalid"),n=!1),d.value.trim()||(d.classList.add("is-invalid"),n=!1);const a=Array.from(y).filter((e=>e.checked&&"sourceSelectAll"!==e.id)).map((e=>e.value));if(a.length?document.getElementById("primarySourceError").style.display="none":(document.getElementById("primarySourceError").style.display="block",n=!1),!n)return;const r=Array.from(u).filter((e=>e.checked&&"sponsorSelectAll"!==e.id)).map((e=>_.find((t=>t.ID==e.value)))),c=p.checked,f=m.checked,g=G.Group.find((e=>"AIGroup"===e.DisplayName)),b={DisplayName:l.value.trim(),Prompt:d.value.trim(),Description:i.value.trim(),GroupKeyClient:r,AllClient:c?1:0,SaveGlobally:f,UserDefined:"1",ComponentKeyDataTypeID:"1",ComponentKeyDataAccessID:"3",AIFlag:1,DocumentTypeID:G.DocumentTypeID,ReportHeadID:G.ID,SourceTypeID:a.join(","),ReportHeadGroupID:g.ID,ReportHeadSourceID:0};await async function(t){try{const n=document.getElementById("text-gen-save"),a=document.getElementById("cancel-btn-gen-ai");a.disabled=!0,n.innerHTML='<i class="fa fa-spinner fa-spin text-white me-2"></i>Save',n.disabled=!0,Y=!0;const r=await async function(t,n){const o=await fetch(`${e}/api/report/group-key/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(t,L);Y=!1,r.Data&&r.Status?(se(),o("Saved successfully","success")):(a.disabled=!1,n.disabled=!1,n.innerHTML='<i class="fa fa-check-circle me-2"></i>Save',o("Something went wrong","error"))}catch(e){o("Something went wrong","error"),console.error("Error creating text generation tag:",e)}}(b)}));const r=()=>{u.forEach((e=>{e.disabled||(e.checked=!0,e.disabled=!0)})),n()},c=()=>{u.forEach((e=>{t.some((t=>t.ID===parseInt(e.value)))||(e.disabled=!1)})),n()};m.addEventListener("change",(function(){Y||(this.checked?(p.disabled=!1,f.disabled=!1):(c(),p.checked=!1,p.disabled=!0,f.disabled=!0,u.forEach((e=>{e.disabled||(e.checked=!1,e.disabled=!1)})),n()))})),p.addEventListener("change",(function(){Y||(this.checked?r():c())})),m.checked=!0,p.checked=!0,m.dispatchEvent(new Event("change")),p.dispatchEvent(new Event("change")),document.querySelectorAll(".sponsor-dropdown-item").forEach((e=>{e.addEventListener("click",(function(e){e.stopPropagation();const t=this.querySelector(".sponsor-dropdown-item .form-check-input");if(t){if("sponsorSelectAll"===t.id){const e=t.checked;u.forEach((t=>{t.disabled||(t.checked=e)}))}n()}}))})),document.querySelectorAll(".source-dropdown-item").forEach((e=>{e.addEventListener("click",(function(e){e.stopPropagation();const t=this.querySelector(".source-dropdown-item .form-check-input");if(!t)return;if("sourceSelectAll"===t.id){const e=t.checked;y.forEach((t=>{t.checked=e}))}a();const n=Array.from(y).filter((e=>e.checked)).length;document.getElementById("primarySourceError").style.display=0===n?"block":"none"}))})),n(),a(),[l,d].forEach((e=>{e.addEventListener("input",(function(){this.classList.contains("is-invalid")&&this.value.trim()&&this.classList.remove("is-invalid")}))}))}else console.error("Required elements missing.")}}async function ve(e){const t=document.getElementById("confirmation-popup");if(!t)return;const o=sessionStorage.getItem("CustomStyle")||"",a=sessionStorage.getItem("DefaultStyle")||Z;let r="Custom"===e?o:a;t.innerHTML=function(e,t){const o="Dark"===Q,a=o?"bg-dark text-light":"bg-light text-dark",r="Custom"===t?"":'<small class="text-secondary font-italic">Warning: The previewed table colors may vary depending on the accent or theme currently selected in Word.</small>';return`\n<div class="modal show d-block" tabindex="-1">\n  <div class="modal-dialog">\n    <div class="modal-content ${a}">\n      <div class="modal-header border-0">\n        <h5 class="fw-bold">${"Custom"===t?"Customized Tables":"Default Tables"}</h5>\n      </div>\n\n      <div class="modal-body">\n        \n    <select class="form-select mb-2 ${a}" id="confirmation-popup-dropdown">\n      ${("Custom"===t?te:n).map((n=>{const o="Custom"===t?n.Name:n.style;return`<option value="${o}" ${o===e?"selected":""}>\n                    ${"Custom"===t?n.Name:n.style}\n                  </option>`})).join("")}\n    </select>\n  \n        \n    <div class="table-responsive">\n      <table class="table table-bordered table-sm" id="confirmation-popup-table-preview">\n        <thead>\n          <tr>\n            <th>Header 1</th>\n            <th>Header 2</th>\n            <th>Header 3</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr style="color:black;">\n            <td>Data 1</td>\n            <td>Data 2</td>\n            <td>Data 3</td>\n          </tr>\n          <tr style="background-color:white;color:black;">\n            <td>Data 4</td>\n            <td>Data 5</td>\n            <td>Data 6</td>\n          </tr>\n          <tr style="color:black;" >\n            <td>Data 7</td>\n            <td>Data 8</td>\n            <td>Data 9</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  \n        ${r}\n      </div>\n\n      <div class="modal-footer border-0">\n        <button type="button" class="btn btn-link ${o?"text-info":"text-primary"}" id="confirmation-popup-cancel">Cancel</button>\n        <button type="button" class="btn btn-primary text-white" id="confirmation-popup-confirm">Ok</button>\n      </div>\n    </div>\n  </div>\n</div>\n  `}(r,e);const s=document.getElementById("confirmation-popup-cancel"),l=document.getElementById("confirmation-popup-confirm"),i=document.getElementById("confirmation-popup-dropdown"),c=document.getElementById("confirmation-popup-table-preview"),d=()=>{if(!i||!c)return;let t;if(t="Custom"===e?te.find((e=>e.Name===i.value)):n.find((e=>e.style===i.value)),t&&"Pre"===e){if(Array.from(c.rows).forEach((e=>{Array.from(e.cells).forEach((e=>e.removeAttribute("style")))})),t.tableClass&&(c.style.cssText=t.tableClass),t.headerClass){const e=c.querySelector("thead");e&&Array.from(e.rows).forEach((e=>{Array.from(e.cells).forEach((e=>{e.style.cssText=t.headerClass}))}))}t.sideHeader&&t.rowClass&&Array.from(c.rows).forEach(((e,t)=>{Array.from(e.cells).forEach(((e,n)=>{0===n&&0!==t&&(e.style.cssText="font-weight:bold;")}))})),"empty"===t.format&&t.rowClass?Array.from(c.rows).forEach(((e,n)=>{n%2==1&&(e.style.cssText=t.rowClass)})):"partial"===t.format&&t.rowClass?Array.from(c.rows).forEach(((e,n)=>{Array.from(e.cells).forEach(((e,o)=>{0===o?e.style.cssText=t.sideHeader?t.tableClass+"font-weight:bold;":t.tableClass:n%2==1&&(e.style.cssText=t.rowClass)}))})):"full"===t.format&&Array.from(c.rows).forEach(((e,n)=>{Array.from(e.cells).forEach(((e,o)=>{const a=0===n?t.headerClass:"";0===o&&t.sideHeader?e.style.cssText=t.tableClass+"font-weight:bold;"+a:e.style.cssText=t.tableClass+a}))}))}else c.innerHTML=t?t.Preview:""};d(),i?.addEventListener("change",d),s&&s.addEventListener("click",(()=>t.innerHTML="")),l&&i&&l.addEventListener("click",(()=>{if("Custom"===e){const e=te.find((e=>e.Name===i.value));ee.Header=e.Setting.HeaderColor,ee.Primary=e.Setting.PrimaryColor,ee.Secondary=e.Setting.SecondaryColor,ee.Customize=!0,ee.IsSideHeaderBold=e.Setting.IsSideHeaderBold,ee.IsHeaderBold=e.Setting.IsHeaderBold,sessionStorage.setItem("CustomStyle",e.Name),Z=e.Setting.BaseStyle}else ee.Customize=!1,Z=i.value,sessionStorage.setItem("DefaultStyle",Z);sessionStorage.setItem("colorPallete",JSON.stringify(ee)),sessionStorage.setItem("tableStyle",Z),t.innerHTML=""}))}function Ee(e,t,n){let o=-1;const a=document.getElementById(`${e}`),r=document.getElementById(`${t}`);if(a){function s(e){const t=document.querySelectorAll(`#${e} .dropdown-item`),n=(document.getElementById(`${e}`),t.length);if(t.forEach((e=>e.classList.remove("active"))),o>=0&&o<n){const e=t[o];e.classList.add("active"),e.scrollIntoView({behavior:"smooth",block:"nearest"})}}a.addEventListener("input",(e=>{const t=a.selectionStart,o=a.value.slice(0,t),s=o.lastIndexOf("#");if(-1!==s){const e=o.slice(s+1).trim();if(e.length>0){const t=(e=>R.filter((e=>0===e.AIFlag)).filter((t=>t.DisplayName.toLowerCase().includes(e.toLowerCase()))))(e);if(t.length>0){r.innerHTML=t.map((e=>{let t="";return t="add"===n?`#${e.DisplayName}#`:e.EditorValue||`#${e.DisplayName}#`,`<li class="dropdown-item" data-editor-value="${t}">${e.DisplayName}</li>`})).join("");const e=a.getBoundingClientRect();r.style.left=`${e.left}px`,r.style.bottom="75px",r.style.display="block"}else r.style.display="none"}else r.style.display="none"}else r.style.display="none"})),a.addEventListener("keydown",(e=>{const n=document.querySelectorAll(`#${t} .dropdown-item`),a=n.length;if("ArrowDown"===e.key)e.preventDefault(),o<a-1?o++:o=0,s(`${t}`);else if("ArrowUp"===e.key)e.preventDefault(),o>0?o--:o=a-1,s(`${t}`);else if("Enter"===e.key&&-1!==o){const t=n[o];t&&(l(t.getAttribute("data-editor-value")),r.style.display="none",e.preventDefault())}})),r.addEventListener("click",(e=>{if(e.target&&e.target.matches("li")){const t=e.target.getAttribute("data-editor-value");l(t),r.style.display="none"}}));const l=t=>{const n=document.getElementById(`${e}`),o=n.value,a=n.selectionStart,r=o.slice(0,a),s=o.slice(a),l=r.lastIndexOf("#"),i=r.slice(0,l);n.value=`${i}${t}${s}`;const c=i.length+t.length;n.setSelectionRange(c,c)};document.addEventListener("click",(e=>{r.contains(e.target)||e.target===a||(r.style.display="none")}))}}function xe(e){return e?e.replace(/^"|"$/g,"").replace(/\\n/g,"").replace(/\*\*/g,"").replace(/\\r/g,""):""}function ke(e){if(!e||""===e.trim())return e;const t=e.split("_");return t.length<=1?e:t.slice(1).join("_").replace(/%20/g," ").replace(/%25/g,"%")}function Ie(e){const t="Dark"===Q,n=t?"btn-dark text-light border-0":"btn-light text-dark border",o=t?"bg-dark text-light border-light":"bg-white text-dark border",a=t?"bg-dark text-light":"bg-white text-dark",r=T.reduce(((e,t)=>(e[t.SourceType]||(e[t.SourceType]=[]),e[t.SourceType].push(t),e)),{}),s=`\n  <div class='p-3 w-100'>\n    <div class="mb-3">\n      <label for="source-select" class="form-label"><span class="text-danger">*</span> Select Sources</label>\n      <div class="dropdown w-100">\n        <button \n          class="btn ${n} w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources" \n          type="button" \n          id="sourceDropdown" \n          data-bs-toggle="dropdown" \n          aria-expanded="false">\n          <span id="sourceDropdownLabel" class='sourceDropdownLabel'></span>\n          <span class="dropdown-toggle-icon dropdown-toggle-icon-s"></span>\n        </button>\n        <ul class="dropdown-menu ${o} w-100 p-2" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000; max-height: 300px; overflow-y: auto;">\n          \n          \x3c!-- Select All --\x3e\n          <li class="dropdown-item p-2 ${a}" data-checkbox-id="selectAll">\n            <div class="form-check">\n              <input class="form-check-input" type="checkbox" value="selectAll" id="selectAll">\n              <label class="form-check-label w-100" for="selectAll">Select All</label>\n            </div>\n          </li>\n\n          \x3c!-- Grouped Sources --\x3e\n          ${Object.keys(r).map(((e,t)=>{const n=r[e].map(((e,n)=>`\n                  <li class="dropdown-item ps-4 ${a}" style="cursor: pointer;" data-checkbox-id="source-${t}-${n}">\n                    <div class="form-check">\n                      <input class="form-check-input source-checkbox" type="checkbox" value="${e.SourceName}" id="source-${t}-${n}">\n                      <label class="form-check-label w-100 text-prewrap" for="source-${t}-${n}">${e.SourceName}</label>\n                    </div>\n                  </li>\n                `)).join("");return`\n                \x3c!-- Group Header --\x3e\n                <li class="dropdown-item p-2 ${a}" data-group-id="group-${t}">\n                  <div class="form-check">\n                    <input class="form-check-input group-checkbox" type="checkbox" value="${e}" id="group-${t}">\n                    <label class="form-check-label fw-bold" for="group-${t}">${e}</label>\n                  </div>\n                </li>\n                ${n}\n              `})).join("")}\n        </ul>\n      </div>\n    </div>\n    <div class="mt-3 d-flex justify-content-between">\n      <span id="cancel-src-btn" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n      <button id="ok-src-btn" class="btn btn-primary">Save</button>\n    </div>\n  </div>\n  `,l=document.getElementById("chatFooter");l.innerHTML=s;let i=[];const c=document.getElementById("selectAll"),d=document.querySelectorAll(".group-checkbox"),m=document.querySelectorAll(".source-checkbox"),f=document.getElementById("sourceDropdownLabel");function u(){f.innerText=i.length>0?i.join(", "):" "}c.addEventListener("change",(function(){const e=this.checked;d.forEach((t=>t.checked=e)),m.forEach((t=>{t.checked=e,e&&!i.includes(t.value)&&i.push(t.value),e||(i=[])})),u()})),d.forEach((e=>{e.addEventListener("change",(function(){const e=this.id.split("-")[1];document.querySelectorAll(`[data-checkbox-id^="source-${e}-"] .source-checkbox`).forEach((e=>{e.checked=this.checked,this.checked&&!i.includes(e.value)&&i.push(e.value),this.checked||(i=i.filter((t=>t!==e.value)))})),c.checked=Array.from(m).every((e=>e.checked)),u()}))})),m.forEach((e=>{e.addEventListener("change",(function(){e.checked?i.includes(e.value)||i.push(e.value):i=i.filter((t=>t!==e.value));const t=e.id.split("-")[1],n=document.querySelectorAll(`[data-checkbox-id^="source-${t}-"] .source-checkbox`);document.getElementById(`group-${t}`).checked=Array.from(n).every((e=>e.checked)),c.checked=Array.from(m).every((e=>e.checked)),u()}))})),e.Sources&&e.Sources.length>0&&(m.forEach((t=>{e.Sources.includes(t.value)&&(t.checked=!0,i.push(t.value))})),d.forEach((e=>{const t=e.id.split("-")[1],n=document.querySelectorAll(`[data-checkbox-id^="source-${t}-"] .source-checkbox`);e.checked=Array.from(n).every((e=>e.checked))})),c.checked=Array.from(m).every((e=>e.checked)),u()),document.getElementById("ok-src-btn").addEventListener("click",(function(){e.Sources=[...i];const t=T.filter((e=>i.includes(e.SourceName)));e.TempSourceValue=t.map((e=>e.VectorID?String(e.VectorID):e.SourceValue)),e.SourceName=t.map((e=>e.SourceName)),e.SourceValueID=t.map((e=>String(e.VectorID))),e.SourceValue=t.map((e=>e.SourceValue)),l.innerHTML=p(e),I(e,L,R)})),document.getElementById("cancel-src-btn").addEventListener("click",(function(){l.innerHTML=p(e),I(e,L,R)}))}function Te(e){return e.split("_Split_")[0].replace(/_/g," ")}window.addEventListener("hashchange",(()=>{"#/dashboard"===window.location.hash&&N&&(N=!1,K=Number(sessionStorage.getItem("userId")),se())})),Office.onReady((e=>{e.host===Office.HostType.Word&&(document.getElementById("app-body").style.display="flex",document.getElementById("footer").innerText=`© ${J} - TrialAssure LINK AI Assistant 2.4.4`,document.getElementById("editor"),window.location.hash="#/login",async function(){try{await Word.run((async e=>{const t=e.document.properties.customProperties;t.load("items"),await e.sync();const n=t.items.find((e=>"DocumentID"===e.key)),o=t.items.find((e=>"Organization"===e.key));if(!n||!o)return document.getElementById("app-body").innerHTML='\n        <p class="px-3 text-center">Export a document from the LINK AI application to use this functionality.</p>',console.log('Custom property "documentID" not found.'),null;B=n.value,D=o.value,ne()}))}catch(e){console.error("Error retrieving custom property:",e)}}(),Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,(()=>{!async function(){Word.run((async e=>{const t=await async function(e){const t=e.document.getSelection().getBookmarks();return await e.sync(),t.value||[]}(e),n=function(e){return Array.from(new Set(e.map(Te))).filter((e=>R.some((t=>1===t.AIFlag&&(t.DisplayName.toLowerCase()===e.toLowerCase()||`id${t.ID}`.toLowerCase()===e.toLowerCase())))))}(t);if(0!==n.length){if(document.getElementById("tags-in-selected-text")?.classList.replace("d-none","d-block"),n.length>1)return X=n,void f(X,R);if(document.getElementById("search-box")){const e=n[0];X=[e],y(e);const t=R.find((t=>1===t.AIFlag&&(t.DisplayName.toLowerCase()===e.toLowerCase()||`id${t.ID}`.toLowerCase()===e.toLowerCase())));if(!t)return;const o=document.getElementById("app-body");o.innerHTML='<div class="text-muted p-2">Loading...</div>',o.innerHTML=await x(t)}}else document.getElementById("tags-in-selected-text")?.classList.replace("d-block","d-none")}))}()})))}))}(),e=s(14385),t=s.n(e),n=new URL(s(58394),s.b),o=new URL(s(57030),s.b),t()(n),t()(o)}();
//# sourceMappingURL=taskpane.js.map