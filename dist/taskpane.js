!function(){"use strict";var e,t,a,n,o={14385:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},57030:function(e,t,a){e.exports=a.p+"cca4de5cf945742b4fdc.css"},58394:function(e,t,a){e.exports=a.p+"da082971ff0d04b3dc9d.css"}},r={};function l(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return o[e](a,a.exports,l),a.exports}l.m=o,l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,{a:t}),t},l.d=function(e,t){for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=a[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e}(),l.b=document.baseURI||self.location.href,function(){l.d({},{Dd:function(){return le},VY:function(){return te},xZ:function(){return ce},Gg:function(){return se},st:function(){return ie}});const e={dataUrl:"https://plsdevapp.azurewebsites.net",storeUrl:"https://linkwordplugin-aphgcwcgbfdqeccs.eastus-01.azurewebsites.net",version:"2.4.4"},t=e.dataUrl;async function a(e,a){const n=await fetch(`${t}/api/groupkey/update-prompt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}class n{static TOKEN_KEY="user_token";static USER_ROLE_KEY="userRole";static STYLE_KEY="tableStyle";static PALETTE_KEY="colorPallete";static getStoredToken(){return sessionStorage.getItem("token")}static restoreSession(){const e=sessionStorage.getItem("token");return e?{jwt:e,userRole:JSON.parse(sessionStorage.getItem(this.USER_ROLE_KEY)||"{}"),tableStyle:sessionStorage.getItem(this.STYLE_KEY),colorPallete:JSON.parse(sessionStorage.getItem(this.PALETTE_KEY)||"null"),userId:sessionStorage.getItem("userId")}:null}static async login(a,n,o){try{console.log(`Logging in to ${e.dataUrl}`);const r=await async function(e,a,n){const o=await fetch(`${t}/api/user/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ClientName:e,Username:a,Password:n})});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(a,n,o);if(!0===r.Status&&r.Data){if(r.Data.ResponseStatus){const e=r.Data.Token,t=r.Data.UserRole,a=r.Data.ID;return sessionStorage.setItem("token",e),sessionStorage.setItem(this.USER_ROLE_KEY,JSON.stringify(t)),sessionStorage.setItem("userId",a),{success:!0,data:{token:e,userRole:t,userId:a,raw:r.Data}}}return{success:!1,message:"An error occurred during login. Please try again."}}return{success:!1,message:"An error occurred during login. Please try again."}}catch(e){return console.error("Error during login:",e),{success:!1,message:"An error occurred during login. Please try again."}}}static logout(){sessionStorage.removeItem("token"),sessionStorage.removeItem(this.USER_ROLE_KEY),console.log("Logged out")}}class o{jwt="";UserRole={};documentID="";organizationName="";aiTagList=[];imageList=[];initialised=!0;availableKeys=[];promptBuilderList=[];glossaryName="";isGlossaryActive=!1;GroupName="";layTerms=[];dataList=[];isTagUpdating=!1;capturedFormatting={};emptyFormat=!1;isNoFormatTextAvailable=!1;clientId="0";userId=0;clientList=[];currentYear=(new Date).getFullYear();selectedNames=[];isPendingResponse=!1;theme="Light";mode="Home";tableStyle="Plain Table 5";colorPallete={Header:"#FFFFFF",Primary:"#FFFFFF",Secondary:"#FFFFFF",Customize:!0,IsHeaderBold:!0,IsSideHeaderBold:!1};customTableStyle=[];constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}}const r=[{name:"Plain White Table",style:"Table Grid",headerClass:"",tableClass:"background-color:#ffffff;border:1px solid #000;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!1},{name:"Plain Table with Gray Alternating Rows",style:"Plain Table 1",headerClass:"",tableClass:"background-color:#ffffff;border:1px solid #000;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Gray Alternating Rows",style:"Grid Table 2",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Blue Alternating Rows",style:"Grid Table 2 - Accent 1",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Pink Alternating Rows",style:"Grid Table 2 - Accent 2",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Green Alternating Rows",style:"Grid Table 2 - Accent 3",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Purple Alternating Rows",style:"Grid Table 2 - Accent 4",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Teal Alternating Rows",style:"Grid Table 2 - Accent 5",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#daeef3;color:#000000;",format:"empty",sideHeader:!0},{name:"Plain Header Table with Light Orange Alternating Rows",style:"Grid Table 2 - Accent 6",headerClass:"border:1px solid white;",tableClass:"background-color:#ffffff;border:1px solid #d4d4d1ff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"empty",sideHeader:!0},{name:"Black Header Only Table with White Rows",style:"List Table 3",headerClass:"",tableClass:"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Blue Header Only Table with White Rows",style:"List Table 3 - Accent 1",headerClass:"",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Red Header Only Table with White Rows",style:"List Table 3 - Accent 2",headerClass:"",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Green Header Only Table with White Rows",style:"List Table 3 - Accent 3",headerClass:"",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Purple Header Only Table with White Rows",style:"List Table 3 - Accent 4",headerClass:"",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Teal Header Only Table with White Rows",style:"List Table 3 - Accent 5",headerClass:"",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Orange Header Only Table with White Rows",style:"List Table 3 - Accent 6",headerClass:"",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#ffffff;color:#000000;",format:"empty",sideHeader:!0},{name:"Black Header Table with Light Gray Alternating Rows",style:"Grid Table 4",headerClass:"",tableClass:"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"empty",sideHeader:!0},{name:"Blue Header Table with Light Blue Alternating Rows",style:"Grid Table 4 - Accent 1",headerClass:"",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"empty",sideHeader:!0},{name:"Red Header Table with Pink Alternating Rows",style:"Grid Table 4 - Accent 2",headerClass:"",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"empty",sideHeader:!0},{name:"Green Header Table with Light Green Alternating Rows",style:"Grid Table 4 - Accent 3",headerClass:"",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"empty",sideHeader:!0},{name:"Purple Header Table with Light Purple Alternating Rows",style:"Grid Table 4 - Accent 4",headerClass:"",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"empty",sideHeader:!0},{name:"Teal Header Table with Light Teal Alternating Rows",style:"Grid Table 4 - Accent 5",headerClass:"",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#daeef3;color:#000000;",format:"empty",sideHeader:!0},{name:"Orange Header Table with Light Orange Alternating Rows",style:"Grid Table 4 - Accent 6",headerClass:"",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"empty",sideHeader:!0},{name:"Black Header Table with Light Gray Alternating Rows - Side header same color",style:"Grid Table 5 Dark",headerClass:"",tableClass:"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"partial",sideHeader:!0},{name:"Blue Header Table with Light Blue Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 1",headerClass:"",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"partial",sideHeader:!0},{name:"Red Header Table with Pink Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 2",headerClass:"",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"partial",sideHeader:!0},{name:"Green Header Table with Light Green Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 3",headerClass:"",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"partial",sideHeader:!0},{name:"Purple Header Table with Light Purple Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 4",headerClass:"",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"partial",sideHeader:!0},{name:"Teal Header Table with Light Teal Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 5",headerClass:"",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#daeef3;color:#000000;",format:"partial",sideHeader:!0},{name:"Orange Header Table with Light Orange Alternating Rows - Side header same color",style:"Grid Table 5 Dark - Accent 6",headerClass:"",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"partial",sideHeader:!0},{name:"Black Table - Whole table is black",style:"List Table 5 Dark",headerClass:"border:1px solid #000000; border-bottom: none;",tableClass:"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;",rowClass:"background-color:#f2f2f2;color:#000000;",format:"full",sideHeader:!0},{name:"Blue Table - Whole table is blue",style:"List Table 5 Dark - Accent 1",headerClass:"border:1px solid #4F81BD; border-bottom: none;",tableClass:"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#dbe5f1;color:#000000;",format:"full",sideHeader:!0},{name:"Red Table - Whole table is red",style:"List Table 5 Dark - Accent 2",headerClass:"border:1px solid #c0504d; border-bottom: none;",tableClass:"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#f2dbdb;color:#000000;",format:"full",sideHeader:!0},{name:"Green Table - Whole table is green",style:"List Table 5 Dark - Accent 3",headerClass:"border:1px solid #9bbb59; border-bottom: none;",tableClass:"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#eaf1dd;color:#000000;",format:"full",sideHeader:!0},{name:"Purple Table - Whole table is purple",style:"List Table 5 Dark - Accent 4",headerClass:"border:1px solid #8064a2; border-bottom: none;",tableClass:"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#e5dfec;color:#000000;",format:"full",sideHeader:!0},{name:"Teal Table - Whole table is teal",style:"List Table 5 Dark - Accent 5",headerClass:"border:1px solid #4bacc6; border-bottom: none;",tableClass:"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#daeef3;color:#000000;",format:"full",sideHeader:!0},{name:"Orange Table - Whole table is orange",style:"List Table 5 Dark - Accent 6",headerClass:"border:1px solid #f79646; border-bottom: none;",tableClass:"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;",rowClass:"background-color:#fde9d9;color:#000000;",format:"full",sideHeader:!0}],s={en:{"Table Grid":"Table Grid","Table Grid 1":"Table Grid","Plain Table 1":"Plain Table 1","Grid Table 2":"Grid Table 2","Grid Table 2 - Accent 1":"Grid Table 2 - Accent 1","Grid Table 2 - Accent 2":"Grid Table 2 - Accent 2","Grid Table 2 - Accent 3":"Grid Table 2 - Accent 3","Grid Table 2 - Accent 4":"Grid Table 2 - Accent 4","Grid Table 2 - Accent 5":"Grid Table 2 - Accent 5","Grid Table 2 - Accent 6":"Grid Table 2 - Accent 6","List Table 3":"List Table 3","List Table 3 - Accent 1":"List Table 3 - Accent 1","List Table 3 - Accent 2":"List Table 3 - Accent 2","List Table 3 - Accent 3":"List Table 3 - Accent 3","List Table 3 - Accent 4":"List Table 3 - Accent 4","List Table 3 - Accent 5":"List Table 3 - Accent 5","List Table 3 - Accent 6":"List Table 3 - Accent 6","Grid Table 4":"Grid Table 4","Grid Table 4 - Accent 1":"Grid Table 4 - Accent 1","Grid Table 4 - Accent 2":"Grid Table 4 - Accent 2","Grid Table 4 - Accent 3":"Grid Table 4 - Accent 3","Grid Table 4 - Accent 4":"Grid Table 4 - Accent 4","Grid Table 4 - Accent 5":"Grid Table 4 - Accent 5","Grid Table 4 - Accent 6":"Grid Table 4 - Accent 6","Grid Table 5 Dark":"Grid Table 5 Dark","Grid Table 5 Dark - Accent 1":"Grid Table 5 Dark - Accent 1","Grid Table 5 Dark - Accent 2":"Grid Table 5 Dark - Accent 2","Grid Table 5 Dark - Accent 3":"Grid Table 5 Dark - Accent 3","Grid Table 5 Dark - Accent 4":"Grid Table 5 Dark - Accent 4","Grid Table 5 Dark - Accent 5":"Grid Table 5 Dark - Accent 5","Grid Table 5 Dark - Accent 6":"Grid Table 5 Dark - Accent 6","List Table 5 Dark":"List Table 5 Dark","List Table 5 Dark - Accent 1":"List Table 5 Dark - Accent 1","List Table 5 Dark - Accent 2":"List Table 5 Dark - Accent 2","List Table 5 Dark - Accent 3":"List Table 5 Dark - Accent 3","List Table 5 Dark - Accent 4":"List Table 5 Dark - Accent 4","List Table 5 Dark - Accent 5":"List Table 5 Dark - Accent 5","List Table 5 Dark - Accent 6":"List Table 5 Dark - Accent 6"},de:{"Table Grid":"Tabellenraster","Table Grid 1":"Tabellenraster","Plain Table 1":"Einfache Tabelle 1","Plain Table 2":"Einfache Tabelle 2","Plain Table 3":"Einfache Tabelle 3","Plain Table 5":"Einfache Tabelle 5","Grid Table 2":"Gitternetztabelle 2","Grid Table 2 - Accent 1":"Gitternetztabelle 2 – Akzent 1","Grid Table 2 - Accent 2":"Gitternetztabelle 2 – Akzent 2","Grid Table 2 - Accent 3":"Gitternetztabelle 2 – Akzent 3","Grid Table 2 - Accent 4":"Gitternetztabelle 2 – Akzent 4","Grid Table 2 - Accent 5":"Gitternetztabelle 2 – Akzent 5","Grid Table 2 - Accent 6":"Gitternetztabelle 2 – Akzent 6","List Table 2":"Listentabelle 2","List Table 3":"Listentabelle 3","List Table 3 - Accent 1":"Listentabelle 3 – Akzent 1","List Table 3 - Accent 2":"Listentabelle 3 – Akzent 2","List Table 3 - Accent 3":"Listentabelle 3 – Akzent 3","List Table 3 - Accent 4":"Listentabelle 3 – Akzent 4","List Table 3 - Accent 5":"Listentabelle 3 – Akzent 5","List Table 3 - Accent 6":"Listentabelle 3 – Akzent 6","Grid Table 4":"Gitternetztabelle 4","Grid Table 4 - Accent 1":"Gitternetztabelle 4 – Akzent 1","Grid Table 4 - Accent 2":"Gitternetztabelle 4 – Akzent 2","Grid Table 4 - Accent 3":"Gitternetztabelle 4 – Akzent 3","Grid Table 4 - Accent 4":"Gitternetztabelle 4 – Akzent 4","Grid Table 4 - Accent 5":"Gitternetztabelle 4 – Akzent 5","Grid Table 4 - Accent 6":"Gitternetztabelle 4 – Akzent 6","Grid Table 5 Dark":"Gitternetztabelle 5 dunkel","Grid Table 5 Dark - Accent 1":"Gitternetztabelle 5 dunkel  – Akzent 1","Grid Table 5 Dark - Accent 2":"Gitternetztabelle 5 dunkel  – Akzent 2","Grid Table 5 Dark - Accent 3":"Gitternetztabelle 5 dunkel  – Akzent 3","Grid Table 5 Dark - Accent 4":"Gitternetztabelle 5 dunkel  – Akzent 4","Grid Table 5 Dark - Accent 5":"Gitternetztabelle 5 dunkel  – Akzent 5","Grid Table 5 Dark - Accent 6":"Gitternetztabelle 5 dunkel  – Akzent 6","List Table 5 Dark":"Listentabelle 5 dunkel","List Table 5 Dark - Accent 1":"Listentabelle 5 dunkel  – Akzent 1","List Table 5 Dark - Accent 2":"Listentabelle 5 dunkel  – Akzent 2","List Table 5 Dark - Accent 3":"Listentabelle 5 dunkel  – Akzent 3","List Table 5 Dark - Accent 4":"Listentabelle 5 dunkel  – Akzent 4","List Table 5 Dark - Accent 5":"Listentabelle 5 dunkel  – Akzent 5","List Table 5 Dark - Accent 6":"Listentabelle 5 dunkel  – Akzent 6"},fr:{"Table Grid":"Quadrillage","Plain Table 1":"Tableau simple 1","Grid Table 2":"Tableau quadrillé 2","Grid Table 2 - Accent 1":"Tableau quadrillé 2 Accent 1","Grid Table 2 - Accent 2":"Tableau quadrillé 2 Accent 2","Grid Table 2 - Accent 3":"Tableau quadrillé 2 Accent 3","Grid Table 2 - Accent 4":"Tableau quadrillé 2 Accent 4","Grid Table 2 - Accent 5":"Tableau quadrillé 2 Accent 5","Grid Table 2 - Accent 6":"Tableau quadrillé 2 Accent 6","List Table 3":"Tableau de liste 3","List Table 3 - Accent 1":"Tableau de liste 3 Accent 1","List Table 3 - Accent 2":"Tableau de liste 3 Accent 2","List Table 3 - Accent 3":"Tableau de liste 3 Accent 3","List Table 3 - Accent 4":"Tableau de liste 3 Accent 4","List Table 3 - Accent 5":"Tableau de liste 3 Accent 5","List Table 3 - Accent 6":"Tableau de liste 3 Accent 6","Grid Table 4":"Tableau quadrillé 4","Grid Table 4 - Accent 1":"Tableau quadrillé 4 Accent 1","Grid Table 4 - Accent 2":"Tableau quadrillé 4 Accent 2","Grid Table 4 - Accent 3":"Tableau quadrillé 4 Accent 3","Grid Table 4 - Accent 4":"Tableau quadrillé 4 Accent 4","Grid Table 4 - Accent 5":"Tableau quadrillé 4 Accent 5","Grid Table 4 - Accent 6":"Tableau quadrillé 4 Accent 6","Grid Table 5 Dark":"Tableau quadrillé 5 foncé","Grid Table 5 Dark - Accent 1":"Tableau quadrillé 5 foncé Accent 1","Grid Table 5 Dark - Accent 2":"Tableau quadrillé 5 foncé Accent 2","Grid Table 5 Dark - Accent 3":"Tableau quadrillé 5 foncé Accent 3","Grid Table 5 Dark - Accent 4":"Tableau quadrillé 5 foncé Accent 4","Grid Table 5 Dark - Accent 5":"Tableau quadrillé 5 foncé Accent 5","Grid Table 5 Dark - Accent 6":"Tableau quadrillé 5 foncé Accent 6","List Table 5 Dark":"Tableau de liste 5 foncé","List Table 5 Dark - Accent 1":"Tableau de liste 5 foncé Accent 1","List Table 5 Dark - Accent 2":"Tableau de liste 5 foncé Accent 2","List Table 5 Dark - Accent 3":"Tableau de liste 5 foncé Accent 3","List Table 5 Dark - Accent 4":"Tableau de liste 5 foncé Accent 4","List Table 5 Dark - Accent 5":"Tableau de liste 5 foncé Accent 5","List Table 5 Dark - Accent 6":"Tableau de liste 5 foncé Accent 6"},es:{"Table Grid":"Cuadrícula de tabla","Plain Table 1":"Tabla simple 1","Grid Table 2":"Tabla de cuadrícula 2","Grid Table 2 - Accent 1":"Tabla de cuadrícula 2 Acento 1","Grid Table 2 - Accent 2":"Tabla de cuadrícula 2 Acento 2","Grid Table 2 - Accent 3":"Tabla de cuadrícula 2 Acento 3","Grid Table 2 - Accent 4":"Tabla de cuadrícula 2 Acento 4","Grid Table 2 - Accent 5":"Tabla de cuadrícula 2 Acento 5","Grid Table 2 - Accent 6":"Tabla de cuadrícula 2 Acento 6","List Table 3":"Tabla de lista 3","List Table 3 - Accent 1":"Tabla de lista 3 Acento 1","List Table 3 - Accent 2":"Tabla de lista 3 Acento 2","List Table 3 - Accent 3":"Tabla de lista 3 Acento 3","List Table 3 - Accent 4":"Tabla de lista 3 Acento 4","List Table 3 - Accent 5":"Tabla de lista 3 Acento 5","List Table 3 - Accent 6":"Tabla de lista 3 Acento 6","Grid Table 4":"Tabla de cuadrícula 4","Grid Table 4 - Accent 1":"Tabla de cuadrícula 4 Acento 1","Grid Table 4 - Accent 2":"Tabla de cuadrícula 4 Acento 2","Grid Table 4 - Accent 3":"Tabla de cuadrícula 4 Acento 3","Grid Table 4 - Accent 4":"Tabla de cuadrícula 4 Acento 4","Grid Table 4 - Accent 5":"Tabla de cuadrícula 4 Acento 5","Grid Table 4 - Accent 6":"Tabla de cuadrícula 4 Acento 6","Grid Table 5 Dark":"Tabla de cuadrícula 5 oscuro","Grid Table 5 Dark - Accent 1":"Tabla de cuadrícula 5 oscuro Acento 1","Grid Table 5 Dark - Accent 2":"Tabla de cuadrícula 5 oscuro Acento 2","Grid Table 5 Dark - Accent 3":"Tabla de cuadrícula 5 oscuro Acento 3","Grid Table 5 Dark - Accent 4":"Tabla de cuadrícula 5 oscuro Acento 4","Grid Table 5 Dark - Accent 5":"Tabla de cuadrícula 5 oscuro Acento 5","Grid Table 5 Dark - Accent 6":"Tabla de cuadrícula 5 oscuro Acento 6","List Table 5 Dark":"Tabla de lista 5 oscuro","List Table 5 Dark - Accent 1":"Tabla de lista 5 oscuro Acento 1","List Table 5 Dark - Accent 2":"Tabla de lista 5 oscuro Acento 2","List Table 5 Dark - Accent 3":"Tabla de lista 5 oscuro Acento 3","List Table 5 Dark - Accent 4":"Tabla de lista 5 oscuro Acento 4","List Table 5 Dark - Accent 5":"Tabla de lista 5 oscuro Acento 5","List Table 5 Dark - Accent 6":"Tabla de lista 5 oscuro Acento 6"}};function i(e){const t="Dark"===o.getInstance().theme;return`\n<div class="modal show d-block" tabindex="-1">\n  <div class="modal-dialog">\n    <div class="modal-content ${t?"bg-dark text-light":"bg-light text-dark"}">\n      <div class="modal-header border-0">\n        <h5 class="fw-bold">Confirmation</h5>\n      </div>\n\n      <div class="modal-body">\n        <p>${e}</p>\n      </div>\n\n      <div class="modal-footer border-0">\n        <button type="button" class="btn btn-link ${t?"text-info":"text-primary"}" id="confirmation-popup-cancel">Cancel</button>\n        <button type="button" class="btn btn-primary text-white" id="confirmation-popup-confirm">Ok</button>\n      </div>\n    </div>\n  </div>\n</div>`}function c(e,t){const a=`<div class="toast show" style="position: fixed; top: 10px; right: 10px; z-index: 1050; max-width: fit-content; background-color: #808080; color: #ffffff;">\n    <div class="toast-body">\n         <i class="fa ${"success"===t?"fa-check-circle":"fa-exclamation-circle"} me-2" style="color: #ffffff;"></i> ${e}\n    </div>\n  </div>`;document.getElementById("toastr").innerHTML=a,setTimeout((()=>{document.getElementById("toastr").innerHTML=""}),4e3)}const d='<ul class="nav nav-tabs" id="tabList" role="tablist">\n  <li class="nav-item">\n    <a class="nav-link active" id="tag-tab" data-bs-toggle="tab" href="#tag" role="tab">Tag</a>\n  </li>\n  <li class="nav-item">\n    <a class="nav-link" id="prompt-tab" data-bs-toggle="tab" href="#prompt" role="tab">Prompt builder</a>\n  </li>\n</ul>\n\n<div class="tab-content p-3 border border-top-0">\n  <div class="tab-pane fade show active" id="add-tag-body" role="tabpanel" aria-labelledby="tag-tab">\n  </div>\n  <div class="tab-pane fade" id="add-prompt-template" role="tabpanel" aria-labelledby="prompt-tab">\n  </div>\n</div>\n',m=e.dataUrl;async function u(e,t){const a=await fetch(`${m}/api/summarytag/reportHead/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}async function p(e,t){const a=await fetch(`${m}/api/summarytag/history/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}async function f(e,t){const a=await fetch(`${m}/api/summarytag/status/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}async function g(e,t){const a=await fetch(`${m}/api/report/summary-history/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}class b{static async fetchAIHistory(e){const a=o.getInstance();try{const n=await async function(e,a){const n=await fetch(`${t}/api/report/ai-history/${e}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error("Network response was not ok");return await n.json()}(e.ID,a.jwt);if(n.Status&&n.Data){e.ReportHeadAIHistoryList=n.Data||[],e.FilteredReportHeadAIHistoryList=[],e.SourceValueID=e.ReportHeadAIHistoryList[0].SourceValue;const t=a.sourceList.filter((t=>e.SourceValueID.includes(String(t.VectorID))));return e.SourceName=t.map((e=>e.SourceName)),e.Sources=e.SourceName.join(","),e.TempSourceValue=t.map((e=>e.VectorID?String(e.VectorID):e.SourceValue)),e.ReportHeadAIHistoryList.forEach((t=>{t.Response=C(t.Response),e.FilteredReportHeadAIHistoryList.unshift(t)})),e.FilteredReportHeadAIHistoryList}return console.warn("No AI history available."),[]}catch(e){return console.error("Error fetching AI history:",e),[]}}static async sendPrompt(e,a,n="AITag"){const r=o.getInstance();if(""===a||r.isTagUpdating)console.error("No empty prompt allowed or tag updating");else{r.isTagUpdating=!0;const o=document.getElementById("sendPromptButton");let l;o&&(o.innerHTML='<i class="fa fa-spinner fa-spin text-white"></i>'),l="Summary"===n?{ReportHeadID:r.dataList.ID,ReportHeadSummaryTagID:e.ID,Prompt:a,Response:"",Selected:1,SourceVector:e.TempSourceValue?e.TempSourceValue.join(","):"",Name:e.Name}:{ReportHeadID:e.FilteredReportHeadAIHistoryList[0].ReportHeadID,DocumentID:r.dataList.NCTID,DocumentType:r.dataList.DocumentType,TextSetting:r.dataList.TextSetting,DocumentTemplate:r.dataList.ReportTemplate,ReportHeadGroupKeyID:e.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,ThreadID:e.ThreadID,AssistantID:r.dataList.AssistantID,Container:r.dataList.Container,GroupName:r.GroupName,Prompt:a,PromptType:1,Response:"",VectorID:r.dataList.VectorID,Selected:0,ID:0,SourceValue:e.TempSourceValue?e.TempSourceValue:[]};try{r.isPendingResponse=!0;const a="Summary"===n?await g(l,r.jwt):await async function(e,a){const n=await fetch(`${t}/api/report/ai-history/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(l,r.jwt);if(a.Data&&"false"!==a.Data){e.ReportHeadAIHistoryList=JSON.parse(JSON.stringify(a.Data)),e.FilteredReportHeadAIHistoryList=[],e.ReportHeadAIHistoryList.forEach((t=>{t.Response=C(t.Response),e.FilteredReportHeadAIHistoryList.unshift(t)}));const t=e.ReportHeadAIHistoryList[0];r.aiTagList.forEach((a=>{a.ID===e.ID&&b.updateTagWithChat(a,t,e.IsApplied)})),r.availableKeys.forEach((a=>{a.ID===e.ID&&b.updateTagWithChat(a,t,e.IsApplied)}));const o=document.getElementById("app-body");o&&(o.innerHTML=await E(e,n)),r.isPendingResponse=!1}o&&(o.innerHTML='<i class="fa fa-paper-plane text-white"></i>');const s=document.getElementById("chatInput");s&&(s.value=""),r.isTagUpdating=!1,r.isPendingResponse=!1}catch(e){o&&(o.innerHTML='<i class="fa fa-paper-plane text-white"></i>'),r.isTagUpdating=!1,r.isPendingResponse=!1,console.error("Error sending AI prompt:",e)}}}static updateTagWithChat(e,t,a){const n=""!==t.FormattedResponse,o=t.FormattedResponse?"\n"+H(t.FormattedResponse):t.Response;e.ComponentKeyDataType=n?"TABLE":"TEXT",e.UserValue=o,e.EditorValue=o,e.text=o,e.IsApplied=a}}let y=!1,h=[],w=0,T=0;async function v(e){const t=++T,a=o.getInstance(),n="Dark"===a.theme?"bg-secondary text-light":"bg-white text-dark";document.getElementById("app-body").innerHTML=`\n    <div class="container pt-3">\n\n      \x3c!-- Top bar --\x3e\n      <div class="d-flex justify-content-end px-2">\n        <div class="dropdown">\n          <button class="btn btn-default dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n            Action\n          </button>\n          <ul class="dropdown-menu dropdown-menu-end">\n            <li>\n              <a class="dropdown-item" href="#" id="add-btn-tag">\n                <i class="fa-solid fa-plus me-2"></i> Add\n              </a>\n            </li>\n\n            <li>\n              <a class="dropdown-item" href="#" id="reanalyze-draft">\n                <i class="fa-solid fa-rotate-right me-2"></i> Re-analyze Draft\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      \x3c!-- Search --\x3e\n      <div class="form-group px-2 pt-2">\n        <div class="input-group">\n          <input type="text" id="search-box"\n            class="form-control ${n}"\n            placeholder="Search Summary Tags ..."\n            autocomplete="off" />\n          <span class="input-group-text">\n            <i class="fa-solid fa-magnifying-glass text-muted"></i>\n          </span>\n        </div>\n      </div>\n\n      \x3c!-- Card Panel (always visible now) --\x3e\n      <div class="card mt-3 mx-2 mb-3" id="summary-card">\n        <div class="card-header fw-semibold">Summary Tags</div>\n\n        <div class="list-group list-group-summary list-group-flush" id="summary-tag-list">\n          <div class="d-flex justify-content-center align-items-center p-5">\n            <div class="loader"></div>\n          </div>\n        </div>\n\n        \x3c!-- Pagination Footer --\x3e\n        <div class="card-footer d-flex justify-content-between align-items-center flex-wrap gap-2">\n          <div class="btn-group btn-group-sm" role="group" aria-label="pagination">\n            <button class="btn btn-outline-secondary" id="page-first" title="First">\n              <i class="fa-solid fa-backward-fast"></i>\n            </button>\n            <button class="btn btn-outline-secondary" id="page-prev" title="Previous">\n              <i class="fa-solid fa-backward-step"></i>\n            </button>\n\n            <div class="btn-group btn-group-sm" id="page-buttons"></div>\n\n            <button class="btn btn-outline-secondary" id="page-next" title="Next">\n              <i class="fa-solid fa-forward-step"></i>\n            </button>\n            <button class="btn btn-outline-secondary" id="page-last" title="Last">\n              <i class="fa-solid fa-forward-fast"></i>\n            </button>\n          </div>\n\n          <div class="text-muted small" id="page-count-label"></div>\n        </div>\n      </div>\n    </div>\n  `;const r=document.getElementById("search-box"),l=document.getElementById("summary-tag-list"),s=document.getElementById("page-buttons"),d=document.getElementById("page-count-label"),b=document.getElementById("page-first"),v=document.getElementById("page-prev"),A=document.getElementById("page-next"),I=document.getElementById("page-last"),L=document.getElementById("add-btn-tag"),x=document.getElementById("reanalyze-draft");function S(e){L&&L.classList.toggle("disabled",e)}function C(e){x&&x.classList.toggle("disabled",!e)}function D(e){let t=e?.Data??e?.SelectedNames??e?.selectedNames??e?.data??e??[];return"string"==typeof t?t.split(",").map((e=>e.trim())).filter(Boolean):Array.isArray(t)&&t.length>0&&"object"==typeof t[0]?t.map((e=>e.DisplayName||e.Name||e.TagName)).filter(Boolean):Array.isArray(t)?t:[]}const B=8;let H,N=1,G=h;function $(){return Math.max(1,Math.ceil(G.length/B))}function P(){l.replaceChildren();const e=function(){const e=(N-1)*B;return G.slice(e,e+B)}();0!==e.length?e.forEach((e=>{const t=document.createElement("button");t.type="button";const n=2===w,o="Dark"===a.theme?"bg-dark text-light "+(n?"list-hover-dark":"opacity-50"):"bg-light text-dark "+(n?"list-hover-light":"opacity-50");t.className=`list-group-item list-group-item-action d-flex justify-content-between align-items-center ${o}`,n||(t.disabled=!0,t.style.cursor="not-allowed");const r=void 0===e.Status||null===e.Status?"1":String(e.Status);let s="";if(s="0"===r?'<i class="fa fa-spinner fa-spin text-muted"></i>':"2"===r?`<i class="fa-solid fa-circle-info text-warning c-pointer" id="reprocess-${e.ID||e.ReportHeadSummaryTagID}" title="Click to Reprocess"></i>`:'<i class="fa-solid fa-circle-check light-navy-blue"></i>',t.innerHTML=`\n        <div class="text-truncate pe-2">${e.Name}</div>\n        <div class="d-flex align-items-center gap-3">\n          ${s}\n          <i class="fa-solid fa-angles-right text-muted"></i>\n        </div>\n      `,n&&(t.onclick=async()=>{try{const t=document.getElementById("app-body");t.innerHTML='\n            <div id="button-container">\n              <div class="loader" id="loader"></div>\n            </div>\n          ';const a=await E(e,"Summary");t.innerHTML=a}catch{document.getElementById("app-body").innerHTML='<div class="text-danger p-2">Error loading data</div>'}}),l.appendChild(t),"2"===r){const n=t.querySelector(`#reprocess-${e.ID||e.ReportHeadSummaryTagID}`);n&&n.addEventListener("click",(t=>{t.stopPropagation(),async function(e){try{e.Status="0",R();const t=a.jwt,n=await p(e.ID||e.ReportHeadSummaryTagID,t),o=n?.Data||[];if(0===o.length)return c("No history found to reprocess","error"),e.Status="2",void R();const r=o[0],l={ReportHeadID:Number(a.documentID),ReportHeadSummaryTagID:e.ID||e.ReportHeadSummaryTagID,Prompt:r.Prompt,Response:"",Selected:1,SourceVector:r.SourceVector?r.SourceVector:"",Name:e.Name};await g(l,t),1!==w&&(w=1,M())}catch(t){console.error("Reprocess failed:",t),c("Reprocess failed","error"),e.Status="2",R()}}(e)}))}})):l.innerHTML=y?'<div class="d-flex justify-content-center align-items-center p-5"><div class="loader"></div></div>':'<div class="p-3 text-muted">No tags found</div>'}function R(){P(),function(){const e=$();N=Math.min(Math.max(1,N),e);const t=0===G.length?0:(N-1)*B+1,a=Math.min(N*B,G.length);d.textContent=`${t} - ${a} of ${G.length} items`,b.toggleAttribute("disabled",1===N),v.toggleAttribute("disabled",1===N),A.toggleAttribute("disabled",N===e),I.toggleAttribute("disabled",N===e),s.replaceChildren();let n=Math.max(1,N-Math.floor(2.5)),o=Math.min(e,n+5-1);n=Math.max(1,o-5+1);for(let e=n;e<=o;e++){const t=document.createElement("button");t.className="btn "+(e===N?"btn-primary":"btn-outline-secondary"),t.textContent=String(e),t.onclick=()=>{N=e,R()},s.appendChild(t)}}()}function F(){const e=r.value.trim().toLowerCase();G=e?h.filter((t=>(t.Name||"").toLowerCase().includes(e))):h,N=1,R()}r.addEventListener("input",(()=>{clearTimeout(H),H=setTimeout(F,250)})),b.addEventListener("click",(()=>{N=1,R()})),v.addEventListener("click",(()=>{N=Math.max(1,N-1),R()})),A.addEventListener("click",(()=>{N=Math.min($(),N+1),R()})),I.addEventListener("click",(()=>{N=$(),R()})),L?.addEventListener("click",(()=>{y||le()}));let j=!1;function z(e){const t=new Map;return e.forEach((e=>{const a=e.FileName;if(t.has(a)){const n=t.get(a);"1"!==String(n.Status)&&"1"===String(e.Status)&&t.set(a,e)}else t.set(a,e)})),Array.from(t.values())}async function M(){for(;t===T;){const e=await f(a.documentID,a.jwt),t=e?.Data,n=t?.SummaryTagGenerated,o=t?.SummaryTagStatus||[];w=n,o&&o.length>0&&(o.forEach((e=>{const t=h.find((t=>(t.ReportHeadSummaryTagID||t.ID)===e.ReportHeadSummaryTagID));t&&(t.Status=e.Status)})),R());const r=!(o.length>0)||o.every((e=>"0"!==String(e.Status)));if(2===n&&r){C(!0);const e=await u(a.documentID,a.jwt);h=e?.Data?.SummaryTags||[],G=h,h&&h.length>0&&D(h),R();break}await new Promise((e=>setTimeout(e,1e4)))}}x?.addEventListener("click",(async()=>{if(y||x.classList.contains("disabled"))return;const e=document.getElementById("confirmation-popup");if(!e)return;e.innerHTML=i("Do you want to refresh all summary tags of the draft?");const t=document.getElementById("confirmation-popup-cancel"),n=document.getElementById("confirmation-popup-confirm");t&&(t.innerText="No"),n&&(n.innerText="Yes");const o=async t=>{e.innerHTML="";try{C(!1),S(!0),y=!0,w=1,h.forEach((e=>e.Status="0")),P();const e=await k(),n={ReportHeadID:Number(a.documentID),RefreshSummaryTag:t,ActiveDocument:e},o=await async function(e,t){const a=await fetch(`${m}/api/report/refresh-summarymode`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(n,a.jwt);o?.Data&&(h=o.Data.SummaryTags||[],a.sourceSummaryList=z(o.Data.SummarySources||[]),w=o.Data.SummaryTagGenerated,G=h,h&&h.length>0&&D(h),R()),await M()}catch(e){console.error("Refresh failed:",e),C(!0)}};document.getElementById("confirmation-popup-confirm")?.addEventListener("click",(()=>o(!0))),document.getElementById("confirmation-popup-cancel")?.addEventListener("click",(()=>o(!1)))})),await async function(){y=!0,S(!0);try{C(!1);const e=await u(a.documentID,a.jwt);w=e?.Data?.SummaryTagGenerated,h=e?.Data?.SummaryTags||[],a.sourceSummaryList=z(e?.Data?.SummarySources||[]),G=h,R();const t=w;if(2===t)return C(!0),void(h&&h.length>0&&D(h));if(0===t){if(!j){j=!0;const e=await k(),t={ReportHeadID:a.documentID,ActiveDocument:e};await async function(e,t){const a=await fetch(`${m}/api/report/activate-summarymode`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(t,a.jwt)}await M()}1===t&&await M()}catch(e){console.error("Summary load failed:",e),l&&(l.innerHTML='<div class="p-3 text-danger">Failed to load Summary mode</div>')}finally{y=!1,S(!1)}}()}function k(){return new Promise(((e,t)=>{Office.context.document.getFileAsync(Office.FileType.Compressed,{sliceSize:1048576},(a=>{if(a.status!==Office.AsyncResultStatus.Succeeded)return void t(a.error);const n=a.value,o=[];let r=0;const l=()=>{n.getSliceAsync(r,(a=>{if(a.status!==Office.AsyncResultStatus.Succeeded)return n.closeAsync(),void t(a.error);const s=a.value.data;if("string"==typeof s)o.push(s);else{const e=new Uint8Array(s);o.push(function(e){let t="";const a=e.byteLength;for(let n=0;n<a;n++)t+=String.fromCharCode(e[n]);return window.btoa(t)}(e))}r++,r<n.sliceCount?l():(n.closeAsync(),e(o.join("")))}))};l()}))}))}class A{static async fetchSummaryAIHistory(e){const t=o.getInstance();try{const a=await p(e.ID,t.jwt);if(a.Status&&a.Data){e.ReportHeadAIHistoryList=a.Data||[],e.FilteredReportHeadAIHistoryList=[],e.SourceValueID=e.ReportHeadAIHistoryList[0].SourceValue;const n=t.sourceSummaryList.filter((t=>e.SourceVector.includes(String(t.VectorID))));return e.SourceName=n.map((e=>e.SourceName)),e.Sources=e.SourceName.join(","),e.TempSourceValue=n.map((e=>e.VectorID?String(e.VectorID):e.SourceValue)),e.ReportHeadAIHistoryList.forEach((t=>{t.Response=C(t.Response),e.FilteredReportHeadAIHistoryList.unshift(t)})),e.FilteredReportHeadAIHistoryList}return console.warn("No Summary AI history available."),[]}catch(e){return console.error("Error fetching Summary AI history:",e),[]}}}function I(e){const t=o.getInstance(),a="Dark"===t.theme?"bg-secondary text-light":"bg-white text-dark";document.getElementById("app-body").innerHTML=`\n    <div class="container pt-3">\n        <div class="d-flex justify-content-end px-2">\n            <div class="dropdown">\n                <button class="btn btn-default dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n                    Action\n                </button>\n                <ul class="dropdown-menu">\n                    <li>\n                        <a class="dropdown-item" href="#" id="add-btn-tag">\n                            <i class="fa fa-plus me-2" aria-hidden="true"></i> Add\n                        </a>\n                    </li>\n                    <li>\n                        <a class="dropdown-item" href="#" id="apply-btn-tag">\n                            <i class="fa-solid fa-circle-check me-2"></i> Apply\n                        </a>\n                    </li>\n\n                     <li>\n                        <a class="dropdown-item" href="#" id="predefined-table">\n                            <i class="fa fa-table me-2" aria-hidden="true"></i> Default Tables\n                        </a>\n                    </li>\n                    <li>\n                        <a class="dropdown-item" href="#" id="customized-table">\n                            <i class="fa fa-brush me-2" aria-hidden="true"></i> Customized Tables\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n\n        <div class="form-group px-2 pt-2">\n            <input type="text" id="search-box" class="form-control ${a}" placeholder="Search Tags..." autocomplete="off" />\n        </div>\n\n        <ul id="suggestion-list" class="list-group mt-2 px-2"></ul>\n        \n        <div id="tags-in-selected-text" class="mt-2 px-2 selected-text-box d-none">\n            <label class="form-label mb-2 fw-bold">Tags in Selected Text</label>\n            <div class="tag-panel d-flex flex-wrap gap-2" id="tag-badge-wrapper"></div>\n        </div>\n    </div>`;const n=document.getElementById("search-box"),r=document.getElementById("suggestion-list");function l(){const a=n.value.trim().toLowerCase();if(r.replaceChildren(),""===a)return void(r.innerHTML="");const l=e.filter((e=>e.DisplayName.toLowerCase().includes(a))),s=l.filter((e=>0===e.AIFlag)),i=l.filter((e=>1===e.AIFlag)),c=s.filter((e=>"TEXT"===e.ComponentKeyDataType||"TABLE"===e.ComponentKeyDataType)),d=s.filter((e=>"IMAGE"===e.ComponentKeyDataType&&e.IsImage)),m=(e,a,n=!1,l=!1)=>{if(0===a.length)return;const s="Dark"===t.theme?{itemClass:"bg-dark text-light list-hover-dark",labelClass:"bg-dark text-light"}:{itemClass:"bg-light text-dark list-hover-light",labelClass:"bg-light text-dark"},i=document.createElement("li");i.className=`list-group-item fw-bold text-secondary ${s.labelClass}`,i.textContent=e,r.appendChild(i),a.forEach((e=>{const t=document.createElement("li");t.className=`list-group-item list-group-item-action ${s.itemClass}`;let a='<i class="fa-solid fa-layer-group text-muted me-2"></i>';n&&(a='<i class="fa-solid fa-microchip-ai text-muted me-2"></i>'),l&&(a='<i class="fa-solid fa-image text-muted me-2"></i>'),t.innerHTML=`${a} ${e.DisplayName}`,t.onclick=()=>{if(n){const t=document.getElementById("app-body");t.innerHTML='<div class="text-muted p-2">Loading...</div>',E(e,"AITag").catch((()=>t.innerHTML='<div class="text-danger p-2">Error loading data</div>')).then((e=>{t.innerHTML=e}))}else!async function(e,t){Word.run((async a=>{try{const n=a.document.getSelection();if(await a.sync(),!n)throw new Error("Selection is invalid or not found.");let r=n;if("TABLE"===t){const t=(new DOMParser).parseFromString(e.EditorValue,"text/html"),l=Array.from(t.body.childNodes);await a.sync();for(const e of l)if(e.nodeType===Node.TEXT_NODE){let t=e.textContent?.trim();t&&(t=t.replace(/\n- /g,"\n• "),t.split("\n").forEach((e=>{e.trim()&&S(n,e)})))}else if(e.nodeType===Node.ELEMENT_NODE){const t=e;if("table"===t.tagName.toLowerCase()){const e=Array.from(t.querySelectorAll("tr"));if(0===e.length){n.insertParagraph("[Empty Table]",Word.InsertLocation.before);continue}const l=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),s=n.insertParagraph("",Word.InsertLocation.before);await a.sync();const i=s.insertTable(e.length,l,Word.InsertLocation.after),c=o.getInstance(),d=O(c.tableStyle);if("none"!==d&&(i.style=d),await a.sync(),c.colorPallete.Customize)await j(i,e,a);else{const t=new Array(l).fill(0);let a=-1;e.forEach(((e,n)=>{const o=Array.from(e.querySelectorAll("td, th"));let r=0,s="";if(o.forEach((e=>{for(;t[r]>0;)t[r]--,r++;const a=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),o=parseInt(e.getAttribute("colspan")||"1",10),c=parseInt(e.getAttribute("rowspan")||"1",10);0===r&&(s=a.trim()),i.getCell(n,r).value=a;for(let e=1;e<o;e++)r+e<l&&(i.getCell(n,r+e).value="");if(c>1)for(let e=0;e<o;e++)r+e<l&&(t[r+e]=c-1);r+=o})),0!==n)if(s)a=n;else if(-1!==a){const e=i.getCell(a,0),t=i.getCell(n,0);e.merge(t);try{e.verticalAlignment=Word.VerticalAlignment.center,e.body.paragraphs.getFirst().alignment=Word.Alignment.center}catch(e){}}}))}r=i.getCell(0,0)}else{let e=t.innerText.trim();e&&(e=e.replace(/\n- /g,"\n• "),e.split("\n").forEach((e=>{e.trim()&&S(n,e)}))),r=n}}}else if("IMAGE"===t){let t=e.EditorValue;t.startsWith("data:image/svg+xml")?t=await M(t):t.startsWith("data:image")&&(t=t.split(",")[1]),n.insertInlinePictureFromBase64(t,Word.InsertLocation.replace),r=n}else""===e.EditorValue||e.IsApplied?n.insertParagraph(`#${e.DisplayName}#`,Word.InsertLocation.before):C(e.EditorValue).split(/\r?\n/).forEach((e=>{n.insertParagraph(e,Word.InsertLocation.before)})),r=n;const l=n.insertParagraph("",Word.InsertLocation.after);await a.sync(),r=l,n.select(),await a.sync()}catch(e){console.error("Detailed error:",e)}}))}(e,e.ComponentKeyDataType),r.replaceChildren()},r.appendChild(t)}))};m("Properties",c),m("AI Tags",i,!0),m("Images",d,!1,!0)}if(t.selectedNames.length>0){const a=document.getElementById("tags-in-selected-text");a.classList.remove("d-none"),a.classList.add("d-block"),$(t.selectedNames,e)}let s;n.addEventListener("input",(()=>{clearTimeout(s),s=setTimeout(l,300)})),document.getElementById("add-btn-tag").addEventListener("click",(()=>{t.isPendingResponse||le()})),document.getElementById("customized-table").addEventListener("click",(()=>{t.isPendingResponse||se("Custom")})),document.getElementById("predefined-table").addEventListener("click",(()=>{t.isPendingResponse||se("Pre")})),document.getElementById("apply-btn-tag").addEventListener("click",(()=>{t.isPendingResponse||te()}))}async function E(e,t){e.FilteredReportHeadAIHistoryList&&0!==e.FilteredReportHeadAIHistoryList.length||("Summary"!==t?await b.fetchAIHistory(e):await A.fetchSummaryAIHistory(e));const a=e.FilteredReportHeadAIHistoryList;if(0===a.length)return"<div>No AI history available.</div>";const n=o.getInstance(),r="Dark"===n.theme,l=r?"fa-solid fa-circle-xmark bg-dark text-light":"fa-solid fa-circle-xmark bg-light text-dark",s=`\n    <div class="chat-header sticky-top ${r?"bg-dark text-light":"bg-white text-dark"} z-3">\n        <div class="d-flex justify-content-between align-items-center px-2 pt-3">\n            <div class="d-flex align-items-center ms-3">\n                <i class="fa fa-microchip-ai text-muted me-2"></i>\n                <span class="fw-bold">${"Summary"===t?e.Name:e.DisplayName}</span>\n            </div>\n            <div class="d-flex justify-content-center align-items-center me-3 c-pointer" id="close-btn-tag">\n                <i class="${l}" id="close-ai-window"></i>\n            </div>\n        </div>\n        <hr class="mt-2 mb-1 mx-3">\n        </div>\n    `,i=`\n        <div class="chat-body flex-grow-1 overflow-auto">\n            ${function(e){const t=o.getInstance(),a="Dark"===t.theme?"bg-secondary text-light":"bg-white text-dark",n=t.UserRole.UserRoleEntityAccessList.find((e=>"Global Prompt Update"===e.UserRoleEntity));return e.map(((e,t)=>{const o=3===n?.UserRoleAccessID,r=e.Evidences&&e.Evidences.length>0;return`\n      <div class="row chat-entry m-0 p-0">\n        <div class="col-md-12 mt-2 p-2">\n          <div class="d-flex justify-content-between align-items-start">\n            \x3c!-- Prompt Box --\x3e\n            <div class="form-control h-34 d-flex align-items-center dynamic-height prompt-text ${a}" style="width: 95%;">\n              ${e.Prompt}\n            </div>\n\n            \x3c!-- Icons Stack --\x3e\n            <div class="d-flex flex-column align-items-center ms-2">\n              <i class="fa fa-copy text-secondary c-pointer mb-2" title="Copy Prompt" id="copyPrompt-${t}"></i>\n              ${o?`<i class="fa fa-save text-secondary c-pointer" title="Save Prompt" id="savePrompt-${t}"></i>`:""}\n            </div>\n          </div>\n        </div>\n\n        <div class="col-md-12 mb-2 p-2 d-flex">\n          <span class="d-flex align-items-baseline w-100">\n            <div class="flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response" id="responseContainer-${t}">\n              <input\n                class="form-check-input c-pointer me-2 response-checkbox"\n                type="checkbox"\n                id="checkbox-${t}"\n                ${1===e.Selected?"checked":""}>\n              <span id="responseText-${t}">${e.Response}</span>\n              <i class="fa fa-copy text-secondary c-pointer ms-2"\n                title="Copy Response"\n                id="copyResponse-${t}"></i>\n              ${r?`<i class="fa fa-folder-gear text-secondary c-pointer ms-2"\n                    title="Open Reference"\n                    id="openRefferance-${t}"></i>`:""}\n            </div>\n          </span>\n        </div>\n      </div>`})).join("")}(a)}\n        </div>\n    `,c=`\n        <div class="d-flex align-items-end justify-content-end chatbox p-2" id="chatFooter">\n            ${G(e)}\n        </div>\n    `;return x(e,n.jwt,n.availableKeys,t),`${s}${i}${c}`}function L(){const e=new Date,t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}_${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}function x(e,n,r,l){setTimeout((()=>{e.FilteredReportHeadAIHistoryList.forEach(((s,d)=>{e.textareavalue&&(document.getElementById("chatInput").value=e.textareavalue,delete e.textareavalue);const u=document.getElementById("chatInput"),p=document.getElementById("changeSourceButton");u&&p&&(p.disabled=0===u.value.trim().length,u.addEventListener("input",(()=>{u.value.trim().length>0?p.disabled=!1:p.disabled=!0}))),document.getElementById(`copyPrompt-${d}`)?.addEventListener("click",(()=>D(s.Prompt))),document.getElementById(`savePrompt-${d}`)&&document.getElementById(`savePrompt-${d}`)?.addEventListener("click",(()=>{const t=document.getElementById("confirmation-popup");t&&(t.innerHTML=i("Do you want to save the current prompt as a global default?"),setTimeout((()=>{document.getElementById("confirmation-popup-cancel")?.addEventListener("click",(()=>{t.innerHTML=""})),document.getElementById("confirmation-popup-confirm")?.addEventListener("click",(async()=>{try{let o;if(document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","true"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","true"),"Summary"===l){const t={Name:e.Name,Prompt:s.Prompt};o=await async function(e,t){const a=await fetch(`${m}/api/summarytag/update-prompt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(t,n)}else{let t=JSON.parse(JSON.stringify(e));t.Prompt=s.Prompt,o=await a(t,n)}o.Status?(c("Updated Succesfully","success"),t.innerHTML=""):(document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),c("Something went wrong","error"))}catch(e){document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),c("Something went wrong","error")}}))}),0))})),document.getElementById(`openRefferance-${d}`)&&document.getElementById(`openRefferance-${d}`)?.addEventListener("click",(()=>{const t=document.getElementById("confirmation-popup");if(t){const r=o.getInstance(),i="Summary"===l?r.sourceSummaryList:r.sourceList,d="Summary"===l?s.SourceVector:s.SourceValue,m=(Array.isArray(d)?d:d?String(d).split(","):[]).map((e=>"Summary"===l?i.find((t=>String(e)===String(t.VectorID))):i.find((t=>Number(e)===t.VectorID)))).filter((e=>!!e)),u={Data:s.Evidences,Name:"Summary"===l?e.Name:e.DisplayName,UserValue:s.Response,Sources:m};t.innerHTML=function(e){const t="Dark"===o.getInstance().theme;return`\n<div class="modal show d-block" tabindex="-1">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content p-2 ${t?"bg-dark text-light":"bg-light text-dark"}">\n      <div class="modal-header flex-column align-items-start border-0">\n        <span class="fw-bold mb-3">${e?.Name||""}</span>\n        <span class="d-block list-height">${e?.UserValue||""}</span>\n        ${e?.Sources?`\n        <hr class="${t?"border-light":"border-dark"}">\n        <div class="d-flex align-items-start flex-wrap">\n          <span class="fw-bold me-2">Selected Sources :</span>\n          <div class="d-flex flex-wrap gap-1">\n            ${e.Sources.map((e=>`\n              <span class="badge ${t?"text-bg-secondary":"text-bg-info"}">${e.FileName}</span>\n            `)).join("")}\n          </div>\n        </div>`:""}\n      </div>\n\n      <div class="modal-body p-3 add-ai-gen">\n        <div class="row g-2 list-height">\n          ${e?.Data?.map((e=>`\n            <div class="col-md-12 mt-3">\n              <div class="border rounded p-2 ${t?"bg-secondary text-light":"bg-light text-dark"} shadow-sm h-100">\n                <div class="fw-bold small text-truncate" title="${e.FileName}">\n                  ${e.FileName}\n                </div>\n                <div class="text-muted small mb-1">Page: ${e.PageNumber}</div>\n                <div class="small" style="white-space: normal;">\n                  ${e.Sentence}\n                </div>\n              </div>\n            </div>\n          `)).join("")}\n        </div>\n\n        <div class="d-flex w-100 justify-content-end mt-3 align-items-center">\n          <button type="button" class="btn btn-primary text-white" id="datamodel-popup-ok">OK</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>`}(u),setTimeout((()=>{document.getElementById("confirmation-popup-cancel")?.addEventListener("click",(()=>{t.innerHTML=""})),document.getElementById("confirmation-popup-confirm")?.addEventListener("click",(async()=>{try{document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","true"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","true");let o=JSON.parse(JSON.stringify(e));o.Prompt=s.Prompt,(await a(o,n)).Status?(c("Updated Succesfully","success"),t.innerHTML=""):(document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),c("Something went wrong","error"))}catch(e){document.getElementById("confirmation-popup-cancel")?.setAttribute("disabled","false"),document.getElementById("confirmation-popup-confirm")?.setAttribute("disabled","false"),c("Something went wrong","error")}})),document.getElementById("datamodel-popup-ok")?.addEventListener("click",(async()=>{t.innerHTML=""}))}),0)}})),document.getElementById(`copyResponse-${d}`)?.addEventListener("click",(()=>D(s.Response)));const f=document.getElementById(`checkbox-${d}`);f&&f.addEventListener("change",(async a=>{const i=a.target.checked;if(e.FilteredReportHeadAIHistoryList.forEach(((t,a)=>{const n=document.getElementById(`checkbox-${a}`),o=document.getElementById(`responseContainer-${a}`);n&&(n.checked=!1),o&&(o.classList.remove("ai-selected-response"),o.classList.add("bg-light")),e.FilteredReportHeadAIHistoryList[a].Selected=0})),i){f.checked=!0;const e=document.getElementById(`responseContainer-${d}`);e&&(e.classList.add("ai-selected-response"),e.classList.remove("bg-light")),s.Selected=1}else s.Selected=0;try{const a="Summary"===l?await async function(e,t){const a=await fetch(`${m}/api/report/summary-history/update`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(s,n):await async function(e,a){const n=await fetch(`${t}/api/report/ai-history/update`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(s,n);if(a.Data){e.ReportHeadAIHistoryList=JSON.parse(JSON.stringify(a.Data)),e.FilteredReportHeadAIHistoryList=[],e.ReportHeadAIHistoryList.forEach((t=>{t.Response=C(t.Response),e.FilteredReportHeadAIHistoryList.unshift(t)}));const t=s.FormattedResponse?"\n"+H(s.FormattedResponse):s.Response;e.ComponentKeyDataType=s.FormattedResponse?"TABLE":"TEXT",e.UserValue=t,e.EditorValue=t,e.text=t;const n=e.FilteredReportHeadAIHistoryList.some((e=>1===e.Selected));e.IsApplied=!n,r.forEach((t=>{if(t.ID===e.ID){const a=""!==s.FormattedResponse,n=s.FormattedResponse?"\n"+H(s.FormattedResponse):s.Response;t.ComponentKeyDataType=a?"TABLE":"TEXT",t.UserValue=n,t.EditorValue=n,t.text=n,t.IsApplied=e.IsApplied}})),o.getInstance().aiTagList.forEach((t=>{if(t.ID===e.ID){const a=""!==s.FormattedResponse,n=s.FormattedResponse?"\n"+H(s.FormattedResponse):s.Response;t.ComponentKeyDataType=a?"TABLE":"TEXT",t.UserValue=n,t.EditorValue=n,t.text=n,t.IsApplied=e.IsApplied}}))}}catch(e){console.error("Failed to update AI history:",e)}}))})),document.getElementById("close-btn-tag")?.addEventListener("click",(()=>{const e=o.getInstance();"Home"===e.mode?I(r):"Summary"===e.mode&&v()})),document.getElementById("insertTagButton")?.addEventListener("click",(()=>{e.IsApplied||async function(e){Word.run((async t=>{try{const a=t.document.getSelection();if(await t.sync(),!a)throw new Error("Invalid selection");const n=a.insertText("​",Word.InsertLocation.replace);await t.sync();let r=n.getRange(),l=null,s=null;const i=e=>{l||(l=e.getRange("Start")),s=e.getRange("End")};if("TABLE"===e.ComponentKeyDataType){const a=(new DOMParser).parseFromString(e.EditorValue,"text/html"),n=Array.from(a.body.childNodes);for(const e of n)if(e.nodeType===Node.TEXT_NODE){let t=e.textContent?.trim();if(!t)continue;t=t.replace(/\n- /g,"\n• ");for(const e of t.split("\n")){if(!e.trim())continue;const t=r.insertParagraph("",Word.InsertLocation.after);S(t,e),i(t.getRange()),r=t.getRange()}}else if(e.nodeType===Node.ELEMENT_NODE){const a=e;if("table"===a.tagName.toLowerCase()){const e=Array.from(a.querySelectorAll("tr"));if(!e.length)continue;const n=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1")),0)))),l=r.insertParagraph("",Word.InsertLocation.after).insertTable(e.length,n,Word.InsertLocation.after),s=o.getInstance(),c=O(s.tableStyle);if("none"!==c&&(l.style=c),s.colorPallete.Customize)await j(l,e,t);else{const t=new Array(n).fill(0);let a=-1;e.forEach(((e,o)=>{const r=Array.from(e.querySelectorAll("td, th"));let s=0,i="";if(r.forEach((e=>{for(;t[s]>0;)t[s]--,s++;const a=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),r=parseInt(e.getAttribute("colspan")||"1",10),c=parseInt(e.getAttribute("rowspan")||"1",10);0===s&&(i=a.trim()),l.getCell(o,s).value=a;for(let e=1;e<r;e++)s+e<n&&(l.getCell(o,s+e).value="");if(c>1)for(let e=0;e<r;e++)s+e<n&&(t[s+e]=c-1);s+=r})),0!==o)if(i)a=o;else if(-1!==a){const e=l.getCell(a,0),t=l.getCell(o,0);e.merge(t);try{e.verticalAlignment=Word.VerticalAlignment.center,e.body.paragraphs.getFirst().alignment=Word.Alignment.center}catch(e){}}}))}i(l.getRange()),r=l.getRange()}else{let e=a.innerText?.trim();if(!e)continue;e=e.replace(/\n- /g,"\n• ");for(const t of e.split("\n")){if(!t.trim())continue;const e=r.insertParagraph("",Word.InsertLocation.after);S(e,t),i(e.getRange()),r=e.getRange()}}}}else{const t=e.EditorValue.replace(/\n- /g,"\n• ").trim();for(const e of t.split("\n")){if(!e.trim())continue;const t=r.insertParagraph("",Word.InsertLocation.after);S(t,e),i(t.getRange()),r=t.getRange()}}if(await t.sync(),l&&s){const t=`ID${e.ID}_Split_${L()}`;l.expandTo(s).insertBookmark(t)}n.delete(),await t.sync(),c("Inserted successfully","success")}catch(e){console.error(e),c("Something went wrong","error")}}))}(e)})),document.getElementById("sendPromptButton")?.addEventListener("click",(()=>{const t=document.getElementById("chatInput").value;b.sendPrompt(e,t,l)})),document.getElementById("changeSourceButton")?.addEventListener("click",(()=>{const t=document.getElementById("chatInput").value;e.textareavalue=t,ce(e,l)})),ie("chatInput","mention-dropdown","edit")}),0)}function S(e,t){let a=Word.BuiltInStyleName.normal,n=t;t.startsWith("###### ")?(a=Word.BuiltInStyleName.heading6,n=t.substring(7).trim()):t.startsWith("##### ")?(a=Word.BuiltInStyleName.heading5,n=t.substring(6).trim()):t.startsWith("#### ")?(a=Word.BuiltInStyleName.heading4,n=t.substring(5).trim()):t.startsWith("### ")?(a=Word.BuiltInStyleName.heading3,n=t.substring(4).trim()):t.startsWith("## ")?(a=Word.BuiltInStyleName.heading2,n=t.substring(3).trim()):t.startsWith("# ")&&(a=Word.BuiltInStyleName.heading1,n=t.substring(2).trim()),e.styleBuiltIn=a;const o=/(\*\*(.+?)\*\*)|(\*(.+?)\*)|(_(.+?)_)/g;let r,l=0;for(;null!==(r=o.exec(n));){r.index>l&&e.insertText(n.substring(l,r.index),Word.InsertLocation.end);let t="",a=!1,s=!1,i=!1;r[1]?(t=r[2],a=!0):r[3]?(t=r[4],s=!0):r[5]&&(t=r[6],i=!0);const c=e.insertText(t,Word.InsertLocation.end);c.font.bold=a,c.font.italic=s,c.font.underline=i?Word.UnderlineType.single:Word.UnderlineType.none,l=o.lastIndex}l<n.length&&e.insertText(n.substring(l),Word.InsertLocation.end)}function C(e){return e?e.replace(/^"|"$/g,"").replace(/\\n/g,"").replace(/\*\*/g,"").replace(/\\r/g,""):""}function D(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),c("Copied to clipboard successfully!","success")}function B(){document.querySelector(".nav-link.active")?.classList.remove("active"),document.querySelector(".tab-pane.show.active")?.classList.remove("show","active"),document.getElementById("tag-tab").classList.add("active"),document.getElementById("add-tag-body").classList.add("show","active")}function H(e){const t=/<TableStart>([\s\S]*?)<TableEnd>/gi;let a,n=[];for(;null!==(a=t.exec(e));)try{const e=JSON.parse(a[1]);n.push(N(e))}catch(e){console.error("Failed to parse JSON:",e,a[1])}let o=0;return e.replace(t,(()=>n[o++]||""))}function N(e){if(!e||Array.isArray(e)&&0===e.length)return"<p>No data available</p>";let t=new Set,a=[];function n(e,t="",a={}){return Object.keys(e).forEach((o=>{const r=e[o],l=t?`${t} > ${o}`:o;"object"!=typeof r||null===r||Array.isArray(r)?Array.isArray(r)?a[l]=r.map((e=>"object"==typeof e?Object.entries(e).map((([e,t])=>`<strong>${e}:</strong> ${t}`)).join("<br>"):e)).join("<br>"):a[l]=r:n(r,l,a)})),a}Array.isArray(e)||(e=Object.entries(e).map((([e,t])=>({[e]:t})))),e.forEach((e=>{let o=n(e);Object.keys(o).forEach((e=>t.add(e))),a.push(o)}));let o='<table border="1" cellspacing="0" cellpadding="5">';return o+="<tr>"+[...t].map((e=>`<th>${e}</th>`)).join("")+"</tr>",a.forEach((e=>{o+="<tr>"+[...t].map((t=>`<td>${e[t]}</td>`)).join("")+"</tr>"})),o+="</table>",o}function G(e){return` <textarea class="form-control ${"Dark"===o.getInstance().theme?"bg-secondary text-light":"bg-white text-dark"}"\n                      rows="5"\n                      id="chatInput"\n                      ></textarea>\n            <div id="mention-dropdown" class="dropdown-menu"></div>\n            <div class="d-flex flex-column align-self-end me-3">\n              <button class="btn btn-secondary text-light ms-2 mb-2 ngb-tooltip" id="insertTagButton">\n                <span class="tooltiptext">Insert</span>\n                <i class="fa fa-plus text-light c-pointer"></i>\n              </button>\n             <div class="ngb-tooltip d-inline-block">\n                 ${e.Sources&&e.Sources.length>0?`  <span class="tooltiptext">${e.Sources}</span>`:'<span class="tooltiptext">Source</span>'}\n                <button class="btn btn-secondary ms-2 mb-2 text-white" id="changeSourceButton">\n                  <i class="fa fa-file-lines text-white"></i>\n                </button>\n              </div>\n\n              <button type="submit" class="btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip" id="sendPromptButton">\n                <span class="tooltiptext">Send</span>\n                <i class="fa fa-paper-plane text-white"></i>\n              </button>\n            </div>`}function $(e,t){const a=document.getElementById("tag-badge-wrapper");a&&(a.innerHTML="",[...new Set(e.map((e=>e.toLowerCase())))].map((t=>e.find((e=>e.toLowerCase()===t)))).forEach((e=>{let n;if(n=/^ID\d+$/i.test(e)?t.find((t=>1===t.AIFlag&&`id${t.ID}`.toLowerCase()===e.toLowerCase())):t.find((t=>1===t.AIFlag&&t.DisplayName.toLowerCase()===e.toLowerCase())),n?.DisplayName){const t=document.createElement("span");t.className="badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable",t.style.cursor="pointer",t.innerHTML=`${n.DisplayName} <i class="fa-solid fa-microchip-ai ms-2 text-muted" aria-label="AI Suggested"></i>`,t.addEventListener("click",(async()=>{if(await F(e),n){const e=document.getElementById("app-body");e.innerHTML='<div class="text-muted p-2">Loading...</div>',E(n,"AITag").then((t=>{e.innerHTML=t}))}})),a.appendChild(t)}})))}const P={Home:"fa-home",Summary:"fa-wand-magic-sparkles",Review:"fa-magnifying-glass"};function R(){const e=document.getElementById("modeDropdown");if(!e)return;const t=o.getInstance();e.classList.remove(...Object.values(P)),e.classList.add(P[t.mode]),sessionStorage.setItem("mode",t.mode)}async function F(e){return Word.run((async t=>{const a=t.document.getSelection().getBookmarks();await t.sync();const n=a.value.find((t=>t.split("_Split_")[0].replace(/_/g," ").toLowerCase()===e.toLowerCase()));if(n){const e=t.document.getBookmarkRangeOrNullObject(n);e.load("isNullObject"),await t.sync(),e.isNullObject||e.select()}}))}async function j(e,t,a){let n=-1;t.forEach(((t,a)=>{const o=Array.from(t.querySelectorAll("td, th"));let r=0,l="";if(o.forEach((t=>{const n=t.innerText.trim();0===r&&(l=n),e.getCell(a,r).value=n,r++})),a>0)if(l)n=a;else if(-1!==n){const t=e.getCell(n,0),o=e.getCell(a,0);t.merge(o);try{t.verticalAlignment=Word.VerticalAlignment.center,t.body.paragraphs.getFirst().alignment=Word.Alignment.center}catch(e){}}})),await a.sync(),e.rows.load("items"),await a.sync();const r=o.getInstance(),l=(e,t,a)=>{let n="Normal";r.colorPallete.IsHeaderBold&&0===t&&(n="Bold"),r.colorPallete.IsSideHeaderBold&&0===a&&(n="Bold"),e.body.font.bold="Bold"===n},s=(e,t)=>{e.shadingColor=t;try{e.font.color=(e=>{const t=e.replace("#","");return(.299*parseInt(t.substring(0,2),16)+.587*parseInt(t.substring(2,4),16)+.114*parseInt(t.substring(4,6),16))/255<.5})(t)?"#FFFFFF":"#000000";const a="#D3D3D3";e.getBorder&&["Top","Bottom","Left","Right"].forEach((t=>{e.getBorder(t).type="Single",e.getBorder(t).color=a,e.getBorder(t).width=1}))}catch(e){}},i=r.tableStyle.split(" - ")[0].trim();if("Plain Table 3"===i)e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,a)=>{let n=r.colorPallete.Primary;n=0===t||0===a?r.colorPallete.Header:t%2==1?r.colorPallete.Primary:r.colorPallete.Secondary,s(e,n),l(e,t,a)}))}));else if("Plain Table 2"===i){e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync();const t=e.rows.items.length,n=0,o=t-1;e.rows.items.forEach(((e,t)=>{t!==n&&t!==o&&(e.getBorder(Word.BorderLocation.bottom).type=Word.BorderType.none)})),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,a)=>{let n=r.colorPallete.Primary;n=0===t?r.colorPallete.Header:t%2==1?r.colorPallete.Primary:r.colorPallete.Secondary,s(e,n),l(e,t,a)}))})),await a.sync()}else if("Plain Table 5"===i)e.getBorder(Word.BorderLocation.insideVertical).type=Word.BorderType.none,e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,a)=>{let n=r.colorPallete.Primary;n=0===t?r.colorPallete.Header:t%2==1?r.colorPallete.Primary:r.colorPallete.Secondary,s(e,n),l(e,t,a)}))}));else if("Table Grid"===i)e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{const a=t%2==0?r.colorPallete.Header:r.colorPallete.Primary;s(e,a),e.cells.items.forEach(((e,a)=>{l(e,t,a)}))}));else if("Table Grid 1"===i){e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{const a=t%2==0?r.colorPallete.Header:r.colorPallete.Primary;s(e,a),e.cells.items.forEach(((e,a)=>{l(e,t,a)}))}));const t=e.rows.items[0].getBorder(Word.BorderLocation.bottom);t.type=Word.BorderType.double,t.width=.5,t.color="000000",await a.sync()}else if(i.startsWith("Grid Table 4")){const t=e.rows.items[0];s(t,r.colorPallete.Header),e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{if(t>0){const a=t%2==0?r.colorPallete.Secondary:r.colorPallete.Primary;s(e,a)}e.cells.items.forEach(((e,a)=>{l(e,t,a)}))}))}else if(i.startsWith("Grid Table 5 Dark"))e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,a)=>{let n=r.colorPallete.Primary;n=0===t||0===a?r.colorPallete.Header:t%2==1?r.colorPallete.Primary:r.colorPallete.Secondary,s(e,n),l(e,t,a)}))}));else if(i.startsWith("List Table 3")){const t=e.rows.items[0];s(t,r.colorPallete.Header),e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{t>0&&s(e,r.colorPallete.Primary),e.cells.items.forEach(((e,a)=>{l(e,t,a)}))}))}else i.startsWith("List Table 2")?(e.rows.items.forEach((e=>e.cells.load("items"))),await a.sync(),e.rows.items.forEach(((e,t)=>{e.cells.items.forEach(((e,a)=>{let n=r.colorPallete.Primary;n=0===t?r.colorPallete.Header:t%2==1?r.colorPallete.Primary:r.colorPallete.Secondary,s(e,n),l(e,t,a)}))}))):e.rows.items.forEach((e=>s(e,r.colorPallete.Primary)));await a.sync()}function z(e){return e?[...e.Flowchart||[],...e.Graph||[],...e.Image||[]].map((e=>({Name:e.ImageName,DisplayName:e.ImageName,EditorValue:e.ImageData,UserValue:e.ImageData,ComponentKeyDataType:"IMAGE",AIFlag:0,IsImage:!0}))):[]}async function M(e){return new Promise(((t,a)=>{try{const n=new Blob([atob(e.split(",")[1])],{type:"image/svg+xml"}),o=URL.createObjectURL(n),r=new Image;r.crossOrigin="anonymous",r.onload=function(){const e=document.createElement("canvas");e.width=r.width||1200,e.height=r.height||800;const n=e.getContext("2d");if(!n)return a("Canvas unsupported.");n.drawImage(r,0,0);const l=e.toDataURL("image/png").split(",")[1];t(l),URL.revokeObjectURL(o)},r.onerror=()=>a("SVG load failed."),r.src=o}catch(e){a(e)}}))}function O(e){const t=Office.context.displayLanguage?.toLowerCase().slice(0,2)||"en";return s[t]?.[e]??s.en[e]??"none"}class W{static transformDocumentName(e){if(!e||""===e.trim())return e;const t=e.split("_");return t.length<=1?e:t.slice(1).join("_").replace(/%20/g," ").replace(/%25/g,"%")}static async loadReportData(e,a,n){try{console.log(`Fetching report data for ID: ${e}`);const n=await async function(e,a){const n=await fetch(`${t}/api/report/id/${e}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error("Network response was not ok");return await n.json()}(e,a);if(!n.Status||!n.Data)throw new Error("Failed to fetch report data");const o=n.Data;o.SourceTypeList||(o.SourceTypeList=[]);const r=o.SourceTypeList.filter((e=>""!==e.SourceValue&&1===e.AIFlag)).map((e=>({...e,SourceName:decodeURIComponent(W.transformDocumentName(e.SourceValue))}))),l=o.ClientID,s=o.Group.find((e=>"AIGroup"===e.DisplayName)),i=s?s.Name:"",c=s?s.GroupKey:[];let d=o.GroupKeyAll.filter((e=>"TABLE"===e.ComponentKeyDataType||"TEXT"===e.ComponentKeyDataType));const m=[],u=e=>{1===e.AIFlag&&null!==/<TableStart>([\s\S]*?)<TableEnd>/gi.exec(e.EditorValue)&&(e.EditorValue=H(e.EditorValue),e.UserValue=e.EditorValue,e.InitialTable=!0,e.ComponentKeyDataType="TABLE")};return d.forEach(u),c.forEach(u),{dataList:o,availableKeys:d,sourceList:r,clientId:l,groupName:i,aiTagList:c,imageList:m,clientList:[],promptBuilderList:[]}}catch(e){throw console.error("Error in loadReportData:",e),e}}static async retrieveDocumentProperties(){try{return await Word.run((async e=>{const t=e.document.properties.customProperties;t.load("items"),await e.sync();const a=t.items.find((e=>"DocumentID"===e.key)),n=t.items.find((e=>"Organization"===e.key));return a&&n?{documentID:a.value,organizationName:n.value}:null}))}catch(e){throw console.error("Error retrieving document properties",e),e}}static async insertText(e){await Word.run((async t=>{t.document.body.insertParagraph(e,Word.InsertLocation.end),await t.sync()}))}}class V{static showNotification(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),document.getElementById("toastr"),"function"==typeof window.toaster?window.toaster(e,t):alert(e)}static toggleLoader(e){const t=document.getElementById("page-loader");t&&(t.style.display=e?"flex":"none")}static renderLoginPage(e,t,a){const n=document.getElementById("logo-header");n&&(n.innerHTML=`\n            <img id="main-logo" src="${e}/assets/logo.png" alt="" class="logo">\n            <div class="icon-nav me-3">\n                <span id="theme-toggle"><i class="fa fa-moon c-pointer me-3"  title="Toggle Theme"></i><span>\n            </div>`);const o=document.getElementById("app-body");o&&(o.innerHTML='\n            <div class="container pt-2">\n            <form id="login-form" class="p-4 border rounded">\n                <div class="mb-3">\n                <label for="organization" class="form-label fw-bold">Organization</label>\n                <input type="text" class="form-control" id="organization" required>\n                </div>\n                <div class="mb-3">\n                <label for="username" class="form-label fw-bold">Username</label>\n                <input type="text" class="form-control" id="username" required>\n                </div>\n                <div class="mb-3">\n                <label for="password" class="form-label fw-bold">Password</label>\n                <input type="password" class="form-control" id="password" required>\n                </div>\n                <div class="d-grid">\n                <button type="submit" class="btn btn-primary bg-primary-clr">Login</button>\n                </div>\n            <div id="login-error" class="mt-3 text-danger" style="display: none;"></div>\n            </form>\n            </div>'),document.getElementById("theme-toggle")?.addEventListener("click",a),document.getElementById("login-form")?.addEventListener("submit",t)}static applyTheme(e){const t="Dark"===e,a="Light"===e,n=(e,n,o)=>{const r=document.querySelectorAll(e),l=n.split(" "),s=o.split(" ");r.forEach((e=>{e&&(e.classList.remove(...l),e.classList.remove(...s),t&&e.classList.add(...l),a&&e.classList.add(...s))}))};document.body.classList.toggle("dark-theme",t),document.body.classList.toggle("light-theme",a),n("#app-body","bg-dark text-light","bg-white text-dark"),n("#search-box","bg-secondary text-light border-0","bg-white text-dark border"),n(".dropdown-menu","bg-dark text-light border-light","bg-white text-dark border"),n(".list-group-item","bg-dark text-light","bg-white text-dark"),n(".dropdown-toggle","bg-dark text-light border-0","bg-white text-dark border"),n(".dropdown-item","bg-dark text-light","bg-white text-dark"),n(".card","bg-dark text-light border-secondary","bg-white text-dark border"),n(".card-header","bg-secondary text-light border-secondary","bg-light text-dark border-bottom"),n(".box","bg-dark text-light border-secondary","bg-light text-dark border"),n(".modal-content","bg-dark text-light border-secondary","bg-white text-dark border"),n(".list-group-item-action","bg-dark text-light list-hover-dark","bg-light text-dark list-hover-light"),n("#close-ai-window","fa-solid fa-circle-xmark bg-dark text-light","fa-solid fa-circle-xmark bg-light text-dark"),n("#chatInput","bg-secondary text-light","bg-white text-dark"),n(".prompt-text","bg-secondary text-light","bg-white text-dark");const o=document.getElementById("theme-toggle"),r=o?.querySelector("i");r&&(t?(r.classList.remove("fa-moon"),r.classList.add("fa-sun")):(r.classList.remove("fa-sun"),r.classList.add("fa-moon")))}static attachDashboardEvents(e){document.getElementById("home")?.addEventListener("click",e.onHome),document.getElementById("summary-mode")?.addEventListener("click",e.onSummary),document.getElementById("glossary")?.addEventListener("click",e.onGlossary),document.getElementById("define-formatting")?.addEventListener("click",e.onFormat),document.getElementById("removeFormatting")?.addEventListener("click",e.onRemoveFormat),document.getElementById("theme-toggle")?.addEventListener("click",e.onThemeToggle),document.getElementById("logout")?.addEventListener("click",e.onLogout)}}function q(){const t=o.getInstance();V.renderLoginPage(e.storeUrl,U,(()=>{t.theme="Light"===t.theme?"Dark":"Light",V.applyTheme(t.theme),sessionStorage.setItem("theme",t.theme)}))}async function U(e){e.preventDefault();const t=document.getElementById("organization").value,a=document.getElementById("username").value,r=document.getElementById("password").value,l=o.getInstance();if(t.toLowerCase().trim()===l.organizationName.toLocaleLowerCase().trim()){V.toggleLoader(!0);const e=await n.login(t,a,r);if(e.success){const t=e.data,a=o.getInstance();a.jwt=t.token,a.UserRole=t.userRole;const n=sessionStorage.getItem("tableStyle");n&&(a.tableStyle=n);const r=sessionStorage.getItem("colorPallete");r&&(a.colorPallete=JSON.parse(r)),c("You are successfully logged in","success"),_(),window.location.hash="#/dashboard"}else K(e.message||"Login failed")}else K("The organization specified is not associated with this document")}function K(e){q();const t=document.getElementById("login-error");t.style.display="block",t.textContent=e}function _(){o.getInstance().userId=Number(sessionStorage.getItem("userId")),J("Init")}async function J(a){V.toggleLoader(!0);try{const n=o.getInstance(),r=sessionStorage.getItem("userId")||"0",l=await W.loadReportData(n.documentID,n.jwt,r);n.dataList=l.dataList,await async function(){const e=o.getInstance(),a=await async function(e){const a=await fetch(`${t}/api/custom-table/all`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(e.jwt);e.customTableStyle=a.Data;const n=e.customTableStyle.find((t=>t.ID===e.dataList.TableCustomizationID));n&&(sessionStorage.setItem("CustomStyle",n?n.Name:""),e.colorPallete={Header:n.Setting.HeaderColor,Primary:n.Setting.PrimaryColor,Secondary:n.Setting.SecondaryColor,Customize:!0,IsHeaderBold:n.Setting.IsHeaderBold,IsSideHeaderBold:n.Setting.IsSideHeaderBold},e.tableStyle=n.Setting.BaseStyle)}(),await async function(){const e=o.getInstance();try{const a=await async function(e){const a=await fetch(`${t}/api/prompt-template/all`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(e.jwt);a.Status&&a.Data&&(e.promptBuilderList=a.Data)}catch(e){console.error("Error fetching prompt templates:",e)}}(),n.availableKeys=l.availableKeys,n.sourceList=l.sourceList,n.clientId=l.clientId,n.aiTagList=l.aiTagList,n.imageList=l.imageList,n.clientList=l.clientList,"AIpanel"!==a&&"Refresh"!==a&&"Init"!==a||("Home"===n.mode&&I(n.availableKeys),"Summary"===n.mode&&v(n.availableKeys));const s=document.getElementById("logo-header");s&&(s.innerHTML=function(e){const t=o.getInstance(),a="Dark"===t.theme?"fa-sun":"fa-moon";return`\n    <img id="main-logo" src="${e}/assets/logo.png" alt="" class="logo">\n    <div class="icon-nav me-3">\n    <div class="dropdown d-inline">\n        <i class="fa ${"Home"===t.mode?"fa-home":"Summary"===t.mode?"fa-wand-magic-sparkles":"fa-magnifying-glass"} c-pointer me-3" id="modeDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Mode"></i>\n        <ul class="dropdown-menu" aria-labelledby="modeDropdown" appendTo="body">\n        <li>\n            <a class="dropdown-item" href="#" id="home">\n              <i class="fa fa-home me-2" aria-hidden="true"></i> Draft Mode\n            </a>\n          </li>\n          <li>\n            <a class="dropdown-item" href="#" id="summary-mode">\n              <i class="fa fa-wand-magic-sparkles me-2" aria-hidden="true"></i> Summary Mode\n            </a>\n          </li>\n          <li>\n            <a class="dropdown-item disabled-link" href="#" id="review-mode">\n              <i class="fa fa-magnifying-glass me-2" aria-hidden="true"></i> Review Mode\n            </a>\n          </li>\n        </ul>\n      </div>\n\n\n      <div class="dropdown d-inline">\n        <i class="fa fa-tools c-pointer me-3" id="settingsDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Settings"></i>\n        <ul class="dropdown-menu" aria-labelledby="settingsDropdown">\n        <li>\n            <a class="dropdown-item" href="#" id="define-formatting">\n              <i class="fa fa-sliders-h me-2" aria-hidden="true"></i> Define Formatting\n            </a>\n          </li>\n          <li>\n            <a class="dropdown-item disabled-link" href="#" id="glossary" tabindex="-1" aria-disabled="true">\n              <i class="fa fa-book me-2" aria-hidden="true"></i> Apply Glossary\n            </a>\n          </li>\n          <li>\n            <a class="dropdown-item disabled-link" href="#" id="removeFormatting" tabindex="-1" aria-disabled="true">\n              <i class="fa fa-eraser me-2" aria-hidden="true"></i> Remove Formatting\n            </a>\n          </li>\n        </ul>\n      </div>\n\n      \x3c!-- Theme Toggle Icon --\x3e\n      <span id="theme-toggle"><i class="fa ${a} c-pointer me-3" title="Toggle Theme"></i></span>\n\n      <i class="fa fa-sign-out c-pointer me-3" id="logout" title="Logout"></i>\n    </div>    \n  `}(e.storeUrl)),R(),V.toggleLoader(!1),async function(){try{const e=o.getInstance(),a=sessionStorage.getItem("userId")||"0",n=async function(e){const a=await fetch(`${t}/api/image/general`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(e.jwt),r=async function(e,a){const n=await fetch(`${t}/api/image/report-head/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(e.dataList.ID,e.jwt),l=async function(e,a){const n=await fetch(`${t}/api/client/all/${e}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error("Network response was not ok");return await n.json()}(a,e.jwt),[s,i,d]=await Promise.all([n,r,l]),m=z(s.Data),u=z(i.Data);e.dataList.GroupKeyAll.push(...m),e.dataList.GroupKeyAll.push(...u),e.availableKeys.push(...m),e.availableKeys.push(...u),e.imageList=e.dataList.GroupKeyAll.filter((e=>"IMAGE"===e.ComponentKeyDataType)),d.Status&&d.Data&&(e.clientList=d.Data),e.imageList&&e.imageList.length>0&&c("Images and data are loaded and ready for use","success")}catch(e){console.error("Error loading background data:",e)}}(),V.attachDashboardEvents({onHome:async()=>{n.isPendingResponse||(n.isGlossaryActive&&await re(),I(n.availableKeys)),n.mode="Home",R()},onSummary:async()=>{n.isPendingResponse||(n.isGlossaryActive&&await re(),v(n.availableKeys)),n.mode="Summary",R()},onGlossary:()=>{n.emptyFormat&&async function(){o.getInstance().isTagUpdating||(document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n\n        <div id="highlighted-text"></div>',ae())}()},onFormat:()=>{n.isPendingResponse||Y()},onRemoveFormat:()=>{Object.keys(n.capturedFormatting).length>0&&async function(){const e=o.getInstance();if(!e.isTagUpdating){e.isGlossaryActive&&await re();const t='\n      <div class="container pt-3">\n        <div class="card">\n          <div class="card-header">\n            <h5 class="card-title">Are you sure you want to remove formatted text ?</h5>\n          </div>\n          <div class="card-body">\n          <div id="format-details">\n              <h5>Selected Formatting:</h5>\n              <ul id="format-list" class="list-unstyled mb-3"></ul>\n              <small class="text-secondary font-italic" id="warning-rem-fmt"></small>\n             \n            </div>\n               \x3c!-- Buttons for Capture and Empty Format --\x3e\n\n            <div class="mt-3 d-flex justify-content-between">\n              <span id="change-ft-btn" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n              <button id="clear-ft-btn" class="btn btn-primary px-3"><i class="fa fa-check-circle me-2"></i>Yes</button>\n\n            </div>\n\n            \n          </div>\n        </div>\n      </div>\n    ';document.getElementById("app-body").innerHTML=t,X(),null===e.capturedFormatting["Background Color"]&&"#000000"===e.capturedFormatting["Text Color"]&&(document.getElementById("warning-rem-fmt").innerHTML="Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?"),document.getElementById("clear-ft-btn").addEventListener("click",ee),document.getElementById("change-ft-btn").addEventListener("click",Y)}}()},onThemeToggle:()=>{n.theme="Light"===n.theme?"Dark":"Light",V.applyTheme(n.theme),sessionStorage.setItem("theme",n.theme)},onLogout:async()=>{n.isPendingResponse||(n.isGlossaryActive&&await re(),async function(){const e=o.getInstance();e.isGlossaryActive&&await re(),sessionStorage.clear(),window.location.hash="#/new",e.initialised=!0,document.getElementById("logo-header").innerHTML="",async function(){const e=sessionStorage.getItem("token"),t=o.getInstance();if(e){t.UserRole=JSON.parse(sessionStorage.getItem("userRole"))||"",t.jwt=e,window.location.hash="#/dashboard";const a=sessionStorage.getItem("tableStyle");a&&(t.tableStyle=a);const n=sessionStorage.getItem("colorPallete");n&&(t.colorPallete=JSON.parse(n))}else q()}()}())}}),"Init"===a&&Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,oe),V.toggleLoader(!1)}catch(e){console.error("Error loading document data",e),V.showNotification("Error loading data","error"),V.toggleLoader(!1)}}async function Y(){const e=o.getInstance();if(!e.isTagUpdating){e.isGlossaryActive&&await re();const t='\n      <div class="container pt-3">\n        <div class="card">\n          <div class="card-header">\n               \x3c!-- Buttons for Capture and Empty Format --\x3e\n            <div class="d-flex justify-content-end">\n              <button id="capture-format-btn" class="btn btn-primary bg-primary-clr"><i class="fa fa-border-style me-1"></i>  Capture Format</button>\n            </div>\n            \x3c!-- <h5 class="card-title">Formatting Options</h5> --\x3e\n          </div>\n          <div class="card-body">\n          <div class="formating-checkbox">\n               <input type="checkbox" id="empty-format-checkbox" class="form-check-input">\n              <label for="empty-format-checkbox" class="form-check-label empty-format-checkbox-label" style="flex: 1;">\n                   Skip ignoring and removing format-based text\n              </label>\n            </div>\n\n            \x3c!-- Section to display captured formatting --\x3e\n            <div id="format-details">\n              <h5 class="my-3">Selected Formatting:</h5>\n              <ul id="format-list" class="list-unstyled"></ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';document.getElementById("app-body").innerHTML=t,0===Object.keys(e.capturedFormatting).length&&(document.getElementById("format-details").style.display="none");const a=document.getElementById("glossary");if(a.classList.contains("disabled-link")||a.classList.add("disabled-link"),e.emptyFormat)Q();else if(null===e.capturedFormatting.Bold||void 0===e.capturedFormatting.Bold||"Mixed"===e.capturedFormatting.Underline||void 0===e.capturedFormatting.Underline||null===e.capturedFormatting.Size||void 0===e.capturedFormatting.Size||null===e.capturedFormatting["Font Name"]||void 0===e.capturedFormatting["Font Name"]||""===e.capturedFormatting["Background Color"]||void 0===e.capturedFormatting["Background Color"]||""===e.capturedFormatting["Text Color"]||void 0===e.capturedFormatting["Text Color"]){document.getElementById("format-list").innerHTML="<p>Multiple style values found. Try again</p>";const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}else document.getElementById("removeFormatting").classList.remove("disabled-link"),X();document.getElementById("capture-format-btn").addEventListener("click",Z);const n=document.getElementById("empty-format-checkbox");e.isNoFormatTextAvailable&&(n.checked=!0,Q()),n.addEventListener("change",(()=>{if(n.checked)e.isNoFormatTextAvailable=!0,Q();else{document.getElementById("capture-format-btn").disabled=!1,e.isNoFormatTextAvailable=!1,e.emptyFormat=!1;const t=document.getElementById("glossary");t.classList.contains("disabled-link")||t.classList.add("disabled-link")}}))}}function X(){const e=o.getInstance();e.emptyFormat=!1;const t=document.getElementById("format-list");t.innerHTML="";for(const[a,n]of Object.entries(e.capturedFormatting))t.innerHTML+="Text Color"!==a&&"Background Color"!==a||!n?`<li><strong>${a}:</strong> ${n}</li>`:`\n        <li><strong>${a}:</strong>${n}\n          <span style="display:inline-block;width:15px;height:15px;background-color:${n};border:1px solid black;"></span>\n        </li>\n      `}function Q(){const e=o.getInstance();e.capturedFormatting={},document.getElementById("format-details").style.display="none",e.emptyFormat=!0,document.getElementById("glossary").classList.remove("disabled-link"),document.getElementById("capture-format-btn").disabled=!0;const t=document.getElementById("removeFormatting");t.classList.contains("disabled-link")||t.classList.add("disabled-link"),console.log("Captured formatting cleared.")}async function Z(){try{await Word.run((async e=>{const t=e.document.getSelection().font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync();const a=o.getInstance();if(a.capturedFormatting={Bold:t.bold,Italic:t.italic,Underline:t.underline,Size:t.size,"Background Color":t.highlightColor,"Font Name":t.name,"Text Color":t.color},document.getElementById("format-details").style.display="block",null===a.capturedFormatting.Bold||"Mixed"===a.capturedFormatting.Underline||null===a.capturedFormatting.Size||null===a.capturedFormatting["Font Name"]||""===a.capturedFormatting["Background Color"]||""===a.capturedFormatting["Text Color"]){document.getElementById("format-list").innerHTML="<p>Multiple style values found. Try again</p>";const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}else document.getElementById("removeFormatting").classList.remove("disabled-link"),X()}))}catch(e){console.error("Error capturing formatting:",e)}}async function ee(){try{await Word.run((async e=>{document.getElementById("clear-ft-btn").innerHTML='<i class="fa fa-spinner fa-spin text-white me-2"></i>Yes',document.getElementById("clear-ft-btn").disabled=!0,document.getElementById("change-ft-btn").disabled=!0;const t=e.document.body.paragraphs;t.load("items"),await e.sync();const a=o.getInstance();for(const n of t.items)if(""!==n.text.trim()){const t=n.split([" "],!0,!0);t.load("items, font"),await e.sync();for(const o of t.items){const t=o.font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),t.highlightColor===a.capturedFormatting["Background Color"]&&t.color===a.capturedFormatting["Text Color"]&&t.bold===a.capturedFormatting.Bold&&t.italic===a.capturedFormatting.Italic&&t.size===a.capturedFormatting.Size&&t.underline===a.capturedFormatting.Underline&&t.name===a.capturedFormatting["Font Name"]&&(t.highlightColor="#FFFFFF",t.color="#000000",t.bold=!1,t.italic=!1,t.underline="None",n.insertText(" ",Word.InsertLocation.replace))}}await e.sync(),a.capturedFormatting={},document.getElementById("format-details").style.display="none",a.emptyFormat=!0,a.isNoFormatTextAvailable=!0,document.getElementById("glossary").classList.remove("disabled-link"),Y()}))}catch(e){console.error("Error removing formatted text:",e)}}async function te(){return Word.run((async e=>{try{const t=e.document.body;e.load(t,"text"),await e.sync(),await async function(e,t){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n    <div class="loader" id="loader"></div>\n    <div id="highlighted-text"></div>\n  </div>',c("Please wait... applying AI tags","info");const a=o.getInstance();for(const r of a.aiTagList){if(r.EditorValue=(n=r.EditorValue)?n.replace(/^"|"$/g,"").replace(/\\n/g,"").replace(/\*\*/g,"").replace(/\\r/g,""):"",!r.EditorValue||r.IsApplied)continue;const a=e.search(`#${r.DisplayName}#`,{matchCase:!1,matchWholeWord:!1});t.load(a,"items"),await t.sync();for(const e of a.items){const a=e.getRange("Start");e.delete(),await t.sync();let n=a,l=null,s=null;const i=e=>{l||(l=e.getRange("Start")),s=e.getRange("End")};if("TABLE"===r.ComponentKeyDataType){const e=(new DOMParser).parseFromString(r.EditorValue,"text/html"),a=Array.from(e.body.childNodes);for(const e of a)if(e.nodeType===Node.TEXT_NODE){let t=e.textContent?.trim();if(!t)continue;t=t.replace(/\n- /g,"\n• ");for(const e of t.split("\n")){if(!e.trim())continue;const t=n.insertParagraph("",Word.InsertLocation.after);S(t,e),i(t.getRange()),n=t.getRange()}}else if(e.nodeType===Node.ELEMENT_NODE){const a=e;if("table"===a.tagName.toLowerCase()){const e=Array.from(a.querySelectorAll("tr"));if(!e.length)continue;const r=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),l=n.insertParagraph("",Word.InsertLocation.after).insertTable(e.length,r,Word.InsertLocation.after),s=o.getInstance(),c=O(s.tableStyle);if("none"!==c&&(l.style=c),s.colorPallete.Customize)await j(l,e,t);else{const t=new Array(r).fill(0);let a=-1;e.forEach(((e,n)=>{const o=Array.from(e.querySelectorAll("td, th"));let s=0,i="";if(o.forEach((e=>{for(;t[s]>0;)t[s]--,s++;const a=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),o=parseInt(e.getAttribute("colspan")||"1",10),c=parseInt(e.getAttribute("rowspan")||"1",10);0===s&&(i=a.trim()),l.getCell(n,s).value=a;for(let e=1;e<o;e++)s+e<r&&(l.getCell(n,s+e).value="");if(c>1)for(let e=0;e<o;e++)s+e<r&&(t[s+e]=c-1);s+=o})),0!==n)if(i)a=n;else if(-1!==a){const e=l.getCell(a,0),t=l.getCell(n,0);e.merge(t);try{e.verticalAlignment=Word.VerticalAlignment.center,e.body.paragraphs.getFirst().alignment=Word.Alignment.center}catch(e){}}}))}i(l.getRange()),n=l.getRange()}else{let e=a.innerText?.trim();if(!e)continue;e=e.replace(/\n- /g,"\n• ");for(const t of e.split("\n")){if(!t.trim())continue;const e=n.insertParagraph("",Word.InsertLocation.after);S(e,t),i(e.getRange()),n=e.getRange()}}}}else if("IMAGE"===r.ComponentKeyDataType){let e=r.EditorValue;e.startsWith("data:image/svg+xml")?e=await M(e):e.startsWith("data:image")&&(e=e.split(",")[1]);const t=n.insertInlinePictureFromBase64(e,Word.InsertLocation.after);i(t.getRange()),n=t.getRange()}else{const e=r.EditorValue.replace(/\n- /g,"\n• ").trim();for(const t of e.split("\n")){if(!t.trim())continue;const e=n.insertParagraph("",Word.InsertLocation.after);S(e,t),i(e.getRange()),n=e.getRange()}}if(await t.sync(),l&&s){const e=`ID${r.ID}_Split_${L()}`;l.expandTo(s).insertBookmark(e)}}}var n}(t,e),await async function(e,t){const a=o.getInstance();for(let n=0;n<a.imageList.length;n++){const o=a.imageList[n],r=e.search(`$${o.DisplayName}$`,{matchCase:!1,matchWholeWord:!1});t.load(r,"items"),await t.sync();for(const e of r.items)if(""!==o.EditorValue){let a=o.EditorValue;if(!a)continue;a.startsWith("data:image/svg+xml")?a=await M(a):a.startsWith("data:image")&&(a=a.split(",")[1]),e.getRange().insertInlinePictureFromBase64(a,Word.InsertLocation.replace),await t.sync()}}await t.sync(),c("AI tag application completed!","success"),I(a.availableKeys)}(t,e)}catch(e){c("Something went wrong","error"),console.error("Error during tag application:",e),I(o.getInstance().availableKeys)}}))}function ae(){document.getElementById("app-body").innerHTML='\n        <div id="button-container">\n          <button class="btn btn-secondary me-2 mark-glossary btn-sm" id="applyglossary">Apply Glossary</button>\n        </div>\n  ',document.getElementById("applyglossary").addEventListener("click",ne)}async function ne(){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n\n        <div id="highlighted-text"></div>';try{await Word.run((async e=>{const a=e.document.body;a.load("text"),await e.sync();const n={Content:a.text.replace(/[\n\r]/g," ")};try{const e=o.getInstance(),a=await async function(e,a,n){const o=await fetch(`${t}/api/glossary-template/client-id/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(a)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(e.dataList?.ClientID,n,e.jwt);e.layTerms=a.Data,a.Data.length>0?(e.glossaryName=a.Data[0].GlossaryTemplate,ae()):document.getElementById("app-body").innerHTML='\n            <p class="text-center">Data not available</p>\n          '}catch(e){console.error("Error fetching glossary data:",e)}const r=o.getInstance();r.layTerms.sort(((e,t)=>t.ClinicalTerm.length-e.ClinicalTerm.length));const l=new Set,s=r.layTerms.filter((e=>{for(const t of l)if("string"==typeof t&&t.includes(e.ClinicalTerm.toLowerCase()))return console.log(`Skipping "${e.ClinicalTerm}" because it's part of "${t}"`),!1;return l.add(e.ClinicalTerm.toLowerCase()),!0}));r.filteredGlossaryTerm=s,await re();const i=new Map,c=r.filteredGlossaryTerm.map((e=>{const t=a.search(e.ClinicalTerm,{matchCase:!1,matchWholeWord:!1});return t.load("items"),t}));await e.sync();for(const t of c)for(const a of t.items){if(!a||!a.text){console.log("Invalid range. Skipping...");continue}const t=a.font;if(t.load(["bold","italic","underline","size","highlightColor","name","color"]),a.load("contentControls"),await e.sync(),a.contentControls.items.length>0)console.log(`Skipping "${a.text}" because it already has a content control.`);else if(i.has(a.text))console.log(`Skipping duplicate occurrence of "${a.text}"`);else{if(i.set(a.text,!0),a.contentControls&&a.contentControls.items.length>0){console.log(`Removing existing content control from: "${a.text}"`);for(const e of a.contentControls.items)e.delete(!1);await e.sync()}try{const n=a.insertContentControl();n.title=`${a.text}`,null!==t.highlightColor&&(n.tag=`${t.highlightColor}`),n.font.highlightColor="yellow",n.appearance=Word.ContentControlAppearance.boundingBox,await e.sync()}catch(e){console.error(`Error inserting content control for term "${a.text}":`,e)}}}r.isGlossaryActive=!0,document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <button class="btn btn-secondary me-2 clear-glossary btn-sm" id="clearGlossary">Clear Glossary</button>\n      </div>\n\n      <div id="highlighted-text"></div>\n      <div class="d-flex justify-content-center box-loader">\n       <div class="loader" id="loader"></div></div>\n      \n',document.getElementById("loader").style.display="none",await e.sync(),document.getElementById("clearGlossary").addEventListener("click",re),Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,oe)})),console.log("Glossary applied successfully")}catch(e){console.error("Error applying glossary:",e),console.log("Error applying glossary. Please try again.")}}async function oe(){const e=o.getInstance();e.isGlossaryActive&&await async function(){try{await Word.run((async e=>{const t=e.document.getSelection();if(t.load("text, font.highlightColor"),await e.sync(),t.text){const a=document.getElementById("loader");a&&(a.style.display="block");const n=o.getInstance(),r=n.layTerms.map((e=>{const a=t.search(e.ClinicalTerm,{matchCase:!1,matchWholeWord:!1});return a.load("items"),a}));await e.sync();const l=[];for(const t of r)for(const a of t.items){const t=a.font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),t.highlightColor===n.capturedFormatting["Background Color"]&&t.color===n.capturedFormatting["Text Color"]&&t.bold===n.capturedFormatting.Bold&&t.italic===n.capturedFormatting.Italic&&t.size===n.capturedFormatting.Size&&t.underline===n.capturedFormatting.Underline&&t.name===n.capturedFormatting["Font Name"]||l.push(a.text)}!function(e){const t=document.getElementById("highlighted-text");if(t){t.innerHTML="";const a=document.getElementById("loader");a.style.display="block";const n={},r=o.getInstance();e.forEach((e=>{r.layTerms.forEach((t=>{t.ClinicalTerm.toLowerCase()===e.toLowerCase()&&(n[t.ClinicalTerm]||(n[t.ClinicalTerm]=[]),n[t.ClinicalTerm].includes(t.LayTerm)||n[t.ClinicalTerm].push(t.LayTerm))}))})),Object.keys(n).forEach((e=>{const a=document.createElement("div");a.className="box";const o=document.createElement("h3");o.textContent=`${e} (${r.glossaryName})`,a.appendChild(o),n[e].forEach((t=>{const n=document.createElement("div");n.className="sub-box",n.textContent=t,n.addEventListener("click",(async()=>{await async function(e,t){const a=document.getElementById("loader");a.style.display="block";try{await Word.run((async n=>{const o=n.document.getSelection();if(o.load("text"),await n.sync(),o.text.toLowerCase().includes(e.toLowerCase())){const r=o.search(e,{matchCase:!1,matchWholeWord:!1});r.load("items"),await n.sync();for(const e of r.items)e.font.load(["bold","italic","underline","color","highlightColor","size","name"]),await n.sync(),e.insertText(t,Word.InsertLocation.replace),e.font.bold=e.font.bold,e.font.italic=e.font.italic,e.font.underline=e.font.underline,e.font.color=e.font.color,e.font.highlightColor="#c7c7c7",e.font.size=e.font.size,e.font.name=e.font.name;await n.sync(),a.style.display="none",console.log(`Replaced '${e}' with '${t}' and preserved the original formatting.`)}else a.style.display="none",console.log(`Selected text does not contain '${e}'.`)}))}catch(e){a.style.display="none",console.error("Error replacing term:",e)}}(e,t),a.remove()})),a.appendChild(n)})),t.appendChild(a)})),a.style.display="none"}}(l),await e.sync()}else console.log("No text is selected.")}))}catch(e){console.error("Error displaying glossary:",e)}}(),"Home"===e.mode&&await async function(){return Word.run((async e=>{const t=await async function(e){const t=e.document.getSelection().getBookmarks();return await e.sync(),t.value||[]}(e),a=function(e){const t=Array.from(new Set(e.map(de))),a=o.getInstance();return t.filter((e=>a.availableKeys.some((t=>1===t.AIFlag&&(t.DisplayName.toLowerCase()===e.toLowerCase()||`id${t.ID}`.toLowerCase()===e.toLowerCase())))))}(t);if(0!==a.length){if(document.getElementById("tags-in-selected-text")?.classList.replace("d-none","d-block"),a.length>1){const e=o.getInstance();return e.selectedNames=a,void $(e.selectedNames,e.availableKeys)}if(document.getElementById("search-box")){const e=a[0],t=o.getInstance();t.selectedNames=[e],F(e);const n=t.availableKeys.find((t=>1===t.AIFlag&&(t.DisplayName.toLowerCase()===e.toLowerCase()||`id${t.ID}`.toLowerCase()===e.toLowerCase())));if(!n)return;const r=document.getElementById("app-body");r.innerHTML='<div class="text-muted p-2">Loading...</div>',r.innerHTML=await E(n,"AITag")}}else document.getElementById("tags-in-selected-text")?.classList.replace("d-block","d-none")}))}()}async function re(){try{await Word.run((async e=>{document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <div class="loader" id="loader"></div>\n        <div id="highlighted-text"></div>';const t=e.document.body.contentControls;if(t.load("items"),await e.sync(),0!==t.items.length){for(const a of t.items){const t=o.getInstance();if(a.title&&t.filteredGlossaryTerm.some((e=>e.ClinicalTerm.toLowerCase()===a.title.toLowerCase()))){const t=a.getRange();t.load("text"),await e.sync(),a.tag&&/^#[0-9A-Fa-f]{6}$/.test(a.tag)?t.font.highlightColor=a.tag:t.font.highlightColor=null,await e.sync(),a.delete(!0)}}document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <button class="btn btn-secondary me-2 mark-glossary btn-sm" id="applyglossary">Apply Glossary</button>\n      </div>\n      ',await e.sync(),o.getInstance().isGlossaryActive=!1,document.getElementById("applyglossary").addEventListener("click",ne)}else console.log("No content controls found.")}))}catch(e){console.error("Error removing content controls:",e)}}async function le(){const e=o.getInstance();if(!e.isTagUpdating){e.isGlossaryActive&&await re();let a=e.clientList.filter((t=>t.ID===e.clientId)),n=[...Array.from(new Map(e.dataList.SourceTypeList.filter((e=>e.VectorID>0)).map((e=>[e.SourceTypeID,{Name:e.SourceType,ID:e.SourceTypeID}]))).values())].map((e=>`\n        <li class="source-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n          <div class="form-check">\n            <input class="form-check-input" type="checkbox" value="${e.ID}" id="source${e.ID}">\n            <label class="form-check-label text-prewrap" for="source${e.ID}">${e.Name}</label>\n          </div>\n        </li>`)).join(""),r=e.clientList.map((e=>{const t=a.some((t=>t.ID===e.ID));return`\n        <li class="sponsor-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n          <div class="form-check">\n            <input class="form-check-input" type="checkbox" value="${e.ID}" id="sponsor${e.ID}" ${t?"checked disabled":""}>\n            <label class="form-check-label text-prewrap" for="sponsor${e.ID}">${e.Name}</label>\n          </div>\n        </li>`})).join("");document.getElementById("app-body").innerHTML=d,document.getElementById("add-tag-body").innerHTML=function(e,t,a=!1){return`<div class="modal-dialog">\n  <div class="modal-content">\n    <div class="modal-body p-3 pt-0">\n      <form id="genai-form" autocomplete="off" novalidate>\n        \x3c!-- Name Field --\x3e\n        <div class="mb-3">\n          <label for="name" class="form-label"><span class="text-danger">*</span> Name</label>\n          <input type="text" class="form-control" id="name" required>\n          <div class="invalid-feedback">Name is required.</div>\n          <div id="submition-error" class="invalid-feedback" style="display: none;"></div>\n\n        </div>\n\n        \x3c!-- Description Field --\x3e\n        <div class="mb-3">\n          <label for="description" class="form-label">Description</label>\n          <textarea class="form-control" id="description" rows="6"></textarea>\n        </div>\n\n      \n\n        <div class="mb-3" ${a?'style="display: none;"':""}>\n          <label for="source" class="form-label"><span class="text-danger">*</span> Primary Source Type</label>\n          <div class="dropdown w-100">\n            <button \n              class="btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle" \n              type="button" \n              id="sourceDropdown" \n              data-bs-toggle="dropdown" \n              aria-expanded="false" \n              >\n              <span id="sponsorDropdownLabel">Select Source</span>\n              <span class="dropdown-toggle-icon"></span>\n            </button>\n            <ul class="dropdown-menu w-100 p-2" aria-labelledby="sourceDropdown" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1);">\n              <li class="source-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n                <div class="form-check">\n                  <input class="form-check-input" type="checkbox" value="selectAll" id="sourceSelectAll">\n                  <label class="form-check-label" for="sourceSelectAll">Select All</label>\n                </div>\n              </li>\n              ${t}\n            </ul>\n          </div>\n          <div class="invalid-feedback" id="primarySourceError" style="display:none;">\n            Primary Source is required.\n          </div>\n\n        </div>\n\n        \x3c!-- Prompt Field --\x3e\n        <div class="mb-3 prompt-box">\n          <label for="prompt" class="form-label"><span class="text-danger">*</span> Prompt \n            <small class="text-secondary">(Note: Use # tag for content suggestions)</small>\n          </label>\n          <textarea class="form-control" id="prompt" rows="6"  required></textarea>\n          <div class="invalid-feedback">Prompt is required.</div>\n          <div id="mention-dropdown" class="dropdown-menu"></div>\n        </div>\n\n        \x3c!-- Save Globally Checkbox --\x3e\n        <div class="form-check mb-3">\n          <input type="checkbox" class="form-check-input" id="saveGlobally">\n          <label class="form-check-label" for="saveGlobally">Save Globally</label>\n        </div>\n\n        \x3c!-- Available to All Sponsors Checkbox --\x3e\n        <div class="form-check mb-3">\n          <input type="checkbox" class="form-check-input" id="isAvailableForAll" disabled>\n          <label class="form-check-label" for="isAvailableForAll">Available to All Sponsors</label>\n        </div>\n\n        \x3c!-- Sponsor Dropdown --\x3e\n        <div class="mb-3">\n          <label for="sponsor" class="form-label"><span class="text-danger">*</span> Sponsor</label>\n          <div class="dropdown w-100">\n            <button \n              class="btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle" \n              type="button" \n              id="sponsorDropdown" \n              data-bs-toggle="dropdown" \n              aria-expanded="false" \n              disabled>\n              <span id="sponsorDropdownLabel">Select Sponsors</span>\n              <span class="dropdown-toggle-icon"></span>\n            </button>\n            <ul class="dropdown-menu w-100 p-2" aria-labelledby="sponsorDropdown" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1);">\n              <li class="sponsor-dropdown-item dropdown-item p-2" style="cursor: pointer;">\n                <div class="form-check">\n                  <input class="form-check-input" type="checkbox" value="selectAll" id="sponsorSelectAll">\n                  <label class="form-check-label" for="sponsorSelectAll">Select All</label>\n                </div>\n              </li>\n              ${e}\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="mt-3 d-flex justify-content-between">\n          <span id="cancel-btn-gen-ai" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n          <button type="submit" class="btn btn-primary" id="text-gen-save">Save</button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>`}(r,n,"Summary"===e.mode),async function(e,a){let n="",o="",r=[];e.innerHTML='\n  <div class="form-group mb-3 p-3 pt-0">\n    <label class=\'form-label\'><span class="text-danger">*</span> Prompt Builder Template</label>\n    <select id="promptBuilderTemplate" class="form-control">\n      <option value="" disabled selected>Select a template</option>\n    </select>\n    <div id="templateError" class="invalid-feedback d-none">Type is required.</div>\n  </div>\n\n  <div id="fieldsContainer"></div>\n\n  <div class="form-group mb-3 p-3 pt-0" id="previewContainer" style="display: none;">\n    <label class="mb-2">Preview</label>\n    <div id="preview" class="form-control"></div>\n  </div>\n\n  <div class="d-flex justify-content-between px-3 align-items-center mt-3">\n    <span id="resetBtn" class="text-primary fw-bold" style="cursor: pointer;">Reset</span>\n    <button id="applyBtn" class="btn btn-primary text-white" disabled>Apply Prompt</button>\n  </div>\n';const l=e.querySelector("#promptBuilderTemplate"),s=e.querySelector("#applyBtn"),i=e.querySelector("#resetBtn"),c=e.querySelector("#preview"),d=e.querySelector("#fieldsContainer"),m=e.querySelector("#previewContainer"),u=e.querySelector("#templateError");function p(){const e={};r.forEach((t=>{const a=t.Label,n=`#${a}#`;let o="";const r=document.getElementById(a);r&&(o=r instanceof HTMLInputElement||r instanceof HTMLSelectElement?r.value:""),e[n]=o||n}));let t=o;for(const[a,n]of Object.entries(e))t=t.replace(new RegExp(a,"g"),n);n=t,c.textContent=n,m.style.display=n?"block":"none",s.disabled=""===n}a.forEach((e=>{const t=document.createElement("option");t.value=e.ID.toString(),t.textContent=e.Name,l.appendChild(t)})),l.addEventListener("change",(async()=>{const e=l.value,s=sessionStorage.getItem("token")||"",i=await async function(e,a){const n=await fetch(`${t}/api/prompt-template/${e}/data`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(e,s);i.Status&&i.Data&&(r=i.Data,n=a.find((t=>t.ID.toString()===e)).Template,o=a.find((t=>t.ID.toString()===e)).Template),e?(u.classList.add("d-none"),d.innerHTML="",r.forEach((e=>{const t=document.createElement("div");t.className="form-group mb-3 p-3 pt-0";const a=document.createElement("label");if(a.textContent=e.Label,t.appendChild(a),1===e.Type){const a=document.createElement("input");a.type="text",a.className="form-control",a.id=e.Label,a.addEventListener("input",p),t.appendChild(a)}else if(2===e.Type){const a=document.createElement("select");a.className="form-control",a.id=e.Label,e.PromptTemplateOptionList.forEach((e=>{const t=document.createElement("option");t.value=e.Text,t.textContent=e.Option,a.appendChild(t)})),a.addEventListener("change",p),t.appendChild(a)}d.appendChild(t)})),p()):u.classList.remove("d-none")})),i.addEventListener("click",(function(){r.forEach((e=>{const t=document.getElementById(e.Label);t&&(t instanceof HTMLInputElement?t.value="":t instanceof HTMLSelectElement&&(t.selectedIndex=0))})),c.textContent=o,n=o})),s.addEventListener("click",(function(){if(!n)return;const e=document.getElementById("prompt");e&&(e.value=n,B())}))}(document.getElementById("add-prompt-template"),e.promptBuilderList),document.getElementById("tag-tab").addEventListener("click",(()=>B())),document.getElementById("prompt-tab").addEventListener("click",(()=>(document.querySelector(".nav-link.active")?.classList.remove("active"),document.querySelector(".tab-pane.show.active")?.classList.remove("show","active"),document.getElementById("prompt-tab").classList.add("active"),void document.getElementById("add-prompt-template").classList.add("show","active")))),ie("prompt","mention-dropdown","add");const l=document.getElementById("genai-form"),s=document.getElementById("name"),i=document.getElementById("description"),u=document.getElementById("prompt"),p=document.getElementById("saveGlobally"),f=document.getElementById("isAvailableForAll"),g=document.getElementById("sponsorDropdown"),b=document.querySelectorAll(".sponsor-dropdown-item .form-check-input"),y=document.getElementById("sourceDropdown"),h=document.querySelectorAll(".source-dropdown-item .form-check-input"),w="Summary"===e.mode;if(document.getElementById("cancel-btn-gen-ai").addEventListener("click",(()=>{const e=o.getInstance();e.isPendingResponse||I(e.availableKeys)})),l&&s&&u&&b.length>0&&(w||h.length>0)){const n=()=>{if(f.checked)g.textContent=e.clientList.map((e=>e.Name)).join(", ");else{const e=Array.from(b).filter((e=>e.checked&&"sponsorSelectAll"!==e.id)).map((e=>e.parentElement.textContent.trim()));g.textContent=e.length?e.join(", "):"Select Sponsors"}},r=()=>{const e=Array.from(h).filter((e=>e.checked&&"sourceSelectAll"!==e.id)).map((e=>e.parentElement.textContent.trim()));y.textContent=e.length?e.join(", "):"Select Source Types"};l.addEventListener("submit",(async a=>{a.preventDefault(),l.querySelectorAll(".is-invalid").forEach((e=>e.classList.remove("is-invalid")));let n=!0;s.value.trim()||(s.classList.add("is-invalid"),n=!1),u.value.trim()||(u.classList.add("is-invalid"),n=!1);let r=[];if(w||(r=Array.from(h).filter((e=>e.checked&&"sourceSelectAll"!==e.id)).map((e=>e.value)),r.length?document.getElementById("primarySourceError").style.display="none":(document.getElementById("primarySourceError").style.display="block",n=!1)),!n)return;const d=Array.from(b).filter((e=>e.checked&&"sponsorSelectAll"!==e.id)).map((t=>e.clientList.find((e=>e.ID==t.value)))),g=f.checked,y=p.checked,T=e.dataList.Group.find((e=>"AIGroup"===e.DisplayName)),k={DisplayName:s.value.trim(),Prompt:u.value.trim(),Description:i.value.trim(),GroupKeyClient:d,AllClient:g?1:0,SaveGlobally:y,UserDefined:"1",ComponentKeyDataTypeID:"1",ComponentKeyDataAccessID:"3",AIFlag:1,DocumentTypeID:e.dataList.DocumentTypeID,ReportHeadID:e.dataList.ID,SourceTypeID:w?"0":r.join(","),ReportHeadGroupID:T.ID,ReportHeadSourceID:0};await async function(e){const a=o.getInstance();try{const n=document.getElementById("text-gen-save"),o=document.getElementById("cancel-btn-gen-ai");let r;if(o.disabled=!0,n.innerHTML='<i class="fa fa-spinner fa-spin text-white me-2"></i>Save',n.disabled=!0,a.isPendingResponse=!0,"Summary"===a.mode){const t={ReportHeadID:e.ReportHeadID,Name:e.DisplayName,Description:e.Description,Prompt:e.Prompt,Selected:1,SourceTypeID:e.SourceTypeID,AllClient:e.AllClient,SaveGlobally:e.SaveGlobally?1:0,SummaryTagClient:e.GroupKeyClient};r=await async function(e,t){const a=await fetch(`${m}/api/report/summary-tag/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(t,a.jwt)}else r=await async function(e,a){const n=await fetch(`${t}/api/report/group-key/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(e,a.jwt);a.isPendingResponse=!1,r.Status?("Summary"===a.mode?v(a.availableKeys):J("AIpanel"),c("Saved successfully","success")):(o.disabled=!1,n.disabled=!1,n.innerHTML='<i class="fa fa-check-circle me-2"></i>Save',c("Something went wrong","error"))}catch(e){c("Something went wrong","error"),console.error("Error creating text generation tag:",e)}}(k)}));const d=()=>{b.forEach((e=>{e.disabled||(e.checked=!0,e.disabled=!0)})),n()},T=()=>{b.forEach((e=>{a.some((t=>t.ID===parseInt(e.value)))||(e.disabled=!1)})),n()};p.addEventListener("change",(function(){e.isPendingResponse||(this.checked?(f.disabled=!1,g.disabled=!1):(T(),f.checked=!1,f.disabled=!0,g.disabled=!0,b.forEach((e=>{e.disabled||(e.checked=!1,e.disabled=!1)})),n()))})),f.addEventListener("change",(function(){e.isPendingResponse||(this.checked?d():T())})),p.checked=!0,f.checked=!0,p.dispatchEvent(new Event("change")),f.dispatchEvent(new Event("change")),document.querySelectorAll(".sponsor-dropdown-item").forEach((e=>{e.addEventListener("click",(function(e){e.stopPropagation();const t=this.querySelector(".sponsor-dropdown-item .form-check-input");if(t){if("sponsorSelectAll"===t.id){const e=t.checked;b.forEach((t=>{t.disabled||(t.checked=e)}))}n()}}))})),w||document.querySelectorAll(".source-dropdown-item").forEach((e=>{e.addEventListener("click",(function(e){e.stopPropagation();const t=this.querySelector(".source-dropdown-item .form-check-input");if(!t)return;if("sourceSelectAll"===t.id){const e=t.checked;h.forEach((t=>{t.checked=e}))}r();const a=Array.from(h).filter((e=>e.checked)).length;document.getElementById("primarySourceError").style.display=0===a?"block":"none"}))})),n(),w||r(),[s,u].forEach((e=>{e.addEventListener("input",(function(){const e=this;e.classList.contains("is-invalid")&&e.value.trim()&&e.classList.remove("is-invalid")}))}))}else console.error("Required elements missing.")}}async function se(e){const t=o.getInstance(),a=document.getElementById("confirmation-popup");if(!a)return;const n=sessionStorage.getItem("CustomStyle")||"",l=sessionStorage.getItem("DefaultStyle")||t.tableStyle;let s="Custom"===e?n:l;a.innerHTML=function(e,t){const a=o.getInstance(),n="Dark"===a.theme,l=n?"bg-dark text-light":"bg-light text-dark",s="Custom"===t?"Customized Tables":"Default Tables",i="Custom"===t?a.customTableStyle:r,c="Custom"===t?"":'<small class="text-secondary font-italic">Warning: The previewed table colors may vary depending on the accent or theme currently selected in Word.</small>';return`\n<div class="modal show d-block" tabindex="-1">\n  <div class="modal-dialog">\n    <div class="modal-content ${l}">\n      <div class="modal-header border-0">\n        <h5 class="fw-bold">${s}</h5>\n      </div>\n\n      <div class="modal-body">\n        \n    <select class="form-select mb-2 ${l}" id="confirmation-popup-dropdown">\n      ${i.map((a=>{const n="Custom"===t?a.Name:a.style;return`<option value="${n}" ${n===e?"selected":""}>\n                    ${"Custom"===t?a.Name:a.style}\n                  </option>`})).join("")}\n    </select>\n  \n        \n    <div class="table-responsive">\n      <table class="table table-bordered table-sm" id="confirmation-popup-table-preview">\n        <thead>\n          <tr>\n            <th>Header 1</th>\n            <th>Header 2</th>\n            <th>Header 3</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr style="color:black;">\n            <td>Data 1</td>\n            <td>Data 2</td>\n            <td>Data 3</td>\n          </tr>\n          <tr style="background-color:white;color:black;">\n            <td>Data 4</td>\n            <td>Data 5</td>\n            <td>Data 6</td>\n          </tr>\n          <tr style="color:black;" >\n            <td>Data 7</td>\n            <td>Data 8</td>\n            <td>Data 9</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  \n        ${c}\n      </div>\n\n      <div class="modal-footer border-0">\n        <button type="button" class="btn btn-link ${n?"text-info":"text-primary"}" id="confirmation-popup-cancel">Cancel</button>\n        <button type="button" class="btn btn-primary text-white" id="confirmation-popup-confirm">Ok</button>\n      </div>\n    </div>\n  </div>\n</div>\n  `}(s,e);const i=document.getElementById("confirmation-popup-cancel"),c=document.getElementById("confirmation-popup-confirm"),d=document.getElementById("confirmation-popup-dropdown"),m=document.getElementById("confirmation-popup-table-preview"),u=()=>{if(!d||!m)return;let a;if(a="Custom"===e?t.customTableStyle.find((e=>e.Name===d.value)):r.find((e=>e.style===d.value)),a&&"Pre"===e){if(Array.from(m.rows).forEach((e=>{Array.from(e.cells).forEach((e=>e.removeAttribute("style")))})),a.tableClass&&(m.style.cssText=a.tableClass),a.headerClass){const e=m.querySelector("thead");e&&Array.from(e.rows).forEach((e=>{Array.from(e.cells).forEach((e=>{e.style.cssText=a.headerClass}))}))}a.sideHeader&&a.rowClass&&Array.from(m.rows).forEach(((e,t)=>{Array.from(e.cells).forEach(((e,a)=>{0===a&&0!==t&&(e.style.cssText="font-weight:bold;")}))})),"empty"===a.format&&a.rowClass?Array.from(m.rows).forEach(((e,t)=>{t%2==1&&(e.style.cssText=a.rowClass)})):"partial"===a.format&&a.rowClass?Array.from(m.rows).forEach(((e,t)=>{Array.from(e.cells).forEach(((e,n)=>{0===n?e.style.cssText=a.tableClass+"font-weight:bold;":t%2==1&&(e.style.cssText=a.rowClass)}))})):"full"===a.format&&Array.from(m.rows).forEach(((e,t)=>{Array.from(e.cells).forEach(((e,n)=>{const o=0===t?a.headerClass:"";0===n&&a.sideHeader?e.style.cssText=a.tableClass+"font-weight:bold;"+o:e.style.cssText=a.tableClass+o}))}))}else m.innerHTML=a?a.Preview:""};u(),d?.addEventListener("change",u),i&&i.addEventListener("click",(()=>a.innerHTML="")),c&&d&&c.addEventListener("click",(()=>{if("Custom"===e){const e=t.customTableStyle.find((e=>e.Name===d.value));t.colorPallete.Header=e.Setting.HeaderColor,t.colorPallete.Primary=e.Setting.PrimaryColor,t.colorPallete.Secondary=e.Setting.SecondaryColor,t.colorPallete.Customize=!0,t.colorPallete.IsSideHeaderBold=e.Setting.IsSideHeaderBold,t.colorPallete.IsHeaderBold=e.Setting.IsHeaderBold,sessionStorage.setItem("CustomStyle",e.Name),t.tableStyle=e.Setting.BaseStyle}else t.colorPallete.Customize=!1,t.tableStyle=d.value,sessionStorage.setItem("DefaultStyle",t.tableStyle);sessionStorage.setItem("colorPallete",JSON.stringify(t.colorPallete)),sessionStorage.setItem("tableStyle",t.tableStyle),a.innerHTML=""}))}function ie(e,t,a){const n=o.getInstance();let r=-1;const l=document.getElementById(`${e}`),s=document.getElementById(`${t}`);if(l){function i(e){const t=document.querySelectorAll(`#${e} .dropdown-item`),a=(document.getElementById(`${e}`),t.length);if(t.forEach((e=>e.classList.remove("active"))),r>=0&&r<a){const e=t[r];e.classList.add("active"),e.scrollIntoView({behavior:"smooth",block:"nearest"})}}l.addEventListener("input",(e=>{const t=l.selectionStart,o=l.value.slice(0,t),r=o.lastIndexOf("#");if(-1!==r){const e=o.slice(r+1).trim();if(e.length>0){const t=(e=>n.availableKeys.filter((e=>0===e.AIFlag)).filter((t=>t.DisplayName.toLowerCase().includes(e.toLowerCase()))))(e);if(t.length>0){s.innerHTML=t.map((e=>{let t="";return t="add"===a?`#${e.DisplayName}#`:e.EditorValue||`#${e.DisplayName}#`,`<li class="dropdown-item" data-editor-value="${t}">${e.DisplayName}</li>`})).join("");const e=l.getBoundingClientRect();s.style.left=`${e.left}px`,s.style.bottom="75px",s.style.display="block"}else s.style.display="none"}else s.style.display="none"}else s.style.display="none"})),l.addEventListener("keydown",(e=>{const a=document.querySelectorAll(`#${t} .dropdown-item`),n=a.length;if("ArrowDown"===e.key)e.preventDefault(),r<n-1?r++:r=0,i(`${t}`);else if("ArrowUp"===e.key)e.preventDefault(),r>0?r--:r=n-1,i(`${t}`);else if("Enter"===e.key&&-1!==r){const t=a[r];t&&(c(t.getAttribute("data-editor-value")),s.style.display="none",e.preventDefault())}})),s.addEventListener("click",(e=>{if(e.target&&e.target.matches("li")){const t=e.target.getAttribute("data-editor-value");c(t),s.style.display="none"}}));const c=t=>{const a=document.getElementById(`${e}`),n=a.value,o=a.selectionStart,r=n.slice(0,o),l=n.slice(o),s=r.lastIndexOf("#"),i=r.slice(0,s);a.value=`${i}${t}${l}`;const c=i.length+t.length;a.setSelectionRange(c,c)};document.addEventListener("click",(e=>{s.contains(e.target)||e.target===l||(s.style.display="none")}))}}function ce(e,t){const a=o.getInstance(),n="Dark"===a.theme,r=n?"btn-dark text-light border-0":"btn-light text-dark border",l=n?"bg-dark text-light border-light":"bg-white text-dark border",s=n?"bg-dark text-light":"bg-white text-dark",i="Summary"===t?a.sourceSummaryList:a.sourceList,c=i.reduce(((e,t)=>(e[t.SourceType]||(e[t.SourceType]=[]),e[t.SourceType].push(t),e)),{}),d=`\n  <div class='p-3 w-100'>\n    <div class="mb-3">\n      <label for="source-select" class="form-label"><span class="text-danger">*</span> Select Sources</label>\n      <div class="dropdown w-100">\n        <button \n          class="btn ${r} w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources" \n          type="button" \n          id="sourceDropdown" \n          data-bs-toggle="dropdown" \n          aria-expanded="false">\n          <span id="sourceDropdownLabel" class='sourceDropdownLabel'></span>\n          <span class="dropdown-toggle-icon dropdown-toggle-icon-s"></span>\n        </button>\n        <ul class="dropdown-menu ${l} w-100 p-2" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000; max-height: 300px; overflow-y: auto;">\n          \n          \x3c!-- Select All --\x3e\n          <li class="dropdown-item p-2 ${s}" data-checkbox-id="selectAll">\n            <div class="form-check">\n              <input class="form-check-input" type="checkbox" value="selectAll" id="selectAll">\n              <label class="form-check-label w-100" for="selectAll">Select All</label>\n            </div>\n          </li>\n\n          \x3c!-- Grouped Sources --\x3e\n          ${Object.keys(c).map(((e,a)=>{const n=c[e].map(((e,n)=>`\n                  <li class="dropdown-item ps-4 ${s}" style="cursor: pointer;" data-checkbox-id="source-${a}-${n}">\n                    <div class="form-check">\n                      <input class="form-check-input source-checkbox" type="checkbox" value="${"Summary"===t?e.FileName:e.SourceName}" id="source-${a}-${n}">\n                      <label class="form-check-label w-100 text-prewrap" for="source-${a}-${n}">${"Summary"===t?e.FileName:e.SourceName}</label>\n                    </div>\n                  </li>\n                `)).join("");return`\n                \x3c!-- Group Header --\x3e\n                <li class="dropdown-item p-2 ${s}" data-group-id="group-${a}">\n                  <div class="form-check">\n                    <input class="form-check-input group-checkbox" type="checkbox" value="${e}" id="group-${a}">\n                    <label class="form-check-label fw-bold" for="group-${a}">${e}</label>\n                  </div>\n                </li>\n                ${n}\n              `})).join("")}\n        </ul>\n      </div>\n    </div>\n    <div class="mt-3 d-flex justify-content-between">\n      <span id="cancel-src-btn" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n      <button id="ok-src-btn" class="btn btn-primary">Save</button>\n    </div>\n  </div>\n  `,m=document.getElementById("chatFooter");m.innerHTML=d;let u=[];const p=document.getElementById("selectAll"),f=document.querySelectorAll(".group-checkbox"),g=document.querySelectorAll(".source-checkbox"),b=document.getElementById("sourceDropdownLabel");function y(){b.innerText=u.length>0?u.join(", "):" "}p.addEventListener("change",(function(){const e=this.checked;f.forEach((t=>t.checked=e)),g.forEach((t=>{t.checked=e,e&&!u.includes(t.value)&&u.push(t.value),e||(u=[])})),y()})),f.forEach((e=>{e.addEventListener("change",(function(){const e=this.id.split("-")[1];document.querySelectorAll(`[data-checkbox-id^="source-${e}-"] .source-checkbox`).forEach((e=>{e.checked=this.checked,this.checked&&!u.includes(e.value)&&u.push(e.value),this.checked||(u=u.filter((t=>t!==e.value)))})),p.checked=Array.from(g).every((e=>e.checked)),y()}))})),g.forEach((e=>{e.addEventListener("change",(function(){e.checked?u.includes(e.value)||u.push(e.value):u=u.filter((t=>t!==e.value));const t=e.id.split("-")[1],a=document.querySelectorAll(`[data-checkbox-id^="source-${t}-"] .source-checkbox`);document.getElementById(`group-${t}`).checked=Array.from(a).every((e=>e.checked)),p.checked=Array.from(g).every((e=>e.checked)),y()}))})),e.Sources&&e.Sources.length>0&&(g.forEach((t=>{e.Sources.includes(t.value)&&(t.checked=!0,u.push(t.value))})),f.forEach((e=>{const t=e.id.split("-")[1],a=document.querySelectorAll(`[data-checkbox-id^="source-${t}-"] .source-checkbox`);e.checked=Array.from(a).every((e=>e.checked))})),p.checked=Array.from(g).every((e=>e.checked)),y()),document.getElementById("ok-src-btn").addEventListener("click",(function(){e.Sources=[...u];const a=o.getInstance(),n=i.filter((e=>u.includes("Summary"===t?e.FileName:e.SourceName)));e.TempSourceValue=n.map((e=>e.VectorID?String(e.VectorID):e.SourceValue)),"Summary"===t?e.FileName=n.map((e=>e.FileName)):e.SourceName=n.map((e=>e.SourceName)),e.SourceValueID=n.map((e=>String(e.VectorID))),e.SourceValue=n.map((e=>e.SourceValue)),m.innerHTML=G(e),x(e,a.jwt,a.availableKeys,t)})),document.getElementById("cancel-src-btn").addEventListener("click",(function(){m.innerHTML=G(e),x(e,a.jwt,a.availableKeys,t)}))}function de(e){return e.split("_Split_")[0].replace(/_/g," ")}Office.onReady((t=>{if(t.host===Office.HostType.Word){document.getElementById("app-body").style.display="flex",document.getElementById("footer").innerText=`© ${(new Date).getFullYear()} - TrialAssure LINK AI Assistant ${e.version}`,W.retrieveDocumentProperties().then((e=>{if(e){const t=o.getInstance();t.documentID=e.documentID,t.organizationName=e.organizationName;const a=n.restoreSession();a?(t.jwt=a.jwt,t.UserRole=a.userRole,a.tableStyle&&(t.tableStyle=a.tableStyle),a.colorPallete&&(t.colorPallete=a.colorPallete),window.location.hash="#/dashboard",c("You are successfully logged in","success"),_()):q()}else document.getElementById("app-body").innerHTML='\n        <p class="px-3 text-center">Export a document from the LINK AI application to use this functionality.</p>',console.log('Custom property "documentID" not found.')})).catch((e=>{console.error("Failed to initialize",e)}));const t=o.getInstance(),a=sessionStorage.getItem("theme");a&&(t.theme=a,V.applyTheme(a)),document.getElementById("login-btn")?.addEventListener("click",U)}}))}(),e=l(14385),t=l.n(e),a=new URL(l(58394),l.b),n=new URL(l(57030),l.b),t()(a),t()(n)}();
//# sourceMappingURL=taskpane.js.map