!function(){"use strict";var e,t,n,o,a={14385:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},57030:function(e,t,n){e.exports=n.p+"972f70ec3ed8599c5254.css"},58394:function(e,t,n){e.exports=n.p+"8dbb102d7c58ab1167a8.css"}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return a[e](n,n.exports,i),n.exports}i.m=a,i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e}(),i.b=document.baseURI||self.location.href,function(){i.d({},{Dd:function(){return ne},tz:function(){return Y},UH:function(){return x},xZ:function(){return se},JB:function(){return J},LQ:function(){return O},a$:function(){return g},st:function(){return oe},IV:function(){return F},LV:function(){return X}});const e="https://plsdevapp.azurewebsites.net";function t(e,t){let n="Normal",o=t;t.startsWith("###### ")?(n="Heading 6",o=t.substring(7).trim()):t.startsWith("##### ")?(n="Heading 5",o=t.substring(6).trim()):t.startsWith("#### ")?(n="Heading 4",o=t.substring(5).trim()):t.startsWith("### ")?(n="Heading 3",o=t.substring(4).trim()):t.startsWith("## ")?(n="Heading 2",o=t.substring(3).trim()):t.startsWith("# ")&&(n="Heading 1",o=t.substring(2).trim()),e.insertParagraph(o,Word.InsertLocation.before).style=n}function n(e){return e?e.replace(/^"|"$/g,"").replace(/\\n/g,"").replace(/\*\*/g,"").replace(/\\r/g,""):""}function o(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function a(){document.querySelector(".nav-link.active")?.classList.remove("active"),document.querySelector(".tab-pane.show.active")?.classList.remove("show","active"),document.getElementById("tag-tab").classList.add("active"),document.getElementById("add-tag-body").classList.add("show","active")}function r(e){const t=/<TableStart>([\s\S]*?)<TableEnd>/gi;let n,o=[];for(;null!==(n=t.exec(e));)try{const e=JSON.parse(n[1]);o.push(s(e))}catch(e){console.error("Failed to parse JSON:",e,n[1])}let a=0;return e.replace(t,(()=>o[a++]||""))}function s(e){if(!e||Array.isArray(e)&&0===e.length)return"<p>No data available</p>";let t=new Set,n=[];function o(e,t="",n={}){return Object.keys(e).forEach((a=>{const r=e[a],i=t?`${t} > ${a}`:a;"object"!=typeof r||null===r||Array.isArray(r)?Array.isArray(r)?n[i]=r.map((e=>"object"==typeof e?Object.entries(e).map((([e,t])=>`<strong>${e}:</strong> ${t}`)).join("<br>"):e)).join("<br>"):n[i]=r:o(r,i,n)})),n}Array.isArray(e)||(e=Object.entries(e).map((([e,t])=>({[e]:t})))),e.forEach((e=>{let a=o(e);Object.keys(a).forEach((e=>t.add(e))),n.push(a)}));let a='<table border="1" cellspacing="0" cellpadding="5">';return a+="<tr>"+[...t].map((e=>`<th>${e}</th>`)).join("")+"</tr>",n.forEach((e=>{a+="<tr>"+[...t].map((t=>`<td>${e[t]}</td>`)).join("")+"</tr>"})),a+="</table>",a}function l(e){return` <textarea class="form-control"\n                      rows="5"\n                      id="chatInput"\n                      placeholder="Type here"></textarea>\n            <div id="mention-dropdown" class="dropdown-menu"></div>\n            <div class="d-flex flex-column align-self-end me-3">\n              <button class="btn btn-secondary text-light ms-2 mb-2 ngb-tooltip" id="insertTagButton">\n                <span class="tooltiptext">Insert</span>\n                <i class="fa fa-plus text-light c-pointer"></i>\n              </button>\n              <button class="btn btn-secondary ms-2 mb-2 text-white ngb-tooltip" id="changeSourceButton">\n              ${e.Sources&&e.Sources.length>0?`  <span class="tooltiptext">${e.Sources}</span>`:'<span class="tooltiptext">Source</span>'}\n                <i class="fa fa-file-lines text-white"></i>\n              </button>\n              <button type="submit" class="btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip" id="sendPromptButton">\n                <span class="tooltiptext">Send</span>\n                <i class="fa fa-paper-plane text-white"></i>\n              </button>\n            </div>`}function c(e,t){const n=document.getElementById("tag-badge-wrapper");n.innerHTML="",e.forEach((e=>{const o=document.createElement("span");o.className="badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable",o.style.cursor="pointer",o.innerHTML=`${e} <i class="fa-solid fa-robot ms-2 text-muted" aria-label="AI Suggested"></i>`,o.addEventListener("click",(()=>{const n=t.find((t=>1===t.AIFlag&&t.DisplayName.toLowerCase()===e.toLowerCase()));if(n){const e=document.getElementById("app-body");e.innerHTML='<div class="text-muted p-2">Loading...</div>',p(n).then((t=>{e.innerHTML=t}))}})),n.appendChild(o)}))}function d(e){document.getElementById("app-body").innerHTML='\n    <div class="container pt-3">\n  <div class="d-flex justify-content-end px-2">\n    <div class="dropdown">\n      <button class="btn btn-default dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n        Action\n      </button>\n      <ul class="dropdown-menu">\n        <li>\n          <a class="dropdown-item" href="#" id="add-btn-tag">\n            <i class="fa fa-plus me-2" aria-hidden="true"></i> Add\n          </a>\n        </li>\n        <li>\n          <a class="dropdown-item" href="#" id="apply-btn-tag">\n            <i class="fa-solid fa-circle-check me-2"></i> Apply\n          </a>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <div class="form-group px-2 pt-2">\n    <input\n      type="text"\n      id="search-box"\n      class="form-control"\n      placeholder="Search Tags..."\n      autocomplete="off"\n    />\n  </div>\n\n  <ul id="suggestion-list" class="list-group mt-2 px-2"></ul>\n  <div id="tags-in-selected-text" class="mt-2 px-2 selected-text-box">\n      <label class="form-label mb-2 fw-bold">Tags in Selected Text</label>\n    <div class="d-flex flex-wrap gap-2" id="tag-badge-wrapper"></div></div>\n\n</div>\n    ';const o=document.getElementById("search-box"),a=document.getElementById("suggestion-list");c(F,e),o.addEventListener("input",(function(){const r=o.value.trim().toLowerCase();if(a.replaceChildren(),""===r)return;const i=e.filter((e=>e.DisplayName.toLowerCase().includes(r))),s=i.filter((e=>0===e.AIFlag)),l=i.filter((e=>1===e.AIFlag)),c=(e,o,r=!1)=>{if(0===o.length)return;const i=document.createElement("li");i.className="list-group-item fw-bold text-secondary bg-light",i.textContent=e,a.appendChild(i),o.forEach((e=>{const o=document.createElement("li");o.className="list-group-item list-group-item-action";const i=r?'<i class="fa-solid fa-robot text-muted me-2"></i>':'<i class="fa-solid fa-layer-group text-muted me-2"></i>';o.innerHTML=`${i} ${e.DisplayName}`,o.onclick=()=>{if(r){const t=document.getElementById("app-body");t.innerHTML='<div class="text-muted p-2">Loading...</div>',p(e).then((e=>{t.innerHTML=e}))}else!async function(e,o){Word.run((async a=>{try{const r=a.document.getSelection();if(await a.sync(),!r)throw new Error("Selection is invalid or not found.");if("TABLE"===o){const n=(new DOMParser).parseFromString(e.EditorValue,"text/html"),o=Array.from(n.body.childNodes),i=`${e.DisplayName.replace(/\s+/g,"_")}_Split_${(new Date).getTime()}`;r.insertParagraph("[[BOOKMARK_START]]",Word.InsertLocation.before),await a.sync();for(const e of o)if(e.nodeType===Node.TEXT_NODE){const n=e.textContent?.trim();n&&n.split("\n").forEach((e=>{e.trim()&&t(r,e)}))}else if(e.nodeType===Node.ELEMENT_NODE){const n=e;if("table"===n.tagName.toLowerCase()){const e=Array.from(n.querySelectorAll("tr"));if(0===e.length){r.insertParagraph("[Empty Table]",Word.InsertLocation.before);continue}const t=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),o=r.insertParagraph("",Word.InsertLocation.before);await a.sync();const i=o.insertTable(e.length,t,Word.InsertLocation.after);i.style="Grid Table 4 - Accent 1",await a.sync();const s=new Array(t).fill(0);e.forEach(((e,n)=>{const o=Array.from(e.querySelectorAll("td, th"));let a=0;o.forEach((e=>{for(;s[a]>0;)s[a]--,a++;const o=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),r=parseInt(e.getAttribute("colspan")||"1",10),l=parseInt(e.getAttribute("rowspan")||"1",10);i.getCell(n,a).value=o;for(let e=1;e<r;e++)a+e<t&&(i.getCell(n,a+e).value="");if(l>1)for(let e=0;e<r;e++)a+e<t&&(s[a+e]=l-1);a+=r}))}))}else{const e=n.innerText.trim();e&&e.split("\n").forEach((e=>{e.trim()&&t(r,e)}))}}r.insertParagraph("[[BOOKMARK_END]]",Word.InsertLocation.after),await a.sync();const s=a.document.body.paragraphs;a.load(s,"text"),await a.sync();const l=s.items.find((e=>"[[BOOKMARK_START]]"===e.text)),c=s.items.find((e=>"[[BOOKMARK_END]]"===e.text));l&&c&&(l.getRange("Start").expandTo(c.getRange("End")).insertBookmark(i),console.log(`Bookmark added for table: ${i}`)),l.insertText("",Word.InsertLocation.replace),c.insertText("",Word.InsertLocation.replace)}else""===e.EditorValue||e.IsApplied?r.insertParagraph(`#${e.DisplayName}#`,Word.InsertLocation.before):n(e.EditorValue).split(/\r?\n/).forEach((e=>{r.insertParagraph(e,Word.InsertLocation.before)}));await a.sync()}catch(e){console.error("Detailed error:",e)}}))}(e,e.ComponentKeyDataType),a.replaceChildren()},a.appendChild(o)}))};c("Properties",s,!1),c("AI Tags",l,!0)})),document.getElementById("add-btn-tag").addEventListener("click",(()=>{O||ne()})),document.getElementById("apply-btn-tag").addEventListener("click",(()=>{O||Y()}))}async function p(e){if(e.FilteredReportHeadAIHistoryList&&0!==e.FilteredReportHeadAIHistoryList.length||await J(e),e.FilteredReportHeadAIHistoryList.length>0){const t=`<div class="d-flex justify-content-between align-items-center px-2 mt-3">\n    <div class="d-flex align-items-center ms-3">\n        <i class="fa fa-robot text-muted me-2"></i>\n        <span class="fw-bold">${e.DisplayName}</span>\n    </div>\n    <div class="d-flex justify-content-center align-items-center me-3 c-pointer" id="close-btn-tag">\n         <i class="fa-solid fa-circle-xmark bg-light text-dark"></i>\n\n    </div>\n</div>\n<hr class="mt-2 mb-1 mx-3">\n\n        <div class="chat-body">\n        ${e.FilteredReportHeadAIHistoryList.map(((e,t)=>`<div class="row chat-entry m-0 p-0">\n            <div class="col-md-12 mt-2 p-2">\n                <span class="float-end me-1">\n                    <i class="fa fa-copy text-secondary c-pointer" title="Copy Prompt" id="copyPrompt-${t}"></i>\n                </span>\n                <span class="float-end w-75 me-2">\n                    <div class="form-control h-34 d-flex align-items-center dynamic-height prompt-text">\n                        ${e.Prompt}\n                    </div>\n                </span>\n            </div>\n            <div class="col-md-12 mb-2 p-2 d-flex">\n                <span class="d-flex align-items-baseline w-100">\n                    <div class="flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response" id="responseContainer-${t}">\n                        <input\n                            class="form-check-input c-pointer me-2 response-checkbox"\n                            type="checkbox"\n                            id="checkbox-${t}"\n                            ${1===e.Selected?"checked":""}>\n                        <span id="responseText-${t}">${e.Response}</span>\n                        <i class="fa fa-copy text-secondary c-pointer ms-2"\n                           title="Copy Response"\n                           id="copyResponse-${t}"></i>\n                    </div>\n                </span>\n            </div>\n        </div>`)).join("")}\n        </div>\n         <div class="d-flex align-items-end justify-content-end chatbox p-2" id="chatFooter">\n            ${l(e)}\n          </div>`;return m(e,g,x),t}return"<div>No AI history available.</div>"}function m(a,i,s){setTimeout((()=>{a.FilteredReportHeadAIHistoryList.forEach(((t,l)=>{document.getElementById(`copyPrompt-${l}`)?.addEventListener("click",(()=>o(t.Prompt))),document.getElementById(`copyResponse-${l}`)?.addEventListener("click",(()=>o(t.Response))),document.getElementById("close-btn-tag")?.addEventListener("click",(()=>d(s)));const c=document.getElementById(`checkbox-${l}`);c&&c.addEventListener("change",(async o=>{const s=o.target.checked;if(a.FilteredReportHeadAIHistoryList.forEach(((e,t)=>{const n=document.getElementById(`checkbox-${t}`),o=document.getElementById(`responseContainer-${t}`);n&&(n.checked=!1),o&&(o.classList.remove("ai-selected-response"),o.classList.add("bg-light")),a.FilteredReportHeadAIHistoryList[t].Selected=0})),s){c.checked=!0;const e=document.getElementById(`responseContainer-${l}`);e&&(e.classList.add("ai-selected-response"),e.classList.remove("bg-light")),t.Selected=1}else t.Selected=0;try{const o=await async function(t,n){const o=await fetch(`${e}/api/report/ai-history/update`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(t,i);if(o.Data){a.ReportHeadAIHistoryList=JSON.parse(JSON.stringify(o.Data)),a.FilteredReportHeadAIHistoryList=[],a.ReportHeadAIHistoryList.forEach((e=>{e.Response=n(e.Response),a.FilteredReportHeadAIHistoryList.unshift(e)}));const e=t.FormattedResponse?"\n"+r(t.FormattedResponse):t.Response;a.ComponentKeyDataType=t.FormattedResponse?"TABLE":"TEXT",a.UserValue=e,a.EditorValue=e,a.text=e;const i=a.FilteredReportHeadAIHistoryList.some((e=>1===e.Selected));a.IsApplied=!i}}catch(e){console.error("Failed to update AI history:",e)}}))})),document.getElementById("insertTagButton")?.addEventListener("click",(()=>{a.IsApplied||async function(e){Word.run((async o=>{try{const a=o.document.getSelection();if(await o.sync(),!a)throw new Error("Selection is invalid or not found.");const r=`${e.DisplayName.replace(/\s+/g,"_")}_Split_${(new Date).getTime()}`;if(a.insertParagraph("[[BOOKMARK_START]]",Word.InsertLocation.before),await o.sync(),""===e.EditorValue)a.insertParagraph(`#${e.DisplayName}#`,Word.InsertLocation.before);else if("TABLE"===e.ComponentKeyDataType){const n=(new DOMParser).parseFromString(e.EditorValue,"text/html"),r=Array.from(n.body.childNodes);for(const e of r)if(e.nodeType===Node.TEXT_NODE){const n=e.textContent?.trim();n&&n.split("\n").forEach((e=>{e.trim()&&t(a,e)}))}else if(e.nodeType===Node.ELEMENT_NODE){const n=e;if("table"===n.tagName.toLowerCase()){const e=Array.from(n.querySelectorAll("tr"));if(0===e.length){a.insertParagraph("[Empty Table]",Word.InsertLocation.before);continue}const t=Math.max(...e.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),r=a.insertParagraph("",Word.InsertLocation.before);await o.sync();const i=r.insertTable(e.length,t,Word.InsertLocation.after);i.style="Grid Table 4 - Accent 1",await o.sync();const s=new Array(t).fill(0);e.forEach(((e,n)=>{const o=Array.from(e.querySelectorAll("td, th"));let a=0;o.forEach((e=>{for(;s[a]>0;)s[a]--,a++;const o=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),r=parseInt(e.getAttribute("colspan")||"1",10),l=parseInt(e.getAttribute("rowspan")||"1",10);i.getCell(n,a).value=o;for(let e=1;e<r;e++)a+e<t&&(i.getCell(n,a+e).value="");if(l>1)for(let e=0;e<r;e++)a+e<t&&(s[a+e]=l-1);a+=r}))}))}else{const e=n.innerText.trim();e&&e.split("\n").forEach((e=>{e.trim()&&t(a,e)}))}}}else n(e.EditorValue).split(/\r?\n/).forEach((e=>{a.insertParagraph(e,Word.InsertLocation.before)}));a.insertParagraph("[[BOOKMARK_END]]",Word.InsertLocation.after),await o.sync();const i=o.document.body.paragraphs;o.load(i,"text"),await o.sync();const s=i.items.find((e=>"[[BOOKMARK_START]]"===e.text)),l=i.items.find((e=>"[[BOOKMARK_END]]"===e.text));s&&l&&(s.getRange("Start").expandTo(l.getRange("End")).insertBookmark(r),console.log(`Bookmark added: ${r}`)),s&&s.insertText("",Word.InsertLocation.replace),l&&l.insertText("",Word.InsertLocation.replace),await o.sync()}catch(e){console.error("Detailed error:",e)}}))}(a)})),document.getElementById("sendPromptButton")?.addEventListener("click",(()=>{const e=document.getElementById("chatInput").value;X(a,e)})),document.getElementById("changeSourceButton")?.addEventListener("click",(()=>{se(a)})),oe("chatInput","mention-dropdown","edit")}),0)}const u='<ul class="nav nav-tabs" id="tabList" role="tablist">\n  <li class="nav-item">\n    <a class="nav-link active" id="tag-tab" data-bs-toggle="tab" href="#tag" role="tab">Tag</a>\n  </li>\n  <li class="nav-item">\n    <a class="nav-link" id="prompt-tab" data-bs-toggle="tab" href="#prompt" role="tab">Prompt builder</a>\n  </li>\n</ul>\n\n<div class="tab-content p-3 border border-top-0">\n  <div class="tab-pane fade show active" id="add-tag-body" role="tabpanel" aria-labelledby="tag-tab">\n  </div>\n  <div class="tab-pane fade" id="add-prompt-template" role="tabpanel" aria-labelledby="prompt-tab">\n  </div>\n</div>\n';let f,y,g="",h="https://linkwordplugin-aphgcwcgbfdqeccs.eastus-01.azurewebsites.net",b="",v="",E=[],w=!0,x=[],I=[],L="",T=!1,k="",A=[],B=[],S=!1,C={},D=!1,N=!1,$="0",H=0,R=[],M=(new Date).getFullYear(),F=[],O=!1;async function j(){const e=sessionStorage.getItem("token");console.log(e),e?(g=e,window.location.hash="#/dashboard"):W()}function W(){document.getElementById("app-body").innerHTML='\n    <div class="container">\n      <form id="login-form" class="p-4 border rounded">\n        <div class="mb-3">\n          <label for="organization" class="form-label fw-bold">Organization</label>\n          <input type="text" class="form-control" id="organization" required>\n        </div>\n        <div class="mb-3">\n          <label for="username" class="form-label fw-bold">Username</label>\n          <input type="text" class="form-control" id="username" required>\n        </div>\n        <div class="mb-3">\n          <label for="password" class="form-label fw-bold">Password</label>\n          <input type="password" class="form-control" id="password" required>\n        </div>\n        <div class="d-grid">\n          <button type="submit" class="btn btn-primary bg-primary-clr">Login</button>\n        </div>\n      <div id="login-error" class="mt-3 text-danger" style="display: none;"></div>\n\n      </form>\n    </div>\n  ',document.getElementById("login-form").addEventListener("submit",P)}async function P(t){t.preventDefault();const n=document.getElementById("organization").value,o=document.getElementById("username").value,a=document.getElementById("password").value;if(n.toLowerCase().trim()===v.toLocaleLowerCase().trim()){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n          </div\n';try{const t=await async function(t,n,o){const a=await fetch(`${e}/api/user/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ClientName:t,Username:n,Password:o})});if(!a.ok)throw new Error("Network response was not ok");return await a.json()}(n,o,a);!0===t.Status&&t.Data&&t.Data.ResponseStatus?(g=t.Data.Token,sessionStorage.setItem("token",g),sessionStorage.setItem("userId",t.Data.ID),window.location.hash="#/dashboard"):q("An error occurred during login. Please try again.")}catch(e){q("An error occurred during login. Please try again."),console.error("Error during login:",e)}}else q("The organization specified is not associated with this document")}function q(e){W();const t=document.getElementById("login-error");t.style.display="block",t.textContent=e}async function V(t){try{const t=await async function(t,n){const o=await fetch(`${e}/api/report/id/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(b,g);document.getElementById("app-body").innerHTML="",document.getElementById("logo-header").innerHTML=function(e){return`\n    <img id="main-logo" src="${e}/assets/logo.png" alt="" class="logo">\n    <div class="icon-nav me-3">\n    <i class="fa fa-home c-pointer me-3" title="Home" id="home"></i>\n<div class="dropdown d-inline">\n  <i class="fa fa-tools c-pointer me-3" id="settingsDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Settings"></i>\n  <ul class="dropdown-menu" aria-labelledby="settingsDropdown">\n    <li>\n      <a class="dropdown-item" href="#" id="define-formatting">\n        <i class="fa fa-sliders-h me-2" aria-hidden="true"></i> Define Formatting\n      </a>\n    </li>\n    <li>\n      <a class="dropdown-item disabled-link" href="#" id="glossary" tabindex="-1" aria-disabled="true">\n        <i class="fa fa-book me-2" aria-hidden="true"></i> Apply Glossary\n      </a>\n    </li>\n    <li>\n      <a class="dropdown-item disabled-link" href="#" id="removeFormatting" tabindex="-1" aria-disabled="true">\n        <i class="fa fa-eraser me-2" aria-hidden="true"></i> Remove Formatting\n      </a>\n    </li>\n  </ul>\n</div>\n\n    <i class="fa fa-sign-out c-pointer me-3" id="logout" title="Logout"></i>\n    </div>    \n`}(h),B=t.Data,f=B.SourceTypeList.filter((e=>""!==e.SourceValue&&1===e.AIFlag)).map((e=>({...e,SourceName:ie(e.SourceValue)}))),$=B.ClientID;const n=t.Data.Group.find((e=>"AIGroup"===e.DisplayName));k=n?n.Name:"",E=n?n.GroupKey:[],x=t.Data.GroupKeyAll.filter((e=>"TABLE"===e.ComponentKeyDataType||"TEXT"===e.ComponentKeyDataType)),x.forEach((e=>{if(1===e.AIFlag){let t;(t=null!==/<TableStart>([\s\S]*?)<TableEnd>/gi.exec(e.EditorValue))&&(e.EditorValue=r(e.EditorValue),e.UserValue=e.EditorValue,e.InitialTable=!0,e.ComponentKeyDataType="TABLE")}})),E.forEach(((e,t)=>{let n;(n=null!==/<TableStart>([\s\S]*?)<TableEnd>/gi.exec(e.EditorValue))&&(e.EditorValue=r(e.EditorValue),e.UserValue=e.EditorValue,e.InitialTable=!0,e.ComponentKeyDataType="TABLE")})),async function(){try{const t=sessionStorage.getItem("userId")||"",n=await async function(t,n){const o=await fetch(`${e}/api/client/all/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(t,g);n.Status&&n.Data?R=n.Data:console.warn("Failed to load clients or no clients found.")}catch(e){}}(),async function(){try{const t=await async function(t){const n=await fetch(`${e}/api/prompt-template/all`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Network response was not ok.");return await n.json()}(g);t.Status&&t.Data&&(I=t.Data)}catch(e){console.error("Error fetching prompt templates:",e)}}(),d(x),document.getElementById("home").addEventListener("click",(async()=>{O||(T&&await te(),d(x))})),document.getElementById("glossary").addEventListener("click",(()=>{D&&async function(){S||(document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n\n        <div id="highlighted-text"></div>',Q())}()})),document.getElementById("define-formatting").addEventListener("click",(()=>{O||z()})),document.getElementById("removeFormatting").addEventListener("click",(()=>{Object.keys(C).length>0&&async function(){if(!S){T&&await te();const e='\n      <div class="container mt-3">\n        <div class="card">\n          <div class="card-header">\n            <h5 class="card-title">Are you sure you want to remove formatted text ?</h5>\n          </div>\n          <div class="card-body">\n          <div id="format-details">\n              <h5>Selected Formatting:</h5>\n              <ul id="format-list" class="list-unstyled mb-3"></ul>\n              <small class="text-secondary font-italic" id="warning-rem-fmt"></small>\n             \n            </div>\n               \x3c!-- Buttons for Capture and Empty Format --\x3e\n            <div class="d-flex justify-content-end mt-2">\n              <button id="change-ft-btn" class="btn btn-danger bg-danger-clr px-3 me-2"><i class="fa fa-reply me-2"></i>Cancel</button>\n              <button id="clear-ft-btn" class="btn btn-success bg-success-clr px-3"><i class="fa fa-check-circle me-2"></i>Yes</button>\n\n            </div>\n\n            \n          </div>\n        </div>\n      </div>\n    ';document.getElementById("app-body").innerHTML=e,_(),null===C["Background Color"]&&"#000000"===C["Text Color"]&&(document.getElementById("warning-rem-fmt").innerHTML="Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?"),document.getElementById("clear-ft-btn").addEventListener("click",U),document.getElementById("change-ft-btn").addEventListener("click",z)}}()})),document.getElementById("logout").addEventListener("click",(async()=>{O||(T&&await te(),async function(){T&&await te(),sessionStorage.clear(),window.location.hash="#/new",w=!0,document.getElementById("logo-header").innerHTML="",j()}())}))}catch(e){console.error("Error fetching glossary data:",e)}}async function z(){if(!S){T&&await te();const e='\n      <div class="container mt-3">\n        <div class="card">\n          <div class="card-header">\n               \x3c!-- Buttons for Capture and Empty Format --\x3e\n            <div class="d-flex justify-content-end">\n              <button id="capture-format-btn" class="btn btn-primary bg-primary-clr"><i class="fa fa-border-style me-1"></i>  Capture Format</button>\n            </div>\n            \x3c!-- <h5 class="card-title">Formatting Options</h5> --\x3e\n          </div>\n          <div class="card-body">\n          <div class="formating-checkbox">\n               <input type="checkbox" id="empty-format-checkbox" class="form-check-input">\n              <label for="empty-format-checkbox" class="form-check-label empty-format-checkbox-label" style="flex: 1;">\n                   Skip ignoring and removing format-based text\n              </label>\n            </div>\n\n            \x3c!-- Section to display captured formatting --\x3e\n            <div id="format-details">\n              <h5 class="my-3">Selected Formatting:</h5>\n              <ul id="format-list" class="list-unstyled"></ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';document.getElementById("app-body").innerHTML=e,0===Object.keys(C).length&&(document.getElementById("format-details").style.display="none");const t=document.getElementById("glossary");if(t.classList.contains("disabled-link")||t.classList.add("disabled-link"),D)G();else if(null===C.Bold||void 0===C.Bold||"Mixed"===C.Underline||void 0===C.Underline||null===C.Size||void 0===C.Size||null===C["Font Name"]||void 0===C["Font Name"]||""===C["Background Color"]||void 0===C["Background Color"]||""===C["Text Color"]||void 0===C["Text Color"]){document.getElementById("format-list").innerHTML="<p>Multiple style values found. Try again</p>";const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}else document.getElementById("removeFormatting").classList.remove("disabled-link"),_();document.getElementById("capture-format-btn").addEventListener("click",K);const n=document.getElementById("empty-format-checkbox");N&&(n.checked=!0,G()),n.addEventListener("change",(()=>{if(n.checked)N=!0,G();else{document.getElementById("capture-format-btn").disabled=!1,N=!1,D=!1;const e=document.getElementById("glossary");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}}))}}function _(){D=!1;const e=document.getElementById("format-list");e.innerHTML="";for(const[t,n]of Object.entries(C))e.innerHTML+="Text Color"!==t&&"Background Color"!==t||!n?`<li><strong>${t}:</strong> ${n}</li>`:`\n        <li><strong>${t}:</strong>${n}\n          <span style="display:inline-block;width:15px;height:15px;background-color:${n};border:1px solid black;"></span>\n        </li>\n      `}function G(){C={},document.getElementById("format-details").style.display="none",D=!0,document.getElementById("glossary").classList.remove("disabled-link"),document.getElementById("capture-format-btn").disabled=!0;const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link"),console.log("Captured formatting cleared.")}async function K(){try{await Word.run((async e=>{const t=e.document.getSelection().font;if(t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),C={Bold:t.bold,Italic:t.italic,Underline:t.underline,Size:t.size,"Background Color":t.highlightColor,"Font Name":t.name,"Text Color":t.color},document.getElementById("format-details").style.display="block",null===C.Bold||"Mixed"===C.Underline||null===C.Size||null===C["Font Name"]||""===C["Background Color"]||""===C["Text Color"]){document.getElementById("format-list").innerHTML="<p>Multiple style values found. Try again</p>";const e=document.getElementById("removeFormatting");e.classList.contains("disabled-link")||e.classList.add("disabled-link")}else document.getElementById("removeFormatting").classList.remove("disabled-link"),_()}))}catch(e){console.error("Error capturing formatting:",e)}}async function U(){try{await Word.run((async e=>{document.getElementById("clear-ft-btn").innerHTML='<i class="fa fa-spinner fa-spin text-white me-2"></i>Yes',document.getElementById("clear-ft-btn").disabled=!0,document.getElementById("change-ft-btn").disabled=!0;const t=e.document.body.paragraphs;t.load("items"),await e.sync();for(const n of t.items)if(""!==n.text.trim()){const t=n.split([" "]);t.load("items, font"),await e.sync();for(const o of t.items){const t=o.font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),t.highlightColor===C["Background Color"]&&t.color===C["Text Color"]&&t.bold===C.Bold&&t.italic===C.Italic&&t.size===C.Size&&t.underline===C.Underline&&t.name===C["Font Name"]&&(t.highlightColor="#FFFFFF",t.color="#000000",t.bold=!1,t.italic=!1,t.underline="None",n.insertText(" ",Word.InsertLocation.replace))}}await e.sync(),C={},document.getElementById("format-details").style.display="none",D=!0,N=!0,document.getElementById("glossary").classList.remove("disabled-link"),z()}))}catch(e){console.error("Error removing formatted text:",e)}}async function J(t){try{const n=await async function(t,n){const o=await fetch(`${e}/api/report/ai-history/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok");return await o.json()}(t.ID,g);if(n.Status&&n.Data)return t.ReportHeadAIHistoryList=n.Data||[],t.FilteredReportHeadAIHistoryList=[],t.ReportHeadAIHistoryList.forEach(((e,n)=>{e.Response=re(e.Response),t.FilteredReportHeadAIHistoryList.unshift(e)})),t.FilteredReportHeadAIHistoryList;console.warn("No AI history available.")}catch(e){return console.error("Error fetching AI history:",e),[]}}async function X(t,n){if(""===n||S)console.error("No empty prompt allowed");else{S=!0;const o=document.getElementById("sendPromptButton");o.innerHTML='<i class="fa fa-spinner fa-spin text-white"></i>';const a={ReportHeadID:t.FilteredReportHeadAIHistoryList[0].ReportHeadID,DocumentID:B.NCTID,DocumentType:B.DocumentType,TextSetting:B.TextSetting,DocumentTemplate:B.ReportTemplate,ReportHeadGroupKeyID:t.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,ThreadID:t.ThreadID,AssistantID:B.AssistantID,Container:B.Container,GroupName:k,Prompt:n,PromptType:1,Response:"",VectorID:B.VectorID,Selected:0,ID:0,SourceValue:t.SourceValue?t.SourceValue:[]};try{O=!0;const n=await async function(t,n){const o=await fetch(`${e}/api/report/ai-history/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(a,g);n.Data&&"false"!==n.Data&&(t.ReportHeadAIHistoryList=JSON.parse(JSON.stringify(n.Data)),t.FilteredReportHeadAIHistoryList=[],t.ReportHeadAIHistoryList.forEach((e=>{e.Response=re(e.Response),t.FilteredReportHeadAIHistoryList.unshift(e)})),document.getElementById("app-body").innerHTML=await p(t),O=!1),o.innerHTML='<i class="fa fa-paper-plane text-white"></i>',document.getElementById("chatInput").value="",S=!1,O=!1}catch(e){o.innerHTML='<i class="fa fa-paper-plane text-white"></i>',S=!1,O=!1,console.error("Error sending AI prompt:",e)}}}async function Y(){return Word.run((async e=>{try{const t=e.document.body;e.load(t,"text"),await e.sync();for(let n=0;n<E.length;n++){const o=E[n];o.EditorValue=re(o.EditorValue);const a=t.search(`#${o.DisplayName}#`,{matchCase:!1,matchWholeWord:!1});e.load(a,"items"),await e.sync(),console.log(`Found ${a.items.length} instances of #${o.DisplayName}#`);const r=[];a.items.forEach((e=>{if(""!==o.EditorValue&&!o.IsApplied)if("TABLE"===o.ComponentKeyDataType){const t=e.getRange();r.push({range:t,tag:o}),t.delete()}else e.insertText(o.EditorValue,Word.InsertLocation.replace)}));for(const{range:t,tag:n}of r){const o=(new DOMParser).parseFromString(n.EditorValue,"text/html"),a=Array.from(o.body.childNodes);for(const n of a)if(n.nodeType===Node.TEXT_NODE){const e=n.textContent?.trim();e&&e.split("\n").forEach((e=>{e.trim()&&ae(t,e)}))}else if(n.nodeType===Node.ELEMENT_NODE){const o=n;if("table"===o.tagName.toLowerCase()){const n=Array.from(o.querySelectorAll("tr"));if(0===n.length){t.insertParagraph("[Empty Table]",Word.InsertLocation.before);continue}const a=Math.max(...n.map((e=>Array.from(e.querySelectorAll("td, th")).reduce(((e,t)=>e+parseInt(t.getAttribute("colspan")||"1",10)),0)))),r=t.insertParagraph("",Word.InsertLocation.before);await e.sync();const i=r.insertTable(n.length,a,Word.InsertLocation.after);i.style="Grid Table 4 - Accent 1",await e.sync();const s=new Array(a).fill(0);n.forEach(((e,t)=>{const n=Array.from(e.querySelectorAll("td, th"));let o=0;n.forEach((e=>{for(;s[o]>0;)s[o]--,o++;const n=Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent?.trim()||"":e.nodeType===Node.ELEMENT_NODE?e.innerText.trim():"")).filter((e=>e.length>0)).join(" "),r=parseInt(e.getAttribute("colspan")||"1",10),l=parseInt(e.getAttribute("rowspan")||"1",10);i.getCell(t,o).value=n;for(let e=1;e<r;e++)o+e<a&&(i.getCell(t,o+e).value="");if(l>1)for(let e=0;e<r;e++)o+e<a&&(s[o+e]=l-1);o+=r}))}))}else{const e=o.innerText.trim();e&&e.split("\n").forEach((e=>{e.trim()&&ae(t,e)}))}}}await e.sync()}await e.sync()}catch(e){console.error("Error during tag application:",e)}}))}function Q(){document.getElementById("app-body").innerHTML='\n        <div id="button-container">\n          <button class="btn btn-secondary me-2 mark-glossary btn-sm" id="applyglossary">Apply Glossary</button>\n        </div>\n  ',document.getElementById("applyglossary").addEventListener("click",Z)}async function Z(){document.getElementById("app-body").innerHTML='\n  <div id="button-container">\n\n          <div class="loader" id="loader"></div>\n\n        <div id="highlighted-text"></div>';try{await Word.run((async t=>{const n=t.document.body;n.load("text"),await t.sync();const o={Content:n.text.replace(/[\n\r]/g," ")};try{const t=await async function(t,n,o){const a=await fetch(`${e}/api/glossary-template/client-id/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(n)});if(!a.ok)throw new Error("Network response was not ok.");return await a.json()}(B?.ClientID,o,g);A=t.Data,t.Data.length>0?(L=t.Data[0].GlossaryTemplate,Q()):document.getElementById("app-body").innerHTML='\n            <p class="text-center">Data not available</p>\n          '}catch(e){console.error("Error fetching glossary data:",e)}A.sort(((e,t)=>t.ClinicalTerm.length-e.ClinicalTerm.length));const a=new Set,r=A.filter((e=>{for(const t of a)if("string"==typeof t&&t.includes(e.ClinicalTerm.toLowerCase()))return console.log(`Skipping "${e.ClinicalTerm}" because it's part of "${t}"`),!1;return a.add(e.ClinicalTerm.toLowerCase()),!0}));y=r,await te();const i=new Map,s=y.map((e=>{const t=n.search(e.ClinicalTerm,{matchCase:!1,matchWholeWord:!1});return t.load("items"),t}));await t.sync();for(const e of s)for(const n of e.items){if(!n||!n.text){console.log("Invalid range. Skipping...");continue}const e=n.font;if(e.load(["bold","italic","underline","size","highlightColor","name","color"]),n.load("contentControls"),await t.sync(),n.contentControls.items.length>0)console.log(`Skipping "${n.text}" because it already has a content control.`);else if(i.has(n.text))console.log(`Skipping duplicate occurrence of "${n.text}"`);else{if(i.set(n.text,!0),n.contentControls&&n.contentControls.items.length>0){console.log(`Removing existing content control from: "${n.text}"`);for(const e of n.contentControls.items)e.delete(!1);await t.sync()}try{const o=n.insertContentControl();o.title=`${n.text}`,null!==e.highlightColor&&(o.tag=`${e.highlightColor}`),o.font.highlightColor="yellow",o.appearance=Word.ContentControlAppearance.boundingBox,await t.sync()}catch(e){console.error(`Error inserting content control for term "${n.text}":`,e)}}}T=!0,document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <button class="btn btn-secondary me-2 clear-glossary btn-sm" id="clearGlossary">Clear Glossary</button>\n      </div>\n\n      <div id="highlighted-text"></div>\n      <div class="d-flex justify-content-center box-loader">\n       <div class="loader" id="loader"></div></div>\n      \n',document.getElementById("loader").style.display="none",await t.sync(),document.getElementById("clearGlossary").addEventListener("click",te),Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,ee)})),console.log("Glossary applied successfully")}catch(e){console.error("Error applying glossary:",e),console.log("Error applying glossary. Please try again.")}}async function ee(){await async function(){try{await Word.run((async e=>{const t=e.document.getSelection();if(t.load("text, font.highlightColor"),await e.sync(),t.text){const n=document.getElementById("loader");n&&(n.style.display="block");const o=A.map((e=>{const n=t.search(e.ClinicalTerm,{matchCase:!1,matchWholeWord:!1});return n.load("items"),n}));await e.sync();const a=[];for(const t of o)for(const n of t.items){const t=n.font;t.load(["bold","italic","underline","size","highlightColor","name","color"]),await e.sync(),t.highlightColor===C["Background Color"]&&t.color===C["Text Color"]&&t.bold===C.Bold&&t.italic===C.Italic&&t.size===C.Size&&t.underline===C.Underline&&t.name===C["Font Name"]||a.push(n.text)}!function(e){const t=document.getElementById("highlighted-text");if(t){t.innerHTML="";const n=document.getElementById("loader");n.style.display="block";const o={};e.forEach((e=>{A.forEach((t=>{t.ClinicalTerm.toLowerCase()===e.toLowerCase()&&(o[t.ClinicalTerm]||(o[t.ClinicalTerm]=[]),o[t.ClinicalTerm].includes(t.LayTerm)||o[t.ClinicalTerm].push(t.LayTerm))}))})),Object.keys(o).forEach((e=>{const n=document.createElement("div");n.className="box";const a=document.createElement("h3");a.textContent=`${e} (${L})`,n.appendChild(a),o[e].forEach((t=>{const o=document.createElement("div");o.className="sub-box",o.textContent=t,o.addEventListener("click",(async()=>{await async function(e,t){const n=document.getElementById("loader");n.style.display="block";try{await Word.run((async o=>{const a=o.document.getSelection();if(a.load("text"),await o.sync(),a.text.toLowerCase().includes(e.toLowerCase())){const r=a.search(e,{matchCase:!1,matchWholeWord:!1});r.load("items"),await o.sync();for(const e of r.items)e.font.load(["bold","italic","underline","color","highlightColor","size","name"]),await o.sync(),e.insertText(t,"replace"),e.font.bold=e.font.bold,e.font.italic=e.font.italic,e.font.underline=e.font.underline,e.font.color=e.font.color,e.font.highlightColor="#c7c7c7",e.font.size=e.font.size,e.font.name=e.font.name;await o.sync(),n.style.display="none",console.log(`Replaced '${e}' with '${t}' and preserved the original formatting.`)}else n.style.display="none",console.log(`Selected text does not contain '${e}'.`)}))}catch(e){n.style.display="none",console.error("Error replacing term:",e)}}(e,t),n.remove()})),n.appendChild(o)})),t.appendChild(n)})),n.style.display="none"}}(a),await e.sync()}else console.log("No text is selected.")}))}catch(e){console.error("Error displaying glossary:",e)}}()}async function te(){try{await Word.run((async e=>{document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <div class="loader" id="loader"></div>\n        <div id="highlighted-text"></div>';const t=e.document.body.contentControls;if(t.load("items"),await e.sync(),0!==t.items.length){for(const n of t.items)if(n.title&&y.some((e=>e.ClinicalTerm.toLowerCase()===n.title.toLowerCase()))){const t=n.getRange();t.load("text"),await e.sync(),n.tag&&/^#[0-9A-Fa-f]{6}$/.test(n.tag)?t.font.highlightColor=n.tag:t.font.highlightColor=null,await e.sync(),n.delete(!0)}document.getElementById("app-body").innerHTML='\n      <div id="button-container">\n        <button class="btn btn-secondary me-2 mark-glossary btn-sm" id="applyglossary">Apply Glossary</button>\n      </div>\n      ',await e.sync(),T=!1,document.getElementById("applyglossary").addEventListener("click",Z)}else console.log("No content controls found.")}))}catch(e){console.error("Error removing content controls:",e)}}async function ne(){if(!S){T&&await te();let t=R.filter((e=>e.ID===$)),n=R.map((e=>{const n=t.some((t=>t.ID===e.ID));return` \n        <li class="dropdown-item p-2" style="cursor: pointer;">\n          <div class="form-check">\n            <input class="form-check-input" type="checkbox" value="${e.ID}" id="sponsor${e.ID}" ${n?"checked disabled":""}>\n            <label class="form-check-label text-prewrap" for="sponsor${e.ID}">${e.Name}</label>\n          </div>\n        </li>\n      `})).join("");document.getElementById("app-body").innerHTML=u,document.getElementById("add-tag-body").innerHTML=function(e){return`<div class="modal-dialog">\n  <div class="modal-content">\n    <div class="modal-body p-3">\n      <form id="genai-form" autocomplete="off" novalidate>\n        \x3c!-- Name Field --\x3e\n        <div class="mb-3">\n          <label for="name" class="form-label"><span class="text-danger">*</span> Name</label>\n          <input type="text" class="form-control" id="name" required>\n          <div class="invalid-feedback">Name is required.</div>\n          <div id="submition-error" class="invalid-feedback" style="display: none;"></div>\n\n        </div>\n\n        \x3c!-- Description Field --\x3e\n        <div class="mb-3">\n          <label for="description" class="form-label">Description</label>\n          <textarea class="form-control" id="description" rows="6"></textarea>\n        </div>\n\n        \x3c!-- Prompt Field --\x3e\n        <div class="mb-3 prompt-box">\n          <label for="prompt" class="form-label"><span class="text-danger">*</span> Prompt \n            <small class="text-secondary">(Note: Use # tag for content suggestions)</small>\n          </label>\n          <textarea class="form-control" id="prompt" rows="6"  required></textarea>\n          <div class="invalid-feedback">Prompt is required.</div>\n          <div id="mention-dropdown" class="dropdown-menu"></div>\n        </div>\n\n        \x3c!-- Save Globally Checkbox --\x3e\n        <div class="form-check mb-3">\n          <input type="checkbox" class="form-check-input" id="saveGlobally">\n          <label class="form-check-label" for="saveGlobally">Save Globally</label>\n        </div>\n\n        \x3c!-- Available to All Sponsors Checkbox --\x3e\n        <div class="form-check mb-3">\n          <input type="checkbox" class="form-check-input" id="isAvailableForAll" disabled>\n          <label class="form-check-label" for="isAvailableForAll">Available to All Sponsors</label>\n        </div>\n\n        \x3c!-- Sponsor Dropdown --\x3e\n        <div class="mb-3">\n          <label for="sponsor" class="form-label"><span class="text-danger">*</span> Sponsor</label>\n          <div class="dropdown w-100">\n            <button \n              class="btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle" \n              type="button" \n              id="sponsorDropdown" \n              data-bs-toggle="dropdown" \n              aria-expanded="false" \n              disabled>\n              <span id="sponsorDropdownLabel">Select Sponsors</span>\n              <span class="dropdown-toggle-icon"></span>\n            </button>\n            <ul class="dropdown-menu w-100 p-2" aria-labelledby="sponsorDropdown" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1);">\n              <li class="dropdown-item p-2" style="cursor: pointer;">\n                <div class="form-check">\n                  <input class="form-check-input" type="checkbox" value="selectAll" id="selectAll">\n                  <label class="form-check-label" for="selectAll">Select All</label>\n                </div>\n              </li>\n              ${e}\n            </ul>\n          </div>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="mt-3 d-flex justify-content-between">\n          <span id="cancel-btn-gen-ai" class="fw-bold text-primary my-auto c-pointer">Cancel</span>\n          <button type="submit" class="btn btn-primary" id="text-gen-save">Save</button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>`}(n),async function(t,n){let o="",r="",i=[];t.innerHTML='\n  <div class="form-group mb-3">\n    <label><span class="mandatory-field">*</span>Prompt Builder Template</label>\n    <select id="promptBuilderTemplate" class="form-control">\n      <option value="" disabled selected>Select a template</option>\n    </select>\n    <div id="templateError" class="invalid-feedback d-none">Type is required.</div>\n  </div>\n\n  <div id="fieldsContainer"></div>\n\n  <div class="form-group mb-3" id="previewContainer" style="display: none;">\n    <label class="mb-2">Preview</label>\n    <div id="preview" class="form-control"></div>\n  </div>\n\n  <div class="d-flex justify-content-between px-3 align-items-center mt-3">\n    <span id="resetBtn" class="text-primary fw-bold" style="cursor: pointer;">Reset</span>\n    <button id="applyBtn" class="btn btn-primary text-white" disabled>Apply Prompt</button>\n  </div>\n';const s=t.querySelector("#promptBuilderTemplate"),l=t.querySelector("#applyBtn"),c=t.querySelector("#resetBtn"),d=t.querySelector("#preview"),p=t.querySelector("#fieldsContainer"),m=t.querySelector("#previewContainer"),u=t.querySelector("#templateError");function f(){const e={};i.forEach((t=>{const n=t.Label,o=`#${n}#`;let a="";const r=document.getElementById(n);r&&(a=r instanceof HTMLInputElement||r instanceof HTMLSelectElement?r.value:""),e[o]=a||o}));let t=r;for(const[n,o]of Object.entries(e))t=t.replace(new RegExp(n,"g"),o);o=t,d.textContent=o,m.style.display=o?"block":"none",l.disabled=""===o}n.forEach((e=>{const t=document.createElement("option");t.value=e.ID.toString(),t.textContent=e.Name,s.appendChild(t)})),s.addEventListener("change",(async()=>{const t=s.value,a=sessionStorage.getItem("token")||"",l=await async function(t,n){const o=await fetch(`${e}/api/prompt-template/${t}/data`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(t,a);l.Status&&l.Data&&(i=l.Data,o=n.find((e=>e.ID.toString()===t)).Template,r=n.find((e=>e.ID.toString()===t)).Template),t?(u.classList.add("d-none"),p.innerHTML="",i.forEach((e=>{const t=document.createElement("div");t.className="form-group mb-3";const n=document.createElement("label");if(n.textContent=e.Label,t.appendChild(n),1===e.Type){const n=document.createElement("input");n.type="text",n.className="form-control",n.id=e.Label,n.addEventListener("input",f),t.appendChild(n)}else if(2===e.Type){const n=document.createElement("select");n.className="form-control",n.id=e.Label,e.PromptTemplateOptionList.forEach((e=>{const t=document.createElement("option");t.value=e.Text,t.textContent=e.Option,n.appendChild(t)})),n.addEventListener("change",f),t.appendChild(n)}p.appendChild(t)})),f()):u.classList.remove("d-none")})),c.addEventListener("click",(function(){i.forEach((e=>{const t=document.getElementById(e.Label);t&&(t instanceof HTMLInputElement?t.value="":t instanceof HTMLSelectElement&&(t.selectedIndex=0))})),d.textContent=r,o=r})),l.addEventListener("click",(function(){if(!o)return;const e=document.getElementById("prompt");e&&(e.value=o,a())}))}(document.getElementById("add-prompt-template"),I),document.getElementById("tag-tab").addEventListener("click",(()=>{a()})),document.getElementById("prompt-tab").addEventListener("click",(()=>{document.querySelector(".nav-link.active")?.classList.remove("active"),document.querySelector(".tab-pane.show.active")?.classList.remove("show","active"),document.getElementById("prompt-tab").classList.add("active"),document.getElementById("add-prompt-template").classList.add("show","active")})),oe("prompt","mention-dropdown","add");const o=document.getElementById("genai-form"),r=document.getElementById("prompt"),i=document.getElementById("name"),s=document.getElementById("description"),l=document.getElementById("saveGlobally"),c=document.getElementById("isAvailableForAll"),p=document.getElementById("sponsorDropdown"),m=document.querySelectorAll(".dropdown-item .form-check-input");if(document.getElementById("cancel-btn-gen-ai").addEventListener("click",(()=>{O||d(x)})),o&&i&&r&&m.length>0){const n=()=>{if(c.checked)p.textContent=R.map((e=>e.Name)).join(", ");else{const e=Array.from(m).filter((e=>e.checked&&"selectAll"!==e.id)).map((e=>e.parentElement.textContent.trim()));p.textContent=e.length?e.join(", "):"Select Sponsors"}};o.addEventListener("submit",(async function(t){t.preventDefault(),o.querySelectorAll(".is-invalid").forEach((e=>e.classList.remove("is-invalid")));let n=!0;if(i.value.trim()||(i.classList.add("is-invalid"),n=!1),r.value.trim()||(r.classList.add("is-invalid"),n=!1),n){const t=Array.from(m).filter((e=>e.checked&&"selectAll"!==e.id)).map((e=>R.find((t=>t.ID==e.value)))),n=c.checked,o=l.checked,a=B.Group.find((e=>"AIGroup"===e.DisplayName)),d={DisplayName:i.value.trim(),Prompt:r.value.trim(),Description:s.value.trim(),GroupKeyClient:t,AllClient:n?1:0,SaveGlobally:o,UserDefined:"1",ComponentKeyDataTypeID:"1",ComponentKeyDataAccessID:"3",AIFlag:1,DocumentTypeID:B.DocumentTypeID,ReportHeadID:B.ID,SourceTypeID:"",ReportHeadGroupID:a.ID,ReportHeadSourceID:""};await async function(t){try{const n=document.getElementById("text-gen-save"),o=document.getElementById("cancel-btn-gen-ai");o.disabled=!0,n.innerHTML='<i class="fa fa-spinner fa-spin text-white me-2"></i>Save',n.disabled=!0,O=!0;const a=await async function(t,n){const o=await fetch(`${e}/api/report/group-key/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("Network response was not ok.");return await o.json()}(t,g);O=!1,a.Data&&a.Status?V():(o.disabled=!1,n.disabled=!1,n.innerHTML='<i class="fa fa-check-circle me-2"></i>Save',function(e){const t=document.getElementById("submition-error");t.style.display="block",t.textContent=e}(a.Data))}catch(e){console.error("Error creating text generation tag:",e)}}(d)}}));const a=()=>{m.forEach((e=>{e.disabled||(e.checked=!0,e.disabled=!0)})),n()},d=()=>{m.forEach((e=>{t.some((t=>t.ID===parseInt(e.value)))||(e.disabled=!1)})),n()};l.addEventListener("change",(function(){O||(this.checked?(c.disabled=!1,p.disabled=!1):(d(),c.checked=!1,c.disabled=!0,p.disabled=!0,m.forEach((e=>{e.disabled||(e.checked=!1,e.disabled=!1)})),n()))})),c.addEventListener("change",(function(){O||(this.checked?a():d())})),document.querySelectorAll(".dropdown-item").forEach((e=>{e.addEventListener("click",(function(e){{e.stopPropagation();const t=this.querySelector(".form-check-input");if(t){if("selectAll"===t.id){const e=t.checked;m.forEach((t=>{t.disabled||(t.checked=e)}))}n()}}}))})),n(),[i,r].forEach((e=>{e.addEventListener("input",(function(){this.classList.contains("is-invalid")&&this.value.trim()&&this.classList.remove("is-invalid"),i&&(document.getElementById("submition-error").style.display="none")}))}))}else console.error("Required elements are missing or not rendered yet.")}}function oe(e,t,n){let o=-1;const a=document.getElementById(`${e}`),r=document.getElementById(`${t}`);if(a){function i(e){const t=document.querySelectorAll(`#${e} .dropdown-item`),n=(document.getElementById(`${e}`),t.length);if(t.forEach((e=>e.classList.remove("active"))),o>=0&&o<n){const e=t[o];e.classList.add("active"),e.scrollIntoView({behavior:"smooth",block:"nearest"})}}a.addEventListener("input",(e=>{const t=a.selectionStart,o=a.value.slice(0,t),i=o.lastIndexOf("#");if(-1!==i){const e=o.slice(i+1).trim();if(e.length>0){const t=(e=>x.filter((e=>0===e.AIFlag)).filter((t=>t.DisplayName.toLowerCase().includes(e.toLowerCase()))))(e);if(t.length>0){r.innerHTML=t.map((e=>{let t="";return t="add"===n?`#${e.DisplayName}#`:e.EditorValue||`#${e.DisplayName}#`,`<li class="dropdown-item" data-editor-value="${t}">${e.DisplayName}</li>`})).join("");const e=a.getBoundingClientRect();r.style.left=`${e.left}px`,r.style.bottom="75px",r.style.display="block"}else r.style.display="none"}else r.style.display="none"}else r.style.display="none"})),a.addEventListener("keydown",(e=>{const n=document.querySelectorAll(`#${t} .dropdown-item`),a=n.length;if("ArrowDown"===e.key)e.preventDefault(),o<a-1?o++:o=0,i(`${t}`);else if("ArrowUp"===e.key)e.preventDefault(),o>0?o--:o=a-1,i(`${t}`);else if("Enter"===e.key&&-1!==o){const t=n[o];t&&(s(t.getAttribute("data-editor-value")),r.style.display="none",e.preventDefault())}})),r.addEventListener("click",(e=>{if(e.target&&e.target.matches("li")){const t=e.target.getAttribute("data-editor-value");s(t),r.style.display="none"}}));const s=t=>{const n=document.getElementById(`${e}`),o=n.value,a=n.selectionStart,r=o.slice(0,a),i=o.slice(a),s=r.lastIndexOf("#"),l=r.slice(0,s);n.value=`${l}${t}${i}`;const c=l.length+t.length;n.setSelectionRange(c,c)};document.addEventListener("click",(e=>{r.contains(e.target)||e.target===a||(r.style.display="none")}))}}function ae(e,t){let n="Normal",o=t;t.startsWith("###### ")?(n="Heading 6",o=t.substring(7).trim()):t.startsWith("##### ")?(n="Heading 5",o=t.substring(6).trim()):t.startsWith("#### ")?(n="Heading 4",o=t.substring(5).trim()):t.startsWith("### ")?(n="Heading 3",o=t.substring(4).trim()):t.startsWith("## ")?(n="Heading 2",o=t.substring(3).trim()):t.startsWith("# ")&&(n="Heading 1",o=t.substring(2).trim()),e.insertParagraph(o,Word.InsertLocation.before).style=n}function re(e){return e?e.replace(/^"|"$/g,"").replace(/\\n/g,"").replace(/\*\*/g,"").replace(/\\r/g,""):""}function ie(e){if(!e||""===e.trim())return e;const t=e.split("_");return t.length<=1?e:t.slice(1).join("_").replace(/%20/g," ").replace(/%25/g,"%")}function se(e){const t=`\n  <div class='p-3 bg-light w-100'>\n    <div class="mb-3">\n      <label for="source-select" class="form-label"><span class="text-danger">*</span> Select Sources</label>\n      <div class="dropdown w-100">\n        <button \n          class="btn btn-light border w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources" \n          type="button" \n          id="sourceDropdown" \n          data-bs-toggle="dropdown" \n          aria-expanded="false">\n          <span id="sourceDropdownLabel" class='sourceDropdownLabel'></span>\n          <span class="dropdown-toggle-icon dropdown-toggle-icon-s"></span>\n        </button>\n        <ul class="dropdown-menu w-100 p-2" aria-labelledby="sourceDropdown" style="box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000;">\n          <li class="dropdown-item p-2" style="cursor: pointer;" data-checkbox-id="selectAll">\n            <div class="form-check">\n              <input class="form-check-input" type="checkbox" value="selectAll" id="selectAll">\n              <label class="form-check-label w-100" for="selectAll">Select All</label>\n            </div>\n          </li>\n          ${f.map(((e,t)=>`\n              <li class="dropdown-item p-2" style="cursor: pointer;" data-checkbox-id="source-${t}">\n                <div class="form-check">\n                  <input class="form-check-input source-checkbox" type="checkbox" value="${e.SourceName}" id="source-${t}">\n                  <label class="form-check-label w-100 text-prewrap" for="source-${t}">${e.SourceName}</label>\n                </div>\n              </li>\n            `)).join("")}\n        </ul>\n      </div>\n    </div>\n    <div class="d-flex justify-content-end mt-2">\n      <button id="cancel-src-btn" class="btn btn-danger bg-danger-clr px-3 me-2"><i class="fa fa-reply me-2"></i>Cancel</button>\n      <button id="ok-src-btn" class="btn btn-success bg-success-clr px-3"><i class="fa fa-check-circle me-2"></i>Save</button>\n    </div>\n  </div>\n  `,n=document.getElementById("chatFooter");n.innerHTML=t;let o=[];const a=document.getElementById("selectAll"),r=document.querySelectorAll(".source-checkbox"),i=document.getElementById("sourceDropdownLabel");function s(){const e=o;e.length>0?i.innerText=e.join(", "):i.innerText=" "}if(a.addEventListener("change",(function(){document.querySelectorAll(".source-checkbox").forEach((e=>{e.checked=this.checked,e.checked?o.includes(e.value)||o.push(e.value):o=o.filter((t=>t!==e.value))})),s()})),document.querySelector('.dropdown-item[data-checkbox-id="selectAll"]').addEventListener("click",(function(e){e.stopPropagation()})),r.forEach((e=>{e.addEventListener("change",(function(){e.checked?o.includes(e.value)||o.push(e.value):o=o.filter((t=>t!==e.value));const t=Array.from(r).every((e=>e.checked));a.checked=t,s()})),e.closest("li").addEventListener("click",(function(e){e.stopPropagation()}))})),e.Sources&&e.Sources.length>0){r.forEach((t=>{e.Sources.includes(t.value)&&(t.checked=!0,o.push(t.value))}));const t=Array.from(r).every((e=>e.checked));a.checked=t,s()}document.getElementById("ok-src-btn").addEventListener("click",(function(){e.Sources=[...o],e.SourceValue=f.filter((e=>o.includes(e.SourceName))).map((e=>e.SourceValue)),n.innerHTML=l(e),m(e,g,x)})),document.getElementById("cancel-src-btn").addEventListener("click",(function(){n.innerHTML=l(e),m(e,g,x)}))}window.addEventListener("hashchange",(()=>{"#/dashboard"===window.location.hash&&w&&(w=!1,H=Number(sessionStorage.getItem("userId")),V())})),Office.onReady((e=>{e.host===Office.HostType.Word&&(document.getElementById("app-body").style.display="flex",document.getElementById("footer").innerText=` ${M} - TrialAssure LINK AI Assistant 2.0.0`,document.getElementById("editor"),window.location.hash="#/login",async function(){try{await Word.run((async e=>{const t=e.document.properties.customProperties;t.load("items"),await e.sync();const n=t.items.find((e=>"DocumentID"===e.key)),o=t.items.find((e=>"Organization"===e.key));if(!n||!o)return document.getElementById("app-body").innerHTML='\n        <p class="px-3 text-center">Export a document from the LINK AI application to use this functionality.</p>',console.log('Custom property "documentID" not found.'),null;b=n.value,v=o.value,j()}))}catch(e){console.error("Error retrieving custom property:",e)}}(),Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,(()=>{!async function(){Word.run((async e=>{let t=e.document.getSelection();await e.sync();let n=t.getBookmarks();await e.sync(),n.value.length>0&&(F=[],n.value.forEach((e=>{let t=e.split("_Split_")[0];t=t.replace(/_/g," "),F.push(t),document.getElementById("tags-in-selected-text")&&c(F,x)})))}))}()})))}))}(),e=i(14385),t=i.n(e),n=new URL(i(58394),i.b),o=new URL(i(57030),i.b),t()(n),t()(o)}();
//# sourceMappingURL=taskpane.js.map