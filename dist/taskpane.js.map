{"version":3,"file":"taskpane.js","mappings":"iCAEIA,EACAC,E,qBCDJC,EAAOC,QAAU,SAAUC,EAAKC,GAK9B,OAJKA,IAEHA,EAAU,CAAC,GAERD,GAKLA,EAAME,OAAOF,EAAIG,WAAaH,EAAII,QAAUJ,GACxCC,EAAQI,OAEVL,GAAOC,EAAQI,MAEbJ,EAAQK,iBAAmB,oBAAoBC,KAAKP,GAC/C,IAAKQ,OAAOR,EAAK,KAEnBA,GAZEA,CAaX,C,mICpBIS,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAab,QAGrB,IAAID,EAASW,EAAyBE,GAAY,CAGjDZ,QAAS,CAAC,GAOX,OAHAe,EAAoBH,GAAUb,EAAQA,EAAOC,QAASW,GAG/CZ,EAAOC,OACf,CAGAW,EAAoBK,EAAID,ECxBxBJ,EAAoBM,EAAI,SAASlB,GAChC,IAAImB,EAASnB,GAAUA,EAAOK,WAC7B,WAAa,OAAOL,EAAgB,OAAG,EACvC,WAAa,OAAOA,CAAQ,EAE7B,OADAY,EAAoBQ,EAAED,EAAQ,CAAEE,EAAGF,IAC5BA,CACR,ECNAP,EAAoBQ,EAAI,SAASnB,EAASqB,GACzC,IAAI,IAAIC,KAAOD,EACXV,EAAoBY,EAAEF,EAAYC,KAASX,EAAoBY,EAAEvB,EAASsB,IAC5EE,OAAOC,eAAezB,EAASsB,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAG3E,ECPAX,EAAoBiB,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOC,MAAQ,IAAIC,SAAS,cAAb,EAChB,CAAE,MAAOC,GACR,GAAsB,iBAAXC,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxBtB,EAAoBY,EAAI,SAASW,EAAKC,GAAQ,OAAOX,OAAOY,UAAUC,eAAeC,KAAKJ,EAAKC,EAAO,E,WCAtG,IAAII,EACA5B,EAAoBiB,EAAEY,gBAAeD,EAAY5B,EAAoBiB,EAAEa,SAAW,IACtF,IAAIC,EAAW/B,EAAoBiB,EAAEc,SACrC,IAAKH,GAAaG,IACbA,EAASC,gBACZJ,EAAYG,EAASC,cAAcC,MAC/BL,GAAW,CACf,IAAIM,EAAUH,EAASI,qBAAqB,UAC5C,GAAGD,EAAQE,OAEV,IADA,IAAIC,EAAIH,EAAQE,OAAS,EAClBC,GAAK,KAAOT,IAAc,aAAa/B,KAAK+B,KAAaA,EAAYM,EAAQG,KAAKJ,GAE3F,CAID,IAAKL,EAAW,MAAM,IAAIU,MAAM,yDAChCV,EAAYA,EAAUW,QAAQ,OAAQ,IAAIA,QAAQ,QAAS,IAAIA,QAAQ,YAAa,KACpFvC,EAAoBwC,EAAIZ,C,IClBxB5B,EAAoByC,EAAIV,SAASW,SAAWC,KAAKb,SAASc,K,wQCA1D,MCGMC,EDHQ,sCEEP,SAASC,EAA2BC,EAAmBC,GAC5D,IAAIC,EAAQ,SACRC,EAAOF,EAEPA,EAAKG,WAAW,YAClBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,WACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,UACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,SACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,QACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,QACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAGTN,EAAMO,gBAAgBJ,EAAMK,KAAKC,eAAeC,QACxDR,MAAQA,CACpB,CAGO,SAASS,EAAaC,GAC3B,OAAOA,EACHA,EACCpB,QAAQ,SAAU,IAClBA,QAAQ,OAAQ,IAChBA,QAAQ,QAAS,IACjBA,QAAQ,OAAQ,IACjB,EACN,CA6BO,SAASqB,EAASV,GAEvB,MAAMW,EAAe9B,SAAS+B,cAAc,YAC5CD,EAAaF,MAAQT,EACrBnB,SAASgC,KAAKC,YAAYH,GAC1BA,EAAaI,SACblC,SAASmC,YAAY,QACrBnC,SAASgC,KAAKI,YAAYN,EAE5B,CAcO,SAASO,IAEdrC,SAASsC,cAAc,qBAAqBC,UAAUC,OAAO,UAC7DxC,SAASsC,cAAc,0BAA0BC,UAAUC,OAAO,OAAQ,UAG1ExC,SAASyC,eAAe,WAAWF,UAAUG,IAAI,UACjD1C,SAASyC,eAAe,gBAAgBF,UAAUG,IAAI,OAAQ,SAChE,CAEO,SAASC,EAAuBC,GACrC,MAAMC,EAAQ,qCACd,IAAIC,EACAC,EAAS,GAEb,KAAsC,QAA9BD,EAAQD,EAAMG,KAAKJ,KACzB,IACE,MAAMK,EAAgBC,KAAKC,MAAML,EAAM,IACvCC,EAAOK,KAAKC,EAAgBJ,GAC9B,CAAE,MAAOK,GACPC,QAAQD,MAAM,wBAAyBA,EAAOR,EAAM,GACtD,CAGF,IAAIU,EAAa,EACjB,OAAOZ,EAAKpC,QAAQqC,GAAO,IAAME,EAAOS,MAAiB,IAC3D,CAEA,SAASH,EAAgBI,GACvB,IAAKA,GAAaC,MAAMC,QAAQF,IAAiC,IAApBA,EAASpD,OACpD,MAAO,2BAGT,IAAIuD,EAAU,IAAIC,IACdC,EAAO,GAEX,SAASC,EAAcvE,EAAKwE,EAAS,GAAIC,EAAS,CAAC,GAiBjD,OAhBAnF,OAAOoF,KAAK1E,GAAK2E,SAAQvF,IACvB,MAAMgD,EAAQpC,EAAIZ,GACZwF,EAASJ,EAAS,GAAGA,OAAYpF,IAAQA,EAE1B,iBAAVgD,GAAgC,OAAVA,GAAmB8B,MAAMC,QAAQ/B,GAEvD8B,MAAMC,QAAQ/B,GACvBqC,EAAOG,GAAUxC,EAAMyC,KAAIC,GACF,iBAATA,EACVxF,OAAOyF,QAAQD,GAAMD,KAAI,EAAEG,EAAGC,KAAO,WAAWD,eAAeC,MAAKC,KAAK,QACzEJ,IACHI,KAAK,QAERT,EAAOG,GAAUxC,EARjBmC,EAAcnC,EAAOwC,EAAQH,EAS/B,IAEKA,CACT,CAEKP,MAAMC,QAAQF,KACjBA,EAAW3E,OAAOyF,QAAQd,GAAUY,KAAI,EAAEzF,EAAKgD,MAAW,CAAG,CAAChD,GAAMgD,OAGtE6B,EAASU,SAAQG,IACf,IAAIK,EAAgBZ,EAAcO,GAClCxF,OAAOoF,KAAKS,GAAeR,SAAQvF,GAAOgF,EAAQlB,IAAI9D,KACtDkF,EAAKV,KAAKuB,EAAc,IAG1B,IAAIC,EAAQ,qDAOZ,OANAA,GAAS,OAAS,IAAIhB,GAASS,KAAIQ,GAAU,OAAOA,WAAeH,KAAK,IAAM,QAC9EZ,EAAKK,SAAQW,IACXF,GAAS,OAAS,IAAIhB,GAASS,KAAIQ,GAAU,OAAOC,EAAID,YAAgBH,KAAK,IAAM,OAAO,IAG5FE,GAAS,WACFA,CACT,CA8KO,SAASG,EAAWC,GAIzB,MAAO,gqBAHeA,EAAIC,SAAWD,EAAIC,QAAQ5E,OAAS,EACtD,+BAA+B2E,EAAIC,iBACnC,kaAoBN,CAEO,SAASC,EAAmBC,EAAeC,GAEhD,MAAMC,EAAerF,SAASyC,eAAe,qBAC7C4C,EAAaC,UAAU,GACvBH,EAAchB,SAAQoB,IACpB,MAAMC,EAAQxF,SAAS+B,cAAc,QACrCyD,EAAMC,UAAY,6GAClBD,EAAMtE,MAAMwE,OAAS,UACrBF,EAAMF,UAAY,GAAGC,gFAErBC,EAAMG,iBAAiB,SAAS,KAC9B,MAAMC,EAAQR,EAAcS,MAC1BC,GAA8B,IAAnBA,EAAQC,QAAgBD,EAAQE,YAAYC,gBAAkBV,EAAKU,gBAGhF,GAAIL,EAAO,CACT,MAAMM,EAAUlG,SAASyC,eAAe,YACxCyD,EAAQZ,UAAY,+CAEpBa,EAAwBP,GAAOQ,MAAKC,IAClCH,EAAQZ,UAAYe,CAAI,GAE5B,KAGFhB,EAAapD,YAAYuD,EAAM,GAEnC,CChYO,SAASc,EAAalB,GACzBpF,SAASyC,eAAe,YAAY6C,UAAY,yqCAyChD,MAAMiB,EAAYvG,SAASyC,eAAe,cACpC+D,EAAiBxG,SAASyC,eAAe,mBAC/CyC,EAAmBC,EAAcC,GA0DjCmB,EAAUZ,iBAAiB,SAxD3B,WACI,MAAMc,EAAaF,EAAU3E,MAAMN,OAAO2E,cAG1C,GAFAO,EAAeE,kBAEI,KAAfD,EAAmB,OAEvB,MAAME,EAAmBvB,EAAcwB,QAAOd,GAC1CA,EAAQE,YAAYC,cAAcY,SAASJ,KAGzCK,EAAYH,EAAiBC,QAAOtI,GAAkB,IAAbA,EAAEyH,SAC3CgB,EAASJ,EAAiBC,QAAOtI,GAAkB,IAAbA,EAAEyH,SAGxCiB,EAAgBA,CAACC,EAAWC,EAAUC,GAAc,KACtD,GAAwB,IAApBD,EAAS7G,OAAc,OAE3B,MAAM+G,EAAQpH,SAAS+B,cAAc,MACrCqF,EAAM3B,UAAY,kDAClB2B,EAAMC,YAAcJ,EACpBT,EAAevE,YAAYmF,GAE3BF,EAAS/C,SAAQ2B,IACb,MAAMwB,EAAWtH,SAAS+B,cAAc,MACxCuF,EAAS7B,UAAY,yCAErB,MAAM8B,EAAOJ,EACP,oDACA,0DAENG,EAAShC,UAAY,GAAGiC,KAAQzB,EAAQE,cAExCsB,EAASE,QAAU,KACf,GAAIL,EAAa,CACb,MAAMjB,EAAUlG,SAASyC,eAAe,YACxCyD,EAAQZ,UAAY,+CACpBa,EAAwBL,GAASM,MAAKC,IAClCH,EAAQZ,UAAYe,CAAI,GAEhC,MAgCboB,eAA8BC,EAAWC,GACrCnG,KAAKoG,KAAIH,UACZ,IACI,MAAMI,EAAYC,EAAQ9H,SAAS+H,eAGnC,SAFMD,EAAQE,QAETH,EACD,MAAM,IAAItH,MAAM,sCAEpB,GAAa,UAAToH,EAAkB,CAClB,MACMM,GADS,IAAIC,WACAC,gBAAgBT,EAAKU,YAAa,aAE/CC,EAAY3E,MAAM4E,KAAKL,EAAIjG,KAAKuG,YAGhCC,EAAe,GAFId,EAAK1B,YAAYxF,QAAQ,OAAQ,eACxC,IAAIiI,MAAOC,YAGTb,EAAUtG,gBAAgB,qBAAsBC,KAAKC,eAAeC,cAClFoG,EAAQE,OAEd,IAAK,MAAMW,KAAQN,EACf,GAAIM,EAAKC,WAAaC,KAAKC,UAAW,CAClC,MAAMzB,EAAcsB,EAAKtB,aAAa/F,OAClC+F,GACAA,EAAY0B,MAAM,MAAM5E,SAAQlD,IACxBA,EAAKK,QACLP,EAA2B8G,EAAW5G,EAC1C,GAGZ,MAAO,GAAI0H,EAAKC,WAAaC,KAAKG,aAAc,CAC5C,MAAMC,EAAUN,EAEhB,GAAsC,UAAlCM,EAAQC,QAAQjD,cAA2B,CAC3C,MAAMnC,EAAOJ,MAAM4E,KAAKW,EAAQE,iBAAiB,OAEjD,GAAoB,IAAhBrF,EAAKzD,OAAc,CACnBwH,EAAUtG,gBAAgB,gBAAiBC,KAAKC,eAAeC,QAC/D,QACJ,CAEA,MAAM0H,EAAUC,KAAKC,OAAOxF,EAAKO,KAAIS,GAC1BpB,MAAM4E,KAAKxD,EAAIqE,iBAAiB,WAAWI,QAAO,CAACC,EAAKC,IACpDD,EAAOE,SAASD,EAAKE,aAAa,YAAc,IAAK,KAC7D,MAGDC,EAAY/B,EAAUtG,gBAAgB,GAAIC,KAAKC,eAAeC,cAC9DoG,EAAQE,OAEd,MAAMpD,EAAQgF,EAAUC,YAAY/F,EAAKzD,OAAQ+I,EAAS5H,KAAKC,eAAeqI,OAC9ElF,EAAM1D,MAAQ,gCAER4G,EAAQE,OAEd,MAAM+B,EAA2B,IAAIrG,MAAM0F,GAASY,KAAK,GAEzDlG,EAAKK,SAAQ,CAACW,EAAKmF,KACf,MAAMC,EAAQxG,MAAM4E,KAAKxD,EAAIqE,iBAAiB,WAC9C,IAAIgB,EAAY,EAEhBD,EAAM/F,SAASsF,IACX,KAAOM,EAAeI,GAAa,GAC/BJ,EAAeI,KACfA,IAGJ,MAAMC,EAAW1G,MAAM4E,KAAKmB,EAAKlB,YAC5BlE,KAAIsE,GACGA,EAAKC,WAAaC,KAAKC,UAChBH,EAAKtB,aAAa/F,QAAU,GAC5BqH,EAAKC,WAAaC,KAAKG,aACtBL,EAAqB0B,UAAU/I,OAEpC,KAEVsF,QAAOzF,GAAQA,EAAKd,OAAS,IAC7BqE,KAAK,KAEJ4F,EAAUZ,SAASD,EAAKE,aAAa,YAAc,IAAK,IACxDY,EAAUb,SAASD,EAAKE,aAAa,YAAc,IAAK,IAC9D/E,EAAM4F,QAAQP,EAAUE,GAAWvI,MAAQwI,EAE3C,IAAK,IAAI9J,EAAI,EAAGA,EAAIgK,EAAShK,IACrB6J,EAAY7J,EAAI8I,IAChBxE,EAAM4F,QAAQP,EAAUE,EAAY7J,GAAGsB,MAAQ,IAIvD,GAAI2I,EAAU,EACV,IAAK,IAAIjK,EAAI,EAAGA,EAAIgK,EAAShK,IACrB6J,EAAY7J,EAAI8I,IAChBW,EAAeI,EAAY7J,GAAKiK,EAAU,GAKtDJ,GAAaG,CAAO,GACtB,GAEV,KAAO,CACH,MAAMG,EAAcxB,EAAQoB,UAAU/I,OAClCmJ,GACAA,EAAY1B,MAAM,MAAM5E,SAAQlD,IACxBA,EAAKK,QACLP,EAA2B8G,EAAW5G,EAC1C,GAGZ,CACJ,CAGc4G,EAAUtG,gBAAgB,mBAAoBC,KAAKC,eAAeqI,aAC9EhC,EAAQE,OAGd,MAAM0C,EAAU5C,EAAQ9H,SAASgC,KAAK2I,WACtC7C,EAAQ8C,KAAKF,EAAS,cAEhB5C,EAAQE,OAEd,MAAM6C,EAAQH,EAAQI,MAAMjF,MAAKpF,GAAgB,uBAAXA,EAAEU,OAClC4J,EAAML,EAAQI,MAAMjF,MAAKpF,GAAgB,qBAAXA,EAAEU,OAElC0J,GAASE,IACaF,EAAMG,SAAS,SAASC,SAASF,EAAIC,SAAS,QACtDE,eAAe1C,GAC7BjF,QAAQ4H,IAAI,6BAA6B3C,MAI7CqC,EAAMO,WAAW,GAAI5J,KAAKC,eAAejB,SACzCuK,EAAIK,WAAW,GAAI5J,KAAKC,eAAejB,QAC3C,KAG6B,KAArBkH,EAAKU,aAAsBV,EAAK2D,UAChCxD,EAAUtG,gBAAgB,IAAImG,EAAK1B,eAAgBxE,KAAKC,eAAeC,QAOzDC,EAAa+F,EAAKU,aACZW,MAAM,SACpB5E,SAAQlD,IACV4G,EAAUtG,gBAAgBN,EAAMO,KAAKC,eAAeC,OAAO,UAMjEoG,EAAQE,MAClB,CAAE,MAAO1E,GACLC,QAAQD,MAAM,kBAAmBA,EACrC,IAER,CA/LwBgI,CAAexF,EAASA,EAAQyF,sBAChC/E,EAAeE,iBACnB,EAGJF,EAAevE,YAAYqF,EAAS,GACtC,EAINN,EAAc,aAAcF,GAAW,GACvCE,EAAc,UAAWD,GAAQ,EACrC,IAKA/G,SAASyC,eAAe,eAAekD,iBAAiB,SAAS,KACxD6F,GACDC,IACJ,IAGJzL,SAASyC,eAAe,iBAAiBkD,iBAAiB,SAAS,KAC1D6F,GACDE,GACJ,GAER,CA8KOjE,eAAetB,EAAwBnB,GAK1C,GAJKA,EAAI2G,iCAAkF,IAA/C3G,EAAI2G,gCAAgCtL,cACtEuL,EAAe5G,GAGrBA,EAAI2G,gCAAgCtL,OAAS,EAAG,CAChD,MAyBMwL,EAAY,mNAtBM7G,EAAIgB,6SASUhB,EAAI2G,gCDNhCtH,KAAI,CAACyH,EAAMC,IACzB,4OAGoGA,2NAI9ED,EAAKE,kVAM0GD,qNAI9FA,mCACK,IAAlBD,EAAKG,SAAiB,UAAY,uDACfF,MAAUD,EAAKI,+LAGlBH,qGAK1CrH,KAAK,mICfkBK,EAAWC,uBAS9B,OADAmH,EAA0BnH,EAAKoH,EAAKhH,GAC7ByG,CACX,CACI,MAAO,qCAEf,CA6UO,SAASM,EAA0BnH,EAAUoH,EAAahH,GAC7DiH,YAAW,KACPrH,EAAI2G,gCAAgCxH,SAAQ,CAAC2H,EAAWC,KAEpD/L,SAASyC,eAAe,cAAcsJ,MAAUpG,iBAAiB,SAAS,IAAM9D,EAASiK,EAAKE,UAC9FhM,SAASyC,eAAe,gBAAgBsJ,MAAUpG,iBAAiB,SAAS,IAAM9D,EAASiK,EAAKI,YAGhGlM,SAASyC,eAAe,kBAAkBkD,iBAAiB,SAAS,IAAMW,EAAalB,KAGvF,MAAMkH,EAAWtM,SAASyC,eAAe,YAAYsJ,KACjDO,GACAA,EAAS3G,iBAAiB,UAAU8B,UAChC,MAAM8E,EAAaC,EAAMC,OAA4BC,QAerD,GAZA1H,EAAI2G,gCAAgCxH,SAAQ,CAACwI,EAAQC,KACjD,MAAMC,EAAgB7M,SAASyC,eAAe,YAAYmK,KACpDE,EAAoB9M,SAASyC,eAAe,qBAAqBmK,KACnEC,IAAeA,EAAcH,SAAU,GACvCI,IACAA,EAAkBvK,UAAUC,OAAO,wBACnCsK,EAAkBvK,UAAUG,IAAI,aAEpCsC,EAAI2G,gCAAgCiB,GAAYX,SAAW,CAAC,IAI5DM,EAAW,CACXD,EAASI,SAAU,EACnB,MAAMI,EAAoB9M,SAASyC,eAAe,qBAAqBsJ,KACnEe,IACAA,EAAkBvK,UAAUG,IAAI,wBAChCoK,EAAkBvK,UAAUC,OAAO,aAEvCsJ,EAAKG,SAAW,CACpB,MACIH,EAAKG,SAAW,EAGpB,IACI,MAAMrJ,QF/kBrB6E,eAA+BsF,EAAcX,GAClD,MAAMY,QAAiBC,MAAM,GAAGnM,iCAAwC,CACtEoM,OAAQ,MACRtJ,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUwI,KAE7BpK,KAAMkB,KAAKiK,UAAUJ,KAGvB,IAAKC,EAASI,GACZ,MAAM,IAAI7M,MAAM,gCAIlB,aADwByM,EAASK,MAEnC,CE+jByCC,CAAgBxB,EAAMM,GACzC,GAAIxJ,EAAW,KAAG,CACdoC,EAAIuI,wBAA0BrK,KAAKC,MAAMD,KAAKiK,UAAUvK,EAAW,OACnEoC,EAAI2G,gCAAkC,GAEtC3G,EAAIuI,wBAAwBpJ,SAASqJ,IACjCA,EAAYtB,SAAWvK,EAAa6L,EAAYtB,UAChDlH,EAAI2G,gCAAgC8B,QAAQD,EAAY,IAG5D,MAAME,EAAgB5B,EAAK6B,kBACrB,KAAOhL,EAAuBmJ,EAAK6B,mBACnC7B,EAAKI,SAEXlH,EAAIuG,qBAAuBO,EAAK6B,kBAAoB,QAAU,OAC9D3I,EAAI4I,UAAYF,EAChB1I,EAAIoD,YAAcsF,EAClB1I,EAAI7D,KAAOuM,EAEX,MAAMG,EAAoB7I,EAAI2G,gCAAgCmC,MAAMxJ,GAAgC,IAAlBA,EAAK2H,WACvFjH,EAAIqG,WAAawC,CACrB,CACJ,CAAE,MAAOE,GACLxK,QAAQD,MAAM,+BAAgCyK,EAClD,IAER,IAIJ/N,SAASyC,eAAe,oBAAoBkD,iBAAiB,SAAS,KAC7DX,EAAIqG,WAjOrB5D,eAA+BzC,GACpBxD,KAAKoG,KAAIH,UACZ,IACI,MAAMI,EAAYC,EAAQ9H,SAAS+H,eAGnC,SAFMD,EAAQE,QAETH,EACD,MAAM,IAAItH,MAAM,sCAGpB,MAEMiI,EAAe,GAFIxD,EAAIgB,YAAYxF,QAAQ,OAAQ,eACvC,IAAIiI,MAAOC,YAM7B,GAHoBb,EAAUtG,gBAAgB,qBAAsBC,KAAKC,eAAeC,cAClFoG,EAAQE,OAEU,KAApBhD,EAAIoD,YACJP,EAAUtG,gBAAgB,IAAIyD,EAAIgB,eAAgBxE,KAAKC,eAAeC,aAEtE,GAAiC,UAA7BsD,EAAIuG,qBAAkC,CACtC,MACMtD,GADS,IAAIC,WACAC,gBAAgBnD,EAAIoD,YAAa,aAC9CC,EAAY3E,MAAM4E,KAAKL,EAAIjG,KAAKuG,YAEtC,IAAK,MAAMI,KAAQN,EACf,GAAIM,EAAKC,WAAaC,KAAKC,UAAW,CAClC,MAAMzB,EAAcsB,EAAKtB,aAAa/F,OAClC+F,GACAA,EAAY0B,MAAM,MAAM5E,SAAQlD,IACxBA,EAAKK,QACLP,EAA2B8G,EAAW5G,EAC1C,GAGZ,MAAO,GAAI0H,EAAKC,WAAaC,KAAKG,aAAc,CAC5C,MAAMC,EAAUN,EAEhB,GAAsC,UAAlCM,EAAQC,QAAQjD,cAA2B,CAC3C,MAAMnC,EAAOJ,MAAM4E,KAAKW,EAAQE,iBAAiB,OAEjD,GAAoB,IAAhBrF,EAAKzD,OAAc,CACnBwH,EAAUtG,gBAAgB,gBAAiBC,KAAKC,eAAeC,QAC/D,QACJ,CAEA,MAAM0H,EAAUC,KAAKC,OAAOxF,EAAKO,KAAIS,GAC1BpB,MAAM4E,KAAKxD,EAAIqE,iBAAiB,WAAWI,QAAO,CAACC,EAAKC,IACpDD,EAAOE,SAASD,EAAKE,aAAa,YAAc,IAAK,KAC7D,MAGDC,EAAY/B,EAAUtG,gBAAgB,GAAIC,KAAKC,eAAeC,cAC9DoG,EAAQE,OAEd,MAAMpD,EAAQgF,EAAUC,YAAY/F,EAAKzD,OAAQ+I,EAAS5H,KAAKC,eAAeqI,OAC9ElF,EAAM1D,MAAQ,gCACR4G,EAAQE,OAEd,MAAM+B,EAA2B,IAAIrG,MAAM0F,GAASY,KAAK,GAEzDlG,EAAKK,SAAQ,CAACW,EAAKmF,KACf,MAAMC,EAAQxG,MAAM4E,KAAKxD,EAAIqE,iBAAiB,WAC9C,IAAIgB,EAAY,EAEhBD,EAAM/F,SAASsF,IACX,KAAOM,EAAeI,GAAa,GAC/BJ,EAAeI,KACfA,IAGJ,MAAMC,EAAW1G,MAAM4E,KAAKmB,EAAKlB,YAC5BlE,KAAIsE,GACGA,EAAKC,WAAaC,KAAKC,UAChBH,EAAKtB,aAAa/F,QAAU,GAC5BqH,EAAKC,WAAaC,KAAKG,aACtBL,EAAqB0B,UAAU/I,OAEpC,KAEVsF,QAAOzF,GAAQA,EAAKd,OAAS,IAC7BqE,KAAK,KAEJ4F,EAAUZ,SAASD,EAAKE,aAAa,YAAc,IAAK,IACxDY,EAAUb,SAASD,EAAKE,aAAa,YAAc,IAAK,IAC9D/E,EAAM4F,QAAQP,EAAUE,GAAWvI,MAAQwI,EAE3C,IAAK,IAAI9J,EAAI,EAAGA,EAAIgK,EAAShK,IACrB6J,EAAY7J,EAAI8I,IAChBxE,EAAM4F,QAAQP,EAAUE,EAAY7J,GAAGsB,MAAQ,IAIvD,GAAI2I,EAAU,EACV,IAAK,IAAIjK,EAAI,EAAGA,EAAIgK,EAAShK,IACrB6J,EAAY7J,EAAI8I,IAChBW,EAAeI,EAAY7J,GAAKiK,EAAU,GAKtDJ,GAAaG,CAAO,GACtB,GAEV,KAAO,CACH,MAAMG,EAAcxB,EAAQoB,UAAU/I,OAClCmJ,GACAA,EAAY1B,MAAM,MAAM5E,SAAQlD,IACxBA,EAAKK,QACLP,EAA2B8G,EAAW5G,EAC1C,GAGZ,CACJ,CAER,MACkBU,EAAaqD,EAAIoD,aACXW,MAAM,SACpB5E,SAAQlD,IACV4G,EAAUtG,gBAAgBN,EAAMO,KAAKC,eAAeC,OAAO,IAKrDmG,EAAUtG,gBAAgB,mBAAoBC,KAAKC,eAAeqI,aAC9EhC,EAAQE,OAEd,MAAM0C,EAAU5C,EAAQ9H,SAASgC,KAAK2I,WACtC7C,EAAQ8C,KAAKF,EAAS,cAChB5C,EAAQE,OAEd,MAAM6C,EAAQH,EAAQI,MAAMjF,MAAKpF,GAAgB,uBAAXA,EAAEU,OAClC4J,EAAML,EAAQI,MAAMjF,MAAKpF,GAAgB,qBAAXA,EAAEU,OAElC0J,GAASE,IACaF,EAAMG,SAAS,SAASC,SAASF,EAAIC,SAAS,QACtDE,eAAe1C,GAC7BjF,QAAQ4H,IAAI,mBAAmB3C,MAG/BqC,GAAOA,EAAMO,WAAW,GAAI5J,KAAKC,eAAejB,SAChDuK,GAAKA,EAAIK,WAAW,GAAI5J,KAAKC,eAAejB,eAE1CsH,EAAQE,MAClB,CAAE,MAAO1E,GACLC,QAAQD,MAAM,kBAAmBA,EACrC,IAER,CA6EgB0K,CAAgBhJ,EACpB,IAIJhF,SAASyC,eAAe,qBAAqBkD,iBAAiB,SAAS,KACnE,MAAMsI,EAAiBjO,SAASyC,eAAe,aAAqCb,MACpFsM,EAAWlJ,EAAKiJ,EAAc,IAIlCjO,SAASyC,eAAe,uBAAuBkD,iBAAiB,SAAS,KACrEwI,GAA0BnJ,EAAI,IAIlCoJ,GAAkB,YAAa,mBAAoB,OAAO,GAC3D,EACP,CCroBA,MAAMC,EAAU,8mBCxGT,IAsBHC,EACAC,EAvBOnC,EAAM,GACboC,ELTW,sEKUXC,EAAa,GACbC,EAAmB,GACnBC,EAAY,GACZC,GAAc,EACPxJ,EAAgB,GACvByJ,EAAoB,GACpBC,EAAe,GACfC,GAA4B,EAC5BC,EAAoB,GACpBC,EAAW,GACXC,EAAgB,GAChBC,GAAyB,EACzBC,EAA0B,CAAC,EAC3BC,GAAuB,EACvBC,GAAmC,EACnCC,EAAW,IACXC,EAAS,EACTC,EAAa,GAEbC,GAAc,IAAIjH,MAAOkH,cAGlBxK,EAAgB,GAChBqG,GAAoB,EAgE/B/D,eAAemI,IAEb,MAAMC,EAAeC,eAAeC,QAAQ,SAC5CxM,QAAQ4H,IAAI0E,GACRA,GACFzD,EAAMyD,EACNtQ,OAAOQ,SAASnC,KAAO,eAEvBoS,GAEJ,CAEA,SAASA,IAGPhQ,SAASyC,eAAe,YAAY6C,UAAY,+6BAwBhDtF,SAASyC,eAAe,cAAckD,iBAAiB,SAAUsK,EACnE,CAEAxI,eAAewI,EAAYzD,GACzBA,EAAM0D,iBAGN,MAAMC,EAAgBnQ,SAASyC,eAAe,gBAAqCb,MAC7EwO,EAAYpQ,SAASyC,eAAe,YAAiCb,MACrEyO,EAAYrQ,SAASyC,eAAe,YAAiCb,MAC3E,GAAIuO,EAAalK,cAAc3E,SAAWoN,EAAiB4B,oBAAoBhP,OAAQ,CACrFtB,SAASyC,eAAe,YAAY6C,UAAY,yGAMhD,IACE,MAAM1C,QJtJL6E,eAAyB0I,EAAsBC,EAAkBC,GACtE,MAAMrD,QAAiBC,MAAM,GAAGnM,mBAA0B,CACxDoM,OAAQ,OACRtJ,QAAS,CACP,eAAgB,oBAElB5B,KAAMkB,KAAKiK,UAAU,CACnBoD,WAAYJ,EACZK,SAAUJ,EACVK,SAAUJ,MAId,IAAKrD,EAASI,GACZ,MAAM,IAAI7M,MAAM,+BAIlB,aADwByM,EAASK,MAEnC,CImIyBqD,CAAUP,EAAcC,EAAUC,IACjC,IAAhBzN,EAAK+N,QAAmB/N,EAAW,MACjCA,EAAW,KAAEgO,gBACfxE,EAAMxJ,EAAKiO,KAAKC,MAChBhB,eAAeiB,QAAQ,QAAS3E,GAChC0D,eAAeiB,QAAQ,SAAUnO,EAAKiO,KAAKG,IAC3CzR,OAAOQ,SAASnC,KAAO,eAMzBqT,EAAe,oDAEnB,CAAE,MAAO3N,GACP2N,EAAe,qDACf1N,QAAQD,MAAM,sBAAuBA,EAEvC,CACF,MACE2N,EAAe,kEAEnB,CAEA,SAASA,EAAeC,GACtBlB,IACA,MAAMmB,EAAWnR,SAASyC,eAAe,eACzC0O,EAASjQ,MAAMkQ,QAAU,QACzBD,EAAS9J,YAAc6J,CACzB,CASAzJ,eAAe4J,EAAcC,GAC3B,IAEE,MAAM1O,QJvKH6E,eAA6BgH,EAAoBrC,GACpD,MAAMY,QAAiBC,MAAM,GAAGnM,mBAAyB2N,IAAc,CACrEvB,OAAQ,MACRtJ,QAAS,CACP,cAAiB,UAAUwI,OAI/B,IAAKY,EAASI,GACZ,MAAM,IAAI7M,MAAM,+BAIlB,aADmByM,EAASK,MAE9B,CIyJqBkE,CAAc9C,EAAYrC,GAC7CpM,SAASyC,eAAe,YAAY6C,UAAY,GAChDtF,SAASyC,eAAe,eAAe6C,UDrH3C,SAAoBkJ,GA6BlB,MA5Ba,kCACgBA,slCA4B/B,CCuFuDgD,CAAWhD,GAE9DU,EAAWtM,EAAW,KACtB0L,EAAaY,EAASuC,eAAe7K,QAClCtC,GAA8B,KAArBA,EAAKoN,aACM,IAAhBpN,EAAKyB,SAET1B,KAAKC,IAAI,IACLA,EACHqN,WAAYC,GAAsBtN,EAAKoN,iBAE3CnC,EAAWL,EAAS2C,SACpB,MAAMC,EAAUlP,EAAW,KAAEmP,MAAMlM,MAAKoD,GAAmC,YAAxBA,EAAQjD,cAC3DgJ,EAAY8C,EAAUA,EAAQE,KAAO,GACrCrD,EAAYmD,EAAUA,EAAQG,SAAW,GAEzC7M,EAAgBxC,EAAW,KAAEsP,YAAYtL,QAAOqC,GAA4C,UAAjCA,EAAQsC,sBAAqE,SAAjCtC,EAAQsC,uBAC/GnG,EAAcjB,SAASvF,IACrB,GAAmB,IAAfA,EAAImH,OAAc,CAGpB,IAAIjD,GACCA,EAAwC,OAH/B,qCAGKE,KAAKpE,EAAIwJ,gBAExBxJ,EAAIwJ,YAAczF,EAAuB/D,EAAIwJ,aAC7CxJ,EAAIgP,UAAYhP,EAAIwJ,YACpBxJ,EAAIuT,cAAe,EACnBvT,EAAI2M,qBAAuB,QAIjC,KAGFoD,EAAUxK,SAAQ,CAACvF,EAAK0B,KAGtB,IAAIwC,GACCA,EAAwC,OAH/B,qCAGKE,KAAKpE,EAAIwJ,gBAExBxJ,EAAIwJ,YAAczF,EAAuB/D,EAAIwJ,aAC7CxJ,EAAIgP,UAAYhP,EAAIwJ,YACpBxJ,EAAIuT,cAAe,EACnBvT,EAAI2M,qBAAuB,QAG/B,IAqDN9D,iBACE,IACE,MAAM+H,EAASM,eAAeC,QAAQ,WAAa,GAG7CnN,QJhQD6E,eAA6B+H,EAAgBpD,GAClD,MAAMY,QAAiBC,MAAM,GAAGnM,oBAA0B0O,IAAU,CAClEtC,OAAQ,MACRtJ,QAAS,CACP,cAAiB,UAAUwI,OAI/B,IAAKY,EAASI,GACZ,MAAM,IAAI7M,MAAM,+BAIlB,aADwByM,EAASK,MAEnC,CIkPqB+E,CAAc5C,EAAQpD,GAErCxJ,EAAK+N,QAAU/N,EAAKiO,KACtBpB,EAAa7M,EAAW,KAExBW,QAAQ8O,KAAK,8CAEjB,CAAE,MAAO/O,GACT,CACF,CA/DIgP,GAo8DJ7K,iBACE,IACE,MAAM7E,QJjhED6E,eAAqC2E,GAC1C,MAAMY,QAAiBC,MAAM,GAAGnM,4BAAmC,CACjEoM,OAAQ,MACRtJ,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUwI,OAI/B,IAAKY,EAASI,GACZ,MAAM,IAAI7M,MAAM,gCAIlB,aADwByM,EAASK,MAEnC,CIkgEqBkF,CAAsBnG,GACrCxJ,EAAK+N,QAAU/N,EAAKiO,OACtBhC,EAAoBjM,EAAKiO,KAG7B,CAAE,MAAOvN,GACPC,QAAQD,MAAM,mCAAoCA,EACpD,CACF,CA78DIkP,GACAlM,EAAalB,GACbpF,SAASyC,eAAe,QAAQkD,iBAAiB,SAAS8B,UACnD+D,IACCuD,SACI0D,KAGRnM,EAAalB,GACf,IAGFpF,SAASyC,eAAe,YAAYkD,iBAAiB,SAAS,KACxD0J,GAmtBV5H,iBACO0H,IAEHnP,SAASyC,eAAe,YAAY6C,UAAY,mIAOhDoN,IAIJ,CAhuBQC,EACF,IAGF3S,SAASyC,eAAe,qBAAqBkD,iBAAiB,SAAS,KAChE6F,GACHoH,GACF,IAKF5S,SAASyC,eAAe,oBAAoBkD,iBAAiB,SAAS,KAChE7G,OAAOoF,KAAKkL,GAAoB/O,OAAS,GAqOnDoH,iBACE,IAAK0H,EAAe,CACdJ,SACI0D,KAER,MAAMI,EAAW,q/BA4BjB7S,SAASyC,eAAe,YAAY6C,UAAYuN,EAChDC,IAE+C,OAA3C1D,EAAmB,qBACgB,YAArCA,EAAmB,gBACApP,SAASyC,eAAe,mBAAmB6C,UAAY,8HAI5EtF,SAASyC,eAAe,gBAAgBkD,iBAAiB,QAASoN,GAClE/S,SAASyC,eAAe,iBAAiBkD,iBAAiB,QAASiN,EAErE,CACF,CAlRQI,EACF,IAGFhT,SAASyC,eAAe,UAAUkD,iBAAiB,SAAS8B,UACrD+D,IACCuD,SACI0D,KAqbhBhL,iBACMsH,SACI0D,KAER3C,eAAemD,QACf1T,OAAOQ,SAASnC,KAAO,QACvBgR,GAAc,EACd5O,SAASyC,eAAe,eAAe6C,UAAY,GACnDsK,GACF,CA3bQsD,GACF,GAIJ,CAAE,MAAO5P,GACPC,QAAQD,MAAM,gCAAiCA,EACjD,CACF,CAoBOmE,eAAemL,IACpB,IAAKzD,EAAe,CACdJ,SACI0D,KAER,MAAMI,EAAW,2qCA6BjB7S,SAASyC,eAAe,YAAY6C,UAAYuN,EACD,IAA3C/T,OAAOoF,KAAKkL,GAAoB/O,SACZL,SAASyC,eAAe,kBAChCvB,MAAMkQ,QAAU,QAIhC,MAAM+B,EAAcnT,SAASyC,eAAe,YAK5C,GAJK0Q,EAAY5Q,UAAU6Q,SAAS,kBAClCD,EAAY5Q,UAAUG,IAAI,iBAGxB2M,EACFgE,SAGA,GAAgC,OAA5BjE,EAAmBkE,WAA6ClV,IAA5BgR,EAAmBkE,MACxB,UAAjClE,EAAmBmE,gBAA0DnV,IAAjCgR,EAAmBmE,WACnC,OAA5BnE,EAAmBoE,WAA6CpV,IAA5BgR,EAAmBoE,MACnB,OAApCpE,EAAmB,mBAA6DhR,IAApCgR,EAAmB,cACpB,KAA3CA,EAAmB,0BAAyEhR,IAA3CgR,EAAmB,qBAC/B,KAArCA,EAAmB,oBAA6DhR,IAArCgR,EAAmB,cAA6B,CACxEpP,SAASyC,eAAe,eAChC6C,UAAY,gDACvB,MAAMmO,EAAkBzT,SAASyC,eAAe,oBAG3CgR,EAAgBlR,UAAU6Q,SAAS,kBACtCK,EAAgBlR,UAAUG,IAAI,gBAElC,MAC0B1C,SAASyC,eAAe,oBAChCF,UAAUC,OAAO,iBACjCsQ,IAKJ9S,SAASyC,eAAe,sBAAsBkD,iBAAiB,QAAS+N,GAExE,MAAMC,EAAsB3T,SAASyC,eAAe,yBAChD6M,IACFqE,EAAoBjH,SAAU,EAC9B2G,KAGFM,EAAoBhO,iBAAiB,UAAU,KAC7C,GAAIgO,EAAoBjH,QACtB4C,GAA0B,EAC1B+D,QACK,CACcrT,SAASyC,eAAe,sBAChCmR,UAAW,EACtBtE,GAA0B,EAC1BD,GAAc,EACd,MAAM8D,EAAcnT,SAASyC,eAAe,YACvC0Q,EAAY5Q,UAAU6Q,SAAS,kBAClCD,EAAY5Q,UAAUG,IAAI,gBAE9B,IAGJ,CACF,CAIA,SAASoQ,IACPzD,GAAc,EACd,MAAMwE,EAAa7T,SAASyC,eAAe,eAC3CoR,EAAWvO,UAAY,GAEvB,IAAK,MAAO1G,EAAKgD,KAAU9C,OAAOyF,QAAQ6K,GAQtCyE,EAAWvO,WAPA,eAAR1G,GAAgC,qBAARA,IAA+BgD,EAOlC,eAAehD,eAAiBgD,SANhC,yBACRhD,cAAgBgD,0FACgDA,2DAOtF,CAEA,SAASyR,IACPjE,EAAqB,CAAC,EACApP,SAASyC,eAAe,kBAChCvB,MAAMkQ,QAAU,OAE9B/B,GAAc,EACMrP,SAASyC,eAAe,YAChCF,UAAUC,OAAO,iBACVxC,SAASyC,eAAe,sBAChCmR,UAAW,EAGtB,MAAMH,EAAkBzT,SAASyC,eAAe,oBAC3CgR,EAAgBlR,UAAU6Q,SAAS,kBACtCK,EAAgBlR,UAAUG,IAAI,iBAEhCa,QAAQ4H,IAAI,+BACd,CAEA1D,eAAeiM,IACb,UACQlS,KAAKoG,KAAIH,UACb,MACMqM,EADYhM,EAAQ9H,SAAS+H,eACZ+L,KAoBvB,GAnBAA,EAAKlJ,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,gBAEtE9C,EAAQE,OAEdoH,EAAqB,CACnBkE,KAAMQ,EAAKC,KACXC,OAAQF,EAAKG,OACbV,UAAWO,EAAKI,UAChBV,KAAMM,EAAKK,KACX,mBAAoBL,EAAKM,eACzB,YAAaN,EAAKvO,KAClB,aAAcuO,EAAKO,OAKCrU,SAASyC,eAAe,kBAChCvB,MAAMkQ,QAAU,QAEE,OAA5BhC,EAAmBkE,MACY,UAAjClE,EAAmBmE,WACS,OAA5BnE,EAAmBoE,MACiB,OAApCpE,EAAmB,cACwB,KAA3CA,EAAmB,qBACkB,KAArCA,EAAmB,cAEnB,CACmBpP,SAASyC,eAAe,eAChC6C,UAAY,gDACvB,MAAMmO,EAAkBzT,SAASyC,eAAe,oBAC3CgR,EAAgBlR,UAAU6Q,SAAS,kBACtCK,EAAgBlR,UAAUG,IAAI,gBAGlC,MAC0B1C,SAASyC,eAAe,oBAChCF,UAAUC,OAAO,iBACjCsQ,GACF,GAEJ,CAAE,MAAOxP,GACPC,QAAQD,MAAM,8BAA+BA,EAC/C,CACF,CAoDAmE,eAAesL,IACb,UACQvR,KAAKoG,KAAIH,UAEOzH,SAASyC,eAAe,gBAChC6C,UAAY,2DACTtF,SAASyC,eAAe,gBAChCmR,UAAW,EAEA5T,SAASyC,eAAe,iBAChCmR,UAAW,EACrB,MAAMjJ,EAAa7C,EAAQ9H,SAASgC,KAAK2I,WACzCA,EAAWC,KAAK,eAEV9C,EAAQE,OAGd,IAAK,MAAM4B,KAAae,EAAWG,MAEjC,GAA8B,KAA1BlB,EAAUzI,KAAKG,OAAe,CAChC,MAAMgT,EAAa1K,EAAUb,MAAM,CAAC,MACpCuL,EAAW1J,KAAK,qBAEV9C,EAAQE,OAEd,IAAK,MAAMhH,KAASsT,EAAWxJ,MAAO,CACpC,MAAMgJ,EAAO9S,EAAM8S,KACnBA,EAAKlJ,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,gBAEtE9C,EAAQE,OAIZ8L,EAAKM,iBAAmBhF,EAAmB,qBAC3C0E,EAAKO,QAAUjF,EAAmB,eAClC0E,EAAKC,OAAS3E,EAAyB,MACvC0E,EAAKG,SAAW7E,EAA2B,QAC3C0E,EAAKK,OAAS/E,EAAyB,MACvC0E,EAAKI,YAAc9E,EAA8B,WACjD0E,EAAKvO,OAAS6J,EAAmB,eAGjC0E,EAAKM,eAAiB,UACtBN,EAAKO,MAAQ,UACbP,EAAKC,MAAO,EACZD,EAAKG,QAAS,EACdH,EAAKI,UAAY,OACjBtK,EAAUwB,WAAW,IAAK5J,KAAKC,eAAejB,SAElD,CACF,OAGIsH,EAAQE,OACdoH,EAAqB,CAAC,EACApP,SAASyC,eAAe,kBAChCvB,MAAMkQ,QAAU,OAE9B/B,GAAc,EACdC,GAA0B,EACNtP,SAASyC,eAAe,YAChCF,UAAUC,OAAO,iBAC7BoQ,GAAsB,GAE1B,CAAE,MAAOtP,GACPC,QAAQD,MAAM,iCAAkCA,EAClD,CACF,CAGOmE,eAAemE,EAAe5G,GACnC,IAEE,MAAMpC,QJnjBD6E,eAA4B8M,EAAenI,GAChD,MAAMY,QAAiBC,MAAM,GAAGnM,2BAAiCyT,IAAS,CACxErH,OAAQ,MACRtJ,QAAS,CACP,cAAiB,UAAUwI,OAI/B,IAAKY,EAASI,GACZ,MAAM,IAAI7M,MAAM,+BAIlB,aADwByM,EAASK,MAEnC,CIqiBqBmH,CAAaxP,EAAIgM,GAAI5E,GAGxC,GAAIxJ,EAAK+N,QAAU/N,EAAKiO,KAQtB,OAPA7L,EAAIuI,wBAA0B3K,EAAW,MAAK,GAC9CoC,EAAI2G,gCAAkC,GACtC3G,EAAIuI,wBAAwBpJ,SAAQ,CAACqJ,EAAalN,KAChDkN,EAAYtB,SAAWvK,GAAa6L,EAAYtB,UAChDlH,EAAI2G,gCAAgC8B,QAAQD,EAAY,IAGnDxI,EAAI2G,gCAGXpI,QAAQ8O,KAAK,2BAIjB,CAAE,MAAO/O,GAEP,OADAC,QAAQD,MAAM,6BAA8BA,GACrC,EACT,CACF,CAEOmE,eAAeyG,EAAWlJ,EAAKyP,GACpC,GAAe,KAAXA,GAAkBtF,EA2DpB5L,QAAQD,MAAM,+BA3DqB,CAEnC6L,GAAgB,EAEhB,MAAMuF,EAAc1U,SAASyC,eAAe,oBAC5CiS,EAAYpP,UAAY,mDAExB,MAAMyH,EAAU,CACd4H,aAAc3P,EAAI2G,gCAAgC,GAAGgJ,aACrDC,WAAY1F,EAAS2F,MACrBC,aAAc5F,EAAS4F,aACvBC,YAAa7F,EAAS6F,YACtBC,iBAAkB9F,EAAS+F,eAC3BC,qBAAsBlQ,EAAI2G,gCAAgC,GAAGuJ,qBAC7DC,SAAUnQ,EAAImQ,SACdC,YAAalG,EAASkG,YACtBC,UAAWnG,EAASmG,UACpBrG,UAAWA,EACXhD,OAAQyI,EACRa,WAAY,EACZpJ,SAAU,GACVqJ,SAAUrG,EAASqG,SACnBtJ,SAAU,EACV+E,GAAI,EACJU,YAAa1M,EAAI0M,YAAc1M,EAAI0M,YAAc,IAGnD,IACElG,GAAoB,EACpB,MAAM5I,QJtkBH6E,eAA4BsF,EAAcX,GAC/C,MAAMY,QAAiBC,MAAM,GAAGnM,8BAAqC,CACnEoM,OAAQ,OACRtJ,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUwI,KAE7BpK,KAAMkB,KAAKiK,UAAUJ,KAGvB,IAAKC,EAASI,GACZ,MAAM,IAAI7M,MAAM,gCAIlB,aADwByM,EAASK,MAEnC,CIsjBuBmI,CAAazI,EAASX,GAErCxJ,EAAW,MAAsB,UAAjBA,EAAW,OAC7BoC,EAAIuI,wBAA0BrK,KAAKC,MAAMD,KAAKiK,UAAUvK,EAAW,OACnEoC,EAAI2G,gCAAkC,GAEtC3G,EAAIuI,wBAAwBpJ,SAASqJ,IACnCA,EAAYtB,SAAWvK,GAAa6L,EAAYtB,UAChDlH,EAAI2G,gCAAgC8B,QAAQD,EAAY,IAG1CxN,SAASyC,eAAe,YAChC6C,gBAAkBa,EAAwBnB,GAClDwG,GAAoB,GAItBkJ,EAAYpP,UAAY,+CACxBtF,SAASyC,eAAe,aAAab,MAAQ,GAC7CuN,GAAgB,EAChB3D,GAAoB,CAGtB,CAAE,MAAOlI,GACPoR,EAAYpP,UAAY,+CACxB6J,GAAgB,EAChB3D,GAAoB,EACpBjI,QAAQD,MAAM,2BAA4BA,EAC5C,CACF,CAGF,CA4COmE,eAAeiE,IACpB,OAAOlK,KAAKoG,KAAIH,UACd,IACE,MAAMzF,EAAO8F,EAAQ9H,SAASgC,KAC9B8F,EAAQ8C,KAAK5I,EAAM,cACb8F,EAAQE,OAGd,IAAK,IAAI1H,EAAI,EAAGA,EAAIqO,EAAUtO,OAAQC,IAAK,CACzC,MAAM0E,EAAM2J,EAAUrO,GAEtB0E,EAAIoD,YAAczG,GAAaqD,EAAIoD,aAGnC,MAAMqN,EAAgBzT,EAAK0T,OAAO,IAAI1Q,EAAIgB,eAAgB,CACxD2P,WAAW,EACXC,gBAAgB,IAIlB9N,EAAQ8C,KAAK6K,EAAe,eAEtB3N,EAAQE,OAGdzE,QAAQ4H,IAAI,SAASsK,EAAc3K,MAAMzK,wBAAwB2E,EAAIgB,gBACrE,MAAM6P,EAA0D,GAGhEJ,EAAc3K,MAAM3G,SAASG,IAE3B,GAAwB,KAApBU,EAAIoD,cAAuBpD,EAAIqG,UACjC,GAAiC,UAA7BrG,EAAIuG,qBAAkC,CACxC,MAAMvK,EAAQsD,EAAK0G,WACnB6K,EAAqBzS,KAAK,CAAEpC,QAAOgE,QACnChE,EAAM8U,QACR,MACExR,EAAK8G,WAAWpG,EAAIoD,YAAa5G,KAAKC,eAAejB,QAEzD,IAGF,IAAK,MAAM,MAAEQ,EAAK,IAAEgE,KAAS6Q,EAAsB,CACjD,MACM5N,GADS,IAAIC,WACAC,gBAAgBnD,EAAIoD,YAAa,aAE9CC,EAAY3E,MAAM4E,KAAKL,EAAIjG,KAAKuG,YAEtC,IAAK,MAAMI,KAAQN,EACjB,GAAIM,EAAKC,WAAaC,KAAKC,UAAW,CACpC,MAAMzB,EAAcsB,EAAKtB,aAAa/F,OAClC+F,GACFA,EAAY0B,MAAM,MAAM5E,SAAQlD,IAC1BA,EAAKK,QACPP,GAA2BC,EAAOC,EACpC,GAGN,MAAO,GAAI0H,EAAKC,WAAaC,KAAKG,aAAc,CAC9C,MAAMC,EAAUN,EAEhB,GAAsC,UAAlCM,EAAQC,QAAQjD,cAA2B,CAC7C,MAAMnC,EAAOJ,MAAM4E,KAAKW,EAAQE,iBAAiB,OAEjD,GAAoB,IAAhBrF,EAAKzD,OAAc,CACrBW,EAAMO,gBAAgB,gBAAiBC,KAAKC,eAAeC,QAC3D,QACF,CAEA,MAAM0H,EAAUC,KAAKC,OAAOxF,EAAKO,KAAIS,GAC5BpB,MAAM4E,KAAKxD,EAAIqE,iBAAiB,WAAWI,QAAO,CAACC,EAAKC,IACtDD,EAAOE,SAASD,EAAKE,aAAa,YAAc,IAAK,KAC3D,MAGCC,EAAY5I,EAAMO,gBAAgB,GAAIC,KAAKC,eAAeC,cAC1DoG,EAAQE,OAEd,MAAMpD,EAAQgF,EAAUC,YAAY/F,EAAKzD,OAAQ+I,EAAS5H,KAAKC,eAAeqI,OAC9ElF,EAAM1D,MAAQ,gCAER4G,EAAQE,OAEd,MAAM+B,EAA2B,IAAIrG,MAAM0F,GAASY,KAAK,GAEzDlG,EAAKK,SAAQ,CAACW,EAAKmF,KACjB,MAAMC,EAAQxG,MAAM4E,KAAKxD,EAAIqE,iBAAiB,WAC9C,IAAIgB,EAAY,EAEhBD,EAAM/F,SAASsF,IACb,KAAOM,EAAeI,GAAa,GACjCJ,EAAeI,KACfA,IAGF,MAAMC,EAAW1G,MAAM4E,KAAKmB,EAAKlB,YAC9BlE,KAAIsE,GACCA,EAAKC,WAAaC,KAAKC,UAClBH,EAAKtB,aAAa/F,QAAU,GAC1BqH,EAAKC,WAAaC,KAAKG,aACxBL,EAAqB0B,UAAU/I,OAElC,KAERsF,QAAOzF,GAAQA,EAAKd,OAAS,IAC7BqE,KAAK,KAEF4F,EAAUZ,SAASD,EAAKE,aAAa,YAAc,IAAK,IACxDY,EAAUb,SAASD,EAAKE,aAAa,YAAc,IAAK,IAO9D/E,EAAM4F,QAAQP,EAAUE,GAAWvI,MAAQwI,EAE3C,IAAK,IAAI9J,EAAI,EAAGA,EAAIgK,EAAShK,IACvB6J,EAAY7J,EAAI8I,IAClBxE,EAAM4F,QAAQP,EAAUE,EAAY7J,GAAGsB,MAAQ,IAInD,GAAI2I,EAAU,EACZ,IAAK,IAAIjK,EAAI,EAAGA,EAAIgK,EAAShK,IACvB6J,EAAY7J,EAAI8I,IAClBW,EAAeI,EAAY7J,GAAKiK,EAAU,GAKhDJ,GAAaG,CAAO,GACpB,GAEN,KAAO,CACL,MAAMG,EAAcxB,EAAQoB,UAAU/I,OAClCmJ,GACFA,EAAY1B,MAAM,MAAM5E,SAAQlD,IAC1BA,EAAKK,QACPP,GAA2BC,EAAOC,EACpC,GAGN,CACF,CAEJ,OAGM6G,EAAQE,MAChB,OAGMF,EAAQE,MAChB,CAAE,MAAO+F,GACPxK,QAAQD,MAAM,gCAAiCyK,EACjD,IAEJ,CAwFA,SAAS2E,IACP1S,SAASyC,eAAe,YAAY6C,UAAY,8KAKhDtF,SAASyC,eAAe,iBAAiBkD,iBAAiB,QAASoQ,EAGrE,CAIOtO,eAAesO,IACpB/V,SAASyC,eAAe,YAAY6C,UAAY,mIAOhD,UAEQ9D,KAAKoG,KAAIH,UAGb,MAAMzF,EAAO8F,EAAQ9H,SAASgC,KAC9BA,EAAK4I,KAAK,cACJ9C,EAAQE,OAEd,MAAMgO,EAAW,CACf,QAAWhU,EAAKb,KAAKX,QAAQ,UAAW,MAE1C,IAEE,MAAMoC,QJt4BL6E,eAAqC8H,EAAkByG,EAAe5J,GAC3E,MAAMY,QAAiBC,MAAM,GAAGnM,qCAA2CyO,IAAY,CACrFrC,OAAQ,OACRtJ,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUwI,KAE7BpK,KAAMkB,KAAKiK,UAAU6I,KAGvB,IAAKhJ,EAASI,GACZ,MAAM,IAAI7M,MAAM,gCAIlB,aADwByM,EAASK,MAEnC,CIs3ByB4I,CAAsB/G,GAAU2C,SAAUmE,EAAU5J,GAEvE6C,EAAWrM,EAAKiO,KAEZjO,EAAKiO,KAAKxQ,OAAS,GACrByO,EAAelM,EAAKiO,KAAK,GAAGqF,iBAC5BxD,KAEA1S,SAASyC,eAAe,YAAY6C,UAAY,yEAIpD,CAAE,MAAOhC,GACPC,QAAQD,MAAM,gCAAiCA,EACjD,CAEA2L,EAASkH,MAAK,CAACzX,EAAGgC,IAAMA,EAAE0V,aAAa/V,OAAS3B,EAAE0X,aAAa/V,SAE/D,MAAMgW,EAAiB,IAAIxS,IAGrByS,EAAgBrH,EAASrI,QAAO2P,IACpC,IAAK,MAAMC,KAAcH,EACvB,GAA0B,iBAAfG,GAA2BA,EAAW3P,SAAS0P,EAAKH,aAAanQ,eAE1E,OADA1C,QAAQ4H,IAAI,aAAaoL,EAAKH,uCAAuCI,OAC9D,EAIX,OADAH,EAAe3T,IAAI6T,EAAKH,aAAanQ,gBAC9B,CAAI,IAGbsI,EAAuB+H,QACjB7D,KAEN,MAAMgE,EAAc,IAAIC,IAElBC,EAAiBpI,EAAqBlK,KAAIkS,IAC9C,MAAMd,EAAgBzT,EAAK0T,OAAOa,EAAKH,aAAc,CAAET,WAAW,EAAOC,gBAAgB,IAEzF,OADAH,EAAc7K,KAAK,SACZ6K,CAAa,UAGhB3N,EAAQE,OAEd,IAAK,MAAMyN,KAAiBkB,EAE1B,IAAK,MAAM3V,KAASyU,EAAc3K,MAAO,CAEvC,IAAK9J,IAAUA,EAAMG,KAAM,CACzBoC,QAAQ4H,IAAI,8BACZ,QACF,CAGA,MAAM2I,EAAO9S,EAAM8S,KAOnB,GANAA,EAAKlJ,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,UAC5E5J,EAAM4J,KAAK,yBACL9C,EAAQE,OAEUhH,EAAM4V,gBAAgB9L,MAAMzK,OAAS,EAG3DkD,QAAQ4H,IAAI,aAAanK,EAAMG,wDAIjC,GAAIsV,EAAYI,IAAI7V,EAAMG,MACxBoC,QAAQ4H,IAAI,qCAAqCnK,EAAMG,aADzD,CAOA,GAFAsV,EAAYK,IAAI9V,EAAMG,MAAM,GAExBH,EAAM4V,iBAAmB5V,EAAM4V,gBAAgB9L,MAAMzK,OAAS,EAAG,CACnEkD,QAAQ4H,IAAI,4CAA4CnK,EAAMG,SAC9D,IAAK,MAAM4V,KAAW/V,EAAM4V,gBAAgB9L,MAC1CiM,EAAQjB,QAAO,SAEXhO,EAAQE,MAChB,CAEA,IAEE,MAAMgP,EAAiBhW,EAAMiW,uBAC7BD,EAAeE,MAAQ,GAAGlW,EAAMG,OACJ,OAAxB2S,EAAKM,iBACP4C,EAAehS,IAAM,GAAG8O,EAAKM,kBAE/B4C,EAAelD,KAAKM,eAAiB,SACrC4C,EAAeG,WAAa3V,KAAK4V,yBAAyBC,kBACpDvP,EAAQE,MAChB,CAAE,MAAO1E,GACPC,QAAQD,MAAM,6CAA6CtC,EAAMG,SAAUmC,EAC7E,CAxBA,CAyBF,CAGFyL,GAAmB,EACnB/O,SAASyC,eAAe,YAAY6C,UAAY,6UAUzBtF,SAASyC,eAAe,UAChCvB,MAAMkQ,QAAU,aACzBtJ,EAAQE,OACdhI,SAASyC,eAAe,iBAAiBkD,iBAAiB,QAAS8M,IACnE6E,OAAOxP,QAAQ9H,SAASuX,gBACtBD,OAAOE,UAAUC,yBACjBC,GACD,IAMHnU,QAAQ4H,IAAI,gCACd,CAAE,MAAO7H,GACPC,QAAQD,MAAM,2BAA4BA,GAE1CC,QAAQ4H,IAAI,6CACd,CACF,CAGA1D,eAAeiQ,WAIRjQ,iBACL,UACQjG,KAAKoG,KAAIH,UACb,MAAMI,EAAYC,EAAQ9H,SAAS+H,eAQnC,GANAF,EAAU+C,KAAK,mCAET9C,EAAQE,OAIVH,EAAU1G,KAAM,CAClB,MAAMwW,EAAS3X,SAASyC,eAAe,UACnCkV,IACFA,EAAOzW,MAAMkQ,QAAU,SAEzB,MAAMuF,EAAiB1H,EAAS5K,KAAIkS,IAClC,MAAMd,EAAgB5N,EAAU6N,OAAOa,EAAKH,aAAc,CAAET,WAAW,EAAOC,gBAAgB,IAE9F,OADAH,EAAc7K,KAAK,SACZ6K,CAAa,UAGhB3N,EAAQE,OACd,MAAM4P,EAAgB,GACtB,IAAK,MAAMnC,KAAiBkB,EAE1B,IAAK,MAAM3V,KAASyU,EAAc3K,MAAO,CACvC,MAAMgJ,EAAO9S,EAAM8S,KACnBA,EAAKlJ,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,gBAEtE9C,EAAQE,OAEZ8L,EAAKM,iBAAmBhF,EAAmB,qBAC3C0E,EAAKO,QAAUjF,EAAmB,eAClC0E,EAAKC,OAAS3E,EAAyB,MACvC0E,EAAKG,SAAW7E,EAA2B,QAC3C0E,EAAKK,OAAS/E,EAAyB,MACvC0E,EAAKI,YAAc9E,EAA8B,WACjD0E,EAAKvO,OAAS6J,EAAmB,cAEjCwI,EAAcxU,KAAKpC,EAAMG,KAG7B,EA+BV,SAAgC0W,GAE9B,MAAMC,EAAiB9X,SAASyC,eAAe,oBAE/C,GAAIqV,EAAgB,CAClBA,EAAexS,UAAY,GAC3B,MAAMqS,EAAS3X,SAASyC,eAAe,UACvCkV,EAAOzW,MAAMkQ,QAAU,QAEvB,MAAM2G,EAAqD,CAAC,EAE5DF,EAAM1T,SAAQuD,IACZuH,EAAS9K,SAAQoS,IACXA,EAAKH,aAAanQ,gBAAkByB,EAAKzB,gBACtC8R,EAAaxB,EAAKH,gBACrB2B,EAAaxB,EAAKH,cAAgB,IAE/B2B,EAAaxB,EAAKH,cAAcvP,SAAS0P,EAAKyB,UACjDD,EAAaxB,EAAKH,cAAchT,KAAKmT,EAAKyB,SAE9C,GACA,IAIJlZ,OAAOoF,KAAK6T,GAAc5T,SAAQ8T,IAEhC,MAAMC,EAAUlY,SAAS+B,cAAc,OACvCmW,EAAQzS,UAAY,MAGpB,MAAM0S,EAAUnY,SAAS+B,cAAc,MACvCoW,EAAQ9Q,YAAc,GAAG4Q,MAAiBnJ,KAC1CoJ,EAAQjW,YAAYkW,GAGpBJ,EAAaE,GAAc9T,SAAQiU,IACjC,MAAMC,EAASrY,SAAS+B,cAAc,OACtCsW,EAAO5S,UAAY,UACnB4S,EAAOhR,YAAc+Q,EAGrBC,EAAO1S,iBAAiB,SAAS8B,gBAgBzCA,eAAmCwQ,EAAsBG,GACvD,MAAMN,EAAiB9X,SAASyC,eAAe,UAC/CqV,EAAe5W,MAAMkQ,QAAU,QAE/B,UACQ5P,KAAKoG,KAAIH,UAEb,MAAMI,EAAYC,EAAQ9H,SAAS+H,eAInC,GAHAF,EAAU+C,KAAK,cACT9C,EAAQE,OAEVH,EAAU1G,KAAK8E,cAAcY,SAASoR,EAAahS,eAAgB,CAErE,MAAMwP,EAAgB5N,EAAU6N,OAAOuC,EAAc,CAAEtC,WAAW,EAAOC,gBAAgB,IACzFH,EAAc7K,KAAK,eAEb9C,EAAQE,OAGd,IAAK,MAAM1D,KAAQmR,EAAc3K,MAE/BxG,EAAKwP,KAAKlJ,KAAK,CAAC,OAAQ,SAAU,YAAa,QAAS,iBAAkB,OAAQ,eAC5E9C,EAAQE,OAGd1D,EAAK8G,WAAWgN,EAAS,WAGzB9T,EAAKwP,KAAKC,KAAOzP,EAAKwP,KAAKC,KAC3BzP,EAAKwP,KAAKG,OAAS3P,EAAKwP,KAAKG,OAC7B3P,EAAKwP,KAAKI,UAAY5P,EAAKwP,KAAKI,UAChC5P,EAAKwP,KAAKO,MAAQ/P,EAAKwP,KAAKO,MAC5B/P,EAAKwP,KAAKM,eAAiB,UAC3B9P,EAAKwP,KAAKK,KAAO7P,EAAKwP,KAAKK,KAC3B7P,EAAKwP,KAAKvO,KAAOjB,EAAKwP,KAAKvO,WAGvBuC,EAAQE,OACd8P,EAAe5W,MAAMkQ,QAAU,OAC/B7N,QAAQ4H,IAAI,aAAa8M,YAAuBG,4CAClD,MACEN,EAAe5W,MAAMkQ,QAAU,OAC/B7N,QAAQ4H,IAAI,mCAAmC8M,MACjD,GAEJ,CAAE,MAAO3U,GACPwU,EAAe5W,MAAMkQ,QAAU,OAC/B7N,QAAQD,MAAM,wBAAyBA,EACzC,CACF,CAhEgBgV,CAAoBL,EAAcG,GAGxCF,EAAQ1V,QAAQ,IAGlB0V,EAAQjW,YAAYoW,EAAO,IAG7BP,EAAe7V,YAAYiW,EAAQ,IAErCP,EAAOzW,MAAMkQ,QAAU,MAEzB,CACF,CAlFQmH,CAAuBX,SAEjB9P,EAAQE,MAYhB,MACEzE,QAAQ4H,IAAI,uBACd,GAEJ,CAAE,MAAO7H,GACPC,QAAQD,MAAM,6BAA8BA,EAC9C,CACF,CAzEQkV,EACR,CA0LO/Q,eAAegL,KACpB,UACQjR,KAAKoG,KAAIH,UACbzH,SAASyC,eAAe,YAAY6C,UAAY,iIAIhD,MAGMsR,EAHO9O,EAAQ9H,SAASgC,KAGD4U,gBAI7B,GAHAA,EAAgBhM,KAAK,eACf9C,EAAQE,OAEuB,IAAjC4O,EAAgB9L,MAAMzK,OAA1B,CAKA,IAAK,MAAM0W,KAAWH,EAAgB9L,MACpC,GAAIiM,EAAQG,OAAS3I,EAAqBT,MAAKyI,GAAQA,EAAKH,aAAanQ,gBAAkB8Q,EAAQG,MAAMjR,gBAAgB,CACvH,MAAMjF,EAAQ+V,EAAQ/L,WACtBhK,EAAM4J,KAAK,cACL9C,EAAQE,OACV+O,EAAQ/R,KAAO,oBAAoBlH,KAAKiZ,EAAQ/R,KAClDhE,EAAM8S,KAAKM,eAAiB2C,EAAQ/R,IAEpChE,EAAM8S,KAAKM,eAAiB,WAExBtM,EAAQE,OACd+O,EAAQjB,QAAO,EACjB,CAGF9V,SAASyC,eAAe,YAAY6C,UAAY,kLAM1CwC,EAAQE,OACd+G,GAAmB,EACnB/O,SAASyC,eAAe,iBAAiBkD,iBAAiB,QAASoQ,EAzBnE,MAFExS,QAAQ4H,IAAI,6BA2BmE,GAErF,CAAE,MAAO7H,GACPC,QAAQD,MAAM,mCAAoCA,EACpD,CACF,CAaOmE,eAAegE,KACpB,IAAK0D,EAAe,CACdJ,SACI0D,KAGR,IAAIgG,EAAiBhJ,EAAW7I,QAAQtC,GAASA,EAAK0M,KAAOzB,IAEzDmJ,EAAiBjJ,EAAWpL,KAAIsU,IAClC,MAAMC,EAAmBH,EAAe3K,MAAK+K,GAAYA,EAAS7H,KAAO2H,EAAO3H,KAChF,MAAO,8KAGwD2H,EAAO3H,kBAAkB2H,EAAO3H,OAAO4H,EAAmB,mBAAqB,6EAC7ED,EAAO3H,OAAO2H,EAAO3G,uDAGrF,IACAtN,KAAK,IAER1E,SAASyC,eAAe,YAAY6C,UAAY+I,EAEhDrO,SAASyC,eAAe,gBAAgB6C,UD95C5C,SAAoBoT,GA8ElB,MA7Ea,kgGA8DCA,wZAgBhB,CC+0CwDI,CAAWJ,GF7kC5DjR,eAAoCsR,EAAWlK,GAGlD,IAAImK,EAAU,GACVC,EAAe,GAGfC,EAAa,GAIjBH,EAAUzT,UAAY,u1BAuBtB,MAAM6T,EAAiBJ,EAAUzW,cAAc,0BACzC8W,EAAWL,EAAUzW,cAAc,aACnC+W,EAAWN,EAAUzW,cAAc,aACnCgX,EAAaP,EAAUzW,cAAc,YACrCiX,EAAkBR,EAAUzW,cAAc,oBAC1CkX,EAAmBT,EAAUzW,cAAc,qBAC3CmX,EAAgBV,EAAUzW,cAAc,kBAoE9C,SAASoX,IACL,MAAMC,EAAwC,CAAC,EAE/CT,EAAW/U,SAASyV,IAChB,MAAMC,EAAKD,EAAME,MACXC,EAAU,IAAIF,KAEpB,IAAIjY,EAAQ,GACZ,MAAMqH,EAAUjJ,SAASyC,eAAeoX,GAEpC5Q,IACArH,EAASqH,aAAmB+Q,kBAAoB/Q,aAAmBgR,kBAC7DhR,EAAQrH,MACR,IAGV+X,EAAWI,GAAWnY,GAAgBmY,CAAO,IAGjD,IAAIG,EAAcjB,EAClB,IAAK,MAAOc,EAASnY,KAAU9C,OAAOyF,QAAQoV,GAC1CO,EAAcA,EAAY1Z,QAAQ,IAAI2Z,OAAOJ,EAAS,KAAMnY,GAGhEoX,EAAUkB,EACVZ,EAAWjS,YAAc2R,EACzBQ,EAAiBtY,MAAMkQ,QAAU4H,EAAU,QAAU,OACrDI,EAASxF,SAAuB,KAAZoF,CACxB,CA7FAnK,EAAkB1K,SAASG,IACvB,MAAM8V,EAASpa,SAAS+B,cAAc,UACtCqY,EAAOxY,MAAQ0C,EAAK0M,GAAGqJ,WACvBD,EAAO/S,YAAc/C,EAAK0N,KAC1BmH,EAAelX,YAAYmY,EAAO,IAGtCjB,EAAexT,iBAAiB,UAAU8B,UACtC,MAAM6S,EAAanB,EAAevX,MAC5BwK,EAAM0D,eAAeC,QAAQ,UAAY,GAEzCnN,QFxML6E,eAAqCoS,EAAWzN,GACrD,MAAMY,QAAiBC,MAAM,GAAGnM,yBAA+B+Y,SAAW,CACxE3M,OAAQ,MACRtJ,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUwI,OAI/B,IAAKY,EAASI,GACZ,MAAM,IAAI7M,MAAM,gCAIlB,aADwByM,EAASK,MAEnC,CEyLyBkN,CAAsBD,EAAYlO,GACjDxJ,EAAK+N,QAAU/N,EAAKiO,OACpBqI,EAAatW,EAAKiO,KAClBmI,EAAUnK,EAAkBhJ,MAAMvB,GAASA,EAAK0M,GAAGqJ,aAAeC,IAAYE,SAE9EvB,EAAepK,EAAkBhJ,MAAMvB,GAASA,EAAK0M,GAAGqJ,aAAeC,IAAYE,UAElFF,GAKLb,EAAclX,UAAUG,IAAI,UAO5B6W,EAAgBjU,UAAY,GAE5B4T,EAAW/U,SAASyV,IAChB,MAAMa,EAAMza,SAAS+B,cAAc,OACnC0Y,EAAIhV,UAAY,kBAEhB,MAAM2B,EAAQpH,SAAS+B,cAAc,SAIrC,GAHAqF,EAAMC,YAAcuS,EAAME,MAC1BW,EAAIxY,YAAYmF,GAEG,IAAfwS,EAAMc,KAAY,CAClB,MAAMC,EAAQ3a,SAAS+B,cAAc,SACrC4Y,EAAMhT,KAAO,OACbgT,EAAMlV,UAAY,eAClBkV,EAAMd,GAAKD,EAAME,MACjBa,EAAMhV,iBAAiB,QAAS+T,GAChCe,EAAIxY,YAAY0Y,EACpB,MAAO,GAAmB,IAAff,EAAMc,KAAY,CACzB,MAAMxY,EAASlC,SAAS+B,cAAc,UACtCG,EAAOuD,UAAY,eACnBvD,EAAO2X,GAAKD,EAAME,MAClBF,EAAMgB,yBAAyBzW,SAAS0W,IACpC,MAAMT,EAASpa,SAAS+B,cAAc,UACtCqY,EAAOxY,MAAQiZ,EAAIC,KACnBV,EAAO/S,YAAcwT,EAAIE,OACzB7Y,EAAOD,YAAYmY,EAAO,IAE9BlY,EAAOyD,iBAAiB,SAAU+T,GAClCe,EAAIxY,YAAYC,EACpB,CAEAqX,EAAgBtX,YAAYwY,EAAI,IAmCpCf,KA7EID,EAAclX,UAAUC,OAAO,SAOpB,IAuGnB6W,EAAS1T,iBAAiB,SA9B1B,WAEIuT,EAAW/U,SAASyV,IAChB,MAAM3Q,EAAUjJ,SAASyC,eAAemX,EAAME,OAC1C7Q,IACIA,aAAmB+Q,iBACnB/Q,EAAQrH,MAAQ,GACTqH,aAAmBgR,oBAC1BhR,EAAQ+R,cAAgB,GAEhC,IAIJ1B,EAAWjS,YAAc4R,EACzBD,EAAUC,CACd,IAeAG,EAASzT,iBAAiB,SAZ1B,WACI,IAAKqT,EAAS,OAEd,MAAMiC,EAAiBjb,SAASyC,eAAe,UAC3CwY,IACAA,EAAerZ,MAAQoX,EACvB3W,IAGR,GAIJ,CEi6BI6Y,CAD8Blb,SAASyC,eAAe,uBACVoM,GAG5C7O,SAASyC,eAAe,WAAWkD,iBAAiB,SAAS,KAC3DtD,GAAgB,IAIlBrC,SAASyC,eAAe,cAAckD,iBAAiB,SAAS,KHt1ClE3F,SAASsC,cAAc,qBAAqBC,UAAUC,OAAO,UAC7DxC,SAASsC,cAAc,0BAA0BC,UAAUC,OAAO,OAAQ,UAG1ExC,SAASyC,eAAe,cAAcF,UAAUG,IAAI,UACpD1C,SAASyC,eAAe,uBAAuBF,UAAUG,IAAI,OAAQ,SGk1C1C,IAIzB0L,GAAkB,SAAU,mBAAoB,OAEhD,MAAM+M,EAAOnb,SAASyC,eAAe,cAC/B2Y,EAAcpb,SAASyC,eAAe,UAEtC4Y,EAAYrb,SAASyC,eAAe,QACpC6Y,EAAmBtb,SAASyC,eAAe,eAC3C8Y,EAAuBvb,SAASyC,eAAe,gBAC/C+Y,EAA0Bxb,SAASyC,eAAe,qBAClDgZ,EAAwBzb,SAASyC,eAAe,mBAChDiZ,EAAuB1b,SAASmJ,iBAAiB,oCASvD,GAPAnJ,SAASyC,eAAe,qBAAqBkD,iBAAiB,SAAS,KAChE6F,GACHlF,EAAalB,EACf,IAIE+V,GAAQE,GAAaD,GAAeM,EAAqBrb,OAAS,EAAG,CACvE,MAAMsb,EAAsBA,KAC1B,GAAIH,EAAwB9O,QAC1B+O,EAAsBpU,YAAcoI,EAAWpL,KAAIsU,GAAUA,EAAO3G,OAAMtN,KAAK,UAC1E,CACL,MAAMkX,EAAkBlY,MAAM4E,KAAKoT,GAChC9U,QAAOiV,GAAMA,EAAGnP,SAAqB,cAAVmP,EAAGhC,KAC9BxV,KAAIwX,GAAMA,EAAGC,cAAczU,YAAY/F,SAC1Cma,EAAsBpU,YAAcuU,EAAgBvb,OAASub,EAAgBlX,KAAK,MAAQ,iBAC5F,GAGFyW,EAAKxV,iBAAiB,UAAU8B,eAAgBnI,GAC9CA,EAAE4Q,iBAGFiL,EAAKhS,iBAAiB,eAAehF,SAAQwW,GAASA,EAAMpY,UAAUC,OAAO,gBAE7E,IAAIuZ,GAAQ,EAYZ,GAVMV,EAA+BzZ,MAAMN,SACzC+Z,EAAU9Y,UAAUG,IAAI,cACxBqZ,GAAQ,GAGJX,EAAiCxZ,MAAMN,SAC3C8Z,EAAY7Y,UAAUG,IAAI,cAC1BqZ,GAAQ,GAGNA,EAAO,CAET,MAAMC,EAAmBtY,MAAM4E,KAAKoT,GACjC9U,QAAOiV,GAAMA,EAAGnP,SAAqB,cAAVmP,EAAGhC,KAC9BxV,KAAIwX,GACYpM,EAAW5J,MAAK8S,GAAUA,EAAO3H,IAAM6K,EAAGja,UAIvDqa,EAAoBT,EAAwB9O,QAC5CwP,EAAiBX,EAAqB7O,QACtCyP,EAAUjN,EAAS6C,MAAMlM,MAAKoD,GAAmC,YAAxBA,EAAQjD,cACjDoW,EAAW,CACfpW,YAAaqV,EAAUzZ,MAAMN,OAC7B0K,OAAQoP,EAAYxZ,MAAMN,OAC1B+a,YAAaf,EAAiB1Z,MAAMN,OACpCgb,eAAgBN,EAChBO,UAAWN,EAAoB,EAAI,EACnCO,aAAcN,EACdO,YAAa,IACbC,uBAAwB,IACxBC,yBAA0B,IAC1B5W,OAAQ,EACR6W,eAAgB1N,EAAS0N,eACzBjI,aAAczF,EAAS8B,GACvB6L,aAAc,GACdC,kBAAmBX,EAAQnL,GAC3B+L,mBAAoB,UA+GhCtV,eAAgCsF,GAC9B,IACE,MAAM2H,EAAc1U,SAASyC,eAAe,iBACtCua,EAAiBhd,SAASyC,eAAe,qBAG9Cua,EAAqCpJ,UAAW,EACjDc,EAAYpP,UAAY,4DACvBoP,EAAkCd,UAAW,EAC9CpI,GAAoB,EAEpB,MAAM5I,QJz9CD6E,eAA2BsF,EAAcX,GAC9C,MAAMY,QAAiBC,MAAM,GAAGnM,6BAAoC,CAClEoM,OAAQ,OACRtJ,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUwI,KAE7BpK,KAAMkB,KAAKiK,UAAUJ,KAGvB,IAAKC,EAASI,GACZ,MAAM,IAAI7M,MAAM,gCAIlB,aADwByM,EAASK,MAEnC,CIy8CqB4P,CAAYlQ,EAASX,GACxCZ,GAAoB,EAEhB5I,EAAW,MAAKA,EAAa,OAC/ByO,KAEC2L,EAAqCpJ,UAAW,EAChDc,EAAkCd,UAAW,EAC9Cc,EAAYpP,UAAY,8CAiV9B,SAAyB4L,GACvB,MAAMC,EAAWnR,SAASyC,eAAe,mBACzC0O,EAASjQ,MAAMkQ,QAAU,QACzBD,EAAS9J,YAAc6J,CACzB,CApVMgM,CAAgBta,EAAW,MAG/B,CAAE,MAAOU,GACPC,QAAQD,MAAM,sCAAuCA,EACvD,CACF,CAtIgB6Z,CAAiBf,EACzB,CACF,IAGA,MAAMgB,EAA0BA,KAC9B1B,EAAqBvX,SAAQmI,IACtBA,EAASsH,WACZtH,EAASI,SAAU,EACnBJ,EAASsH,UAAW,EACtB,IAEF+H,GAAqB,EAIjB0B,EAAiBA,KACrB3B,EAAqBvX,SAAQmI,IACFmM,EAAe3K,MAAK+K,GAAYA,EAAS7H,KAAOtH,SAAS4C,EAAS1K,WAEzF0K,EAASsH,UAAW,EACtB,IAEF+H,GAAqB,EAQvBJ,EAAqB5V,iBAAiB,UAAU,WACzC6F,IACCpM,KAAKsN,SACP8O,EAAwB5H,UAAW,EACnC6H,EAAsB7H,UAAW,IAEjCyJ,IACA7B,EAAwB9O,SAAU,EAClC8O,EAAwB5H,UAAW,EACnC6H,EAAsB7H,UAAW,EACjC8H,EAAqBvX,SAAQmI,IACtBA,EAASsH,WACZtH,EAASI,SAAU,EACnBJ,EAASsH,UAAW,EACtB,IAEF+H,KAGN,IAGAH,EAAwB7V,iBAAiB,UAAU,WAC5C6F,IAECpM,KAAKsN,QACP0Q,IAEAC,IAGN,IAGArd,SAASmJ,iBAAiB,kBAAkBhF,SAAQG,IAClDA,EAAKqB,iBAAiB,SAAS,SAAU6G,GACvC,CACEA,EAAM8Q,kBACN,MAAMhR,EAAWlN,KAAKkD,cAAc,qBACpC,GAAIgK,EAAU,CAGZ,GAAoB,cAAhBA,EAASuN,GAAoB,CAC/B,MAAMtN,EAAYD,EAASI,QAC3BgP,EAAqBvX,SAAQ0X,IACtBA,EAAGjI,WAAUiI,EAAGnP,QAAUH,EAAS,GAE5C,CACAoP,GACF,CACF,CACF,GAAE,IAIJA,IAIA,CAACN,EAAWD,GAAajX,SAAQyV,IAC/BA,EAAMjU,iBAAiB,SAAS,WAC1BvG,KAAKmD,UAAU6Q,SAAS,eAAiBhU,KAAKwC,MAAMN,QACtDlC,KAAKmD,UAAUC,OAAO,cAEpB6Y,IACerb,SAASyC,eAAe,mBAChCvB,MAAMkQ,QAAU,OAE7B,GAAE,GAEN,MACE7N,QAAQD,MAAM,qDAElB,CACF,CAgCO,SAAS8K,GAAkBmP,EAAYC,EAAYlM,GAQxD,IAAImM,GAAoB,EAExB,MAAMrC,EAAcpb,SAASyC,eAAe,GAAG8a,KACzCG,EAAkB1d,SAASyC,eAAe,GAAG+a,KACnD,GAAIpC,EAAa,CAgFf,SAASuC,EAAsB9D,GAC7B,MAAM/O,EAAQ9K,SAASmJ,iBAAiB,IAAI0Q,oBAEtC+D,GADW5d,SAASyC,eAAe,GAAGoX,KACzB/O,EAAMzK,QAMzB,GAHAyK,EAAM3G,SAAQG,GAAQA,EAAK/B,UAAUC,OAAO,YAGxCib,GAAoB,GAAKA,EAAmBG,EAAY,CAC1D,MAAMC,EAAkB/S,EAAM2S,GAC9BI,EAAgBtb,UAAUG,IAAI,UAG9Bmb,EAAgBC,eAAe,CAC7BC,SAAU,SACVC,MAAO,WAEX,CACF,CAhGA5C,EAAYzV,iBAAiB,SAAUrG,IACrC,MAAM2e,EAAiB7C,EAAY8C,eAC7BC,EAAmB/C,EAAYxZ,MAAMwc,MAAM,EAAGH,GAC9CI,EAAcF,EAAiBG,YAAY,KACjD,IAAqB,IAAjBD,EAAoB,CACtB,MAAME,EAAQJ,EAAiBC,MAAMC,EAAc,GAAG/c,OACtD,GAAIid,EAAMle,OAAS,EAAG,CACpB,MAAM6G,EArBUqX,IAELnZ,EAAcwB,QAAOtC,GAAwB,IAAhBA,EAAKyB,SAAca,QAAOtC,GACtEA,EAAK0B,YAAYC,cAAcY,SAAS0X,EAAMtY,iBAkBzBuY,CAAeD,GAEhC,GAAIrX,EAAS7G,OAAS,EAAG,CACvBqd,EAAgBpY,UAAY4B,EAAS7C,KAAIC,IACvC,IAAIma,EAAc,GAOlB,OALEA,EADa,QAAXnN,EACY,IAAIhN,EAAK0B,eAET1B,EAAK8D,aAAe,IAAI9D,EAAK0B,eAGtC,gDAAgDyY,MAAgBna,EAAK0B,kBAAkB,IAC7FtB,KAAK,IAGR,MAAMga,EAAetD,EAAYuD,wBACjCjB,EAAgBxc,MAAM0d,KAAO,GAAGF,EAAaE,SAC7ClB,EAAgBxc,MAAM2d,OAAS,OAC/BnB,EAAgBxc,MAAMkQ,QAAU,OAClC,MACEsM,EAAgBxc,MAAMkQ,QAAU,MAEpC,MACEsM,EAAgBxc,MAAMkQ,QAAU,MAEpC,MACEsM,EAAgBxc,MAAMkQ,QAAU,MAClC,IAKFgK,EAAYzV,iBAAiB,WAAYrG,IACvC,MAAMwL,EAAQ9K,SAASmJ,iBAAiB,IAAIqU,oBACtCI,EAAa9S,EAAMzK,OAEzB,GAAc,cAAVf,EAAEV,IAEJU,EAAE4Q,iBAGEuN,EAAmBG,EAAa,EAClCH,IAEAA,EAAmB,EAErBE,EAAsB,GAAGH,UACpB,GAAc,YAAVle,EAAEV,IAEXU,EAAE4Q,iBAGEuN,EAAmB,EACrBA,IAEAA,EAAmBG,EAAa,EAElCD,EAAsB,GAAGH,UACpB,GAAc,UAAVle,EAAEV,MAAyC,IAAtB6e,EAAyB,CAEvD,MAAMqB,EAAehU,EAAM2S,GACvBqB,IACFC,EAAcD,EAAanV,aAAa,sBACxC+T,EAAgBxc,MAAMkQ,QAAU,OAChC9R,EAAE4Q,iBAEN,KA4BFwN,EAAgB/X,iBAAiB,SAAUrG,IACzC,GAAIA,EAAEmN,QAAUnN,EAAEmN,OAAOuS,QAAQ,MAAO,CACtC,MAAMP,EAAcnf,EAAEmN,OAAO9C,aAAa,qBAC1CoV,EAAcN,GACdf,EAAgBxc,MAAMkQ,QAAU,MAClC,KAIF,MAAM2N,EAAiBN,IACrB,MAAMQ,EAAWjf,SAASyC,eAAe,GAAG8a,KACtC2B,EAAeD,EAASrd,MACxBqc,EAAiBgB,EAASf,eAE1BiB,EAAaD,EAAad,MAAM,EAAGH,GACnCmB,EAAYF,EAAad,MAAMH,GAE/BoB,EAAmBF,EAAWb,YAAY,KAC1CgB,EAAoBH,EAAWf,MAAM,EAAGiB,GAE9CJ,EAASrd,MAAQ,GAAG0d,IAAoBb,IAAcW,IACtD,MAAMG,EAAoBD,EAAkBjf,OAASoe,EAAYpe,OACjE4e,EAASO,kBAAkBD,EAAmBA,EAAkB,EAIlEvf,SAAS2F,iBAAiB,SAAUrG,IAC7Boe,EAAgBtK,SAAS9T,EAAEmN,SAAWnN,EAAEmN,SAAW2O,IACtDsC,EAAgBxc,MAAMkQ,QAAU,OAClC,GAEJ,CACF,CA2IA,SAASrQ,GAA2BC,EAAmBC,GACrD,IAAIC,EAAQ,SACRC,EAAOF,EAEPA,EAAKG,WAAW,YAClBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,WACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,UACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,SACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,QACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAChBL,EAAKG,WAAW,QACzBF,EAAQ,YACRC,EAAOF,EAAKI,UAAU,GAAGC,QAGTN,EAAMO,gBAAgBJ,EAAMK,KAAKC,eAAeC,QACxDR,MAAQA,CACpB,CAIA,SAASS,GAAaC,GACpB,OAAOA,EACHA,EACCpB,QAAQ,SAAU,IAClBA,QAAQ,OAAQ,IAChBA,QAAQ,QAAS,IACjBA,QAAQ,OAAQ,IACjB,EACN,CAQA,SAASoR,GAAsBhQ,GAC7B,IAAKA,GAA0B,KAAjBA,EAAMN,OAClB,OAAOM,EAGT,MAAM6d,EAAQ7d,EAAMmH,MAAM,KAC1B,OAAI0W,EAAMpf,QAAU,EACXuB,EAGF6d,EAAMrB,MAAM,GAAG1Z,KAAK,KAAKlE,QAAQ,OAAQ,KAAKA,QAAQ,OAAQ,IACvE,CAIO,SAAS2N,GAA0BnJ,GAIxC,MAAM0a,EAAkB,qqCAqBdpR,EACLjK,KACC,CAACsb,EAAQ5T,IAAU,mGACqEA,2IAEL4T,EAAOhO,0BAA0B5F,yFACzCA,MAAU4T,EAAOhO,kFAK7FjN,KAAK,8XAYJkb,EAAgB5f,SAASyC,eAAe,cAK9Cmd,EAActa,UAAYoa,EAG1B,IAAIG,EAAkB,GAGtB,MAAMC,EAAoB9f,SAASyC,eAAe,aAC5Csd,EAAuB/f,SAASmJ,iBAAiB,oBACjD6W,EAAsBhgB,SAASyC,eAAe,uBAGpD,SAASwd,IACP,MAAMC,EAAsBL,EACxBK,EAAoB7f,OAAS,EAC/B2f,EAAoB3V,UAAY6V,EAAoBxb,KAAK,MAEzDsb,EAAoB3V,UAAY,GAEpC,CAsDA,GAnDAyV,EAAkBna,iBAAiB,UAAU,WACxB3F,SAASmJ,iBAAiB,oBAClChF,SAASmI,IAClBA,EAASI,QAAUtN,KAAKsN,QAEpBJ,EAASI,QACNmT,EAAgBhZ,SAASyF,EAAS1K,QACrCie,EAAgBzc,KAAKkJ,EAAS1K,OAGhCie,EAAkBA,EAAgBjZ,QAAQ+Y,GAAWA,IAAWrT,EAAS1K,OAC3E,IAGFqe,GACF,IAGsBjgB,SAASsC,cAAc,gDAC/BqD,iBAAiB,SAAS,SAAU6G,GAChDA,EAAM8Q,iBACR,IAGAyC,EAAqB5b,SAASmI,IAC5BA,EAAS3G,iBAAiB,UAAU,WAC9B2G,EAASI,QACNmT,EAAgBhZ,SAASyF,EAAS1K,QACrCie,EAAgBzc,KAAKkJ,EAAS1K,OAGhCie,EAAkBA,EAAgBjZ,QAAQ+Y,GAAWA,IAAWrT,EAAS1K,QAI3E,MAAMue,EAAazc,MAAM4E,KAAKyX,GAAsBK,OAAO9T,GAAaA,EAASI,UACjFoT,EAAkBpT,QAAUyT,EAE5BF,GACF,IAGiB3T,EAAS+T,QAAQ,MACzB1a,iBAAiB,SAAS,SAAU6G,GAC3CA,EAAM8Q,iBACR,GAAE,IAMAtY,EAAIC,SAAWD,EAAIC,QAAQ5E,OAAS,EAAG,CACzC0f,EAAqB5b,SAASmI,IACxBtH,EAAIC,QAAQ4B,SAASyF,EAAS1K,SAChC0K,EAASI,SAAU,EACnBmT,EAAgBzc,KAAKkJ,EAAS1K,OAChC,IAIF,MAAMue,EAAazc,MAAM4E,KAAKyX,GAAsBK,OAAO9T,GAAaA,EAASI,UACjFoT,EAAkBpT,QAAUyT,EAC5BF,GAEF,CAGAjgB,SAASyC,eAAe,cAAckD,iBAAiB,SAAS,WAC9DX,EAAIC,QAAU,IAAI4a,GAClB7a,EAAI0M,YAAcpD,EACf1H,QAAO+Y,GAAUE,EAAgBhZ,SAAS8Y,EAAOhO,cACjDtN,KAAIsb,GAAUA,EAAOjO,cAExBkO,EAActa,UAAYP,EAAWC,GACrCmH,EAA0BnH,EAAKoH,EAAKhH,EAEtC,IAEApF,SAASyC,eAAe,kBAAkBkD,iBAAiB,SAAS,WAClEia,EAActa,UAAYP,EAAWC,GACrCmH,EAA0BnH,EAAKoH,EAAKhH,EACtC,GACF,CAtlEA7F,OAAOoG,iBAAiB,cAAc,KAEvB,gBADApG,OAAOQ,SAASnC,MACCgR,IAC5BA,GAAc,EAiJhBY,EAAS8Q,OAAOxQ,eAAeC,QAAQ,WAEvCsB,IAhJA,IAIFiG,OAAOiJ,SAASC,IACVA,EAAKC,OAASnJ,OAAOoJ,SAASlf,OAChCxB,SAASyC,eAAe,YAAYvB,MAAMkQ,QAAU,OACpDpR,SAASyC,eAAe,UAAU4H,UAAY,KAAKqF,0CACpC1P,SAASyC,eAAe,UAEvClD,OAAOQ,SAASnC,KAAO,UAiB3B6J,iBACE,UACQjG,KAAKoG,KAAIH,UACb,MAAMkZ,EAAa7Y,EAAQ9H,SAAS2gB,WAAWC,iBAC/CD,EAAW/V,KAAK,eAEV9C,EAAQE,OACd,MAAM6Y,EAAWF,EAAW7V,MAAMjF,MAAKpG,GAAqB,eAAbA,EAAKb,MAC9CkiB,EAAUH,EAAW7V,MAAMjF,MAAKpG,GAAqB,iBAAbA,EAAKb,MACnD,IAAIiiB,IAAYC,EAQd,OAHA9gB,SAASyC,eAAe,YAAY6C,UAAY,sHAEhD/B,QAAQ4H,IAAI,2CACL,KAPPsD,EAAaoS,EAASjf,MACtB8M,EAAmBoS,EAAQlf,MAC3BgO,GAMF,GAEJ,CAAE,MAAOtM,GACPC,QAAQD,MAAM,oCAAqCA,EACrD,CAEF,CAxCIyd,GAEAzJ,OAAOxP,QAAQ9H,SAASuX,gBACtBD,OAAOE,UAAUC,0BACjB,MA6oENhQ,iBACSjG,KAAKoG,KAAIH,UACd,IAAIzG,EAAQ8G,EAAQ9H,SAAS+H,qBACvBD,EAAQE,OAGd,IAAIgZ,EAAYhgB,EAAMigB,qBAEhBnZ,EAAQE,OACVgZ,EAAUpf,MAAMvB,OAAS,IAC3B8E,EAAgB,GAChB6b,EAAUpf,MAAMuC,SAASqE,IACvB,IAAI0Y,EAAgB1Y,EAAaO,MAAM,WAAW,GAClDmY,EAAgBA,EAAc1gB,QAAQ,KAAM,KAC5C2E,EAAc/B,KAAK8d,GACDlhB,SAASyC,eAAe,0BAExCyC,EAAmBC,EAAcC,EACnC,IAEJ,GAEJ,CAlqEQ+b,EAAyB,IAG/B,G,wBd9DEhkB,EAA6B,IAAIikB,IAAI,cACrChkB,EAA6B,IAAIgkB,IAAI,cAEH,IAAyCjkB,GACzC,IAAyCC,E","sources":["webpack://office-addin-taskpane/./src/taskpane/index.html","webpack://office-addin-taskpane/./node_modules/html-loader/dist/runtime/getUrl.js","webpack://office-addin-taskpane/webpack/bootstrap","webpack://office-addin-taskpane/webpack/runtime/compat get default export","webpack://office-addin-taskpane/webpack/runtime/define property getters","webpack://office-addin-taskpane/webpack/runtime/global","webpack://office-addin-taskpane/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane/webpack/runtime/publicPath","webpack://office-addin-taskpane/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane/./src/taskpane/data.ts","webpack://office-addin-taskpane/./src/taskpane/api.ts","webpack://office-addin-taskpane/./src/taskpane/functions.ts","webpack://office-addin-taskpane/./src/taskpane/components/home.ts","webpack://office-addin-taskpane/./src/taskpane/components/bodyelements.ts","webpack://office-addin-taskpane/./src/taskpane/taskpane.ts"],"sourcesContent":["// Imports\nimport ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___ from \"../../node_modules/html-loader/dist/runtime/getUrl.js\";\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\nvar ___HTML_LOADER_IMPORT_1___ = new URL(\"./css/bootstrap3.css\", import.meta.url);\n// Module\nvar ___HTML_LOADER_REPLACEMENT_0___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_0___);\nvar ___HTML_LOADER_REPLACEMENT_1___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_1___);\nvar code = \" <!DOCTYPE html> <html> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>Link addin</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css\\\"/> <link href=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" integrity=\\\"sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65\\\" crossorigin=\\\"anonymous\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\\\"> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_0___ + \"\\\" rel=\\\"stylesheet\\\"/> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_1___ + \"\\\" rel=\\\"stylesheet\\\"/> </head> <body class=\\\"ms-font-m ms-welcome ms-Fabric\\\"> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\\\" integrity=\\\"sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <div id=\\\"header-nav\\\"> <div class=\\\"logo-header d-flex w-100 justify-content-between align-items-center bg-light\\\" id=\\\"logo-header\\\"> </div> </div> <main id=\\\"app-body\\\" class=\\\"d-block mh-34\\\"> <div id=\\\"ai-tag-list-container\\\" class=\\\"accordion\\\"></div> </main> <div id=\\\"footer\\\" class=\\\"py-2 text-center footer\\\"> </div> </body> </html>\";\n// Exports\nexport default code;","\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    // eslint-disable-next-line no-param-reassign\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n  url = String(url.__esModule ? url.default : url);\n  if (options.hash) {\n    // eslint-disable-next-line no-param-reassign\n    url += options.hash;\n  }\n  if (options.maybeNeedQuotes && /[\\t\\n\\f\\r \"'=<>`]/.test(url)) {\n    return \"\\\"\".concat(url, \"\\\"\");\n  }\n  return url;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","const dataUrl='https://plsdevapp.azurewebsites.net'\r\nconst storeUrl='https://linkwordplugin-aphgcwcgbfdqeccs.eastus-01.azurewebsites.net'\r\nconst versionLink='2.0.0'\r\nexport {dataUrl,storeUrl,versionLink};","import { dataUrl } from \"./data\";\r\n\r\n// api.ts\r\nconst baseUrl = dataUrl // Set your actual base URL\r\n\r\nexport async function loginUser(organization: string, username: string, password: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/user/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      ClientName: organization,\r\n      Username: username,\r\n      Password: password\r\n    })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\n// api.ts\r\n\r\nexport async function getReportById(documentID: string, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/report/id/${documentID}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${jwt}`\r\n      }\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok');\r\n    }\r\n  \r\n    const data = await response.json();\r\n    return data;\r\n  }\r\n  \r\n\r\n  export async function getAllClients(userId: string, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/client/all/${userId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${jwt}`\r\n      }\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n\r\n\r\n  export async function getAiHistory(tagId: string, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/report/ai-history/${tagId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${jwt}`\r\n      }\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n  export async function updateGroupKey(tag: any, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/report/head/groupkey`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(tag)\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n\r\n  export async function addAiHistory(payload: any, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/report/ai-history/add`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n\r\n  export async function updateAiHistory(payload: any, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/report/ai-history/update`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n  export async function fetchGlossaryTemplate(clientId: string, bodyText: any, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/glossary-template/client-id/${clientId}`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(bodyText)\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n\r\n  export async function addGroupKey(payload: any, jwt: string): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/report/group-key/add`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n\r\n  export async function getAllPromptTemplates(jwt): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/prompt-template/all`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  \r\n\r\n  export async function getPromptTemplateById(id: string,jwt): Promise<any> {\r\n    const response = await fetch(`${baseUrl}/api/prompt-template/${id}/data`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n    });\r\n  \r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n  \r\n    const data: any = await response.json();\r\n    return data;\r\n  }\r\n  ","import { generateCheckboxHistory } from \"./components/home\";\r\n\r\nexport function insertLineWithHeadingStyle(range: Word.Range, line: string) {\r\n  let style = \"Normal\";\r\n  let text = line;\r\n\r\n  if (line.startsWith('###### ')) {\r\n    style = \"Heading 6\";\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith('##### ')) {\r\n    style = \"Heading 5\";\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith('#### ')) {\r\n    style = \"Heading 4\";\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith('### ')) {\r\n    style = \"Heading 3\";\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith('## ')) {\r\n    style = \"Heading 2\";\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith('# ')) {\r\n    style = \"Heading 1\";\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  const paragraph = range.insertParagraph(text, Word.InsertLocation.before);\r\n  paragraph.style = style;\r\n}\r\n\r\n\r\nexport function removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\n\r\nexport async function insertSingleBookmark(text: any, DisplayName: any) {\r\n  return Word.run(async (context) => {\r\n    let range = context.document.getSelection();\r\n    await context.sync(); // Ensure selection is ready\r\n\r\n    // Replace spaces with underscores in DisplayName\r\n    let cleanDisplayName = DisplayName.replace(/\\s+/g, \"_\");\r\n\r\n    let uniqueStr = new Date().getTime();\r\n    let splitString = 'Split';\r\n    let bookmarkName = `${cleanDisplayName}_${splitString}_${uniqueStr}`;\r\n\r\n    // Insert text and get the range of inserted content\r\n    let insertedTextRange = range.insertText(text, Word.InsertLocation.replace);\r\n\r\n    await context.sync(); // Ensure text is inserted\r\n\r\n    // Expand the range to cover the newly inserted text and apply bookmark\r\n    insertedTextRange.insertBookmark(bookmarkName);\r\n\r\n    await context.sync(); // Ensure bookmark is inserted\r\n    console.log(`Single bookmark added: ${bookmarkName}`);\r\n  });\r\n}\r\n\r\n\r\nexport function copyText(text: string) {\r\n  // Copy text to clipboard logic\r\n  const tempTextArea = document.createElement('textarea');\r\n  tempTextArea.value = text;\r\n  document.body.appendChild(tempTextArea);\r\n  tempTextArea.select();\r\n  document.execCommand('copy');\r\n  document.body.removeChild(tempTextArea);\r\n\r\n}\r\n\r\n\r\nexport function switchToPromptBuilder() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('prompt-tab').classList.add('active');\r\n  document.getElementById('add-prompt-template').classList.add('show', 'active');\r\n}\r\n\r\n\r\nexport function switchToAddTag() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('tag-tab').classList.add('active');\r\n  document.getElementById('add-tag-body').classList.add('show', 'active');\r\n}\r\n\r\nexport function updateEditorFinalTable(data) {\r\n  const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n  let match;\r\n  let tables = [];\r\n\r\n  while ((match = regex.exec(data)) !== null) {\r\n    try {\r\n      const parsedContent = JSON.parse(match[1]);\r\n      tables.push(jsonToHtmlTable(parsedContent));\r\n    } catch (error) {\r\n      console.error(\"Failed to parse JSON:\", error, match[1]);\r\n    }\r\n  }\r\n\r\n  let tableIndex = 0;\r\n  return data.replace(regex, () => tables[tableIndex++] || \"\");\r\n}\r\n\r\nfunction jsonToHtmlTable(jsonData) {\r\n  if (!jsonData || (Array.isArray(jsonData) && jsonData.length === 0)) {\r\n    return '<p>No data available</p>';\r\n  }\r\n\r\n  let headers = new Set();\r\n  let rows = [];\r\n\r\n  function flattenObject(obj, prefix = \"\", result = {}) {\r\n    Object.keys(obj).forEach(key => {\r\n      const value = obj[key];\r\n      const newKey = prefix ? `${prefix} > ${key}` : key;\r\n\r\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n        flattenObject(value, newKey, result);\r\n      } else if (Array.isArray(value)) {\r\n        result[newKey] = value.map(item => {\r\n          return typeof item === 'object'\r\n            ? Object.entries(item).map(([k, v]) => `<strong>${k}:</strong> ${v}`).join('<br>')\r\n            : item;\r\n        }).join('<br>');\r\n      } else {\r\n        result[newKey] = value;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  if (!Array.isArray(jsonData)) {\r\n    jsonData = Object.entries(jsonData).map(([key, value]) => ({ [key]: value }));\r\n  }\r\n\r\n  jsonData.forEach(item => {\r\n    let flattenedItem = flattenObject(item);\r\n    Object.keys(flattenedItem).forEach(key => headers.add(key));\r\n    rows.push(flattenedItem);\r\n  });\r\n\r\n  let table = '<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">';\r\n  table += '<tr>' + [...headers].map(header => `<th>${header}</th>`).join('') + '</tr>';\r\n  rows.forEach(row => {\r\n    table += '<tr>' + [...headers].map(header => `<td>${row[header]}</td>`).join('') + '</tr>';\r\n  });\r\n\r\n  table += '</table>';\r\n  return table;\r\n}\r\n\r\n\r\nexport async function insertTagPrompt(tag: any) {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const selection = context.document.getSelection();\r\n      await context.sync();\r\n\r\n      if (!selection) {\r\n        throw new Error('Selection is invalid or not found.');\r\n      }\r\n\r\n      if (tag.EditorValue === '') {\r\n        selection.insertParagraph(`#${tag.DisplayName}#`, Word.InsertLocation.before);\r\n      } else {\r\n        if (tag.ComponentKeyDataType === 'TABLE') {\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(tag.EditorValue, 'text/html');\r\n\r\n          const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n          for (const node of bodyNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n              const textContent = node.textContent?.trim();\r\n              if (textContent) {\r\n                textContent.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    insertLineWithHeadingStyle(selection, line);\r\n                  }\r\n                });\r\n              }\r\n            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n              const element = node as HTMLElement;\r\n\r\n              if (element.tagName.toLowerCase() === 'table') {\r\n                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                if (rows.length === 0) {\r\n                  selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                  continue;\r\n                }\r\n\r\n                const maxCols = Math.max(...rows.map(row => {\r\n                  return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                  }, 0);\r\n                }));\r\n\r\n                const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                await context.sync();\r\n\r\n                const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                table.style = \"Grid Table 4 - Accent 1\";  // Apply built-in Word table style\r\n\r\n                await context.sync();\r\n\r\n                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                    // if (rowIndex === 0) {\r\n                    //   const cell = table.getCell(rowIndex, cellIndex);\r\n                    //   const paragraph = cell.body.paragraphs.getFirst();\r\n                    //   paragraph.font.bold = true;\r\n                    //   paragraph.font.highlightColor = \"lightGray\";  // This works!\r\n                    // }\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < maxCols) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < maxCols) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n                });\r\n              } else {\r\n                const elementText = element.innerText.trim();\r\n                if (elementText) {\r\n                  elementText.split('\\n').forEach(line => {\r\n                    if (line.trim()) {\r\n                      insertLineWithHeadingStyle(selection, line);\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          let content = removeQuotes(tag.EditorValue);\r\n          let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n\r\n          lines.forEach(line => {\r\n            selection.insertParagraph(line, Word.InsertLocation.before);\r\n          });\r\n        }\r\n\r\n\r\n      }\r\n\r\n\r\n      await context.sync();\r\n    } catch (error) {\r\n      console.error('Detailed error:', error);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nexport function generateChatHistoryHtml(chatList: any[]): string {\r\n  return chatList.map((chat, index) =>\r\n    `<div class=\"row chat-entry m-0 p-0\">\r\n            <div class=\"col-md-12 mt-2 p-2\">\r\n                <span class=\"float-end me-1\">\r\n                    <i class=\"fa fa-copy text-secondary c-pointer\" title=\"Copy Prompt\" id=\"copyPrompt-${index}\"></i>\r\n                </span>\r\n                <span class=\"float-end w-75 me-2\">\r\n                    <div class=\"form-control h-34 d-flex align-items-center dynamic-height prompt-text\">\r\n                        ${chat.Prompt}\r\n                    </div>\r\n                </span>\r\n            </div>\r\n            <div class=\"col-md-12 mb-2 p-2 d-flex\">\r\n                <span class=\"d-flex align-items-baseline w-100\">\r\n                    <div class=\"flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response\" id=\"responseContainer-${index}\">\r\n                        <input\r\n                            class=\"form-check-input c-pointer me-2 response-checkbox\"\r\n                            type=\"checkbox\"\r\n                            id=\"checkbox-${index}\"\r\n                            ${chat.Selected === 1 ? 'checked' : ''}>\r\n                        <span id=\"responseText-${index}\">${chat.Response}</span>\r\n                        <i class=\"fa fa-copy text-secondary c-pointer ms-2\"\r\n                           title=\"Copy Response\"\r\n                           id=\"copyResponse-${index}\"></i>\r\n                    </div>\r\n                </span>\r\n            </div>\r\n        </div>`\r\n  ).join('');\r\n}\r\n\r\n\r\nexport function chatfooter(tag: any) {\r\n  const tooltipButton = tag.Sources && tag.Sources.length > 0\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n  return ` <textarea class=\"form-control\"\r\n                      rows=\"5\"\r\n                      id=\"chatInput\"\r\n                      placeholder=\"Type here\"></textarea>\r\n            <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n            <div class=\"d-flex flex-column align-self-end me-3\">\r\n              <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insertTagButton\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\"></i>\r\n              </button>\r\n              <button class=\"btn btn-secondary ms-2 mb-2 text-white ngb-tooltip\" id=\"changeSourceButton\">\r\n              ${tooltipButton}\r\n                <i class=\"fa fa-file-lines text-white\"></i>\r\n              </button>\r\n              <button type=\"submit\" class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\" id=\"sendPromptButton\">\r\n                <span class=\"tooltiptext\">Send</span>\r\n                <i class=\"fa fa-paper-plane text-white\"></i>\r\n              </button>\r\n            </div>`\r\n}\r\n\r\nexport function renderSelectedTags(selectedNames, availableKeys) {\r\n\r\n  const badgeWrapper = document.getElementById('tag-badge-wrapper');\r\n  badgeWrapper.innerHTML='';\r\n  selectedNames.forEach(name => {\r\n    const badge = document.createElement('span');\r\n    badge.className = 'badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable';\r\n    badge.style.cursor = 'pointer';\r\n    badge.innerHTML = `${name} <i class=\"fa-solid fa-robot ms-2 text-muted\" aria-label=\"AI Suggested\"></i>`;\r\n\r\n    badge.addEventListener('click', () => {\r\n      const aiTag = availableKeys.find(\r\n        mention => mention.AIFlag === 1 && mention.DisplayName.toLowerCase() === name.toLowerCase()\r\n      );\r\n\r\n      if (aiTag) {\r\n        const appBody = document.getElementById('app-body');\r\n        appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n      \r\n        generateCheckboxHistory(aiTag).then(html => {\r\n          appBody.innerHTML = html;\r\n        });\r\n      }\r\n    });\r\n\r\n    badgeWrapper.appendChild(badge);\r\n  });\r\n}\r\n\r\n","import { getPromptTemplateById, updateGroupKey, updateAiHistory } from \"../api\";\r\nimport { chatfooter, copyText, generateChatHistoryHtml, insertLineWithHeadingStyle, insertSingleBookmark, removeQuotes, renderSelectedTags, switchToAddTag, updateEditorFinalTable } from \"../functions\";\r\nimport { addGenAITags, applyAITagFn, availableKeys, createMultiSelectDropdown, fetchAIHistory, isPendingResponse, jwt, mentionDropdownFn, selectedNames, sendPrompt } from \"../taskpane\";\r\n\r\nlet preview = '';\r\n\r\n\r\nexport function loadHomepage(availableKeys) {\r\n    document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-3\">\r\n  <div class=\"d-flex justify-content-end px-2\">\r\n    <div class=\"dropdown\">\r\n      <button class=\"btn btn-default dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n        Action\r\n      </button>\r\n      <ul class=\"dropdown-menu\">\r\n        <li>\r\n          <a class=\"dropdown-item\" href=\"#\" id=\"add-btn-tag\">\r\n            <i class=\"fa fa-plus me-2\" aria-hidden=\"true\"></i> Add\r\n          </a>\r\n        </li>\r\n        <li>\r\n          <a class=\"dropdown-item\" href=\"#\" id=\"apply-btn-tag\">\r\n            <i class=\"fa-solid fa-circle-check me-2\"></i> Apply\r\n          </a>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"form-group px-2 pt-2\">\r\n    <input\r\n      type=\"text\"\r\n      id=\"search-box\"\r\n      class=\"form-control\"\r\n      placeholder=\"Search Tags...\"\r\n      autocomplete=\"off\"\r\n    />\r\n  </div>\r\n\r\n  <ul id=\"suggestion-list\" class=\"list-group mt-2 px-2\"></ul>\r\n  <div id=\"tags-in-selected-text\" class=\"mt-2 px-2 selected-text-box\">\r\n      <label class=\"form-label mb-2 fw-bold\">Tags in Selected Text</label>\r\n    <div class=\"d-flex flex-wrap gap-2\" id=\"tag-badge-wrapper\"></div></div>\r\n\r\n</div>\r\n    `\r\n\r\n\r\n    const searchBox = document.getElementById('search-box');\r\n    const suggestionList = document.getElementById('suggestion-list');\r\n    renderSelectedTags(selectedNames,availableKeys);\r\n    // Function to filter and display suggestions\r\n    function updateSuggestions() {\r\n        const searchTerm = searchBox.value.trim().toLowerCase();\r\n        suggestionList.replaceChildren(); // Clear previous results\r\n\r\n        if (searchTerm === '') return;\r\n\r\n        const filteredMentions = availableKeys.filter(mention =>\r\n            mention.DisplayName.toLowerCase().includes(searchTerm)\r\n        );\r\n\r\n        const nonAITags = filteredMentions.filter(m => m.AIFlag === 0);\r\n        const aiTags = filteredMentions.filter(m => m.AIFlag === 1);\r\n\r\n        // Helper to create section\r\n        const createSection = (labelText, mentions, isAISection = false) => {\r\n            if (mentions.length === 0) return;\r\n\r\n            const label = document.createElement('li');\r\n            label.className = 'list-group-item fw-bold text-secondary bg-light';\r\n            label.textContent = labelText;\r\n            suggestionList.appendChild(label);\r\n\r\n            mentions.forEach(mention => {\r\n                const listItem = document.createElement('li');\r\n                listItem.className = 'list-group-item list-group-item-action';\r\n\r\n                const icon = isAISection\r\n                    ? `<i class=\"fa-solid fa-robot text-muted me-2\"></i>`\r\n                    : `<i class=\"fa-solid fa-layer-group text-muted me-2\"></i>`;\r\n\r\n                listItem.innerHTML = `${icon} ${mention.DisplayName}`;\r\n\r\n                listItem.onclick = () => {\r\n                    if (isAISection) {\r\n                        const appBody = document.getElementById('app-body');\r\n                        appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n                        generateCheckboxHistory(mention).then(html => {\r\n                            appBody.innerHTML = html;\r\n                        });\r\n                    } else {\r\n                        replaceMention(mention, mention.ComponentKeyDataType);\r\n                        suggestionList.replaceChildren();\r\n                    }\r\n                };\r\n\r\n                suggestionList.appendChild(listItem);\r\n            });\r\n        };\r\n\r\n        // Render both sections\r\n        createSection('Properties', nonAITags, false);\r\n        createSection('AI Tags', aiTags, true);\r\n    }\r\n\r\n\r\n    // Add input event listener to the search box\r\n    searchBox.addEventListener('input', updateSuggestions);\r\n    document.getElementById('add-btn-tag').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            addGenAITags();\r\n        }\r\n    });\r\n\r\n    document.getElementById('apply-btn-tag').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            applyAITagFn();\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) {\r\n                throw new Error('Selection is invalid or not found.');\r\n            }\r\n            if (type === 'TABLE') {\r\n                const parser = new DOMParser();\r\n                const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n\r\n                const bodyNodes = Array.from(doc.body.childNodes);\r\n                const cleanDisplayName = word.DisplayName.replace(/\\s+/g, \"_\");\r\n                const uniqueStr = new Date().getTime();\r\n                const bookmarkName = `${cleanDisplayName}_Split_${uniqueStr}`;\r\n\r\n                const startMarker = selection.insertParagraph(\"[[BOOKMARK_START]]\", Word.InsertLocation.before);\r\n                await context.sync();\r\n\r\n                for (const node of bodyNodes) {\r\n                    if (node.nodeType === Node.TEXT_NODE) {\r\n                        const textContent = node.textContent?.trim();\r\n                        if (textContent) {\r\n                            textContent.split('\\n').forEach(line => {\r\n                                if (line.trim()) {\r\n                                    insertLineWithHeadingStyle(selection, line);\r\n                                }\r\n                            });\r\n                        }\r\n                    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        const element = node as HTMLElement;\r\n\r\n                        if (element.tagName.toLowerCase() === 'table') {\r\n                            const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                            if (rows.length === 0) {\r\n                                selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                                continue;\r\n                            }\r\n\r\n                            const maxCols = Math.max(...rows.map(row => {\r\n                                return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                                }, 0);\r\n                            }));\r\n\r\n                            const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                            await context.sync();\r\n\r\n                            const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                            table.style = \"Grid Table 4 - Accent 1\";  // Apply built-in Word table style\r\n\r\n                            await context.sync();\r\n\r\n                            const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                            rows.forEach((row, rowIndex) => {\r\n                                const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                let cellIndex = 0;\r\n\r\n                                cells.forEach((cell) => {\r\n                                    while (rowspanTracker[cellIndex] > 0) {\r\n                                        rowspanTracker[cellIndex]--;\r\n                                        cellIndex++;\r\n                                    }\r\n\r\n                                    const cellText = Array.from(cell.childNodes)\r\n                                        .map(node => {\r\n                                            if (node.nodeType === Node.TEXT_NODE) {\r\n                                                return node.textContent?.trim() || '';\r\n                                            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                return (node as HTMLElement).innerText.trim();\r\n                                            }\r\n                                            return '';\r\n                                        })\r\n                                        .filter(text => text.length > 0)\r\n                                        .join(' ');\r\n\r\n                                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                    for (let i = 1; i < colspan; i++) {\r\n                                        if (cellIndex + i < maxCols) {\r\n                                            table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                        }\r\n                                    }\r\n\r\n                                    if (rowspan > 1) {\r\n                                        for (let i = 0; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    cellIndex += colspan;\r\n                                });\r\n                            });\r\n                        } else {\r\n                            const elementText = element.innerText.trim();\r\n                            if (elementText) {\r\n                                elementText.split('\\n').forEach(line => {\r\n                                    if (line.trim()) {\r\n                                        insertLineWithHeadingStyle(selection, line);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                const endMarker = selection.insertParagraph(\"[[BOOKMARK_END]]\", Word.InsertLocation.after);\r\n                await context.sync();\r\n\r\n                // Now create bookmark between start and end markers\r\n                const markers = context.document.body.paragraphs;\r\n                context.load(markers, 'text');\r\n\r\n                await context.sync();\r\n\r\n                const start = markers.items.find(p => p.text === '[[BOOKMARK_START]]');\r\n                const end = markers.items.find(p => p.text === '[[BOOKMARK_END]]');\r\n\r\n                if (start && end) {\r\n                    const bookmarkRange = start.getRange('Start').expandTo(end.getRange('End'));\r\n                    bookmarkRange.insertBookmark(bookmarkName);\r\n                    console.log(`Bookmark added for table: ${bookmarkName}`);\r\n                }\r\n\r\n                // Optionally: Remove the markers\r\n                start.insertText('', Word.InsertLocation.replace);\r\n                end.insertText('', Word.InsertLocation.replace);\r\n            }\r\n\r\n            else {\r\n                if (word.EditorValue === '' || word.IsApplied) {\r\n                    selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n                } else {\r\n                    // if (word.AIFlag === 1) {\r\n                    //     let content = removeQuotes(word.EditorValue);\r\n                    //     let textToInsert = content.replace(/\\r?\\n/g, \"\\n\"); // Ensure line breaks remain\r\n                    //     insertSingleBookmark(textToInsert, word.DisplayName);\r\n                    // } else {\r\n                    let content = removeQuotes(word.EditorValue);\r\n                    let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n                    lines.forEach(line => {\r\n                        selection.insertParagraph(line, Word.InsertLocation.before);\r\n                    });\r\n\r\n                }\r\n            }\r\n\r\n            await context.sync();\r\n        } catch (error) {\r\n            console.error('Detailed error:', error);\r\n        }\r\n    });\r\n}\r\n\r\nexport async function openAITag(tag) {\r\n    tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n    });\r\n\r\n\r\n}\r\n\r\nexport async function generateCheckboxHistory(tag) {\r\n    if (!tag.FilteredReportHeadAIHistoryList || tag.FilteredReportHeadAIHistoryList.length === 0) {\r\n        await fetchAIHistory(tag);\r\n    }\r\n\r\n    if (tag.FilteredReportHeadAIHistoryList.length > 0) {\r\n        const closeBar = `<div class=\"d-flex justify-content-between align-items-center px-2 mt-3\">\r\n    <div class=\"d-flex align-items-center ms-3\">\r\n        <i class=\"fa fa-robot text-muted me-2\"></i>\r\n        <span class=\"fw-bold\">${tag.DisplayName}</span>\r\n    </div>\r\n    <div class=\"d-flex justify-content-center align-items-center me-3 c-pointer\" id=\"close-btn-tag\">\r\n         <i class=\"fa-solid fa-circle-xmark bg-light text-dark\"></i>\r\n\r\n    </div>\r\n</div>\r\n<hr class=\"mt-2 mb-1 mx-3\">\r\n`;\r\n        const chats = generateChatHistoryHtml(tag.FilteredReportHeadAIHistoryList)\r\n\r\n        const chatHistoryHtml = `\r\n        <div class=\"chat-body\">\r\n        ${chats}\r\n        </div>`\r\n\r\n        const chatFooter = chatfooter(tag);\r\n        const chatInputFooter = `\r\n         <div class=\"d-flex align-items-end justify-content-end chatbox p-2\" id=\"chatFooter\">\r\n            ${chatFooter}\r\n          </div>`;\r\n\r\n        const finalHtml = `${closeBar}${chatHistoryHtml}${chatInputFooter}`;\r\n\r\n        initializeAIHistoryEvents(tag, jwt, availableKeys)\r\n        return finalHtml;\r\n    } else {\r\n        return '<div>No AI history available.</div>';\r\n    }\r\n}\r\n\r\n\r\n\r\nexport async function setupPromptBuilderUI(container, promptBuilderList) {\r\n\r\n    // Static template and field definitions\r\n    let preview = '';\r\n    let templateText = '';\r\n\r\n    // Field configs (can be extended)\r\n    let fieldsList = [];\r\n\r\n    // Create the form container\r\n    // Create the form container\r\n    container.innerHTML = `\r\n  <div class=\"form-group mb-3\">\r\n    <label><span class=\"mandatory-field\">*</span>Prompt Builder Template</label>\r\n    <select id=\"promptBuilderTemplate\" class=\"form-control\">\r\n      <option value=\"\" disabled selected>Select a template</option>\r\n    </select>\r\n    <div id=\"templateError\" class=\"invalid-feedback d-none\">Type is required.</div>\r\n  </div>\r\n\r\n  <div id=\"fieldsContainer\"></div>\r\n\r\n  <div class=\"form-group mb-3\" id=\"previewContainer\" style=\"display: none;\">\r\n    <label class=\"mb-2\">Preview</label>\r\n    <div id=\"preview\" class=\"form-control\"></div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-between px-3 align-items-center mt-3\">\r\n    <span id=\"resetBtn\" class=\"text-primary fw-bold\" style=\"cursor: pointer;\">Reset</span>\r\n    <button id=\"applyBtn\" class=\"btn btn-primary text-white\" disabled>Apply Prompt</button>\r\n  </div>\r\n`;\r\n\r\n    // Element references\r\n    const templateSelect = container.querySelector('#promptBuilderTemplate') as HTMLSelectElement;\r\n    const applyBtn = container.querySelector('#applyBtn') as HTMLButtonElement;\r\n    const resetBtn = container.querySelector('#resetBtn') as HTMLSpanElement;\r\n    const previewDiv = container.querySelector('#preview') as HTMLDivElement;\r\n    const fieldsContainer = container.querySelector('#fieldsContainer') as HTMLDivElement;\r\n    const previewContainer = container.querySelector('#previewContainer') as HTMLDivElement;\r\n    const templateError = container.querySelector('#templateError') as HTMLDivElement;\r\n\r\n    // Populate template dropdown\r\n    promptBuilderList.forEach((item) => {\r\n        const option = document.createElement('option');\r\n        option.value = item.ID.toString();\r\n        option.textContent = item.Name;\r\n        templateSelect.appendChild(option);\r\n    });\r\n\r\n    templateSelect.addEventListener('change', async () => {\r\n        const templateId = templateSelect.value;\r\n        const jwt = sessionStorage.getItem('token') || '';\r\n\r\n        const data = await getPromptTemplateById(templateId, jwt);\r\n        if (data.Status && data.Data) {\r\n            fieldsList = data.Data;\r\n            preview = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n\r\n            templateText = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n        }\r\n        if (!templateId) {\r\n            templateError.classList.remove('d-none');\r\n            return;\r\n        }\r\n\r\n        templateError.classList.add('d-none');\r\n\r\n        renderFields();\r\n        updatePreview();\r\n    });\r\n\r\n    function renderFields() {\r\n        fieldsContainer.innerHTML = '';\r\n\r\n        fieldsList.forEach((field) => {\r\n            const div = document.createElement('div');\r\n            div.className = 'form-group mb-3';\r\n\r\n            const label = document.createElement('label');\r\n            label.textContent = field.Label;\r\n            div.appendChild(label);\r\n\r\n            if (field.Type === 1) {\r\n                const input = document.createElement('input');\r\n                input.type = 'text';\r\n                input.className = 'form-control';\r\n                input.id = field.Label;\r\n                input.addEventListener('input', replaceKeywordsManually);\r\n                div.appendChild(input);\r\n            } else if (field.Type === 2) {\r\n                const select = document.createElement('select');\r\n                select.className = 'form-control';\r\n                select.id = field.Label;\r\n                field.PromptTemplateOptionList.forEach((opt: any) => {\r\n                    const option = document.createElement('option');\r\n                    option.value = opt.Text;\r\n                    option.textContent = opt.Option;\r\n                    select.appendChild(option);\r\n                });\r\n                select.addEventListener('change', replaceKeywordsManually);\r\n                div.appendChild(select);\r\n            }\r\n\r\n            fieldsContainer.appendChild(div);\r\n        });\r\n    }\r\n\r\n    function replaceKeywordsManually() {\r\n        const keywordMap: { [key: string]: string } = {};\r\n\r\n        fieldsList.forEach((field) => {\r\n            const id = field.Label;\r\n            const keyword = `#${id}#`;\r\n\r\n            let value = '';\r\n            const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement;\r\n\r\n            if (element) {\r\n                value = (element instanceof HTMLInputElement || element instanceof HTMLSelectElement)\r\n                    ? element.value\r\n                    : '';\r\n            }\r\n\r\n            keywordMap[keyword] = value ? value : keyword;\r\n        });\r\n\r\n        let insertValue = templateText;\r\n        for (const [keyword, value] of Object.entries(keywordMap)) {\r\n            insertValue = insertValue.replace(new RegExp(keyword, 'g'), value);\r\n        }\r\n\r\n        preview = insertValue;\r\n        previewDiv.textContent = preview;\r\n        previewContainer.style.display = preview ? 'block' : 'none';\r\n        applyBtn.disabled = preview === '';\r\n    }\r\n\r\n    function updatePreview() {\r\n        replaceKeywordsManually();\r\n    }\r\n\r\n    function resetForm() {\r\n        // Reset only the dynamic field values\r\n        fieldsList.forEach((field) => {\r\n            const element = document.getElementById(field.Label) as HTMLInputElement | HTMLSelectElement;\r\n            if (element) {\r\n                if (element instanceof HTMLInputElement) {\r\n                    element.value = '';\r\n                } else if (element instanceof HTMLSelectElement) {\r\n                    element.selectedIndex = 0; // optional: reset to first option\r\n                }\r\n            }\r\n        });\r\n\r\n        // Clear preview\r\n        previewDiv.textContent = templateText;\r\n        preview = templateText;\r\n    }\r\n\r\n\r\n    function applyPrompt() {\r\n        if (!preview) return;\r\n\r\n        const promptTextarea = document.getElementById('prompt') as HTMLTextAreaElement;\r\n        if (promptTextarea) {\r\n            promptTextarea.value = preview;\r\n            switchToAddTag()\r\n        }\r\n\r\n    }\r\n\r\n    resetBtn.addEventListener('click', resetForm);\r\n    applyBtn.addEventListener('click', applyPrompt);\r\n}\r\n\r\n\r\nasync function insertTagPrompt(tag: any) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) {\r\n                throw new Error('Selection is invalid or not found.');\r\n            }\r\n\r\n            const cleanDisplayName = tag.DisplayName.replace(/\\s+/g, \"_\");\r\n            const uniqueStr = new Date().getTime();\r\n            const bookmarkName = `${cleanDisplayName}_Split_${uniqueStr}`;\r\n\r\n            const startMarker = selection.insertParagraph(\"[[BOOKMARK_START]]\", Word.InsertLocation.before);\r\n            await context.sync();\r\n\r\n            if (tag.EditorValue === '') {\r\n                selection.insertParagraph(`#${tag.DisplayName}#`, Word.InsertLocation.before);\r\n            } else {\r\n                if (tag.ComponentKeyDataType === 'TABLE') {\r\n                    const parser = new DOMParser();\r\n                    const doc = parser.parseFromString(tag.EditorValue, 'text/html');\r\n                    const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                    for (const node of bodyNodes) {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                            const textContent = node.textContent?.trim();\r\n                            if (textContent) {\r\n                                textContent.split('\\n').forEach(line => {\r\n                                    if (line.trim()) {\r\n                                        insertLineWithHeadingStyle(selection, line);\r\n                                    }\r\n                                });\r\n                            }\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                            const element = node as HTMLElement;\r\n\r\n                            if (element.tagName.toLowerCase() === 'table') {\r\n                                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                                if (rows.length === 0) {\r\n                                    selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                                    continue;\r\n                                }\r\n\r\n                                const maxCols = Math.max(...rows.map(row => {\r\n                                    return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                                        return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                                    }, 0);\r\n                                }));\r\n\r\n                                const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                                await context.sync();\r\n\r\n                                const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                                table.style = \"Grid Table 4 - Accent 1\";\r\n                                await context.sync();\r\n\r\n                                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                                rows.forEach((row, rowIndex) => {\r\n                                    const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                    let cellIndex = 0;\r\n\r\n                                    cells.forEach((cell) => {\r\n                                        while (rowspanTracker[cellIndex] > 0) {\r\n                                            rowspanTracker[cellIndex]--;\r\n                                            cellIndex++;\r\n                                        }\r\n\r\n                                        const cellText = Array.from(cell.childNodes)\r\n                                            .map(node => {\r\n                                                if (node.nodeType === Node.TEXT_NODE) {\r\n                                                    return node.textContent?.trim() || '';\r\n                                                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                    return (node as HTMLElement).innerText.trim();\r\n                                                }\r\n                                                return '';\r\n                                            })\r\n                                            .filter(text => text.length > 0)\r\n                                            .join(' ');\r\n\r\n                                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                        for (let i = 1; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                            }\r\n                                        }\r\n\r\n                                        if (rowspan > 1) {\r\n                                            for (let i = 0; i < colspan; i++) {\r\n                                                if (cellIndex + i < maxCols) {\r\n                                                    rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        cellIndex += colspan;\r\n                                    });\r\n                                });\r\n                            } else {\r\n                                const elementText = element.innerText.trim();\r\n                                if (elementText) {\r\n                                    elementText.split('\\n').forEach(line => {\r\n                                        if (line.trim()) {\r\n                                            insertLineWithHeadingStyle(selection, line);\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    let content = removeQuotes(tag.EditorValue);\r\n                    let lines = content.split(/\\r?\\n/);\r\n                    lines.forEach(line => {\r\n                        selection.insertParagraph(line, Word.InsertLocation.before);\r\n                    });\r\n                }\r\n            }\r\n\r\n            const endMarker = selection.insertParagraph(\"[[BOOKMARK_END]]\", Word.InsertLocation.after);\r\n            await context.sync();\r\n\r\n            const markers = context.document.body.paragraphs;\r\n            context.load(markers, 'text');\r\n            await context.sync();\r\n\r\n            const start = markers.items.find(p => p.text === '[[BOOKMARK_START]]');\r\n            const end = markers.items.find(p => p.text === '[[BOOKMARK_END]]');\r\n\r\n            if (start && end) {\r\n                const bookmarkRange = start.getRange('Start').expandTo(end.getRange('End'));\r\n                bookmarkRange.insertBookmark(bookmarkName);\r\n                console.log(`Bookmark added: ${bookmarkName}`);\r\n            }\r\n\r\n            if (start) start.insertText('', Word.InsertLocation.replace);\r\n            if (end) end.insertText('', Word.InsertLocation.replace);\r\n\r\n            await context.sync();\r\n        } catch (error) {\r\n            console.error('Detailed error:', error);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport function initializeAIHistoryEvents(tag: any, jwt: string, availableKeys: any) {\r\n    setTimeout(() => {\r\n        tag.FilteredReportHeadAIHistoryList.forEach((chat: any, index: number) => {\r\n            // Copy buttons\r\n            document.getElementById(`copyPrompt-${index}`)?.addEventListener('click', () => copyText(chat.Prompt));\r\n            document.getElementById(`copyResponse-${index}`)?.addEventListener('click', () => copyText(chat.Response));\r\n\r\n            // Close button\r\n            document.getElementById(`close-btn-tag`)?.addEventListener('click', () => loadHomepage(availableKeys));\r\n\r\n            // Checkbox logic\r\n            const checkbox = document.getElementById(`checkbox-${index}`) as HTMLInputElement;\r\n            if (checkbox) {\r\n                checkbox.addEventListener('change', async (event: Event) => {\r\n                    const isChecked = (event.target as HTMLInputElement).checked;\r\n\r\n                    // Reset all\r\n                    tag.FilteredReportHeadAIHistoryList.forEach((_: any, otherIndex: number) => {\r\n                        const otherCheckbox = document.getElementById(`checkbox-${otherIndex}`) as HTMLInputElement;\r\n                        const responseContainer = document.getElementById(`responseContainer-${otherIndex}`);\r\n                        if (otherCheckbox) otherCheckbox.checked = false;\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.remove('ai-selected-response');\r\n                            responseContainer.classList.add('bg-light');\r\n                        }\r\n                        tag.FilteredReportHeadAIHistoryList[otherIndex].Selected = 0;\r\n                    });\r\n\r\n                    // Set selected\r\n                    if (isChecked) {\r\n                        checkbox.checked = true;\r\n                        const responseContainer = document.getElementById(`responseContainer-${index}`);\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.add('ai-selected-response');\r\n                            responseContainer.classList.remove('bg-light');\r\n                        }\r\n                        chat.Selected = 1;\r\n                    } else {\r\n                        chat.Selected = 0;\r\n                    }\r\n\r\n                    try {\r\n                        const data = await updateAiHistory(chat, jwt);\r\n                        if (data['Data']) {\r\n                            tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n                            tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n                            tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                                historyList.Response = removeQuotes(historyList.Response);\r\n                                tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                            });\r\n\r\n                            const finalResponse = chat.FormattedResponse\r\n                                ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                : chat.Response;\r\n\r\n                            tag.ComponentKeyDataType = chat.FormattedResponse ? 'TABLE' : 'TEXT';\r\n                            tag.UserValue = finalResponse;\r\n                            tag.EditorValue = finalResponse;\r\n                            tag.text = finalResponse;\r\n\r\n                            const currentlySelected = tag.FilteredReportHeadAIHistoryList.some((item: any) => item.Selected === 1);\r\n                            tag.IsApplied = !currentlySelected;\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('Failed to update AI history:', err);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        // Button: Insert Tag\r\n        document.getElementById(`insertTagButton`)?.addEventListener('click', () => {\r\n            if (!tag.IsApplied) {\r\n                insertTagPrompt(tag);\r\n            }\r\n        });\r\n\r\n        // Button: Send Prompt\r\n        document.getElementById(`sendPromptButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            sendPrompt(tag, textareaValue);\r\n        });\r\n\r\n        // Button: Change Source\r\n        document.getElementById(`changeSourceButton`)?.addEventListener('click', () => {\r\n            createMultiSelectDropdown(tag);\r\n        });\r\n\r\n        // Mention dropdown\r\n        mentionDropdownFn(`chatInput`, `mention-dropdown`, 'edit');\r\n    }, 0);\r\n}\r\n","function addtagbody(sponsorOptions) {\r\n  const body = `<div class=\"modal-dialog\">\r\n  <div class=\"modal-content\">\r\n    <div class=\"modal-body p-3\">\r\n      <form id=\"genai-form\" autocomplete=\"off\" novalidate>\r\n        <!-- Name Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"name\" class=\"form-label\"><span class=\"text-danger\">*</span> Name</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"name\" required>\r\n          <div class=\"invalid-feedback\">Name is required.</div>\r\n          <div id=\"submition-error\" class=\"invalid-feedback\" style=\"display: none;\"></div>\r\n\r\n        </div>\r\n\r\n        <!-- Description Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"description\" class=\"form-label\">Description</label>\r\n          <textarea class=\"form-control\" id=\"description\" rows=\"6\"></textarea>\r\n        </div>\r\n\r\n        <!-- Prompt Field -->\r\n        <div class=\"mb-3 prompt-box\">\r\n          <label for=\"prompt\" class=\"form-label\"><span class=\"text-danger\">*</span> Prompt \r\n            <small class=\"text-secondary\">(Note: Use # tag for content suggestions)</small>\r\n          </label>\r\n          <textarea class=\"form-control\" id=\"prompt\" rows=\"6\"  required></textarea>\r\n          <div class=\"invalid-feedback\">Prompt is required.</div>\r\n          <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n        </div>\r\n\r\n        <!-- Save Globally Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"saveGlobally\">\r\n          <label class=\"form-check-label\" for=\"saveGlobally\">Save Globally</label>\r\n        </div>\r\n\r\n        <!-- Available to All Sponsors Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"isAvailableForAll\" disabled>\r\n          <label class=\"form-check-label\" for=\"isAvailableForAll\">Available to All Sponsors</label>\r\n        </div>\r\n\r\n        <!-- Sponsor Dropdown -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"sponsor\" class=\"form-label\"><span class=\"text-danger\">*</span> Sponsor</label>\r\n          <div class=\"dropdown w-100\">\r\n            <button \r\n              class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n              type=\"button\" \r\n              id=\"sponsorDropdown\" \r\n              data-bs-toggle=\"dropdown\" \r\n              aria-expanded=\"false\" \r\n              disabled>\r\n              <span id=\"sponsorDropdownLabel\">Select Sponsors</span>\r\n              <span class=\"dropdown-toggle-icon\"></span>\r\n            </button>\r\n            <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sponsorDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n              <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\r\n                  <label class=\"form-check-label\" for=\"selectAll\">Select All</label>\r\n                </div>\r\n              </li>\r\n              ${sponsorOptions}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Action Buttons -->\r\n        <div class=\"mt-3 d-flex justify-content-between\">\r\n          <span id=\"cancel-btn-gen-ai\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n          <button type=\"submit\" class=\"btn btn-primary\" id=\"text-gen-save\">Save</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>`\r\n\r\n  return body\r\n}\r\n\r\nfunction logoheader(storedUrl) {\r\n  const body = `\r\n    <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n    <div class=\"icon-nav me-3\">\r\n    <i class=\"fa fa-home c-pointer me-3\" title=\"Home\" id=\"home\"></i>\r\n<div class=\"dropdown d-inline\">\r\n  <i class=\"fa fa-tools c-pointer me-3\" id=\"settingsDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Settings\"></i>\r\n  <ul class=\"dropdown-menu\" aria-labelledby=\"settingsDropdown\">\r\n    <li>\r\n      <a class=\"dropdown-item\" href=\"#\" id=\"define-formatting\">\r\n        <i class=\"fa fa-sliders-h me-2\" aria-hidden=\"true\"></i> Define Formatting\r\n      </a>\r\n    </li>\r\n    <li>\r\n      <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"glossary\" tabindex=\"-1\" aria-disabled=\"true\">\r\n        <i class=\"fa fa-book me-2\" aria-hidden=\"true\"></i> Apply Glossary\r\n      </a>\r\n    </li>\r\n    <li>\r\n      <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"removeFormatting\" tabindex=\"-1\" aria-disabled=\"true\">\r\n        <i class=\"fa fa-eraser me-2\" aria-hidden=\"true\"></i> Remove Formatting\r\n      </a>\r\n    </li>\r\n  </ul>\r\n</div>\r\n\r\n    <i class=\"fa fa-sign-out c-pointer me-3\" id=\"logout\" title=\"Logout\"></i>\r\n    </div>    \r\n`\r\n  return body\r\n}\r\n\r\nconst navTabs = `<ul class=\"nav nav-tabs\" id=\"tabList\" role=\"tablist\">\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link active\" id=\"tag-tab\" data-bs-toggle=\"tab\" href=\"#tag\" role=\"tab\">Tag</a>\r\n  </li>\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link\" id=\"prompt-tab\" data-bs-toggle=\"tab\" href=\"#prompt\" role=\"tab\">Prompt builder</a>\r\n  </li>\r\n</ul>\r\n\r\n<div class=\"tab-content p-3 border border-top-0\">\r\n  <div class=\"tab-pane fade show active\" id=\"add-tag-body\" role=\"tabpanel\" aria-labelledby=\"tag-tab\">\r\n  </div>\r\n  <div class=\"tab-pane fade\" id=\"add-prompt-template\" role=\"tabpanel\" aria-labelledby=\"prompt-tab\">\r\n  </div>\r\n</div>\r\n`\r\n\r\n\r\n\r\nconst promptbuilderbody = `<div>hi</div>`\r\n\r\n\r\nexport { navTabs, addtagbody, promptbuilderbody, logoheader };","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\nimport { dataUrl, storeUrl, versionLink } from \"./data\";\r\nimport { generateCheckboxHistory, initializeAIHistoryEvents, loadHomepage, setupPromptBuilderUI } from \"./components/home\";\r\nimport { chatfooter, copyText, insertTagPrompt, renderSelectedTags, switchToAddTag, switchToPromptBuilder, updateEditorFinalTable } from \"./functions\";\r\nimport { addtagbody, logoheader, navTabs, promptbuilderbody } from \"./components/bodyelements\";\r\nimport { addAiHistory, addGroupKey, fetchGlossaryTemplate, getAiHistory, getAllClients, getAllPromptTemplates, getReportById, loginUser, updateAiHistory, updateGroupKey } from \"./api\";\r\nexport let jwt = '';\r\nlet storedUrl = storeUrl\r\nlet documentID = ''\r\nlet organizationName = ''\r\nlet aiTagList = [];\r\nlet initialised = true;\r\nexport let availableKeys = [];\r\nlet promptBuilderList = [];\r\nlet glossaryName = ''\r\nlet isGlossaryActive: boolean = false;\r\nlet GroupName: string = '';\r\nlet layTerms = [];\r\nlet dataList: any = []\r\nlet isTagUpdating: boolean = false;\r\nlet capturedFormatting: any = {};\r\nlet emptyFormat: boolean = false;\r\nlet isNoFormatTextAvailable: boolean = false;\r\nlet clientId = '0';\r\nlet userId = 0;\r\nlet clientList = [];\r\nlet version = versionLink;\r\nlet currentYear = new Date().getFullYear();\r\nlet sourceList;\r\nlet filteredGlossaryTerm;\r\nexport let selectedNames = [];\r\nexport let isPendingResponse = false;\r\n\r\n\r\n/* global document, Office, Word */\r\n\r\nwindow.addEventListener('hashchange', () => {\r\n  const hash = window.location.hash;\r\n  if (hash === '#/dashboard' && initialised) {\r\n    initialised = false;\r\n    displayMenu();\r\n\r\n  }\r\n});\r\n\r\n\r\nOffice.onReady((info) => {\r\n  if (info.host === Office.HostType.Word) {\r\n    document.getElementById(\"app-body\").style.display = \"flex\";\r\n    document.getElementById(\"footer\").innerText = ` ${currentYear} - TrialAssure LINK AI Assistant ${version}`\r\n    const editor = document.getElementById('editor');\r\n\r\n    window.location.hash = '#/login';\r\n    retrieveDocumentProperties()\r\n\r\n    Office.context.document.addHandlerAsync(\r\n      Office.EventType.DocumentSelectionChanged,\r\n      () => {\r\n        logBookmarksInSelection();\r\n      }\r\n    );\r\n  }\r\n});\r\n\r\n\r\n// Example usage:\r\n\r\n\r\n\r\nasync function retrieveDocumentProperties() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const properties = context.document.properties.customProperties;\r\n      properties.load(\"items\");\r\n\r\n      await context.sync();\r\n      const property = properties.items.find(prop => prop.key === 'DocumentID');\r\n      const orgName = properties.items.find(prop => prop.key === 'Organization');\r\n      if (property && orgName) {\r\n        documentID = property.value;\r\n        organizationName = orgName.value;\r\n        login()\r\n      } else {\r\n        document.getElementById('app-body').innerHTML = `\r\n        <p class=\"px-3 text-center\">Export a document from the LINK AI application to use this functionality.</p>`\r\n        console.log(`Custom property \"documentID\" not found.`);\r\n        return null;\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error retrieving custom property:\", error);\r\n  }\r\n\r\n}\r\n\r\nasync function login() {\r\n  // document.getElementById('header').innerHTML = ``\r\n  const sessionToken = sessionStorage.getItem('token');\r\n  console.log(sessionToken)\r\n  if (sessionToken) {\r\n    jwt = sessionToken;\r\n    window.location.hash = '#/dashboard';\r\n  } else {\r\n    loadLoginPage();\r\n  }\r\n}\r\n\r\nfunction loadLoginPage() {\r\n\r\n\r\n  document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container\">\r\n      <form id=\"login-form\" class=\"p-4 border rounded\">\r\n        <div class=\"mb-3\">\r\n          <label for=\"organization\" class=\"form-label fw-bold\">Organization</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"organization\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"username\" class=\"form-label fw-bold\">Username</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"username\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"password\" class=\"form-label fw-bold\">Password</label>\r\n          <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n        </div>\r\n        <div class=\"d-grid\">\r\n          <button type=\"submit\" class=\"btn btn-primary bg-primary-clr\">Login</button>\r\n        </div>\r\n      <div id=\"login-error\" class=\"mt-3 text-danger\" style=\"display: none;\"></div>\r\n\r\n      </form>\r\n    </div>\r\n  `;\r\n\r\n  document.getElementById('login-form').addEventListener('submit', handleLogin);\r\n}\r\n\r\nasync function handleLogin(event) {\r\n  event.preventDefault();\r\n\r\n  // Get the values from the form fields\r\n  const organization = (document.getElementById('organization') as HTMLInputElement).value;\r\n  const username = (document.getElementById('username') as HTMLInputElement).value;\r\n  const password = (document.getElementById('password') as HTMLInputElement).value;\r\n  if (organization.toLowerCase().trim() === organizationName.toLocaleLowerCase().trim()) {\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n          </div\r\n`\r\n    try {\r\n      const data = await loginUser(organization, username, password);\r\n      if (data.Status === true && data['Data']) {\r\n        if (data['Data'].ResponseStatus) {\r\n          jwt = data.Data.Token;\r\n          sessionStorage.setItem('token', jwt)\r\n          sessionStorage.setItem('userId', data.Data.ID);\r\n          window.location.hash = '#/dashboard';\r\n\r\n        } else {\r\n          showLoginError(\"An error occurred during login. Please try again.\")\r\n        }\r\n      } else {\r\n        showLoginError(\"An error occurred during login. Please try again.\")\r\n      }\r\n    } catch (error) {\r\n      showLoginError(\"An error occurred during login. Please try again.\")\r\n      console.error('Error during login:', error);\r\n      // Handle login error (e.g., show an error message)\r\n    }\r\n  } else {\r\n    showLoginError(\"The organization specified is not associated with this document\")\r\n  }\r\n}\r\n\r\nfunction showLoginError(message) {\r\n  loadLoginPage();  // Reload the form UI\r\n  const errorDiv = document.getElementById('login-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction displayMenu() {\r\n  userId = Number(sessionStorage.getItem('userId'))\r\n  // document.getElementById('aitag').addEventListener('click', redirectAI);\r\n  fetchDocument('Init');\r\n\r\n}\r\n\r\nasync function fetchDocument(action) {\r\n  try {\r\n\r\n    const data = await getReportById(documentID, jwt);\r\n    document.getElementById('app-body').innerHTML = ``\r\n    document.getElementById('logo-header').innerHTML = logoheader(storedUrl);\r\n\r\n    dataList = data['Data'];\r\n    sourceList = dataList.SourceTypeList.filter(\r\n      (item) => item.SourceValue !== ''\r\n        && item.AIFlag === 1\r\n    ) // Filter items with an extension\r\n      .map((item) => ({\r\n        ...item, // Spread the existing properties\r\n        SourceName: transformDocumentName(item.SourceValue)\r\n      }));\r\n    clientId = dataList.ClientID;\r\n    const aiGroup = data['Data'].Group.find(element => element.DisplayName === 'AIGroup');\r\n    GroupName = aiGroup ? aiGroup.Name : '';\r\n    aiTagList = aiGroup ? aiGroup.GroupKey : [];\r\n\r\n    availableKeys = data['Data'].GroupKeyAll.filter(element => element.ComponentKeyDataType === 'TABLE' || element.ComponentKeyDataType === 'TEXT');\r\n    availableKeys.forEach((key) => {\r\n      if (key.AIFlag === 1) {\r\n        const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n        let match;\r\n        if ((match = regex.exec(key.EditorValue) !== null)) {\r\n          {\r\n            key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n            key.UserValue = key.EditorValue;\r\n            key.InitialTable = true;\r\n            key.ComponentKeyDataType = 'TABLE';\r\n          }\r\n\r\n        }\r\n      }\r\n    });\r\n\r\n    aiTagList.forEach((key, i) => {\r\n      const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n      let match;\r\n      if ((match = regex.exec(key.EditorValue) !== null)) {\r\n        {\r\n          key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n          key.UserValue = key.EditorValue;\r\n          key.InitialTable = true;\r\n          key.ComponentKeyDataType = 'TABLE';\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    );\r\n    fetchClients();\r\n    loadPromptTemplates();\r\n    loadHomepage(availableKeys);\r\n    document.getElementById('home').addEventListener('click', async () => {\r\n      if (!isPendingResponse) {\r\n        if (isGlossaryActive) {\r\n          await removeMatchingContentControls();\r\n        }\r\n\r\n        loadHomepage(availableKeys);\r\n      }\r\n    });\r\n\r\n    document.getElementById('glossary').addEventListener('click', () => {\r\n      if (emptyFormat) {\r\n        fetchGlossary();\r\n      }\r\n    });\r\n\r\n    document.getElementById('define-formatting').addEventListener('click', () => {\r\n      if (!isPendingResponse) {\r\n        formatOptionsDisplay()\r\n      }\r\n    }\r\n    );\r\n\r\n\r\n    document.getElementById('removeFormatting').addEventListener('click', () => {\r\n      if (Object.keys(capturedFormatting).length > 0) {\r\n        removeOptionsConfirmation();\r\n      }\r\n    });\r\n\r\n    document.getElementById('logout').addEventListener('click', async () => {\r\n      if (!isPendingResponse) {\r\n        if (isGlossaryActive) {\r\n          await removeMatchingContentControls();\r\n        }\r\n\r\n        logout()\r\n      }\r\n    }\r\n    );\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching glossary data:', error);\r\n  }\r\n}\r\n\r\nasync function fetchClients() {\r\n  try {\r\n    const userId = sessionStorage.getItem('userId') || '';\r\n\r\n\r\n    const data = await getAllClients(userId, jwt);\r\n\r\n    if (data.Status && data.Data) {\r\n      clientList = data['Data'];\r\n    } else {\r\n      console.warn(\"Failed to load clients or no clients found.\");\r\n    }\r\n  } catch (error) {\r\n  }\r\n}\r\n\r\n\r\n\r\nexport async function formatOptionsDisplay() {\r\n  if (!isTagUpdating) { // Check if isTagUpdating is false\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n    const htmlBody = `\r\n      <div class=\"container mt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n               <!-- Buttons for Capture and Empty Format -->\r\n            <div class=\"d-flex justify-content-end\">\r\n              <button id=\"capture-format-btn\" class=\"btn btn-primary bg-primary-clr\"><i class=\"fa fa-border-style me-1\"></i>  Capture Format</button>\r\n            </div>\r\n            <!-- <h5 class=\"card-title\">Formatting Options</h5> -->\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div class=\"formating-checkbox\">\r\n               <input type=\"checkbox\" id=\"empty-format-checkbox\" class=\"form-check-input\">\r\n              <label for=\"empty-format-checkbox\" class=\"form-check-label empty-format-checkbox-label\" style=\"flex: 1;\">\r\n                   Skip ignoring and removing format-based text\r\n              </label>\r\n            </div>\r\n\r\n            <!-- Section to display captured formatting -->\r\n            <div id=\"format-details\">\r\n              <h5 class=\"my-3\">Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled\"></ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    if (Object.keys(capturedFormatting).length === 0) {\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // The object is not empty\r\n    }\r\n\r\n    const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n    if (!glossaryBtn.classList.contains('disabled-link')) {\r\n      glossaryBtn.classList.add('disabled-link');\r\n    }\r\n\r\n    if (emptyFormat) {\r\n      clearCapturedFormatting();\r\n    }\r\n    else {\r\n      if (capturedFormatting.Bold === null || capturedFormatting.Bold === undefined ||\r\n        capturedFormatting.Underline === 'Mixed' || capturedFormatting.Underline === undefined ||\r\n        capturedFormatting.Size === null || capturedFormatting.Size === undefined ||\r\n        capturedFormatting[\"Font Name\"] === null || capturedFormatting[\"Font Name\"] === undefined ||\r\n        capturedFormatting[\"Background Color\"] === '' || capturedFormatting[\"Background Color\"] === undefined ||\r\n        capturedFormatting[\"Text Color\"] === '' || capturedFormatting[\"Text Color\"] === undefined) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n\r\n\r\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n          removeFormatBtn.classList.add('disabled-link');\r\n        }\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.classList.remove('disabled-link');\r\n        displayCapturedFormatting();\r\n      }\r\n    }\r\n    // Event listeners for the buttons\r\n\r\n    document.getElementById(\"capture-format-btn\").addEventListener(\"click\", captureFormatting);\r\n\r\n    const emptyFormatCheckbox = document.getElementById(\"empty-format-checkbox\") as HTMLInputElement;\r\n    if (isNoFormatTextAvailable) {\r\n      emptyFormatCheckbox.checked = true;\r\n      clearCapturedFormatting();\r\n    }\r\n\r\n    emptyFormatCheckbox.addEventListener(\"change\", () => {\r\n      if (emptyFormatCheckbox.checked) {\r\n        isNoFormatTextAvailable = true;\r\n        clearCapturedFormatting();\r\n      } else {\r\n        const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n        CaptureBtn.disabled = false;\r\n        isNoFormatTextAvailable = false;\r\n        emptyFormat = false;\r\n        const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n        if (!glossaryBtn.classList.contains('disabled-link')) {\r\n          glossaryBtn.classList.add('disabled-link');\r\n        }\r\n      }\r\n    });\r\n\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayCapturedFormatting() {\r\n  emptyFormat = false;\r\n  const formatList = document.getElementById(\"format-list\");\r\n  formatList.innerHTML = \"\"; // Clear the list before adding new items\r\n\r\n  for (const [key, value] of Object.entries(capturedFormatting)) {\r\n    if ((key === \"Text Color\" || key === \"Background Color\") && value) {\r\n      formatList.innerHTML += `\r\n        <li><strong>${key}:</strong>${value}\r\n          <span style=\"display:inline-block;width:15px;height:15px;background-color:${value};border:1px solid black;\"></span>\r\n        </li>\r\n      `;\r\n    } else {\r\n      formatList.innerHTML += `<li><strong>${key}:</strong> ${value}</li>`;\r\n    }\r\n  }\r\n}\r\n\r\nfunction clearCapturedFormatting() {\r\n  capturedFormatting = {}; // Clear the captured formatting object\r\n  const formatDetails = document.getElementById(\"format-details\");\r\n  formatDetails.style.display = 'none';\r\n  // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n  emptyFormat = true;\r\n  const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n  glossaryBtn.classList.remove('disabled-link');\r\n  const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n  CaptureBtn.disabled = true;\r\n\r\n\r\n  const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n  if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n    removeFormatBtn.classList.add('disabled-link');\r\n  }\r\n  console.log(\"Captured formatting cleared.\");\r\n}\r\n\r\nasync function captureFormatting() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n      const font = selection.font;\r\n      font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n\r\n      await context.sync();\r\n\r\n      capturedFormatting = {\r\n        Bold: font.bold,\r\n        Italic: font.italic,\r\n        Underline: font.underline,\r\n        Size: font.size,\r\n        \"Background Color\": font.highlightColor,\r\n        \"Font Name\": font.name,\r\n        'Text Color': font.color\r\n      };\r\n\r\n\r\n\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'block';\r\n\r\n      if (capturedFormatting.Bold === null ||\r\n        capturedFormatting.Underline === 'Mixed' ||\r\n        capturedFormatting.Size === null ||\r\n        capturedFormatting[\"Font Name\"] === null ||\r\n        capturedFormatting[\"Background Color\"] === '' ||\r\n        capturedFormatting[\"Text Color\"] === ''\r\n\r\n      ) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n          removeFormatBtn.classList.add('disabled-link');\r\n        }\r\n\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.classList.remove('disabled-link');\r\n        displayCapturedFormatting();\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error capturing formatting:\", error);\r\n  }\r\n}\r\n\r\n\r\n\r\nasync function removeOptionsConfirmation() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    } // Check if isTagUpdating is false\r\n    const htmlBody = `\r\n      <div class=\"container mt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n            <h5 class=\"card-title\">Are you sure you want to remove formatted text ?</h5>\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div id=\"format-details\">\r\n              <h5>Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled mb-3\"></ul>\r\n              <small class=\"text-secondary font-italic\" id=\"warning-rem-fmt\"></small>\r\n             \r\n            </div>\r\n               <!-- Buttons for Capture and Empty Format -->\r\n            <div class=\"d-flex justify-content-end mt-2\">\r\n              <button id=\"change-ft-btn\" class=\"btn btn-danger bg-danger-clr px-3 me-2\"><i class=\"fa fa-reply me-2\"></i>Cancel</button>\r\n              <button id=\"clear-ft-btn\" class=\"btn btn-success bg-success-clr px-3\"><i class=\"fa fa-check-circle me-2\"></i>Yes</button>\r\n\r\n            </div>\r\n\r\n            \r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    displayCapturedFormatting();\r\n\r\n    if (capturedFormatting['Background Color'] === null &&\r\n      capturedFormatting['Text Color'] === '#000000') {\r\n      const warningEle = document.getElementById('warning-rem-fmt').innerHTML = 'Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?'\r\n    }\r\n\r\n    // Event listeners for the buttons\r\n    document.getElementById(\"clear-ft-btn\").addEventListener(\"click\", removeFormattedText);\r\n    document.getElementById(\"change-ft-btn\").addEventListener(\"click\", formatOptionsDisplay);\r\n\r\n  }\r\n}\r\n\r\nasync function removeFormattedText() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n\r\n      const iconelement = document.getElementById(`clear-ft-btn`);\r\n      iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Yes`;\r\n      const clrBtn = document.getElementById('clear-ft-btn') as HTMLButtonElement;\r\n      clrBtn.disabled = true;\r\n\r\n      const changeBtn = document.getElementById('change-ft-btn') as HTMLButtonElement;\r\n      changeBtn.disabled = true;\r\n      const paragraphs = context.document.body.paragraphs;\r\n      paragraphs.load(\"items\"); // Load paragraphs from the body\r\n\r\n      await context.sync();\r\n\r\n      // Iterate through each paragraph in the document body\r\n      for (const paragraph of paragraphs.items) {\r\n        // Check if the paragraph contains text\r\n        if (paragraph.text.trim() !== \"\") {\r\n          const textRanges = paragraph.split([\" \"]); // Split paragraph into individual words/segments\r\n          textRanges.load(\"items, font\");\r\n\r\n          await context.sync();\r\n\r\n          for (const range of textRanges.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n\r\n            // Check if the text range matches the captured formatting\r\n            if (\r\n              font.highlightColor === capturedFormatting['Background Color'] &&\r\n              font.color === capturedFormatting['Text Color'] &&\r\n              font.bold === capturedFormatting['Bold'] &&\r\n              font.italic === capturedFormatting['Italic'] &&\r\n              font.size === capturedFormatting['Size'] &&\r\n              font.underline === capturedFormatting['Underline'] &&\r\n              font.name === capturedFormatting['Font Name']\r\n            ) {\r\n              // Clear the range whether it's a full word or part of a word\r\n              font.highlightColor = \"#FFFFFF\"; // Set new background color\r\n              font.color = \"#000000\"; // Set new text color\r\n              font.bold = false; // Reset bold if needed\r\n              font.italic = false; // Reset italic if needed\r\n              font.underline = \"None\";\r\n              paragraph.insertText(\" \", Word.InsertLocation.replace);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n      capturedFormatting = {}; // Clear the captured formatting object\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n      emptyFormat = true;\r\n      isNoFormatTextAvailable = true;\r\n      const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n      glossaryBtn.classList.remove('disabled-link');\r\n      formatOptionsDisplay()\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing formatted text:\", error);\r\n  }\r\n}\r\n\r\n\r\nexport async function fetchAIHistory(tag) {\r\n  try {\r\n\r\n    const data = await getAiHistory(tag.ID, jwt);\r\n\r\n\r\n    if (data.Status && data.Data) {\r\n      tag.ReportHeadAIHistoryList = data['Data'] || [];\r\n      tag.FilteredReportHeadAIHistoryList = [];\r\n      tag.ReportHeadAIHistoryList.forEach((historyList, i) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n\r\n      });\r\n      return tag.FilteredReportHeadAIHistoryList;\r\n      // Use the data here\r\n    } else {\r\n      console.warn(\"No AI history available.\");\r\n    }\r\n\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching AI history:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function sendPrompt(tag, prompt) {\r\n  if (prompt !== '' && !isTagUpdating) {\r\n\r\n    isTagUpdating = true;\r\n\r\n    const iconelement = document.getElementById(`sendPromptButton`);\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`;\r\n\r\n    const payload = {\r\n      ReportHeadID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadID,\r\n      DocumentID: dataList.NCTID,\r\n      DocumentType: dataList.DocumentType,\r\n      TextSetting: dataList.TextSetting,\r\n      DocumentTemplate: dataList.ReportTemplate,\r\n      ReportHeadGroupKeyID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,\r\n      ThreadID: tag.ThreadID,\r\n      AssistantID: dataList.AssistantID,\r\n      Container: dataList.Container,\r\n      GroupName: GroupName,\r\n      Prompt: prompt,\r\n      PromptType: 1,\r\n      Response: '',\r\n      VectorID: dataList.VectorID,\r\n      Selected: 0,\r\n      ID: 0,\r\n      SourceValue: tag.SourceValue ? tag.SourceValue : []\r\n    };\r\n\r\n    try {\r\n      isPendingResponse = true;\r\n      const data = await addAiHistory(payload, jwt);\r\n\r\n      if (data['Data'] && data['Data'] !== 'false') {\r\n        tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n        tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n        tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n          historyList.Response = removeQuotes(historyList.Response);\r\n          tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n        });\r\n\r\n        const appbody = document.getElementById('app-body')\r\n        appbody.innerHTML = await generateCheckboxHistory(tag);\r\n        isPendingResponse = false;\r\n\r\n      }\r\n\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      document.getElementById(`chatInput`).value = '';\r\n      isTagUpdating = false;\r\n      isPendingResponse = false;\r\n      // sourceListBtn.disabled = false;\r\n\r\n    } catch (error) {\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      isTagUpdating = false;\r\n      isPendingResponse = false;\r\n      console.error('Error sending AI prompt:', error);\r\n    }\r\n  } else {\r\n    console.error('No empty prompt allowed');\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n// Your existing copyText function\r\n\r\n\r\n\r\nasync function logout() {\r\n  if (isGlossaryActive) {\r\n    await removeMatchingContentControls();\r\n  }\r\n  sessionStorage.clear();\r\n  window.location.hash = '#/new';\r\n  initialised = true;\r\n  document.getElementById('logo-header').innerHTML = ``;\r\n  login();\r\n}\r\n\r\nfunction addAccordionListeners() {\r\n  const accordionButtons = document.querySelectorAll('.accordion-button');\r\n\r\n  accordionButtons.forEach(button => {\r\n    button.addEventListener('click', function () {\r\n      const collapseElement = this.nextElementSibling;\r\n\r\n      // Check if the element exists before accessing its classList\r\n      if (collapseElement && collapseElement.classList) {\r\n        collapseElement.classList.toggle('show');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction addCopyListeners() {\r\n  const copyIcons = document.querySelectorAll('.fa-copy');\r\n  copyIcons.forEach(icon => {\r\n    icon.addEventListener('click', function () {\r\n      const textToCopy = this.closest('.p-2').querySelector('.form-control').textContent;\r\n    });\r\n  });\r\n}\r\n\r\nexport async function applyAITagFn() {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const body = context.document.body;\r\n      context.load(body, 'text');\r\n      await context.sync();\r\n\r\n      // Iterate over the aiTagList to search and replace\r\n      for (let i = 0; i < aiTagList.length; i++) {\r\n        const tag = aiTagList[i];\r\n        // Clean up the EditorValue by removing quotes\r\n        tag.EditorValue = removeQuotes(tag.EditorValue);\r\n\r\n        // Search for all instances of the tag.DisplayName enclosed with `#`\r\n        const searchResults = body.search(`#${tag.DisplayName}#`, {\r\n          matchCase: false,\r\n          matchWholeWord: false,\r\n        });\r\n\r\n        // Load the search results to ensure they are available for further operations\r\n        context.load(searchResults, 'items');\r\n\r\n        await context.sync(); // Synchronize to fetch the search results\r\n\r\n        // Log the number of search results for debugging\r\n        console.log(`Found ${searchResults.items.length} instances of #${tag.DisplayName}#`);\r\n        const tableInsertPositions: { range: Word.Range, tag: any }[] = [];\r\n\r\n        // Replace each found instance with tag.EditorValue\r\n        searchResults.items.forEach((item: any) => {\r\n          // Ensure the EditorValue is not empty before replacing\r\n          if (tag.EditorValue !== \"\" && !tag.IsApplied) {\r\n            if (tag.ComponentKeyDataType === 'TABLE') {\r\n              const range = item.getRange();\r\n              tableInsertPositions.push({ range, tag });\r\n              range.delete();\r\n            } else {\r\n              item.insertText(tag.EditorValue, Word.InsertLocation.replace);\r\n            }\r\n          }\r\n        });\r\n\r\n        for (const { range, tag } of tableInsertPositions) {\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(tag.EditorValue, 'text/html');\r\n\r\n          const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n          for (const node of bodyNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n              const textContent = node.textContent?.trim();\r\n              if (textContent) {\r\n                textContent.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    insertLineWithHeadingStyle(range, line);\r\n                  }\r\n                });\r\n              }\r\n            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n              const element = node as HTMLElement;\r\n\r\n              if (element.tagName.toLowerCase() === 'table') {\r\n                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                if (rows.length === 0) {\r\n                  range.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                  continue;\r\n                }\r\n\r\n                const maxCols = Math.max(...rows.map(row => {\r\n                  return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                  }, 0);\r\n                }));\r\n\r\n                const paragraph = range.insertParagraph(\"\", Word.InsertLocation.before);\r\n                await context.sync();\r\n\r\n                const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                table.style = \"Grid Table 4 - Accent 1\";  // Apply built-in Word table style\r\n\r\n                await context.sync();\r\n\r\n                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                    // if (rowIndex === 0) {\r\n                    //   const cell = table.getCell(rowIndex, cellIndex);\r\n                    //   const paragraph = cell.body.paragraphs.getFirst();\r\n                    //   paragraph.font.bold = true;\r\n                    //   paragraph.font.highlightColor = \"lightGray\";  // This works!\r\n                    // }\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < maxCols) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < maxCols) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n                });\r\n              } else {\r\n                const elementText = element.innerText.trim();\r\n                if (elementText) {\r\n                  elementText.split('\\n').forEach(line => {\r\n                    if (line.trim()) {\r\n                      insertLineWithHeadingStyle(range, line);\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // Additional sync after each replacement\r\n        await context.sync();\r\n      }\r\n\r\n      // Final sync to apply all changes\r\n      await context.sync();\r\n    } catch (err) {\r\n      console.error(\"Error during tag application:\", err);\r\n    }\r\n  });\r\n}\r\n\r\n\r\n\r\n\r\nasync function onRadioChange(tag, tagIndex, chatIndex) {\r\n  if (!isTagUpdating) {\r\n    isTagUpdating = true;\r\n    const iconelement = document.getElementById(`sendPrompt-${tagIndex}`)\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`\r\n    const chat = tag.FilteredReportHeadAIHistoryList[chatIndex];\r\n    let payload = JSON.parse(JSON.stringify(chat));\r\n    payload.Container = dataList.Container;\r\n    payload.Selected = 1;\r\n    const matchingKey = availableKeys.find(prop => prop.DisplayName === tag.DisplayName);\r\n    if (matchingKey) {\r\n      matchingKey.EditorValue = payload.Response;\r\n    }\r\n    try {\r\n\r\n      const data = await updateAiHistory(payload, jwt);\r\n\r\n      if (data['Data']) {\r\n        tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n        tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n        tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n          historyList.Response = removeQuotes(historyList.Response);\r\n          tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n        });\r\n\r\n        const selectedParent = document.getElementById(`selected-response-parent-${tagIndex}`);\r\n        const allSelectedDivs = selectedParent.querySelectorAll('.ai-selected-reply');\r\n        allSelectedDivs.forEach(div => {\r\n          div.classList.remove('ai-selected-reply');\r\n          div.classList.add('bg-light');\r\n        });\r\n\r\n        const selectElement = document.getElementById(`selected-response-${tagIndex}${chatIndex}`);\r\n        if (selectElement) {\r\n          selectElement.classList.remove('bg-light');\r\n          selectElement.classList.add('ai-selected-reply');\r\n        }\r\n\r\n        const finalResponse = chat.FormattedResponse\r\n          ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n          : chat.Response;\r\n\r\n        tag.ComponentKeyDataType = chat.FormattedResponse ? 'TABLE' : 'TEXT';\r\n        tag.UserValue = finalResponse;\r\n        tag.EditorValue = finalResponse;\r\n        tag.text = finalResponse;\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error updating AI data:', error);\r\n    } finally {\r\n      const iconelement = document.getElementById(`sendPrompt-${tagIndex}`);\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      isTagUpdating = false;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nfunction selectResponse(tagIndex, chatIndex) {\r\n  // Handle the response selection logic here\r\n  console.log(`Response selected for tagIndex ${tagIndex}, chatIndex ${chatIndex}`);\r\n}\r\n\r\n\r\nasync function fetchGlossary() {\r\n  if (!isTagUpdating) {\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n    loadGlossary()\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction loadGlossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n        <div id=\"button-container\">\r\n          <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n        </div>\r\n  `\r\n  document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport async function applyglossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n  try {\r\n\r\n    await Word.run(async (context) => {\r\n\r\n\r\n      const body = context.document.body;\r\n      body.load(\"text\");\r\n      await context.sync(); // Sync to get the text content\r\n\r\n      const bodyText = {\r\n        \"Content\": body.text.replace(/[\\n\\r]/g, ' ')\r\n      };\r\n      try {\r\n\r\n        const data = await fetchGlossaryTemplate(dataList?.ClientID, bodyText, jwt);\r\n\r\n        layTerms = data.Data;\r\n\r\n        if (data.Data.length > 0) {\r\n          glossaryName = data.Data[0].GlossaryTemplate;\r\n          loadGlossary();\r\n        } else {\r\n          document.getElementById('app-body').innerHTML = `\r\n            <p class=\"text-center\">Data not available</p>\r\n          `;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching glossary data:', error);\r\n      }\r\n      // Sort terms by length (longest first)\r\n      layTerms.sort((a, b) => b.ClinicalTerm.length - a.ClinicalTerm.length);\r\n\r\n      const processedTerms = new Set(); // Track added larger terms\r\n\r\n      // Filter out smaller terms if they are included in a larger term\r\n      const filteredTerms = layTerms.filter(term => {\r\n        for (const biggerTerm of processedTerms) {\r\n          if (typeof biggerTerm === 'string' && biggerTerm.includes(term.ClinicalTerm.toLowerCase())) {\r\n            console.log(`Skipping \"${term.ClinicalTerm}\" because it's part of \"${biggerTerm}\"`);\r\n            return false; // Exclude this smaller term\r\n          }\r\n        }\r\n        processedTerms.add(term.ClinicalTerm.toLowerCase());\r\n        return true;\r\n      });\r\n\r\n      filteredGlossaryTerm = filteredTerms;\r\n      await removeMatchingContentControls();\r\n\r\n      const foundRanges = new Map(); // Track words already processed\r\n\r\n      const searchPromises = filteredGlossaryTerm.map(term => {\r\n        const searchResults = body.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load(\"items\");\r\n        return searchResults;\r\n      });\r\n\r\n      await context.sync();\r\n\r\n      for (const searchResults of searchPromises) {\r\n\r\n        for (const range of searchResults.items) {\r\n\r\n          if (!range || !range.text) {\r\n            console.log(\"Invalid range. Skipping...\");\r\n            continue;\r\n          }\r\n\r\n          // Load existing content controls inside this range\r\n          const font = range.font;\r\n          font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n          range.load(\"contentControls\");\r\n          await context.sync();\r\n\r\n          const existingControl = range.contentControls.items.length > 0;\r\n\r\n          if (existingControl) {\r\n            console.log(`Skipping \"${range.text}\" because it already has a content control.`);\r\n            continue; // Skip if content control is already present\r\n          }\r\n          // Check if we've already processed this term at this range\r\n          if (foundRanges.has(range.text)) {\r\n            console.log(`Skipping duplicate occurrence of \"${range.text}\"`);\r\n            continue;\r\n          }\r\n          // Mark this word as processed\r\n          foundRanges.set(range.text, true);\r\n          // Remove existing content controls if any\r\n          if (range.contentControls && range.contentControls.items.length > 0) {\r\n            console.log(`Removing existing content control from: \"${range.text}\"`);\r\n            for (const control of range.contentControls.items) {\r\n              control.delete(false); // 'false' keeps the text, only removes the control\r\n            }\r\n            await context.sync(); // Ensure deletion is applied before adding a new one\r\n          }\r\n\r\n          try {\r\n            // Insert a new content control\r\n            const contentControl = range.insertContentControl();\r\n            contentControl.title = `${range.text}`;\r\n            if (font.highlightColor !== null) {\r\n              contentControl.tag = `${font.highlightColor}`;\r\n            }\r\n            contentControl.font.highlightColor = \"yellow\"; // Highlight the control\r\n            contentControl.appearance = Word.ContentControlAppearance.boundingBox;\r\n            await context.sync();\r\n          } catch (error) {\r\n            console.error(`Error inserting content control for term \"${range.text}\":`, error);\r\n          }\r\n        }\r\n      }\r\n      // document.getElementById('glossarycheck').style.display='block';\r\n      isGlossaryActive = true;\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 clear-glossary btn-sm\" id=\"clearGlossary\">Clear Glossary</button>\r\n      </div>\r\n\r\n      <div id=\"highlighted-text\"></div>\r\n      <div class=\"d-flex justify-content-center box-loader\">\r\n       <div class=\"loader\" id=\"loader\"></div></div>\r\n      \r\n`\r\n      const displayElement = document.getElementById('loader');\r\n      displayElement.style.display = 'none';\r\n      await context.sync();\r\n      document.getElementById('clearGlossary').addEventListener('click', removeMatchingContentControls);\r\n      Office.context.document.addHandlerAsync(\r\n        Office.EventType.DocumentSelectionChanged,\r\n        handleSelectionChange\r\n      );\r\n\r\n\r\n    });\r\n\r\n    // Optional: Notify user of completion\r\n    console.log('Glossary applied successfully');\r\n  } catch (error) {\r\n    console.error('Error applying glossary:', error);\r\n    // Optional: Notify user of error\r\n    console.log('Error applying glossary. Please try again.');\r\n  }\r\n}\r\n\r\n\r\nasync function handleSelectionChange() {\r\n  await checkGlossary();\r\n}\r\n\r\nexport async function checkGlossary() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n\r\n      selection.load(\"text, font.highlightColor\");\r\n\r\n      await context.sync();\r\n\r\n\r\n\r\n      if (selection.text) {\r\n        const loader = document.getElementById('loader');\r\n        if (loader) {\r\n          loader.style.display = 'block';\r\n        }\r\n        const searchPromises = layTerms.map(term => {\r\n          const searchResults = selection.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n          searchResults.load(\"items\");\r\n          return searchResults;\r\n        });\r\n\r\n        await context.sync();\r\n        const selectedWords = []\r\n        for (const searchResults of searchPromises) {\r\n\r\n          for (const range of searchResults.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n            if (\r\n              font.highlightColor !== capturedFormatting['Background Color'] ||\r\n              font.color !== capturedFormatting['Text Color'] ||\r\n              font.bold !== capturedFormatting['Bold'] ||\r\n              font.italic !== capturedFormatting['Italic'] ||\r\n              font.size !== capturedFormatting['Size'] ||\r\n              font.underline !== capturedFormatting['Underline'] ||\r\n              font.name !== capturedFormatting['Font Name']\r\n            ) {\r\n              selectedWords.push(range.text);\r\n            }\r\n\r\n          }\r\n        }\r\n        // searchPromises.forEach(searchResults => {\r\n        //   searchResults.items.forEach(item => {\r\n        //   });\r\n        // });\r\n        displayHighlightedText(selectedWords)\r\n\r\n        await context.sync();\r\n\r\n\r\n\r\n\r\n        // const highlightColor = selection.font.highlightColor;\r\n\r\n        // if (highlightColor === \"red\") {\r\n        //   displayHighlightedText(selection.text);\r\n        // } else {\r\n        //   console.log('Selected text is not highlighted.');\r\n        // }\r\n      } else {\r\n        console.log('No text is selected.');\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error displaying glossary:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayHighlightedText(words: string[]) {\r\n\r\n  const displayElement = document.getElementById('highlighted-text');\r\n\r\n  if (displayElement) {\r\n    displayElement.innerHTML = ''; // Clear previous content\r\n    const loader = document.getElementById('loader');\r\n    loader.style.display = 'block';\r\n    // Group lay terms by their clinical term\r\n    const groupedTerms: { [clinicalTerm: string]: string[] } = {};\r\n\r\n    words.forEach(word => {\r\n      layTerms.forEach(term => {\r\n        if (term.ClinicalTerm.toLowerCase() === word.toLowerCase()) {\r\n          if (!groupedTerms[term.ClinicalTerm]) {\r\n            groupedTerms[term.ClinicalTerm] = [];\r\n          }\r\n          if (!groupedTerms[term.ClinicalTerm].includes(term.LayTerm)) {\r\n            groupedTerms[term.ClinicalTerm].push(term.LayTerm);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // Create a box for each clinical term\r\n    Object.keys(groupedTerms).forEach(clinicalTerm => {\r\n      // Create the main box for the clinical term\r\n      const mainBox = document.createElement('div');\r\n      mainBox.className = 'box'; // Add box class for styling\r\n\r\n      // Create a heading for the clinical term\r\n      const heading = document.createElement('h3');\r\n      heading.textContent = `${clinicalTerm} (${glossaryName})`;\r\n      mainBox.appendChild(heading);\r\n\r\n      // Create sub-boxes for each lay term\r\n      groupedTerms[clinicalTerm].forEach(layTerm => {\r\n        const subBox = document.createElement('div');\r\n        subBox.className = 'sub-box'; // Add class for sub-box styling\r\n        subBox.textContent = layTerm;\r\n\r\n        // Add click event listener to replace ClinicalTerm with LayTerm\r\n        subBox.addEventListener('click', async () => {\r\n          await replaceClinicalTerm(clinicalTerm, layTerm);\r\n\r\n          // Remove the main box containing the clicked sub-box\r\n          mainBox.remove();\r\n        });\r\n\r\n        mainBox.appendChild(subBox);\r\n      });\r\n\r\n      displayElement.appendChild(mainBox);\r\n    });\r\n    loader.style.display = 'none';\r\n\r\n  }\r\n}\r\nasync function replaceClinicalTerm(clinicalTerm: string, layTerm: string) {\r\n  const displayElement = document.getElementById('loader');\r\n  displayElement.style.display = 'block';\r\n\r\n  try {\r\n    await Word.run(async (context) => {\r\n      // Get the current selection\r\n      const selection = context.document.getSelection();\r\n      selection.load('text');\r\n      await context.sync();\r\n\r\n      if (selection.text.toLowerCase().includes(clinicalTerm.toLowerCase())) {\r\n        // Search for the clinicalTerm in the document\r\n        const searchResults = selection.search(clinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load('items');\r\n\r\n        await context.sync();\r\n\r\n        // Replace each occurrence of the clinicalTerm with the layTerm\r\n        for (const item of searchResults.items) {\r\n          // Load the font properties\r\n          item.font.load(['bold', 'italic', 'underline', 'color', 'highlightColor', 'size', 'name']);\r\n          await context.sync();  // Ensure the properties are loaded before accessing them\r\n\r\n          // Insert the layTerm while keeping the formatting\r\n          item.insertText(layTerm, 'replace');\r\n\r\n          // Apply the original formatting to the new text\r\n          item.font.bold = item.font.bold;\r\n          item.font.italic = item.font.italic;\r\n          item.font.underline = item.font.underline;\r\n          item.font.color = item.font.color;\r\n          item.font.highlightColor = '#c7c7c7';\r\n          item.font.size = item.font.size;\r\n          item.font.name = item.font.name;\r\n        }\r\n\r\n        await context.sync();\r\n        displayElement.style.display = 'none';\r\n        console.log(`Replaced '${clinicalTerm}' with '${layTerm}' and preserved the original formatting.`);\r\n      } else {\r\n        displayElement.style.display = 'none';\r\n        console.log(`Selected text does not contain '${clinicalTerm}'.`);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    displayElement.style.display = 'none';\r\n    console.error('Error replacing term:', error);\r\n  }\r\n}\r\n\r\n\r\nexport async function removeMatchingContentControls() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <div class=\"loader\" id=\"loader\"></div>\r\n        <div id=\"highlighted-text\"></div>`;\r\n      const body = context.document.body;\r\n\r\n      // Load all content controls\r\n      const contentControls = body.contentControls;\r\n      contentControls.load(\"items\");\r\n      await context.sync();\r\n\r\n      if (contentControls.items.length === 0) {\r\n        console.log(\"No content controls found.\");\r\n        return;\r\n      }\r\n\r\n      for (const control of contentControls.items) {\r\n        if (control.title && filteredGlossaryTerm.some(term => term.ClinicalTerm.toLowerCase() === control.title.toLowerCase())) {\r\n          const range = control.getRange();\r\n          range.load(\"text\");\r\n          await context.sync();\r\n          if (control.tag && /^#[0-9A-Fa-f]{6}$/.test(control.tag)) {\r\n            range.font.highlightColor = control.tag;\r\n          } else {\r\n            range.font.highlightColor = null\r\n          }\r\n          await context.sync();\r\n          control.delete(true);\r\n        }\r\n      }\r\n\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n      </div>\r\n      `;\r\n\r\n      await context.sync();\r\n      isGlossaryActive = false;\r\n      document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing content controls:\", error);\r\n  }\r\n}\r\n\r\n\r\nasync function displayMentions() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n\r\n  }\r\n}\r\n\r\nexport async function addGenAITags() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n    let selectedClient = clientList.filter((item) => item.ID === clientId);\r\n\r\n    let sponsorOptions = clientList.map(client => {\r\n      const isSelectedClient = selectedClient.some(selected => selected.ID === client.ID);\r\n      return ` \r\n        <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\">\r\n          <div class=\"form-check\">\r\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${client.ID}\" id=\"sponsor${client.ID}\" ${isSelectedClient ? 'checked disabled' : ''}>\r\n            <label class=\"form-check-label text-prewrap\" for=\"sponsor${client.ID}\">${client.Name}</label>\r\n          </div>\r\n        </li>\r\n      `;\r\n    }).join('');\r\n\r\n    document.getElementById('app-body').innerHTML = navTabs;\r\n    // Add modal HTML to the DOM\r\n    document.getElementById('add-tag-body').innerHTML = addtagbody(sponsorOptions);\r\n    const promptTemplateElement = document.getElementById('add-prompt-template')\r\n    setupPromptBuilderUI(promptTemplateElement, promptBuilderList)\r\n\r\n\r\n    document.getElementById('tag-tab').addEventListener('click', () => {\r\n      switchToAddTag()\r\n    });\r\n\r\n\r\n    document.getElementById('prompt-tab').addEventListener('click', () => {\r\n      switchToPromptBuilder()\r\n    });\r\n\r\n    //prompt starting\r\n    mentionDropdownFn('prompt', 'mention-dropdown', 'add');\r\n    //prompt end\r\n    const form = document.getElementById('genai-form');\r\n    const promptField = document.getElementById('prompt');\r\n\r\n    const nameField = document.getElementById('name');\r\n    const descriptionField = document.getElementById('description');\r\n    const saveGloballyCheckbox = document.getElementById('saveGlobally');\r\n    const availableForAllCheckbox = document.getElementById('isAvailableForAll');\r\n    const sponsorDropdownButton = document.getElementById('sponsorDropdown');\r\n    const sponsorDropdownItems = document.querySelectorAll('.dropdown-item .form-check-input');\r\n\r\n    document.getElementById('cancel-btn-gen-ai').addEventListener('click', () => {\r\n      if (!isPendingResponse) {\r\n        loadHomepage(availableKeys)\r\n      }\r\n    });\r\n\r\n    // Check if elements exist\r\n    if (form && nameField && promptField && sponsorDropdownItems.length > 0) {\r\n      const updateDropdownLabel = () => {\r\n        if (availableForAllCheckbox.checked) {\r\n          sponsorDropdownButton.textContent = clientList.map(client => client.Name).join(\", \");\r\n        } else {\r\n          const selectedOptions = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'selectAll')\r\n            .map(cb => cb.parentElement.textContent.trim());\r\n          sponsorDropdownButton.textContent = selectedOptions.length ? selectedOptions.join(\", \") : \"Select Sponsors\";\r\n        }\r\n      };\r\n      // Form validation logic on submit\r\n      form.addEventListener('submit', async function (e) {\r\n        e.preventDefault();\r\n\r\n        // Reset previous validation errors\r\n        form.querySelectorAll('.is-invalid').forEach(input => input.classList.remove('is-invalid'));\r\n\r\n        let valid = true;\r\n\r\n        if (!(nameField as HTMLInputElement).value.trim()) {\r\n          nameField.classList.add('is-invalid');\r\n          valid = false;\r\n        }\r\n\r\n        if (!(promptField as HTMLInputElement).value.trim()) {\r\n          promptField.classList.add('is-invalid');\r\n          valid = false;\r\n        }\r\n\r\n        if (valid) {\r\n          // Prepare object to pass to createTextGenTag\r\n          const selectedSponsors = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'selectAll')\r\n            .map(cb => {\r\n              const client = clientList.find(client => client.ID == cb.value);\r\n              return client; // Collect the entire client object\r\n            });\r\n\r\n          const isAvailableForAll = availableForAllCheckbox.checked;\r\n          const isSaveGlobally = saveGloballyCheckbox.checked;\r\n          const aigroup = dataList.Group.find(element => element.DisplayName === 'AIGroup');\r\n          const formData = {\r\n            DisplayName: nameField.value.trim(),\r\n            Prompt: promptField.value.trim(),\r\n            Description: descriptionField.value.trim(),\r\n            GroupKeyClient: selectedSponsors, // Array of selected sponsor objects\r\n            AllClient: isAvailableForAll ? 1 : 0,\r\n            SaveGlobally: isSaveGlobally,\r\n            UserDefined: '1',\r\n            ComponentKeyDataTypeID: '1',\r\n            ComponentKeyDataAccessID: '3',\r\n            AIFlag: 1,\r\n            DocumentTypeID: dataList.DocumentTypeID,\r\n            ReportHeadID: dataList.ID,\r\n            SourceTypeID: '',\r\n            ReportHeadGroupID: aigroup.ID,\r\n            ReportHeadSourceID: ''\r\n          };\r\n\r\n          await createTextGenTag(formData);\r\n        }\r\n      });\r\n\r\n\r\n      const checkAndDisableSponsors = () => {\r\n        sponsorDropdownItems.forEach(checkbox => {\r\n          if (!checkbox.disabled) {\r\n            checkbox.checked = true;\r\n            checkbox.disabled = true;\r\n          }\r\n        });\r\n        updateDropdownLabel();\r\n      };\r\n\r\n      // Function to enable sponsors without unchecking them\r\n      const enableSponsors = () => {\r\n        sponsorDropdownItems.forEach(checkbox => {\r\n          const isSelectedClient = selectedClient.some(selected => selected.ID === parseInt(checkbox.value));\r\n          if (!isSelectedClient) {\r\n            checkbox.disabled = false;\r\n          }\r\n        });\r\n        updateDropdownLabel();\r\n      };\r\n\r\n      // Event listener for \"Save Globally\" checkbox\r\n\r\n\r\n      // Event listener for \"Available to All Sponsors\" checkbox\r\n\r\n      saveGloballyCheckbox.addEventListener('change', function () {\r\n        if (!isPendingResponse) {\r\n          if (this.checked) {\r\n            availableForAllCheckbox.disabled = false;\r\n            sponsorDropdownButton.disabled = false;\r\n          } else {\r\n            enableSponsors();\r\n            availableForAllCheckbox.checked = false;\r\n            availableForAllCheckbox.disabled = true;\r\n            sponsorDropdownButton.disabled = true;\r\n            sponsorDropdownItems.forEach(checkbox => {\r\n              if (!checkbox.disabled) {\r\n                checkbox.checked = false;\r\n                checkbox.disabled = false;\r\n              }\r\n            });\r\n            updateDropdownLabel();\r\n          }\r\n        }\r\n      });\r\n\r\n      // Event listener for \"Available to All Sponsors\" checkbox\r\n      availableForAllCheckbox.addEventListener('change', function () {\r\n        if (!isPendingResponse) {\r\n\r\n          if (this.checked) {\r\n            checkAndDisableSponsors();\r\n          } else {\r\n            enableSponsors();\r\n          }\r\n        }\r\n      });\r\n\r\n      // Add event listener to prevent dropdown close on item selection\r\n      document.querySelectorAll('.dropdown-item').forEach(item => {\r\n        item.addEventListener('click', function (event) {\r\n          {\r\n            event.stopPropagation(); // Prevent dropdown from closing\r\n            const checkbox = this.querySelector('.form-check-input');\r\n            if (checkbox) {\r\n\r\n\r\n              if (checkbox.id === 'selectAll') {\r\n                const isChecked = checkbox.checked;\r\n                sponsorDropdownItems.forEach(cb => {\r\n                  if (!cb.disabled) cb.checked = isChecked;\r\n                });\r\n              }\r\n              updateDropdownLabel();\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n      // Initial label update\r\n      updateDropdownLabel();\r\n\r\n\r\n      // Clear validation errors when user types\r\n      [nameField, promptField].forEach(field => {\r\n        field.addEventListener('input', function () {\r\n          if (this.classList.contains('is-invalid') && this.value.trim()) {\r\n            this.classList.remove('is-invalid');\r\n          }\r\n          if (nameField) {\r\n            const errorDiv = document.getElementById('submition-error');\r\n            errorDiv.style.display = 'none';\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      console.error('Required elements are missing or not rendered yet.');\r\n    }\r\n  }\r\n}\r\n\r\n\r\nasync function createTextGenTag(payload) {\r\n  try {\r\n    const iconelement = document.getElementById(`text-gen-save`);\r\n    const cancelBtnGenAi = document.getElementById('cancel-btn-gen-ai');\r\n\r\n\r\n    (cancelBtnGenAi as HTMLButtonElement).disabled = true;\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Save`;\r\n    (iconelement as HTMLButtonElement).disabled = true;\r\n    isPendingResponse = true;\r\n\r\n    const data = await addGroupKey(payload, jwt);\r\n    isPendingResponse = false;\r\n\r\n    if (data['Data'] && data['Status']) {\r\n      fetchDocument('AIpanel');\r\n    } else {\r\n      (cancelBtnGenAi as HTMLButtonElement).disabled = false;\r\n      (iconelement as HTMLButtonElement).disabled = false;\r\n      iconelement.innerHTML = `<i class=\"fa fa-check-circle me-2\"></i>Save`;\r\n      showAddTagError(data['Data']);\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Error creating text generation tag:', error);\r\n  }\r\n}\r\n\r\n\r\nexport function mentionDropdownFn(textareaId, DropdownId, action) {\r\n  const filterMentions = (query) => {\r\n    // Assuming availableKeys is an array of objects with DisplayName and EditorValue properties\r\n    const filtered = availableKeys.filter(item => item.AIFlag === 0).filter(item =>\r\n      item.DisplayName.toLowerCase().includes(query.toLowerCase())\r\n    );\r\n    return filtered;\r\n  };\r\n  let highlightedIndex = -1;\r\n\r\n  const promptField = document.getElementById(`${textareaId}`);\r\n  const mentionDropdown = document.getElementById(`${DropdownId}`);\r\n  if (promptField) {\r\n\r\n    // Handle input events on prompt field for mentions\r\n    promptField.addEventListener('input', (e) => {\r\n      const cursorPosition = promptField.selectionStart;\r\n      const textBeforeCursor = promptField.value.slice(0, cursorPosition);\r\n      const lastHashtag = textBeforeCursor.lastIndexOf('#');\r\n      if (lastHashtag !== -1) {\r\n        const query = textBeforeCursor.slice(lastHashtag + 1).trim();\r\n        if (query.length > 0) {\r\n          const mentions = filterMentions(query);\r\n\r\n          if (mentions.length > 0) {\r\n            mentionDropdown.innerHTML = mentions.map(item => {\r\n              let editorValue = '';\r\n              if (action === 'add') {\r\n                editorValue = `#${item.DisplayName}#`;\r\n              } else {\r\n                editorValue = item.EditorValue || `#${item.DisplayName}#`;\r\n              }\r\n\r\n              return `<li class=\"dropdown-item\" data-editor-value=\"${editorValue}\">${item.DisplayName}</li>`;\r\n            }).join('');\r\n\r\n            // Get the position of the textarea and place the dropdown above it\r\n            const textareaRect = promptField.getBoundingClientRect();\r\n            mentionDropdown.style.left = `${textareaRect.left}px`;\r\n            mentionDropdown.style.bottom = `75px`; // Position above the textarea\r\n            mentionDropdown.style.display = 'block';\r\n          } else {\r\n            mentionDropdown.style.display = 'none';\r\n          }\r\n        } else {\r\n          mentionDropdown.style.display = 'none';\r\n        }\r\n      } else {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n\r\n    });\r\n\r\n    // Handle keyboard navigation in the dropdown\r\n    promptField.addEventListener('keydown', (e) => {\r\n      const items = document.querySelectorAll(`#${DropdownId} .dropdown-item`);\r\n      const totalItems = items.length;\r\n\r\n      if (e.key === 'ArrowDown') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight down and wrap around to the top if at the end\r\n        if (highlightedIndex < totalItems - 1) {\r\n          highlightedIndex++;\r\n        } else {\r\n          highlightedIndex = 0; // Wrap to the first item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'ArrowUp') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight up and wrap around to the bottom if at the top\r\n        if (highlightedIndex > 0) {\r\n          highlightedIndex--;\r\n        } else {\r\n          highlightedIndex = totalItems - 1; // Wrap to the last item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'Enter' && highlightedIndex !== -1) {\r\n        // Select the highlighted item\r\n        const selectedItem = items[highlightedIndex];\r\n        if (selectedItem) {\r\n          selectMention(selectedItem.getAttribute('data-editor-value'));\r\n          mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n          e.preventDefault();  // Prevent form submission on Enter key\r\n        }\r\n      }\r\n    });\r\n\r\n    // Function to highlight the selected item\r\n    function updateHighlightedItem(id) {\r\n      const items = document.querySelectorAll(`#${id} .dropdown-item`);\r\n      const dropdown = document.getElementById(`${id}`);\r\n      const totalItems = items.length;\r\n\r\n      // Remove the 'active' class from all items\r\n      items.forEach(item => item.classList.remove('active'));\r\n\r\n      // Add the 'active' class to the currently highlighted item\r\n      if (highlightedIndex >= 0 && highlightedIndex < totalItems) {\r\n        const highlightedItem = items[highlightedIndex];\r\n        highlightedItem.classList.add('active');\r\n\r\n        // Ensure the highlighted item is visible within the dropdown\r\n        highlightedItem.scrollIntoView({\r\n          behavior: 'smooth',    // Smooth scroll\r\n          block: 'nearest'      // Scroll only if necessary\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n\r\n    // Handle selecting an item from the dropdown via mouse click\r\n    mentionDropdown.addEventListener('click', (e) => {\r\n      if (e.target && e.target.matches('li')) {\r\n        const editorValue = e.target.getAttribute('data-editor-value');\r\n        selectMention(editorValue);\r\n        mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n      }\r\n    });\r\n\r\n    // Function to insert the selected mention into the prompt field\r\n    const selectMention = (editorValue) => {\r\n      const textarea = document.getElementById(`${textareaId}`);\r\n      const currentValue = textarea.value;\r\n      const cursorPosition = textarea.selectionStart;\r\n\r\n      const textBefore = currentValue.slice(0, cursorPosition);\r\n      const textAfter = currentValue.slice(cursorPosition);\r\n\r\n      const lastHashPosition = textBefore.lastIndexOf('#');\r\n      const updatedTextBefore = textBefore.slice(0, lastHashPosition); // Removing '#' symbol\r\n\r\n      textarea.value = `${updatedTextBefore}${editorValue}${textAfter}`;\r\n      const newCursorPosition = updatedTextBefore.length + editorValue.length;\r\n      textarea.setSelectionRange(newCursorPosition, newCursorPosition);\r\n    };\r\n\r\n    // Hide the dropdown if clicked outside\r\n    document.addEventListener('click', (e) => {\r\n      if (!mentionDropdown.contains(e.target) && e.target !== promptField) {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const selection = context.document.getSelection();\r\n      await context.sync();\r\n\r\n      if (!selection) {\r\n        throw new Error('Selection is invalid or not found.');\r\n      }\r\n\r\n      if (type === 'TABLE') {\r\n        const parser = new DOMParser();\r\n        const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n\r\n        const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n        for (const node of bodyNodes) {\r\n          if (node.nodeType === Node.TEXT_NODE) {\r\n            const textContent = node.textContent?.trim();\r\n            if (textContent) {\r\n              textContent.split('\\n').forEach(line => {\r\n                if (line.trim()) {\r\n                  insertLineWithHeadingStyle(selection, line);\r\n                }\r\n              });\r\n            }\r\n          } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n            const element = node as HTMLElement;\r\n\r\n            if (element.tagName.toLowerCase() === 'table') {\r\n              const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n              if (rows.length === 0) {\r\n                selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                continue;\r\n              }\r\n\r\n              const maxCols = Math.max(...rows.map(row => {\r\n                return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                  return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                }, 0);\r\n              }));\r\n\r\n              const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n              await context.sync();\r\n\r\n              const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n              table.style = \"Grid Table 4 - Accent 1\";  // Apply built-in Word table style\r\n\r\n              await context.sync();\r\n\r\n              const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n              rows.forEach((row, rowIndex) => {\r\n                const cells = Array.from(row.querySelectorAll('td, th'));\r\n                let cellIndex = 0;\r\n\r\n                cells.forEach((cell) => {\r\n                  while (rowspanTracker[cellIndex] > 0) {\r\n                    rowspanTracker[cellIndex]--;\r\n                    cellIndex++;\r\n                  }\r\n\r\n                  const cellText = Array.from(cell.childNodes)\r\n                    .map(node => {\r\n                      if (node.nodeType === Node.TEXT_NODE) {\r\n                        return node.textContent?.trim() || '';\r\n                      } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        return (node as HTMLElement).innerText.trim();\r\n                      }\r\n                      return '';\r\n                    })\r\n                    .filter(text => text.length > 0)\r\n                    .join(' ');\r\n\r\n                  const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                  const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                  // if (rowIndex === 0) {\r\n                  //   const cell = table.getCell(rowIndex, cellIndex);\r\n                  //   const paragraph = cell.body.paragraphs.getFirst();\r\n                  //   paragraph.font.bold = true;\r\n                  //   paragraph.font.highlightColor = \"lightGray\";  // This works!\r\n                  // }\r\n                  table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                  for (let i = 1; i < colspan; i++) {\r\n                    if (cellIndex + i < maxCols) {\r\n                      table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                    }\r\n                  }\r\n\r\n                  if (rowspan > 1) {\r\n                    for (let i = 0; i < colspan; i++) {\r\n                      if (cellIndex + i < maxCols) {\r\n                        rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                      }\r\n                    }\r\n                  }\r\n\r\n                  cellIndex += colspan;\r\n                });\r\n              });\r\n            } else {\r\n              const elementText = element.innerText.trim();\r\n              if (elementText) {\r\n                elementText.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    insertLineWithHeadingStyle(selection, line);\r\n                  }\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      else {\r\n        if (word.EditorValue === '' || word.IsApplied) {\r\n          selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n        } else {\r\n          let content = removeQuotes(word.EditorValue);\r\n          let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n\r\n          lines.forEach(line => {\r\n            selection.insertParagraph(line, Word.InsertLocation.before);\r\n          });\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n    } catch (error) {\r\n      console.error('Detailed error:', error);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nfunction insertLineWithHeadingStyle(range: Word.Range, line: string) {\r\n  let style = \"Normal\";\r\n  let text = line;\r\n\r\n  if (line.startsWith('###### ')) {\r\n    style = \"Heading 6\";\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith('##### ')) {\r\n    style = \"Heading 5\";\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith('#### ')) {\r\n    style = \"Heading 4\";\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith('### ')) {\r\n    style = \"Heading 3\";\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith('## ')) {\r\n    style = \"Heading 2\";\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith('# ')) {\r\n    style = \"Heading 1\";\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  const paragraph = range.insertParagraph(text, Word.InsertLocation.before);\r\n  paragraph.style = style;\r\n}\r\n\r\n\r\n\r\nfunction removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\nfunction showAddTagError(message) {\r\n  const errorDiv = document.getElementById('submition-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction transformDocumentName(value: string): string {\r\n  if (!value || value.trim() === '') {\r\n    return value; // Return the input value unchanged\r\n  }\r\n\r\n  const parts = value.split('_');\r\n  if (parts.length <= 1) {\r\n    return value; // Return the input value unchanged if no underscores are present\r\n  }\r\n\r\n  return parts.slice(1).join('_').replace(/%20/g, ' ').replace(/%25/g, '%');\r\n}\r\n\r\n\r\n\r\nexport function createMultiSelectDropdown(tag) {\r\n\r\n  // Get the current scroll position\r\n\r\n  const multiSelectHTML = `\r\n  <div class='p-3 bg-light w-100'>\r\n    <div class=\"mb-3\">\r\n      <label for=\"source-select\" class=\"form-label\"><span class=\"text-danger\">*</span> Select Sources</label>\r\n      <div class=\"dropdown w-100\">\r\n        <button \r\n          class=\"btn btn-light border w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources\" \r\n          type=\"button\" \r\n          id=\"sourceDropdown\" \r\n          data-bs-toggle=\"dropdown\" \r\n          aria-expanded=\"false\">\r\n          <span id=\"sourceDropdownLabel\" class='sourceDropdownLabel'></span>\r\n          <span class=\"dropdown-toggle-icon dropdown-toggle-icon-s\"></span>\r\n        </button>\r\n        <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sourceDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000;\">\r\n          <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\" data-checkbox-id=\"selectAll\">\r\n            <div class=\"form-check\">\r\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\r\n              <label class=\"form-check-label w-100\" for=\"selectAll\">Select All</label>\r\n            </div>\r\n          </li>\r\n          ${sourceList\r\n      .map(\r\n        (source, index) => `\r\n              <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\" data-checkbox-id=\"source-${index}\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input source-checkbox\" type=\"checkbox\" value=\"${source.SourceName}\" id=\"source-${index}\">\r\n                  <label class=\"form-check-label w-100 text-prewrap\" for=\"source-${index}\">${source.SourceName}</label>\r\n                </div>\r\n              </li>\r\n            `\r\n      )\r\n      .join('')}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n    <div class=\"d-flex justify-content-end mt-2\">\r\n      <button id=\"cancel-src-btn\" class=\"btn btn-danger bg-danger-clr px-3 me-2\"><i class=\"fa fa-reply me-2\"></i>Cancel</button>\r\n      <button id=\"ok-src-btn\" class=\"btn btn-success bg-success-clr px-3\"><i class=\"fa fa-check-circle me-2\"></i>Save</button>\r\n    </div>\r\n  </div>\r\n  `;\r\n\r\n  // Get the accordion body element\r\n  const accordionBody = document.getElementById(`chatFooter`);\r\n\r\n  // Set height to ensure the dropdown button appears with some space\r\n\r\n  // Clear existing content and insert the dropdown\r\n  accordionBody.innerHTML = multiSelectHTML;\r\n\r\n  // Temporary array to hold the selected sources\r\n  let selectedSources = [];\r\n\r\n  // Get \"Select All\" checkbox and individual source checkboxes\r\n  const selectAllCheckbox = document.getElementById(`selectAll`);\r\n  const individualCheckboxes = document.querySelectorAll(`.source-checkbox`);\r\n  const sourceDropdownLabel = document.getElementById(`sourceDropdownLabel`);\r\n\r\n  // Function to update the dropdown label based on selected checkboxes\r\n  function updateLabel() {\r\n    const selectedSourceNames = selectedSources;\r\n    if (selectedSourceNames.length > 0) {\r\n      sourceDropdownLabel.innerText = selectedSourceNames.join(', ');  // Display selected sources as comma-separated\r\n    } else {\r\n      sourceDropdownLabel.innerText = ' ';  // Default text when no sources are selected\r\n    }\r\n  }\r\n\r\n  // Handle \"Select All\" functionality\r\n  selectAllCheckbox.addEventListener(\"change\", function () {\r\n    const checkboxes = document.querySelectorAll(`.source-checkbox`);\r\n    checkboxes.forEach((checkbox) => {\r\n      checkbox.checked = this.checked;  // If \"Select All\" is checked, all checkboxes are checked, and vice versa\r\n      // Update the temporary array based on the state of the checkboxes\r\n      if (checkbox.checked) {\r\n        if (!selectedSources.includes(checkbox.value)) {\r\n          selectedSources.push(checkbox.value);  // Add source to the array if checked\r\n        }\r\n      } else {\r\n        selectedSources = selectedSources.filter((source) => source !== checkbox.value);  // Remove unchecked sources\r\n      }\r\n    });\r\n\r\n    updateLabel();  // Update the label when \"Select All\" changes\r\n  });\r\n\r\n\r\n  const selectAllItem = document.querySelector(`.dropdown-item[data-checkbox-id=\"selectAll\"]`);\r\n  selectAllItem.addEventListener(\"click\", function (event) {\r\n    event.stopPropagation();  // Prevent dropdown from closing when clicking on the \"Select All\" item\r\n  });\r\n\r\n  // Handle individual checkbox state change\r\n  individualCheckboxes.forEach((checkbox) => {\r\n    checkbox.addEventListener(\"change\", function () {\r\n      if (checkbox.checked) {\r\n        if (!selectedSources.includes(checkbox.value)) {\r\n          selectedSources.push(checkbox.value);  // Add source to the array if checked\r\n        }\r\n      } else {\r\n        selectedSources = selectedSources.filter((source) => source !== checkbox.value);  // Remove unchecked sources\r\n      }\r\n\r\n      // Check if all individual checkboxes are checked\r\n      const allChecked = Array.from(individualCheckboxes).every((checkbox) => checkbox.checked);\r\n      selectAllCheckbox.checked = allChecked;  // Update \"Select All\" checkbox based on individual selections\r\n\r\n      updateLabel();  // Update the label when an individual checkbox is changed\r\n    });\r\n\r\n    // Add click event listener to the whole list item (not just the checkbox)\r\n    const listItem = checkbox.closest(\"li\");\r\n    listItem.addEventListener(\"click\", function (event) {\r\n      event.stopPropagation();  // Prevent dropdown from closing when clicking on list item\r\n    });\r\n  });\r\n\r\n  // Prevent the dropdown from closing when clicking on the \"Select All\" checkbox label\r\n\r\n  // Initialize checkboxes based on tag.Sources\r\n  if (tag.Sources && tag.Sources.length > 0) {\r\n    individualCheckboxes.forEach((checkbox) => {\r\n      if (tag.Sources.includes(checkbox.value)) {\r\n        checkbox.checked = true;  // Check the checkbox if its value is in tag.Sources\r\n        selectedSources.push(checkbox.value);  // Add the source to the temporary array\r\n      }\r\n    });\r\n\r\n    // Also check \"Select All\" if all checkboxes are selected\r\n    const allChecked = Array.from(individualCheckboxes).every((checkbox) => checkbox.checked);\r\n    selectAllCheckbox.checked = allChecked;\r\n    updateLabel();  // Update the label when \"Select All\" changes\r\n\r\n  }\r\n\r\n  // Handle \"OK\" button click\r\n  document.getElementById(`ok-src-btn`).addEventListener(\"click\", function () {\r\n    tag.Sources = [...selectedSources];  // Add selected sources to tag.Sources when \"OK\" is clicked\r\n    tag.SourceValue = sourceList\r\n      .filter(source => selectedSources.includes(source.SourceName))  // Find the sources with matching SourceNames\r\n      .map(source => source.SourceValue);\r\n\r\n    accordionBody.innerHTML = chatfooter(tag);\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n\r\n  });\r\n\r\n  document.getElementById(`cancel-src-btn`).addEventListener(\"click\", function () {\r\n    accordionBody.innerHTML = chatfooter(tag);\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n  });\r\n}\r\n\r\n\r\n\r\nfunction appendAccordionBody(i, tag, radioButtonsHTML, textareaValue, scrollPosition) {\r\n\r\n  const tooltipButton = tag.Sources && tag.Sources.length > 0\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n\r\n\r\n  const accordionBody = document.getElementById(`box-bottom-${i}`);\r\n  // Clear existing content and insert the dropdown\r\n  accordionBody.innerHTML =\r\n    `\r\n           <textarea class=\"form-control\"\r\n                      rows=\"5\"\r\n                      id=\"chatbox-${i}\"\r\n                      placeholder=\"Type here\">${textareaValue}</textarea>\r\n              <div id=\"mention-dropdown-${i}\" class=\"dropdown-menu\"></div>\r\n              <div class=\"d-flex flex-column align-self-end me-3\">\r\n                <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insert-tag-${i}\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\" ></i>\r\n                </button>\r\n\r\n                <button\r\n                    class=\"btn btn-secondary ms-2 mb-2 text-white ngb-tooltip\"\r\n                    id=\"changeSource-${i}\">\r\n                    ${tooltipButton}\r\n                 <i class=\"fa fa-file-lines text-white\"></i>\r\n                </button>\r\n                <button type=\"submit\"\r\n                    class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\"\r\n                    id=\"sendPrompt-${i}\">\r\n                    <span class=\"tooltiptext\">Send</span>\r\n                  <i class=\"fa fa-paper-plane text-white\"></i>\r\n               </button>\r\n             </div>`;\r\n\r\n  const cardContainer = document.getElementById('card-container');\r\n\r\n  cardContainer.scrollTop = scrollPosition;\r\n  mentionDropdownFn(`chatbox-${i}`, `mention-dropdown-${i}`, 'edit');\r\n\r\n  document.getElementById(`sendPrompt-${i}`)?.addEventListener('click', () => {\r\n    const textareaValue = (document.getElementById(`chatbox-${i}`) as HTMLTextAreaElement).value;\r\n\r\n    sendPrompt(tag, textareaValue,)\r\n  });\r\n\r\n\r\n  document.getElementById(`insert-tag-${i}`)?.addEventListener('click', () => {\r\n    insertTagPrompt(i)\r\n  })\r\n\r\n  document.getElementById(`changeSource`)?.addEventListener('click', () => {\r\n    const textareaValue = (document.getElementById(`chatbox-${i}`) as HTMLTextAreaElement).value;\r\n    // const accordionbody=document.getElementById(`accordion-body-${i}`).innerHTML=''\r\n    createMultiSelectDropdown(tag)\r\n  })\r\n}\r\n\r\nasync function loadPromptTemplates() {\r\n  try {\r\n    const data = await getAllPromptTemplates(jwt);\r\n    if (data.Status && data.Data) {\r\n      promptBuilderList = data.Data;\r\n    }\r\n    // Do something with the data\r\n  } catch (error) {\r\n    console.error('Error fetching prompt templates:', error);\r\n  }\r\n}\r\n\r\n\r\nasync function logBookmarksInSelection() {\r\n  return Word.run(async (context) => {\r\n    let range = context.document.getSelection();\r\n    await context.sync(); // Ensure selection is ready\r\n\r\n    // Get bookmarks in the selection\r\n    let bookmarks = range.getBookmarks(); // Returns ClientResult<string[]>\r\n\r\n    await context.sync(); // Ensure bookmarks are retrieved\r\n    if (bookmarks.value.length > 0) {\r\n      selectedNames = []\r\n      bookmarks.value.forEach((bookmarkName) => {\r\n        let processedName = bookmarkName.split(\"_Split_\")[0];\r\n        processedName = processedName.replace(/_/g, \" \");\r\n        selectedNames.push(processedName)\r\n        const container = document.getElementById('tags-in-selected-text');\r\n        if(container){\r\n          renderSelectedTags(selectedNames,availableKeys)// Trigger function when selection changes\r\n        }\r\n      });\r\n    }\r\n  });\r\n}"],"names":["___HTML_LOADER_IMPORT_0___","___HTML_LOADER_IMPORT_1___","module","exports","url","options","String","__esModule","default","hash","maybeNeedQuotes","test","concat","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","m","n","getter","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","b","baseURI","self","href","baseUrl","insertLineWithHeadingStyle","range","line","style","text","startsWith","substring","trim","insertParagraph","Word","InsertLocation","before","removeQuotes","value","copyText","tempTextArea","createElement","body","appendChild","select","execCommand","removeChild","switchToAddTag","querySelector","classList","remove","getElementById","add","updateEditorFinalTable","data","regex","match","tables","exec","parsedContent","JSON","parse","push","jsonToHtmlTable","error","console","tableIndex","jsonData","Array","isArray","headers","Set","rows","flattenObject","prefix","result","keys","forEach","newKey","map","item","entries","k","v","join","flattenedItem","table","header","row","chatfooter","tag","Sources","renderSelectedTags","selectedNames","availableKeys","badgeWrapper","innerHTML","name","badge","className","cursor","addEventListener","aiTag","find","mention","AIFlag","DisplayName","toLowerCase","appBody","generateCheckboxHistory","then","html","loadHomepage","searchBox","suggestionList","searchTerm","replaceChildren","filteredMentions","filter","includes","nonAITags","aiTags","createSection","labelText","mentions","isAISection","label","textContent","listItem","icon","onclick","async","word","type","run","selection","context","getSelection","sync","doc","DOMParser","parseFromString","EditorValue","bodyNodes","from","childNodes","bookmarkName","Date","getTime","node","nodeType","Node","TEXT_NODE","split","ELEMENT_NODE","element","tagName","querySelectorAll","maxCols","Math","max","reduce","sum","cell","parseInt","getAttribute","paragraph","insertTable","after","rowspanTracker","fill","rowIndex","cells","cellIndex","cellText","innerText","colspan","rowspan","getCell","elementText","markers","paragraphs","load","start","items","end","getRange","expandTo","insertBookmark","log","insertText","IsApplied","replaceMention","ComponentKeyDataType","isPendingResponse","addGenAITags","applyAITagFn","FilteredReportHeadAIHistoryList","fetchAIHistory","finalHtml","chat","index","Prompt","Selected","Response","initializeAIHistoryEvents","jwt","setTimeout","checkbox","isChecked","event","target","checked","_","otherIndex","otherCheckbox","responseContainer","payload","response","fetch","method","stringify","ok","json","updateAiHistory","ReportHeadAIHistoryList","historyList","unshift","finalResponse","FormattedResponse","UserValue","currentlySelected","some","err","insertTagPrompt","textareaValue","sendPrompt","createMultiSelectDropdown","mentionDropdownFn","navTabs","sourceList","filteredGlossaryTerm","storedUrl","documentID","organizationName","aiTagList","initialised","promptBuilderList","glossaryName","isGlossaryActive","GroupName","layTerms","dataList","isTagUpdating","capturedFormatting","emptyFormat","isNoFormatTextAvailable","clientId","userId","clientList","currentYear","getFullYear","login","sessionToken","sessionStorage","getItem","loadLoginPage","handleLogin","preventDefault","organization","username","password","toLocaleLowerCase","ClientName","Username","Password","loginUser","Status","ResponseStatus","Data","Token","setItem","ID","showLoginError","message","errorDiv","display","fetchDocument","action","getReportById","logoheader","SourceTypeList","SourceValue","SourceName","transformDocumentName","ClientID","aiGroup","Group","Name","GroupKey","GroupKeyAll","InitialTable","getAllClients","warn","fetchClients","getAllPromptTemplates","loadPromptTemplates","removeMatchingContentControls","loadGlossary","fetchGlossary","formatOptionsDisplay","htmlBody","displayCapturedFormatting","removeFormattedText","removeOptionsConfirmation","clear","logout","glossaryBtn","contains","clearCapturedFormatting","Bold","Underline","Size","removeFormatBtn","captureFormatting","emptyFormatCheckbox","disabled","formatList","font","bold","Italic","italic","underline","size","highlightColor","color","textRanges","tagId","getAiHistory","prompt","iconelement","ReportHeadID","DocumentID","NCTID","DocumentType","TextSetting","DocumentTemplate","ReportTemplate","ReportHeadGroupKeyID","ThreadID","AssistantID","Container","PromptType","VectorID","addAiHistory","searchResults","search","matchCase","matchWholeWord","tableInsertPositions","delete","applyglossary","bodyText","fetchGlossaryTemplate","GlossaryTemplate","sort","ClinicalTerm","processedTerms","filteredTerms","term","biggerTerm","foundRanges","Map","searchPromises","contentControls","has","set","control","contentControl","insertContentControl","title","appearance","ContentControlAppearance","boundingBox","Office","addHandlerAsync","EventType","DocumentSelectionChanged","handleSelectionChange","loader","selectedWords","words","displayElement","groupedTerms","LayTerm","clinicalTerm","mainBox","heading","layTerm","subBox","replaceClinicalTerm","displayHighlightedText","checkGlossary","selectedClient","sponsorOptions","client","isSelectedClient","selected","addtagbody","container","preview","templateText","fieldsList","templateSelect","applyBtn","resetBtn","previewDiv","fieldsContainer","previewContainer","templateError","replaceKeywordsManually","keywordMap","field","id","Label","keyword","HTMLInputElement","HTMLSelectElement","insertValue","RegExp","option","toString","templateId","getPromptTemplateById","Template","div","Type","input","PromptTemplateOptionList","opt","Text","Option","selectedIndex","promptTextarea","setupPromptBuilderUI","form","promptField","nameField","descriptionField","saveGloballyCheckbox","availableForAllCheckbox","sponsorDropdownButton","sponsorDropdownItems","updateDropdownLabel","selectedOptions","cb","parentElement","valid","selectedSponsors","isAvailableForAll","isSaveGlobally","aigroup","formData","Description","GroupKeyClient","AllClient","SaveGlobally","UserDefined","ComponentKeyDataTypeID","ComponentKeyDataAccessID","DocumentTypeID","SourceTypeID","ReportHeadGroupID","ReportHeadSourceID","cancelBtnGenAi","addGroupKey","showAddTagError","createTextGenTag","checkAndDisableSponsors","enableSponsors","stopPropagation","textareaId","DropdownId","highlightedIndex","mentionDropdown","updateHighlightedItem","totalItems","highlightedItem","scrollIntoView","behavior","block","cursorPosition","selectionStart","textBeforeCursor","slice","lastHashtag","lastIndexOf","query","filterMentions","editorValue","textareaRect","getBoundingClientRect","left","bottom","selectedItem","selectMention","matches","textarea","currentValue","textBefore","textAfter","lastHashPosition","updatedTextBefore","newCursorPosition","setSelectionRange","parts","multiSelectHTML","source","accordionBody","selectedSources","selectAllCheckbox","individualCheckboxes","sourceDropdownLabel","updateLabel","selectedSourceNames","allChecked","every","closest","Number","onReady","info","host","HostType","properties","customProperties","property","orgName","retrieveDocumentProperties","bookmarks","getBookmarks","processedName","logBookmarksInSelection","URL"],"sourceRoot":""}