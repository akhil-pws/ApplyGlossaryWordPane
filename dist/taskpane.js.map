{"version":3,"file":"taskpane.js","mappings":"iCAEIA,EACAC,E,qBCDJC,EAAOC,QAAU,SAAUC,EAAKC,GAK9B,OAJKA,IAEHA,EAAU,CAAC,GAERD,GAKLA,EAAME,OAAOF,EAAIG,WAAaH,EAAII,QAAUJ,GACxCC,EAAQI,OAEVL,GAAOC,EAAQI,MAEbJ,EAAQK,iBAAmB,oBAAoBC,KAAKP,GAC/C,IAAKQ,OAAOR,EAAK,KAEnBA,GAZEA,CAaX,C,mICpBIS,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAab,QAGrB,IAAID,EAASW,EAAyBE,GAAY,CAGjDZ,QAAS,CAAC,GAOX,OAHAe,EAAoBH,GAAUb,EAAQA,EAAOC,QAASW,GAG/CZ,EAAOC,OACf,CAGAW,EAAoBK,EAAID,ECxBxBJ,EAAoBM,EAAI,SAASlB,GAChC,IAAImB,EAASnB,GAAUA,EAAOK,WAC7B,WAAa,OAAOL,EAAgB,OAAG,EACvC,WAAa,OAAOA,CAAQ,EAE7B,OADAY,EAAoBQ,EAAED,EAAQ,CAAEE,EAAGF,IAC5BA,CACR,ECNAP,EAAoBQ,EAAI,SAASnB,EAASqB,GACzC,IAAI,IAAIC,KAAOD,EACXV,EAAoBY,EAAEF,EAAYC,KAASX,EAAoBY,EAAEvB,EAASsB,IAC5EE,OAAOC,eAAezB,EAASsB,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAG3E,ECPAX,EAAoBiB,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOC,MAAQ,IAAIC,SAAS,cAAb,EAChB,CAAE,MAAOC,GACR,GAAsB,iBAAXC,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxBtB,EAAoBY,EAAI,SAASW,EAAKC,GAAQ,OAAOX,OAAOY,UAAUC,eAAeC,KAAKJ,EAAKC,EAAO,E,WCAtG,IAAII,EACA5B,EAAoBiB,EAAEY,gBAAeD,EAAY5B,EAAoBiB,EAAEa,SAAW,IACtF,IAAIC,EAAW/B,EAAoBiB,EAAEc,SACrC,IAAKH,GAAaG,IACbA,EAASC,gBACZJ,EAAYG,EAASC,cAAcC,MAC/BL,GAAW,CACf,IAAIM,EAAUH,EAASI,qBAAqB,UAC5C,GAAGD,EAAQE,OAEV,IADA,IAAIC,EAAIH,EAAQE,OAAS,EAClBC,GAAK,KAAOT,IAAc,aAAa/B,KAAK+B,KAAaA,EAAYM,EAAQG,KAAKJ,GAE3F,CAID,IAAKL,EAAW,MAAM,IAAIU,MAAM,yDAChCV,EAAYA,EAAUW,QAAQ,OAAQ,IAAIA,QAAQ,QAAS,IAAIA,QAAQ,YAAa,KACpFvC,EAAoBwC,EAAIZ,C,IClBxB5B,EAAoByC,EAAIV,SAASW,SAAWC,KAAKb,SAASc,K,gdCA1D,MCGMC,EDHQ,sCCgNPC,eAAeC,EAAqBC,EAAcC,GACvD,MAAMC,QAAiBC,MAAM,GAAGN,+BAAsC,CACpEO,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,KAE7BK,KAAMC,KAAKC,UAAUR,KAGvB,IAAKE,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CChOO,MAAMC,EAAkB,CAE7B,CACEC,KAAM,oBACNC,MAAO,aACPC,YAAa,GACbC,WAAY,kDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,yCACNC,MAAO,gBACPC,YAAa,GACbC,WAAY,kDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAId,CACEN,KAAM,sDACNC,MAAO,eACPC,YAAa,0BACbC,WAAY,4BACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,sDACNC,MAAO,0BACPC,YAAa,0BACbC,WAAY,uDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,gDACNC,MAAO,0BACPC,YAAa,0BACbC,WAAY,uDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,uDACNC,MAAO,0BACPC,YAAa,0BACbC,WAAY,uDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,wDACNC,MAAO,0BACPC,YAAa,0BACbC,WAAY,uDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,sDACNC,MAAO,0BACPC,YAAa,0BACbC,WAAY,uDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,wDACNC,MAAO,0BACPC,YAAa,0BACbC,WAAY,uDACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAId,CACEN,KAAM,0CACNC,MAAO,eACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,yCACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,wCACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,0CACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,2CACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,yCACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,2CACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAId,CACEN,KAAM,sDACNC,MAAO,eACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,qDACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,8CACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,uDACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,yDACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,qDACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAEd,CACEN,KAAM,yDACNC,MAAO,0BACPC,YAAa,GACbC,WAAY,qEACZC,SAAU,0CACVC,OAAQ,QACRC,YAAY,GAKd,CACE,KAAQ,+EACR,MAAS,oBACT,YAAe,GACf,WAAc,mEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,8EACR,MAAS,+BACT,YAAe,GACf,WAAc,qEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,uEACR,MAAS,+BACT,YAAe,GACf,WAAc,qEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,gFACR,MAAS,+BACT,YAAe,GACf,WAAc,qEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,kFACR,MAAS,+BACT,YAAe,GACf,WAAc,qEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,8EACR,MAAS,+BACT,YAAe,GACf,WAAc,qEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,kFACR,MAAS,+BACT,YAAe,GACf,WAAc,qEACd,SAAY,0CACZ,OAAU,UACV,YAAc,GAEhB,CACE,KAAQ,qCACR,MAAS,oBACT,YAAe,iDACf,WAAc,mEACd,SAAY,0CACZ,OAAU,OACV,YAAc,GAEhB,CACE,KAAQ,mCACR,MAAS,+BACT,YAAe,iDACf,WAAc,qEACd,SAAY,0CACZ,OAAU,OACV,YAAc,GAEhB,CACE,KAAQ,iCACR,MAAS,+BACT,YAAe,iDACf,WAAc,qEACd,SAAY,0CACZ,OAAU,OACV,YAAc,GAEhB,CACE,KAAQ,qCACR,MAAS,+BACT,YAAe,iDACf,WAAc,qEACd,SAAY,0CACZ,OAAU,OACV,YAAc,GAEhB,CACE,KAAQ,uCACR,MAAS,+BACT,YAAe,iDACf,WAAc,qEACd,SAAY,0CACZ,OAAU,OACV,YAAc,GAEhB,CACE,KAAQ,mCACR,MAAS,+BACT,YAAe,iDACf,WAAc,qEACd,SAAY,0CACZ,OAAU,OACV,YAAc,GAEhB,CACE,KAAQ,uCACR,MAAS,+BACT,YAAe,iDACf,WAAc,qEACd,SAAY,0CACZ,OAAU,OACV,YAAc,IAKLC,EAGT,CACFC,GAAI,CACF,aAAc,aACd,eAAgB,aAChB,gBAAiB,gBAEjB,eAAgB,eAChB,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAE3B,eAAgB,eAChB,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAE3B,eAAgB,eAChB,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAC3B,0BAA2B,0BAE3B,oBAAqB,oBACrB,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAEhC,oBAAqB,oBACrB,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,+BAChC,+BAAgC,gCAIlCC,GAAI,CACF,aAAc,iBACd,eAAgB,iBAChB,gBAAiB,qBACjB,gBAAiB,qBACjB,gBAAgB,qBAChB,gBAAkB,qBAClB,eAAgB,sBAChB,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAE3B,eAAgB,kBAChB,eAAgB,kBAChB,0BAA2B,6BAC3B,0BAA2B,6BAC3B,0BAA2B,6BAC3B,0BAA2B,6BAC3B,0BAA2B,6BAC3B,0BAA2B,6BAE3B,eAAgB,sBAChB,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAC3B,0BAA2B,iCAE3B,oBAAqB,6BACrB,+BAAgC,yCAChC,+BAAgC,yCAChC,+BAAgC,yCAChC,+BAAgC,yCAChC,+BAAgC,yCAChC,+BAAgC,yCAEhC,oBAAqB,yBACrB,+BAAgC,qCAChC,+BAAgC,qCAChC,+BAAgC,qCAChC,+BAAgC,qCAChC,+BAAgC,qCAChC,+BAAgC,uCC5KpC,SAASC,EAAQC,EAAiBC,GAChC,MAGMlB,EAAO,oNAHS,YAATkB,EAAqB,kBAAoB,8DAKYD,0BAIlExC,SAAS0C,eAAe,UAAUC,UAAYpB,EAC9CqB,YAAW,KACT5C,SAAS0C,eAAe,UAAUC,UAAY,EAAE,GAC/C,IACL,CAuCA,MAAME,EAAU,8mBChUT,SAASC,EACdC,EACAC,GAEA,IAAIC,EAAsCC,KAAKC,iBAAiBC,OAC5DC,EAAOL,EAEPA,EAAKM,WAAW,YAClBL,EAAeC,KAAKC,iBAAiBI,SACrCF,EAAOL,EAAKQ,UAAU,GAAGC,QAChBT,EAAKM,WAAW,WACzBL,EAAeC,KAAKC,iBAAiBO,SACrCL,EAAOL,EAAKQ,UAAU,GAAGC,QAChBT,EAAKM,WAAW,UACzBL,EAAeC,KAAKC,iBAAiBQ,SACrCN,EAAOL,EAAKQ,UAAU,GAAGC,QAChBT,EAAKM,WAAW,SACzBL,EAAeC,KAAKC,iBAAiBS,SACrCP,EAAOL,EAAKQ,UAAU,GAAGC,QAChBT,EAAKM,WAAW,QACzBL,EAAeC,KAAKC,iBAAiBU,SACrCR,EAAOL,EAAKQ,UAAU,GAAGC,QAChBT,EAAKM,WAAW,QACzBL,EAAeC,KAAKC,iBAAiBW,SACrCT,EAAOL,EAAKQ,UAAU,GAAGC,QAI3BV,EAAUgB,aAAed,EAEzB,MAAMe,EAAQ,yCACd,IACIC,EADAC,EAAY,EAGhB,KAAsC,QAA9BD,EAAQD,EAAMG,KAAKd,KAAiB,CACtCY,EAAMG,MAAQF,GAChBnB,EAAUsB,WACRhB,EAAKG,UAAUU,EAAWD,EAAMG,OAChClB,KAAKoB,eAAeC,KAIxB,IAAIC,EAAU,GACVC,GAAO,EACPC,GAAS,EACTC,GAAY,EAEZV,EAAM,IACRO,EAAUP,EAAM,GAChBQ,GAAO,GACER,EAAM,IACfO,EAAUP,EAAM,GAChBS,GAAS,GACAT,EAAM,KACfO,EAAUP,EAAM,GAChBU,GAAY,GAGd,MAAMC,EAAI7B,EAAUsB,WAAWG,EAAStB,KAAKoB,eAAeC,KAC5DK,EAAEC,KAAKJ,KAAOA,EACdG,EAAEC,KAAKH,OAASA,EAChBE,EAAEC,KAAKF,UAAYA,EACfzB,KAAK4B,cAAcC,OACnB7B,KAAK4B,cAAcE,KAEvBd,EAAYF,EAAME,SACpB,CAEIA,EAAYb,EAAKhD,QACnB0C,EAAUsB,WACRhB,EAAKG,UAAUU,GACfhB,KAAKoB,eAAeC,IAG1B,CAEO,SAASU,EAAaC,GAC3B,OAAOA,EACHA,EACC1E,QAAQ,SAAU,IAClBA,QAAQ,OAAQ,IAChBA,QAAQ,QAAS,IACjBA,QAAQ,OAAQ,IACjB,EACN,CAIO,SAAS2E,EAAS9B,GAEvB,MAAM+B,EAAepF,SAASqF,cAAc,YAC5CD,EAAaF,MAAQ7B,EACrBrD,SAASuB,KAAK+D,YAAYF,GAC1BA,EAAaG,SACbvF,SAASwF,YAAY,QACrBxF,SAASuB,KAAKkE,YAAYL,GAC1B7C,EAAQ,oCAAqC,UAE/C,CAcO,SAASmD,IAEd1F,SAAS2F,cAAc,qBAAqBC,UAAUC,OAAO,UAC7D7F,SAAS2F,cAAc,0BAA0BC,UAAUC,OAAO,OAAQ,UAG1E7F,SAAS0C,eAAe,WAAWkD,UAAUE,IAAI,UACjD9F,SAAS0C,eAAe,gBAAgBkD,UAAUE,IAAI,OAAQ,SAChE,CAEO,SAASC,EAAuBC,GACrC,MAAMhC,EAAQ,qCACd,IAAIC,EACAgC,EAAS,GAEb,KAAsC,QAA9BhC,EAAQD,EAAMG,KAAK6B,KACzB,IACE,MAAME,EAAgB1E,KAAK2E,MAAMlC,EAAM,IACvCgC,EAAOG,KAAKC,EAAgBH,GAC9B,CAAE,MAAOI,GACPC,QAAQD,MAAM,wBAAyBA,EAAOrC,EAAM,GACtD,CAGF,IAAIuC,EAAa,EACjB,OAAOR,EAAKxF,QAAQwD,GAAO,IAAMiC,EAAOO,MAAiB,IAC3D,CAEA,SAASH,EAAgBI,GACvB,IAAKA,GAAaC,MAAMC,QAAQF,IAAiC,IAApBA,EAASpG,OACpD,MAAO,2BAGT,IAAIiB,EAAU,IAAIsF,IACdC,EAAO,GAEX,SAASC,EAActH,EAAKuH,EAAS,GAAIC,EAAS,CAAC,GAiBjD,OAhBAlI,OAAOmI,KAAKzH,GAAK0H,SAAQtI,IACvB,MAAMsG,EAAQ1F,EAAIZ,GACZuI,EAASJ,EAAS,GAAGA,OAAYnI,IAAQA,EAE1B,iBAAVsG,GAAgC,OAAVA,GAAmBwB,MAAMC,QAAQzB,GAEvDwB,MAAMC,QAAQzB,GACvB8B,EAAOG,GAAUjC,EAAMkC,KAAIC,GACF,iBAATA,EACVvI,OAAOwI,QAAQD,GAAMD,KAAI,EAAEG,EAAGC,KAAO,WAAWD,eAAeC,MAAKC,KAAK,QACzEJ,IACHI,KAAK,QAERT,EAAOG,GAAUjC,EARjB4B,EAAc5B,EAAOiC,EAAQH,EAS/B,IAEKA,CACT,CAEKN,MAAMC,QAAQF,KACjBA,EAAW3H,OAAOwI,QAAQb,GAAUW,KAAI,EAAExI,EAAKsG,MAAW,CAAG,CAACtG,GAAMsG,OAGtEuB,EAASS,SAAQG,IACf,IAAIK,EAAgBZ,EAAcO,GAClCvI,OAAOmI,KAAKS,GAAeR,SAAQtI,GAAO0C,EAAQwE,IAAIlH,KACtDiI,EAAKT,KAAKsB,EAAc,IAG1B,IAAIC,EAAQ,qDAOZ,OANAA,GAAS,OAAS,IAAIrG,GAAS8F,KAAIQ,GAAU,OAAOA,WAAeH,KAAK,IAAM,QAC9EZ,EAAKK,SAAQW,IACXF,GAAS,OAAS,IAAIrG,GAAS8F,KAAIQ,GAAU,OAAOC,EAAID,YAAgBH,KAAK,IAAM,OAAO,IAG5FE,GAAS,WACFA,CACT,CAyDO,SAASG,EAAWC,GAKzB,MAAO,kCAJuB,SAAVC,GAAmB,0BAA4B,8kBAC7CD,EAAIE,SAAWF,EAAIE,QAAQ5H,OAAS,EACtD,+BAA+B0H,EAAIE,iBACnC,+hBAuBN,CAEO,SAASC,EAAmBC,EAAeC,GAChD,MAAMC,EAAerI,SAAS0C,eAAe,qBACzC2F,IACFA,EAAa1F,UAAY,GAEL,IAAI,IAAIiE,IAC1BuB,EAAcf,KAAIvF,GAAQA,EAAKyG,kBAC9BlB,KAAImB,GACLJ,EAAcK,MAAK3G,GAAQA,EAAKyG,gBAAkBC,MAIxCrB,SAAQrF,IAClB,IAAI4G,EAWJ,GAREA,EADE,WAAW3K,KAAK+D,GACVuG,EAAcI,MACpBE,GAA8B,IAAnBA,EAAQC,QAAgB,KAAKD,EAAQE,KAAKN,gBAAkBzG,EAAKyG,gBAGtEF,EAAcI,MACpBE,GAA8B,IAAnBA,EAAQC,QAAgBD,EAAQG,YAAYP,gBAAkBzG,EAAKyG,gBAG9EG,GAAOI,YAAa,CAEtB,MAAMC,EAAQ9I,SAASqF,cAAc,QACrCyD,EAAMC,UAAY,6GAClBD,EAAMhH,MAAMkH,OAAS,UACrBF,EAAMnG,UAAY,GAAG8F,EAAMI,iGAC3BC,EAAMG,iBAAiB,SAASlI,UAG9B,SAFMmI,EAAoCrH,GAEtC4G,EAAO,CACT,MAAMU,EAAUnJ,SAAS0C,eAAe,YACxCyG,EAAQxG,UAAY,+CAEpByG,EAAwBX,GAAOY,MAAKC,IAClCH,EAAQxG,UAAY2G,CAAI,GAE5B,KAEFjB,EAAa/C,YAAYwD,EAC3B,KAIN,CAIO,SAASS,EAAkBvB,GAChC,MAAMwB,EAAmB,SAAVxB,EACTyB,EAAoB,UAAVzB,EAEV0B,EAAiBA,CAACC,EAAUC,EAAaC,KAC7C,MAAMC,EAAW9J,SAAS+J,iBAAiBJ,GACrCK,EAAgBJ,EAAYK,MAAM,KAClCC,EAAiBL,EAAaI,MAAM,KAE1CH,EAAS5C,SAAQiD,IACVA,IAELA,EAAKvE,UAAUC,UAAUmE,GACzBG,EAAKvE,UAAUC,UAAUqE,GAErBV,GAAQW,EAAKvE,UAAUE,OAAOkE,GAC9BP,GAASU,EAAKvE,UAAUE,OAAOoE,GAAe,GAClD,EAIJR,EAAe,YAAa,qBAAsB,sBAClDA,EAAe,cAAe,mCAAoC,6BAClEA,EAAe,iBAAkB,kCAAmC,6BACpEA,EAAe,mBAAoB,qBAAsB,sBACzDA,EAAe,mBAAoB,8BAA+B,6BAClEA,EAAe,iBAAkB,qBAAsB,sBAEvDA,EACE,0BACA,qCACA,uCAGFA,EAAe,mBAAoB,8CAA+C,+CAClFA,EAAe,aAAc,0BAA2B,sBACxDA,EAAe,eAAgB,0BAA2B,qBAG5D,CAEO,SAASU,IACd,MACMC,EADcrK,SAAS0C,eAAe,gBACnBiD,cAAc,KAEzB,SAAVqC,IACFqC,EAAKzE,UAAUC,OAAO,WACtBwE,EAAKzE,UAAUE,IAAI,UACnBwE,eAAeC,QAAQ,QAAS,SACb,UAAVvC,KACTqC,EAAKzE,UAAUC,OAAO,UACtBwE,EAAKzE,UAAUE,IAAI,WACnBwE,eAAeC,QAAQ,QAAS,SAEpC,CAEOxJ,eAAemI,EAAoCsB,GACxD,OAAOtH,KAAKuH,KAAI1J,UACd,MACM2J,EADYC,EAAQ3K,SAAS4K,eACPC,qBACtBF,EAAQG,OAEd,MAAMC,EAAqBL,EAAUxF,MAAMsD,MAAKwC,GAC5BA,EAASf,MAAM,WAAW,GAAGzJ,QAAQ,KAAM,KAC5C8H,gBAAkBkC,EAAYlC,gBAGjD,GAAIyC,EAAoB,CACtB,MAAME,EAAQN,EAAQ3K,SAASkL,6BAA6BH,GAC5DE,EAAME,KAAK,sBACLR,EAAQG,OAETG,EAAMG,cACTH,EAAM1F,QAEV,IAEJ,CAEOxE,eAAesK,EAAW1D,EAAYd,EAAW8D,GAKtD,IAAIW,GAAqB,EAEzBzE,EAAKK,SAAQ,CAACW,EAAK0D,KACjB,MAAMC,EAAQ9E,MAAM+E,KAAK5D,EAAIkC,iBAAiB,WAC9C,IAAI2B,EAAY,EAEZC,EAAe,GAenB,GAbAH,EAAMtE,SAAS0E,IACb,MAAMvI,EAAOuI,EAAKC,UAAUpI,OAGV,IAAdiI,IACFC,EAAetI,GAGjBsE,EAAMmE,QAAQP,EAAUG,GAAWxG,MAAQ7B,EAC3CqI,GAAW,IAITH,EAAW,EACb,GAAII,EAEFL,EAAoBC,OAGpB,IAA2B,IAAvBD,EAA0B,CAC5B,MAAMS,EAAUpE,EAAMmE,QAAQR,EAAmB,GAC3CU,EAAarE,EAAMmE,QAAQP,EAAU,GAE3CQ,EAAQE,MAAMD,GAGd,IACED,EAAQG,kBAAoBhJ,KAAKiJ,kBAAkBC,OACnDL,EAAQxK,KAAK8K,WAAWC,WAAWC,UAAYrJ,KAAKsJ,UAAUJ,MAChE,CAAE,MAAO9M,GACP,CAEJ,CAEJ,UAGIqL,EAAQG,OAKdnD,EAAMd,KAAKsE,KAAK,eACVR,EAAQG,OAGd,MASM2B,EAAoBA,CAACb,EAAWL,EAAkBG,KACtD,IAAIgB,EAAS,SAETC,GAAaC,cAA6B,IAAbrB,IAAgBmB,EAAS,QACtDC,GAAaE,kBAAkC,IAAdnB,IAAiBgB,EAAS,QAE/Dd,EAAKrK,KAAKsD,KAAKJ,KAAkB,SAAXiI,CAAiB,EAInCI,EAAaA,CAACC,EAAgBC,KAClCD,EAAUE,aAAeD,EACzB,IACED,EAAUlI,KAAKqI,MAtBEC,KACnB,MAAMC,EAAMD,EAAS3M,QAAQ,IAAK,IAKlC,OADmB,KAHT6M,SAASD,EAAI5J,UAAU,EAAG,GAAI,IAGT,KAFrB6J,SAASD,EAAI5J,UAAU,EAAG,GAAI,IAEG,KADjC6J,SAASD,EAAI5J,UAAU,EAAG,GAAI,KACgB,IACrC,EAAG,EAgBG8J,CAAYN,GAAW,UAAY,UAG1D,MAAMO,EAAc,UAChBR,EAAUS,WACZ,CAAC,MAAO,SAAU,OAAQ,SAAStG,SAASuG,IAC1CV,EAAUS,UAAUC,GAAMhL,KAAO,SACjCsK,EAAUS,UAAUC,GAAMP,MAAQK,EAClCR,EAAUS,UAAUC,GAAMC,MAAQ,CAAC,GAGzC,CAAE,MAAOpO,GACP,GAKEqO,EAAOC,GAAW3D,MAAM,OAAO,GAAGxG,OAKxC,GAAa,kBAATkK,EACFhG,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OAEdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAK0D,KAC7B1D,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7B,IAAIsB,EAAUL,GAAamB,QAGzBd,EADe,IAAbzB,GAAgC,IAAdG,EACViB,GAAaoB,OAEbxC,EAAW,GAAM,EACvBoB,GAAamB,QACbnB,GAAaqB,UAGnBlB,EAAWlB,EAAMoB,GACjBP,EAAkBb,EAAML,EAAUG,EAAU,GAC5C,SAOD,GAAa,kBAATiC,EAA0B,CAEjChG,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OAEd,MAAMmD,EAAWtG,EAAMd,KAAKgH,MAAMxN,OAC5B6N,EAAgB,EAChBC,EAAeF,EAAW,EAGhCtG,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAK0D,KAEzBA,IAAa2C,GAAiB3C,IAAa4C,IAC9BtG,EAAI2F,UAAUtK,KAAKkL,eAAeC,QAC1C5L,KAAOS,KAAKoL,WAAWtJ,KAChC,IAGF2C,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAK0D,KAC7B1D,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7B,IAAIsB,EAAUL,GAAamB,QAGzBd,EADe,IAAbzB,EACQoB,GAAaoB,OAEbxC,EAAW,GAAM,EACvBoB,GAAamB,QACbnB,GAAaqB,UAGnBlB,EAAWlB,EAAMoB,GACjBP,EAAkBb,EAAML,EAAUG,EAAU,GAC5C,UAGEf,EAAQG,MAChB,MAKK,GAAa,kBAAT6C,EACPhG,EAAM6F,UAAUtK,KAAKkL,eAAeG,gBAAgB9L,KAAOS,KAAKoL,WAAWtJ,KAE3E2C,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OAEdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAK0D,KAC7B1D,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7B,IAAIsB,EAAUL,GAAamB,QAGzBd,EADe,IAAbzB,EACQoB,GAAaoB,OAEbxC,EAAW,GAAM,EACvBoB,GAAamB,QACbnB,GAAaqB,UAGnBlB,EAAWlB,EAAMoB,GACjBP,EAAkBb,EAAML,EAAUG,EAAU,GAC5C,SAOD,GAAa,eAATiC,EACPhG,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OACdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAKvH,KAC7B,MAAMkO,EAAK7B,GAAaoB,OACxBjB,EAAWjF,EAAK2G,GAChB3G,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7Be,EAAkBb,EAAMtL,EAAGoL,EAAU,GACrC,SAID,GAAa,iBAATiC,EAAyB,CAChChG,EAAMd,KAAKgH,MAAM3G,SAAQtC,GAAKA,EAAE4G,MAAML,KAAK,iBACrCR,EAAQG,OAEdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAKvH,KAC7B,MAAMkO,EAAK7B,GAAaoB,OACxBjB,EAAWjF,EAAK2G,GAEhB3G,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7Be,EAAkBb,EAAMtL,EAAGoL,EAAU,GACrC,IAIJ,MACM2C,EADY1G,EAAMd,KAAKgH,MAAM,GACVL,UAAUtK,KAAKkL,eAAeC,QACvDA,EAAO5L,KAAOS,KAAKoL,WAAWG,OAC9BJ,EAAOX,MAAQ,GACfW,EAAOnB,MAAQ,eAETvC,EAAQG,MAChB,MAMK,GAAI6C,EAAKrK,WAAW,gBAAiB,CACxC,MAAMoL,EAAY/G,EAAMd,KAAKgH,MAAM,GACnCf,EAAW4B,EAAW/B,GAAaoB,QACnCpG,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OACdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAKvH,KAC7B,GAAIA,EAAI,EAAG,CACT,MAAMkO,EAAKlO,EAAI,GAAM,EAAIqM,GAAaqB,UAAYrB,GAAamB,QAC/DhB,EAAWjF,EAAK2G,EAClB,CAEA3G,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7Be,EAAkBb,EAAMtL,EAAGoL,EAAU,GACrC,GAEN,MAKK,GAAIiC,EAAKrK,WAAW,qBACvBqE,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OAEdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAK0D,KAC7B1D,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7B,IAAIsB,EAAUL,GAAamB,QAGzBd,EADe,IAAbzB,GAAgC,IAAdG,EACViB,GAAaoB,OAEbxC,EAAW,GAAM,EACvBoB,GAAamB,QACbnB,GAAaqB,UAGnBlB,EAAWlB,EAAMoB,GACjBP,EAAkBb,EAAML,EAAUG,EAAU,GAC5C,SAOD,GAAIiC,EAAKrK,WAAW,gBAAiB,CACxC,MAAMoL,EAAY/G,EAAMd,KAAKgH,MAAM,GACnCf,EAAW4B,EAAW/B,GAAaoB,QACnCpG,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OACdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAKvH,KACzBA,EAAI,GAAGwM,EAAWjF,EAAK8E,GAAamB,SAExCjG,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7Be,EAAkBb,EAAMtL,EAAGoL,EAAU,GACrC,GAEN,MAKSiC,EAAKrK,WAAW,iBACvBqE,EAAMd,KAAKgH,MAAM3G,SAAQW,GAAOA,EAAI2D,MAAML,KAAK,iBACzCR,EAAQG,OAEdnD,EAAMd,KAAKgH,MAAM3G,SAAQ,CAACW,EAAK0D,KAC7B1D,EAAI2D,MAAMqC,MAAM3G,SAAQ,CAAC0E,EAAMF,KAC7B,IAAIsB,EAAUL,GAAamB,QAGzBd,EADe,IAAbzB,EACQoB,GAAaoB,OAEbxC,EAAW,GAAM,EACvBoB,GAAamB,QACbnB,GAAaqB,UAGnBlB,EAAWlB,EAAMoB,GACjBP,EAAkBb,EAAML,EAAUG,EAAU,GAC5C,KAQJ/D,EAAMd,KAAKgH,MAAM3G,SAASW,GAAQiF,EAAWjF,EAAK8E,GAAamB,iBAG3DnD,EAAQG,MAChB,CAGO,SAAS6D,EAA4BC,GAC1C,OAAKA,EAGc,IACbA,EAAMC,WAAa,MACnBD,EAAME,OAAS,MACfF,EAAMG,OAAS,IAIH3H,KAAI4H,IAAO,CAC3BC,KAAMD,EAAIE,UACVrG,YAAamG,EAAIE,UACjBC,YAAaH,EAAII,UACjBC,UAAWL,EAAII,UACfE,qBAAsB,QACtB3G,OAAQ,EACR4G,SAAS,MAjBQ,EAmBrB,CAEOxO,eAAeyO,EAAqBC,GACzC,OAAO,IAAIC,SAAQ,CAACC,EAASC,KAC3B,IACE,MAAMC,EAAU,IAAIC,KAClB,CAACC,KAAKN,EAAUxF,MAAM,KAAK,KAC3B,CAAExH,KAAM,kBAEJlF,EAAMyS,IAAIC,gBAAgBJ,GAE1Bb,EAAM,IAAID,MAChBC,EAAIkB,YAAc,YAElBlB,EAAImB,OAAS,WACX,MAAMC,EAASpQ,SAASqF,cAAc,UACtC+K,EAAO1C,MAAQsB,EAAItB,OAAS,KAC5B0C,EAAOC,OAASrB,EAAIqB,QAAU,IAE9B,MAAMC,EAAMF,EAAOG,WAAW,MAC9B,IAAKD,EAAK,OAAOV,EAAO,uBAExBU,EAAIE,UAAUxB,EAAK,EAAG,GAEtB,MAAMyB,EAAYL,EAAOM,UAAU,aAAazG,MAAM,KAAK,GAC3D0F,EAAQc,GAERT,IAAIW,gBAAgBpT,EACtB,EAEAyR,EAAI4B,QAAU,IAAMhB,EAAO,oBAC3BZ,EAAI9O,IAAM3C,CAEZ,CAAE,MAAOsT,GACPjB,EAAOiB,EACT,IAEJ,CAEO,SAASC,EAAsBC,GACpC,MAAMC,EACJC,OAAOtG,QAAQuG,iBAAiB5I,cAAc6I,MAAM,EAAG,IAAM,KAE/D,OACE/O,EAAsB4O,KAAQD,IAC9B3O,EAAsBC,GAAG0O,IACzB,MAEJ,CC7xBO,SAASK,EAAahJ,GACzB,MAAMiJ,EAA2B,SAAVrJ,GAAmB,0BAA4B,qBAEtEhI,SAAS0C,eAAe,YAAYC,UAAY,wgDAkCiB0O,qbAWjE,MAAMC,EAAYtR,SAAS0C,eAAe,cACpC6O,EAAiBvR,SAAS0C,eAAe,mBAE/C,SAAS8O,IACL,MAAMC,EAAaH,EAAUpM,MAAMzB,OAAO6E,cAG1C,GAFAiJ,EAAeG,kBAEI,KAAfD,EAEA,YADAF,EAAe5O,UAAY,IAI/B,MAAMgP,EAAmBvJ,EAAcwJ,QAAOtT,GAC1CA,EAAEuK,YAAYP,cAAcuJ,SAASJ,KAInCK,EAAYH,EAAiBC,QAAOtT,GAAkB,IAAbA,EAAEqK,SAC3CoJ,EAASJ,EAAiBC,QAAOtT,GAAkB,IAAbA,EAAEqK,SAGxCqJ,EAAiBF,EAAUF,QAAOtT,GAAgC,SAA3BA,EAAEgR,sBAA8D,UAA3BhR,EAAEgR,uBAC9E2C,EAAYH,EAAUF,QAAOtT,GAAgC,UAA3BA,EAAEgR,sBAAoChR,EAAEiR,UAE1E2C,EAAgBA,CAACC,EAAWC,EAAUC,GAAc,EAAOC,GAAiB,KAC9E,GAAwB,IAApBF,EAAS/R,OAAc,OAE3B,MAAMkS,EAAyB,SAAVvK,GACf,CAAEwK,UAAW,qCAAsCC,WAAY,sBAC/D,CAAED,UAAW,sCAAuCC,WAAY,sBAEhEC,EAAQ1S,SAASqF,cAAc,MACrCqN,EAAM3J,UAAY,0CAA0CwJ,EAAaE,aACzEC,EAAMC,YAAcR,EACpBZ,EAAejM,YAAYoN,GAE3BN,EAASlL,SAAQwB,IACb,MAAMkK,EAAW5S,SAASqF,cAAc,MACxCuN,EAAS7J,UAAY,0CAA0CwJ,EAAaC,YAG5E,IAAInI,EAAO,0DACPgI,IAAahI,EAAO,4DACpBiI,IAAgBjI,EAAO,qDAE3BuI,EAASjQ,UAAY,GAAG0H,KAAQ3B,EAAQG,cAExC+J,EAASC,QAAU,KACf,GAAIR,EAAa,CACb,MAAMlJ,EAAUnJ,SAAS0C,eAAe,YACxCyG,EAAQxG,UAAY,+CACpByG,EAAwBV,GACnBoK,OAAM,IAAM3J,EAAQxG,UAAY,0DAChC0G,MAAKC,IAAUH,EAAQxG,UAAY2G,CAAI,GAChD,MAEIyJ,EAAerK,EAASA,EAAQ4G,sBAChCiC,EAAeG,iBACnB,EAGJH,EAAejM,YAAYsN,EAAS,GACtC,EAINV,EAAc,aAAcF,GAC5BE,EAAc,UAAWH,GAAQ,GACjCG,EAAc,SAAUD,GAAW,GAAO,EAC9C,CAEA,GAAI9J,EAAc9H,OAAS,EAAG,CAC1B,MAAMgI,EAAerI,SAAS0C,eAAe,yBAC7C2F,EAAazC,UAAUC,OAAO,UAC9BwC,EAAazC,UAAUE,IAAI,WAC3BoC,EAAmBC,EAAeC,EACtC,CAGA,IAAI4K,EACJ1B,EAAUrI,iBAAiB,SAAS,KAChCgK,aAAaD,GACbA,EAAkBpQ,WAAW4O,EAAmB,IAAI,IAGxDxR,SAAS0C,eAAe,eAAeuG,iBAAiB,SAAS,KACxDiK,GACDC,IACJ,IAGJnT,SAAS0C,eAAe,oBAAoBuG,iBAAiB,SAAS,KAC7DiK,GACDE,GAAe,SACnB,IAGJpT,SAAS0C,eAAe,oBAAoBuG,iBAAiB,SAAS,KAC7DiK,GACDE,GAAe,MACnB,IAGJpT,SAAS0C,eAAe,iBAAiBuG,iBAAiB,SAAS,KAC1DiK,GACDG,IACJ,GAER,CAIOtS,eAAegS,EAAeO,EAAW7Q,GAC5C,OAAOS,KAAKuH,KAAI1J,UACZ,IACI,MAAMwS,EAAY5I,EAAQ3K,SAAS4K,eAGnC,SAFMD,EAAQG,QAETyI,EACD,MAAM,IAAIhT,MAAM,sCAGpB,IAAIiT,EAAeD,EAEnB,GAAa,UAAT9Q,EAAkB,CAClB,MACMgR,GADS,IAAIC,WACAC,gBAAgBL,EAAKnE,YAAa,aAC/CyE,EAAYlN,MAAM+E,KAAKgI,EAAIlS,KAAKsS,kBAEhClJ,EAAQG,OAEd,IAAK,MAAMgJ,KAAQF,EACf,GAAIE,EAAKC,WAAaC,KAAKC,UAAW,CAClC,IAAItB,EAAcmB,EAAKnB,aAAalP,OAChCkP,IACAA,EAAcA,EAAYnS,QAAQ,QAAS,QAE3CmS,EAAY1I,MAAM,MAAM/C,SAAQlE,IACxBA,EAAKS,QACLX,EAA2ByQ,EAAWvQ,EAC1C,IAGZ,MAAO,GAAI8Q,EAAKC,WAAaC,KAAKE,aAAc,CAC5C,MAAMC,EAAUL,EAEhB,GAAsC,UAAlCK,EAAQC,QAAQ9L,cAA2B,CAC3C,MAAMzB,EAAOH,MAAM+E,KAAK0I,EAAQpK,iBAAiB,OAEjD,GAAoB,IAAhBlD,EAAKxG,OAAc,CACnBkT,EAAUc,gBAAgB,gBAAiBnR,KAAKoB,eAAegQ,QAC/D,QACJ,CAEA,MAAMC,EAAUC,KAAKC,OAAO5N,EAAKO,KAAIS,GAC1BnB,MAAM+E,KAAK5D,EAAIkC,iBAAiB,WAAW2K,QAAO,CAACC,EAAK/I,IACpD+I,EAAOtH,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,KAC7D,MAGD7R,EAAYwQ,EAAUc,gBAAgB,GAAInR,KAAKoB,eAAegQ,cAC9D3J,EAAQG,OAEd,MAAMnD,EAAQ5E,EAAU8R,YAAYhO,EAAKxG,OAAQkU,EAASrR,KAAKoB,eAAewQ,OACxEC,EAAqBjE,EAAsBlD,IAMjD,GAL2B,SAAvBmH,IACApN,EAAM7F,MAAQiT,SAGZpK,EAAQG,OACV6B,GAAaqI,gBACP3J,EAAW1D,EAAOd,EAAM8D,OAE7B,CACD,MAAMsK,EAA2B,IAAIvO,MAAM6N,GAASW,KAAK,GACzD,IAAI5J,GAAqB,EAEzBzE,EAAKK,SAAQ,CAACW,EAAK0D,KACf,MAAMC,EAAQ9E,MAAM+E,KAAK5D,EAAIkC,iBAAiB,WAC9C,IAAI2B,EAAY,EAGZC,EAAe,GAkDnB,GAhDAH,EAAMtE,SAAS0E,IACX,KAAOqJ,EAAevJ,GAAa,GAC/BuJ,EAAevJ,KACfA,IAGJ,MAAMyJ,EAAWzO,MAAM+E,KAAKG,EAAKiI,YAC5BzM,KAAI0M,GACGA,EAAKC,WAAaC,KAAKC,UAChBH,EAAKnB,aAAalP,QAAU,GAC5BqQ,EAAKC,WAAaC,KAAKE,aACtBJ,EAAqBjI,UAAUpI,OAEpC,KAEVmO,QAAOvO,GAAQA,EAAKhD,OAAS,IAC7BoH,KAAK,KAEJ2N,EAAU/H,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,IACxDS,EAAUhI,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,IAG5C,IAAdlJ,IACAC,EAAewJ,EAAS1R,QAG5BkE,EAAMmE,QAAQP,EAAUG,GAAWxG,MAAQiQ,EAG3C,IAAK,IAAI7U,EAAI,EAAGA,EAAI8U,EAAS9U,IACrBoL,EAAYpL,EAAIiU,IAChB5M,EAAMmE,QAAQP,EAAUG,EAAYpL,GAAG4E,MAAQ,IAKvD,GAAImQ,EAAU,EACV,IAAK,IAAI/U,EAAI,EAAGA,EAAI8U,EAAS9U,IACrBoL,EAAYpL,EAAIiU,IAChBU,EAAevJ,EAAYpL,GAAK+U,EAAU,GAKtD3J,GAAa0J,CAAO,IAIP,IAAb7J,EAKJ,GAAII,EAEAL,EAAoBC,OAGpB,IAA2B,IAAvBD,EAA0B,CAC1B,MAAMS,EAAUpE,EAAMmE,QAAQR,EAAmB,GAC3CU,EAAarE,EAAMmE,QAAQP,EAAU,GAG3CQ,EAAQE,MAAMD,GAGd,IACID,EAAQG,kBAAoBhJ,KAAKiJ,kBAAkBC,OACnDL,EAAQxK,KAAK8K,WAAWC,WAAWC,UAAYrJ,KAAKsJ,UAAUJ,MAClE,CAAE,MAAO9M,GACL,CAER,CACJ,GAGR,CAEAkU,EAAe7L,EAAMmE,QAAQ,EAAG,EACpC,KAAO,CACH,IAAIwJ,EAAcnB,EAAQtI,UAAUpI,OAChC6R,IACAA,EAAcA,EAAY9U,QAAQ,QAAS,QAE3C8U,EAAYrL,MAAM,MAAM/C,SAAQlE,IACxBA,EAAKS,QACLX,EAA2ByQ,EAAWvQ,EAC1C,KAGRwQ,EAAeD,CACnB,CACJ,CAER,MACK,GAAa,UAAT9Q,EAAkB,CACvB,IAAI8S,EAAsBjC,EAAKnE,YAE3BoG,EAAYjS,WAAW,sBAEvBiS,QAAoB/F,EAAqB+F,GAClCA,EAAYjS,WAAW,gBAC9BiS,EAAcA,EAAYtL,MAAM,KAAK,IAGzCsJ,EAAUiC,8BAA8BD,EAAarS,KAAKoB,eAAe9D,SACzEgT,EAAeD,CACnB,KAC6B,KAArBD,EAAKnE,aAAsBmE,EAAKmC,UAChClC,EAAUc,gBAAgB,IAAIf,EAAKzK,eAAgB3F,KAAKoB,eAAegQ,QAEzDrP,EAAaqO,EAAKnE,aACZlF,MAAM,SACpB/C,SAAQlE,IACVuQ,EAAUc,gBAAgBrR,EAAME,KAAKoB,eAAegQ,OAAO,IAGnEd,EAAeD,EAInB,MAAMmC,EAAoBnC,EAAUc,gBAAgB,GAAInR,KAAKoB,eAAewQ,aACtEnK,EAAQG,OAGd0I,EAAekC,EACfnC,EAAUhO,eACJoF,EAAQG,MAElB,CAAE,MAAOxE,GACLC,QAAQD,MAAM,kBAAmBA,EACrC,IAER,CAYOvF,eAAeqI,EAAwBrB,GACrCA,EAAI4N,iCAAkF,IAA/C5N,EAAI4N,gCAAgCtV,cACtEuV,GAAe7N,GAGzB,MAAM8N,EAAU9N,EAAI4N,gCAEpB,GAAuB,IAAnBE,EAAQxV,OACR,MAAO,sCAIX,MACMyV,EADmB,SAAV9N,GAET,8CACA,8CAEA+N,EAAW,mTAKmBhO,EAAIc,mLAGhBiN,8HAOlBE,EAAW,4ED9Nd,SAAiCC,GACtC,MAAMC,EAAwB,SAAVlO,GAAmB,0BAA4B,qBAC7DmO,EAAqBC,EAASC,yBAAyB7N,MAC1DnB,GAAsC,yBAAxBA,EAAKiP,iBAGtB,OAAOL,EAAS7O,KAAI,CAACmP,EAAMnS,KACzB,MAAMoS,EAA2D,IAAzCL,GAAoBM,iBACtCC,EAAuBH,EAAKI,WAAaJ,EAAKI,UAAUtW,OAAS,EAEvE,MAAO,2SAKsF6V,0CACjFK,EAAKK,oPAKkFxS,0BACvFoS,EAAkB,qFAAqFpS,UAAgB,2SAONA,uKAIlGA,uBACK,IAAlBmS,EAAKM,SAAiB,UAAY,6CACbzS,MAAUmS,EAAKO,+JAGnB1S,0BACnBsS,EACN,kJAE+BtS,UAC/B,yEAIG,IACRqD,KAAK,GACV,CC+KcsP,CAAwBlB,2BAI5BmB,EAAiB,+GAEblP,EAAWC,2BAMrB,OAFAkP,EAA0BlP,EAAK7G,EAAKkH,GAE7B,GAAG2N,IAAWC,IAAWgB,GACpC,CA2aO,SAASE,IACZ,MAAMzY,EAAI,IAAI0Y,KAERC,EAAO7Y,GAAMA,EAAE8Y,WAAWC,SAAS,EAAG,KAE5C,MAAO,GAAG7Y,EAAE8Y,gBAAgBH,EAAI3Y,EAAE+Y,WAAa,KAAKJ,EAAI3Y,EAAEgZ,cACnDL,EAAI3Y,EAAEiZ,cAAcN,EAAI3Y,EAAEkZ,gBAAgBP,EAAI3Y,EAAEmZ,eAC3D,CAKO,SAASX,EAA0BlP,EAAU7G,EAAakH,GAC7DxF,YAAW,KACPmF,EAAI4N,gCAAgCzO,SAAQ,CAACqP,EAAWnS,KAEhD2D,EAAI8P,gBACH7X,SAAS0C,eAAe,aAAqCwC,MAAQ6C,EAAI8P,qBAClE9P,EAAI8P,eAIhB,MAAMC,EAAY9X,SAAS0C,eAAe,aACpCqV,EAAqB/X,SAAS0C,eAAe,sBAE/CoV,GAAaC,IAEbA,EAAmBC,SAA6C,IAAlCF,EAAU5S,MAAMzB,OAAOpD,OAGrDyX,EAAU7O,iBAAiB,SAAS,KAC5B6O,EAAU5S,MAAMzB,OAAOpD,OAAS,EAChC0X,EAAmBC,UAAW,EAE9BD,EAAmBC,UAAW,CAClC,KAGRhY,SAAS0C,eAAe,cAAc0B,MAAU6E,iBAAiB,SAAS,IAAM9D,EAASoR,EAAKK,UACxE5W,SAAS0C,eAAe,cAAc0B,MAExDpE,SAAS0C,eAAe,cAAc0B,MAAU6E,iBAAiB,SAAS,KACtE,MAAMgP,EAAYjY,SAAS0C,eAAe,sBACtCuV,IACAA,EAAUtV,UFlxBlC,WACE,MAAM6G,EAAmB,SAAVxB,GAsBf,MAnBa,iHAFMwB,EAAS,qBAAuB,8VAeDA,EAAS,YAAc,0NAO3E,CE0vB8C0O,GAGtBtV,YAAW,KACP5C,SAAS0C,eAAe,8BAA8BuG,iBAAiB,SAAS,KAC5EgP,EAAUtV,UAAY,EAAE,IAG5B3C,SAAS0C,eAAe,+BAA+BuG,iBAAiB,SAASlI,UAC7E,IACIf,SAAS0C,eAAe,8BAA8ByV,aAAa,WAAY,QAC/EnY,SAAS0C,eAAe,+BAA+ByV,aAAa,WAAY,QAChF,IAAIC,EAAa5W,KAAK2E,MAAM3E,KAAKC,UAAUsG,IAC3CqQ,EAAWxB,OAASL,EAAKK,cACN5V,EAAqBoX,EAAYlX,IACnC,QACbqB,EAAQ,sBAAuB,WAC/B0V,EAAUtV,UAAY,KAEtB3C,SAAS0C,eAAe,8BAA8ByV,aAAa,WAAY,SAC/EnY,SAAS0C,eAAe,+BAA+ByV,aAAa,WAAY,SAChF5V,EAAQ,uBAAwB,SAIxC,CAAE,MAAO+D,GACLtG,SAAS0C,eAAe,8BAA8ByV,aAAa,WAAY,SAC/EnY,SAAS0C,eAAe,+BAA+ByV,aAAa,WAAY,SAChF5V,EAAQ,uBAAwB,QACpC,IACF,GACH,GACP,IAIevC,SAAS0C,eAAe,kBAAkB0B,MAE7DpE,SAAS0C,eAAe,kBAAkB0B,MAAU6E,iBAAiB,SAAS,KAC1E,MAAMgP,EAAYjY,SAAS0C,eAAe,sBAC1C,GAAIuV,EAAW,CACX,MAMMI,EANc9B,EAAK+B,YAAYlR,KAAKC,GAC/BkR,EAAW/P,MACbgQ,GAAgBC,OAAOpR,KAAUmR,EAAOE,aAIrB9G,QAAQ1R,KAAeA,IAC7CyY,EAAY,CACdC,KAAMrC,EAAKI,UACX1H,KAAMlH,EAAIc,YACVwG,UAAWkH,EAAKO,SAChB7O,QAASoQ,GAGbJ,EAAUtV,UFjuBlC,SAAwBkW,GACtB,MAAMrP,EAAmB,SAAVxB,GAGf,MAAO,8HAFYwB,EAAS,qBAAuB,uIAOhBqP,GAAc5J,MAAQ,wDACf4J,GAAcxJ,WAAa,sBAC7DwJ,GAAc5Q,QAAU,wBACbuB,EAAS,eAAiB,0MAIjCqP,EAAa5Q,QAAQb,KAAIoR,GAAU,sCACdhP,EAAS,oBAAsB,mBAAmBgP,EAAOM,kCAC7ErR,KAAK,wCAEF,2HAKNoR,GAAcD,MAAMxR,KAAIC,GAAQ,4FAEGmC,EAAS,0BAA4B,2GAClBnC,EAAKyR,iCACnDzR,EAAKyR,8FAEkCzR,EAAK0R,yGAE5C1R,EAAK2R,2FAIZvR,KAAK,2QAUlB,CEkrB8CwR,CAAeN,GAGrC/V,YAAW,KACP5C,SAAS0C,eAAe,8BAA8BuG,iBAAiB,SAAS,KAC5EgP,EAAUtV,UAAY,EAAE,IAG5B3C,SAAS0C,eAAe,+BAA+BuG,iBAAiB,SAASlI,UAC7E,IACIf,SAAS0C,eAAe,8BAA8ByV,aAAa,WAAY,QAC/EnY,SAAS0C,eAAe,+BAA+ByV,aAAa,WAAY,QAChF,IAAIC,EAAa5W,KAAK2E,MAAM3E,KAAKC,UAAUsG,IAC3CqQ,EAAWxB,OAASL,EAAKK,cACN5V,EAAqBoX,EAAYlX,IACnC,QACbqB,EAAQ,sBAAuB,WAC/B0V,EAAUtV,UAAY,KAEtB3C,SAAS0C,eAAe,8BAA8ByV,aAAa,WAAY,SAC/EnY,SAAS0C,eAAe,+BAA+ByV,aAAa,WAAY,SAChF5V,EAAQ,uBAAwB,SAIxC,CAAE,MAAO+D,GACLtG,SAAS0C,eAAe,8BAA8ByV,aAAa,WAAY,SAC/EnY,SAAS0C,eAAe,+BAA+ByV,aAAa,WAAY,SAChF5V,EAAQ,uBAAwB,QACpC,KAGJvC,SAAS0C,eAAe,uBAAuBuG,iBAAiB,SAASlI,UACrEkX,EAAUtV,UAAY,EAAE,GAC1B,GACH,EACP,KAKR3C,SAAS0C,eAAe,gBAAgB0B,MAAU6E,iBAAiB,SAAS,IAAM9D,EAASoR,EAAKO,YAGhG9W,SAAS0C,eAAe,kBAAkBuG,iBAAiB,SAAS,IAAMmI,EAAahJ,KAGvF,MAAM8Q,EAAWlZ,SAAS0C,eAAe,YAAY0B,KACjD8U,GACAA,EAASjQ,iBAAiB,UAAUlI,UAChC,MAAMoY,EAAaC,EAAMC,OAA4BC,QAerD,GAZAvR,EAAI4N,gCAAgCzO,SAAQ,CAACqS,EAAQC,KACjD,MAAMC,EAAgBzZ,SAAS0C,eAAe,YAAY8W,KACpDE,EAAoB1Z,SAAS0C,eAAe,qBAAqB8W,KACnEC,IAAeA,EAAcH,SAAU,GACvCI,IACAA,EAAkB9T,UAAUC,OAAO,wBACnC6T,EAAkB9T,UAAUE,IAAI,aAEpCiC,EAAI4N,gCAAgC6D,GAAY3C,SAAW,CAAC,IAI5DsC,EAAW,CACXD,EAASI,SAAU,EACnB,MAAMI,EAAoB1Z,SAAS0C,eAAe,qBAAqB0B,KACnEsV,IACAA,EAAkB9T,UAAUE,IAAI,wBAChC4T,EAAkB9T,UAAUC,OAAO,aAEvC0Q,EAAKM,SAAW,CACpB,MACIN,EAAKM,SAAW,EAGpB,IACI,MAAM7Q,QJv5BvBjF,eAA+BE,EAAcC,GAClD,MAAMC,QAAiBC,MAAM,GAAGN,iCAAwC,CACtEO,OAAQ,MACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,KAE7BK,KAAMC,KAAKC,UAAUR,KAGvB,IAAKE,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CIu4B2CgY,CAAgBpD,EAAMrV,GACzC,GAAI8E,EAAW,KAAG,CACd+B,EAAI6R,wBAA0BpY,KAAK2E,MAAM3E,KAAKC,UAAUuE,EAAW,OACnE+B,EAAI4N,gCAAkC,GAEtC5N,EAAI6R,wBAAwB1S,SAAS2S,IACjCA,EAAY/C,SAAW7R,EAAa4U,EAAY/C,UAChD/O,EAAI4N,gCAAgCmE,QAAQD,EAAY,IAG5D,MAAME,EAAgBxD,EAAKyD,kBACrB,KAAOjU,EAAuBwQ,EAAKyD,mBACnCzD,EAAKO,SAEX/O,EAAIuH,qBAAuBiH,EAAKyD,kBAAoB,QAAU,OAC9DjS,EAAIsH,UAAY0K,EAChBhS,EAAIoH,YAAc4K,EAClBhS,EAAI1E,KAAO0W,EAEX,MAAME,EAAoBlS,EAAI4N,gCAAgCuE,MAAM7S,GAAgC,IAAlBA,EAAKwP,WACvF9O,EAAI0N,WAAawE,EACjB7R,EAAclB,SAAQiT,IAClB,GAAIA,EAAWvR,KAAOb,EAAIa,GAAI,CAC1B,MAAMwR,EAAqC,KAA3B7D,EAAKyD,kBACfD,EAAgBxD,EAAKyD,kBACrB,KAAOjU,EAAuBwQ,EAAKyD,mBACnCzD,EAAKO,SACXqD,EAAW7K,qBAAuB8K,EAAU,QAAU,OACtDD,EAAW9K,UAAY0K,EACvBI,EAAWhL,YAAc4K,EACzBI,EAAW9W,KAAO0W,EAClBI,EAAW1E,UAAY1N,EAAI0N,SAC/B,KAGJ4E,EAAUnT,SAAQiT,IACd,GAAIA,EAAWvR,KAAOb,EAAIa,GAAI,CAC1B,MAAMwR,EAAqC,KAA3B7D,EAAKyD,kBACfD,EAAgBxD,EAAKyD,kBACrB,KAAOjU,EAAuBwQ,EAAKyD,mBACnCzD,EAAKO,SAGXqD,EAAW7K,qBAAuB8K,EAAU,QAAU,OACtDD,EAAW9K,UAAY0K,EACvBI,EAAWhL,YAAc4K,EACzBI,EAAW9W,KAAO0W,EAClBI,EAAW1E,UAAY1N,EAAI0N,SAC/B,IAER,CACJ,CAAE,MAAO5E,GACLtK,QAAQD,MAAM,+BAAgCuK,EAClD,IAER,IAIJ7Q,SAAS0C,eAAe,oBAAoBuG,iBAAiB,SAAS,KAC7DlB,EAAI0N,WAled1U,eAA+BgH,GAC3B7E,KAAKuH,KAAI1J,UACZ,IACI,MAAMwS,EAAY5I,EAAQ3K,SAAS4K,eAGnC,SAFMD,EAAQG,QAETyI,EAAW,MAAM,IAAIhT,MAAM,qBAKhC,MAAM+Z,EAAa/G,EAAUlP,WACzB,IACAnB,KAAKoB,eAAe9D,eAElBmK,EAAQG,OAEd,IAAI9B,EAASsR,EAAWC,WAEpBC,EAAmC,KACnCC,EAAiC,KAErC,MAAMC,EAAW9V,IACR4V,IACDA,EAAgB5V,EAAE2V,SAAS,UAE/BE,EAAc7V,EAAE2V,SAAS,MAAM,EAMnC,GAAiC,UAA7BxS,EAAIuH,qBAAkC,CACtC,MACMmE,GADS,IAAIC,WACAC,gBAAgB5L,EAAIoH,YAAa,aAC9CyE,EAAYlN,MAAM+E,KAAKgI,EAAIlS,KAAKsS,YAEtC,IAAK,MAAMC,KAAQF,EAGf,GAAIE,EAAKC,WAAaC,KAAKC,UAAW,CAClC,IAAI0G,EAAM7G,EAAKnB,aAAalP,OAC5B,IAAKkX,EAAK,SAEVA,EAAMA,EAAIna,QAAQ,QAAS,QAC3B,IAAK,MAAMwC,KAAQ2X,EAAI1Q,MAAM,MAAO,CAChC,IAAKjH,EAAKS,OAAQ,SAElB,MAAMhD,EAAIuI,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzDhS,EAA2BrC,EAAGuC,GAC9B0X,EAAQja,EAAE8Z,YACVvR,EAASvI,EAAE8Z,UACf,CACJ,MAGK,GAAIzG,EAAKC,WAAaC,KAAKE,aAAc,CAC1C,MAAM0G,EAAK9G,EAGX,GAAiC,UAA7B8G,EAAGxG,QAAQ9L,cAA2B,CACtC,MAAMzB,EAAOH,MAAM+E,KAAKmP,EAAG7Q,iBAAiB,OAC5C,IAAKlD,EAAKxG,OAAQ,SAElB,MAAMkU,EAAUC,KAAKC,OACd5N,EAAKO,KAAIxC,GACR8B,MAAM+E,KAAK7G,EAAEmF,iBAAiB,WACzB2K,QACG,CAACmG,EAAGC,IAAMD,EAAIxN,SAASyN,EAAElG,aAAa,YAAc,MACpD,MAMVjN,EADIqB,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzCD,YACZhO,EAAKxG,OACLkU,EACArR,KAAKoB,eAAewQ,OAGlBC,EAAqBjE,EAAsBlD,IAKjD,GAJ2B,SAAvBmH,IACApN,EAAM7F,MAAQiT,GAGdpI,GAAaqI,gBACP3J,EAAW1D,EAAOd,EAAM8D,OAC3B,CACH,MAAMsK,EAA2B,IAAIvO,MAAM6N,GAASW,KAAK,GACzD,IAAI5J,GAAqB,EAEzBzE,EAAKK,SAAQ,CAACW,EAAK0D,KACf,MAAMC,EAAQ9E,MAAM+E,KAAK5D,EAAIkC,iBAAiB,WAC9C,IAAI2B,EAAY,EAGZC,EAAe,GAkDnB,GAhDAH,EAAMtE,SAAS0E,IACX,KAAOqJ,EAAevJ,GAAa,GAC/BuJ,EAAevJ,KACfA,IAGJ,MAAMyJ,EAAWzO,MAAM+E,KAAKG,EAAKiI,YAC5BzM,KAAI0M,GACGA,EAAKC,WAAaC,KAAKC,UAChBH,EAAKnB,aAAalP,QAAU,GAC5BqQ,EAAKC,WAAaC,KAAKE,aACtBJ,EAAqBjI,UAAUpI,OAEpC,KAEVmO,QAAOvO,GAAQA,EAAKhD,OAAS,IAC7BoH,KAAK,KAEJ2N,EAAU/H,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,IACxDS,EAAUhI,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,IAG5C,IAAdlJ,IACAC,EAAewJ,EAAS1R,QAG5BkE,EAAMmE,QAAQP,EAAUG,GAAWxG,MAAQiQ,EAG3C,IAAK,IAAI7U,EAAI,EAAGA,EAAI8U,EAAS9U,IACrBoL,EAAYpL,EAAIiU,IAChB5M,EAAMmE,QAAQP,EAAUG,EAAYpL,GAAG4E,MAAQ,IAKvD,GAAImQ,EAAU,EACV,IAAK,IAAI/U,EAAI,EAAGA,EAAI8U,EAAS9U,IACrBoL,EAAYpL,EAAIiU,IAChBU,EAAevJ,EAAYpL,GAAK+U,EAAU,GAKtD3J,GAAa0J,CAAO,IAIP,IAAb7J,EAKJ,GAAII,EAEAL,EAAoBC,OAIpB,IAA2B,IAAvBD,EAA0B,CAC1B,MAAMS,EAAUpE,EAAMmE,QAAQR,EAAmB,GAC3CU,EAAarE,EAAMmE,QAAQP,EAAU,GAG3CQ,EAAQE,MAAMD,GAGd,IACID,EAAQG,kBAAoBhJ,KAAKiJ,kBAAkBC,OACnDL,EAAQxK,KAAK8K,WAAWC,WAAWC,UAAYrJ,KAAKsJ,UAAUJ,MAClE,CAAE,MAAO9M,GACL,CAER,CAEJ,GAGR,CAEAob,EAAQ/S,EAAM4S,YACdvR,EAASrB,EAAM4S,UACnB,KAGK,CACD,IAAII,EAAMC,EAAG/O,WAAWpI,OACxB,IAAKkX,EAAK,SAEVA,EAAMA,EAAIna,QAAQ,QAAS,QAC3B,IAAK,MAAMwC,KAAQ2X,EAAI1Q,MAAM,MAAO,CAChC,IAAKjH,EAAKS,OAAQ,SAElB,MAAMhD,EAAIuI,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzDhS,EAA2BrC,EAAGuC,GAC9B0X,EAAQja,EAAE8Z,YACVvR,EAASvI,EAAE8Z,UACf,CACJ,CACJ,CAER,KAGK,CACD,MAAMI,EAAM5S,EAAIoH,YAAY3O,QAAQ,QAAS,QAAQiD,OAErD,IAAK,MAAMT,KAAQ2X,EAAI1Q,MAAM,MAAO,CAChC,IAAKjH,EAAKS,OAAQ,SAElB,MAAMhD,EAAIuI,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzDhS,EAA2BrC,EAAGuC,GAC9B0X,EAAQja,EAAE8Z,YACVvR,EAASvI,EAAE8Z,UACf,CACJ,CAOA,SALM5P,EAAQG,OAKV0P,GAAiBC,EAAa,CAC9B,MAAMM,EACF,KAAKhT,EAAIa,YAAYsO,MAEzBsD,EACKQ,SAASP,GACTQ,eAAeF,EACxB,CAKAT,EAAWY,eAELvQ,EAAQG,OACdvI,EAAQ,wBAAyB,UAErC,CAAE,MAAOsO,GACLtK,QAAQD,MAAMuK,GACdtO,EAAQ,uBAAwB,QACpC,IAER,CAgPgB4Y,CAAgBpT,EACpB,IAIJ/H,SAAS0C,eAAe,qBAAqBuG,iBAAiB,SAAS,KACnE,MAAMmS,EAAiBpb,SAAS0C,eAAe,aAAqCwC,MACpFmW,GAAWtT,EAAKqT,EAAc,IAIlCpb,SAAS0C,eAAe,uBAAuBuG,iBAAiB,SAAS,KACrE,MAAMmS,EAAiBpb,SAAS0C,eAAe,aAAqCwC,MACpF6C,EAAI8P,cAAgBuD,EACpBE,GAA0BvT,EAAI,IAIlCwT,GAAkB,YAAa,mBAAoB,OAAO,GAC3D,EACP,CCnlCO,IAwBIhD,EACPiD,EAzBOta,EAAM,GACNkV,EAAgB,CAAC,EACxBqF,ENXW,oDMYXC,EAAa,GACbC,EAAmB,GACZtB,EAAY,GACZuB,EAAY,GACnBC,GAAc,EACPzT,EAAgB,GACvB0T,EAAoB,GACpBC,EAAe,GACfC,GAA4B,EAC5BC,EAAoB,GACpBC,EAAW,GACXC,EAAgB,GAChBC,GAAyB,EACzBC,EAA0B,CAAC,EAC3BC,GAAuB,EACvBC,GAAmC,EACnCC,EAAW,IACXC,EAAS,EACTC,EAAa,GAEbC,GAAc,IAAIxF,MAAOI,cAGlBpP,EAAgB,GAChB+K,GAAoB,EACpBlL,GAAQ,QACR4F,GAAa,gBACbjB,GAAoB,CAC7B,OAAU,UACV,QAAW,UACX,UAAa,UACb,WAAa,EACb,cAAgB,EAChB,kBAAoB,GAGXiQ,GAAmB,GA+D9B7b,eAAe8b,KAEb,MAAMC,EAAexS,eAAeyS,QAAQ,SAC5C,GAAID,EAAc,CAChB1G,EAAW5U,KAAK2E,MAAMmE,eAAeyS,QAAQ,cAAgB,GAC7D7b,EAAM4b,EACNvd,OAAOQ,SAASnC,KAAO,cACvB,MAAMkE,EAAQwI,eAAeyS,QAAQ,cACjCjb,IACF8L,GAAa9L,GAEf,MAAMkb,EAAe1S,eAAeyS,QAAQ,gBACxCC,IACFrQ,GAAenL,KAAK2E,MAAM6W,GAG9B,MACEC,IAEJ,CAEA,SAASA,KAEPjd,SAAS0C,eAAe,eAAeC,UAAY,gCACxB8Y,wLAM3Bzb,SAAS0C,eAAe,YAAYC,UAAY,o7BAuBhD3C,SAAS0C,eAAe,gBAAgBuG,iBAAiB,SAAS,KAChEjB,GAAkB,UAAVA,GAAoB,OAAS,QACrCuB,EAAkBvB,IAElBhI,SAASuB,KAAKqE,UAAUsX,OAAO,aAAwB,SAAVlV,IAC7ChI,SAASuB,KAAKqE,UAAUsX,OAAO,cAAyB,UAAVlV,IAC9CoC,GAAiB,IAGnBpK,SAAS0C,eAAe,cAAcuG,iBAAiB,SAAUkU,GACnE,CAEApc,eAAeoc,GAAY/D,GACzBA,EAAMgE,iBAGN,MAAMC,EAAgBrd,SAAS0C,eAAe,gBAAqCwC,MAC7EoY,EAAYtd,SAAS0C,eAAe,YAAiCwC,MACrEqY,EAAYvd,SAAS0C,eAAe,YAAiCwC,MAC3E,GAAImY,EAAa/U,cAAc7E,SAAWkY,EAAiB6B,oBAAoB/Z,OAAQ,CACrFzD,SAAS0C,eAAe,YAAYC,UAAY,yGAMhD,IACE,MAAMqD,QL3LLjF,eAAyBsc,EAAsBC,EAAkBC,GACtE,MAAMpc,QAAiBC,MAAM,GAAGN,mBAA0B,CACxDO,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAU,CACnBgc,WAAYJ,EACZK,SAAUJ,EACVK,SAAUJ,MAId,IAAKpc,EAASO,GACZ,MAAM,IAAInB,MAAM,+BAIlB,aADwBY,EAASQ,MAEnC,CKwKyBic,CAAUP,EAAcC,EAAUC,GACrD,IAAoB,IAAhBvX,EAAK6X,QAAmB7X,EAAW,KACrC,GAAIA,EAAW,KAAE8X,eAAgB,CAC/B5c,EAAM8E,EAAK4S,KAAKmF,MAChB,MAAMjc,EAAQwI,eAAeyS,QAAQ,cACjCjb,IACF8L,GAAa9L,GAGf,MAAMkb,EAAe1S,eAAeyS,QAAQ,gBACxCC,IACFrQ,GAAenL,KAAK2E,MAAM6W,IAE5B5G,EAAWpQ,EAAK4S,KAAKxC,SACrB9L,eAAeC,QAAQ,WAAY/I,KAAKC,UAAUuE,EAAK4S,KAAKxC,WAC5D9L,eAAeC,QAAQ,QAASrJ,GAChCoJ,eAAeC,QAAQ,SAAUvE,EAAK4S,KAAKhQ,IAC3CrG,EAAQ,iCAAkC,WAC1ChD,OAAOQ,SAASnC,KAAO,aACzB,MACEogB,GAAe,0DAGjBA,GAAe,oDAEnB,CAAE,MAAO1X,GACP0X,GAAe,qDACfzX,QAAQD,MAAM,sBAAuBA,EAEvC,CACF,MACE0X,GAAe,kEAEnB,CAEA,SAASA,GAAexb,GACtBya,KACA,MAAMgB,EAAWje,SAAS0C,eAAe,eACzCub,EAASnc,MAAMoc,QAAU,QACzBD,EAAStL,YAAcnQ,CACzB,CA4BAzB,eAAeod,GAAcC,GAC3B,IAEE,MAAMpY,QL1OHjF,eAA6B2a,EAAoBxa,GACtD,MAAMC,QAAiBC,MAAM,GAAGN,mBAAyB4a,IAAc,CACrEra,OAAQ,MACRC,QAAS,CACP,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,+BAIlB,aADmBY,EAASQ,MAE9B,CK4NuB0c,CAAc3C,EAAYxa,GAE7ClB,SAAS0C,eAAe,YAAYC,UAAY,GAChD3C,SAAS0C,eAAe,eAAeC,UHsB3C,SAAoB8Y,GAkClB,MAhCa,kCACgBA,ktCAFD,SAAVzT,GAAmB,SAAW,kKAkClD,CGzDuDsW,CAAW7C,GAE9DU,EAAWnW,EAAW,KACtB,MAAMuY,EAAKjU,eAAeyS,QAAQ,cAEhCnP,GADE2Q,GAGW,gBAGf,MAAMC,EAAKlU,eAAeyS,QAAQ,gBAEhCpQ,GADE6R,EACahd,KAAK2E,MAAMqY,GAEX,CACb,OAAU,UACV,QAAW,UACX,UAAa,UACb,WAAa,EACb,cAAgB,EAChB,kBAAoB,GA7C5Bzd,iBACE,MAAM0d,QLhBD1d,eAAkCG,GACvC,MAAMC,QAAiBC,MAAM,GAAGN,yBAAgC,CAC9DO,OAAQ,MACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CKC8B+c,CAAmBxd,GAC/C0b,GAAmB6B,EAAoB,KACvC,MAAME,EAAgB/B,GAAiBpU,MAAK1G,GAASA,EAAM8G,KAAOuT,EAASyC,uBACvED,IACFrU,eAAeC,QAAQ,cAAeoU,EAAgBA,EAAc1P,KAAO,IAC3EtC,GAAe,CACb,OAAUgS,EAAcE,QAAQC,YAChC,QAAWH,EAAcE,QAAQE,aACjC,UAAaJ,EAAcE,QAAQG,eACnC,WAAa,EACb,aAAgBL,EAAcE,QAAQjS,aACtC,iBAAoB+R,EAAcE,QAAQhS,kBAE5Ce,GAAa+Q,EAAcE,QAAQI,UAGvC,CAgCIC,GACA3G,EAAa4D,GAAUgD,gBAAgBvN,QACpCvK,GAA8B,KAArBA,EAAKiR,aACM,IAAhBjR,EAAKsB,SACVvB,KAAKC,IAAI,IACNA,EACH+X,WAAYC,mBAAmBC,GAAsBjY,EAAKiR,kBAE5DkE,EAAWL,EAASoD,SACpB,MAAMC,EAAUxZ,EAAW,KAAEyZ,MAAMjX,MAAK2L,GAAmC,YAAxBA,EAAQtL,cAC3DoT,EAAYuD,EAAUA,EAAQvQ,KAAO,GACrCoL,EAAYmF,EAAUA,EAAQE,SAAW,GA6vE7C3e,iBACE,MAAM4e,QLxzED5e,eAAgCG,GACrC,MAAMC,QAAiBC,MAAM,GAAGN,sBAA6B,CAC3DO,OAAQ,MACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CKyyE8Bie,CAAiB1e,GACvC0H,EAAKuT,EAASvT,GAEpB,IAAIiX,EAAuBlR,SL1yEtB5N,eAAsC+e,EAAY5e,GACvD,MAAMC,QAAiBC,MAAM,GAAGN,2BAAiCgf,IAAM,CACrEze,OAAQ,MACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAGlB,aADwBY,EAASQ,MAEnC,CK2xE+Boe,CAAuBnX,EAAI1H,IACoB,MACxE8e,EAAerR,EAA4BgR,EAAoB,MACnExD,EAAS8D,YAAY7Z,QAAQ4Z,GAC7B7D,EAAS8D,YAAY7Z,QAAQyZ,GAC7BzX,EAAchC,QAAQ4Z,GACtB5X,EAAchC,QAAQyZ,GACtBjE,EAAYO,EAAS8D,YAAYrO,QAAOuC,GAA4C,UAAjCA,EAAQ7E,uBAC3D,MAAMgC,EAAYtR,SAAS0C,eAAe,cACpC6O,EAAiBvR,SAAS0C,eAAe,mBAC/C,IAAK4O,IAAcC,EAAgB,OACnC,SAASC,IACP,MAAMC,EAAaH,EAAUpM,MAAMzB,OAAO6E,cAG1C,GAFAiJ,EAAeG,kBAEI,KAAfD,EAEF,YADAF,EAAe5O,UAAY,IAI7B,MAAMgP,EAAmBvJ,EAAcwJ,QAAOtT,GAC5CA,EAAEuK,YAAYP,cAAcuJ,SAASJ,KAIjCK,EAAYH,EAAiBC,QAAOtT,GAAkB,IAAbA,EAAEqK,SAC3CoJ,EAASJ,EAAiBC,QAAOtT,GAAkB,IAAbA,EAAEqK,SAGxCqJ,EAAiBF,EAAUF,QAAOtT,GAAgC,SAA3BA,EAAEgR,sBAA8D,UAA3BhR,EAAEgR,uBAC9E2C,EAAYH,EAAUF,QAAOtT,GAAgC,UAA3BA,EAAEgR,sBAAoChR,EAAEiR,UAE1E2C,EAAgBA,CAACC,EAAWC,EAAUC,GAAc,EAAOC,GAAiB,KAChF,GAAwB,IAApBF,EAAS/R,OAAc,OAE3B,MAAMkS,EAAyB,SAAVvK,GACjB,CAAEwK,UAAW,qCAAsCC,WAAY,sBAC/D,CAAED,UAAW,sCAAuCC,WAAY,sBAE9DC,EAAQ1S,SAASqF,cAAc,MACrCqN,EAAM3J,UAAY,0CAA0CwJ,EAAaE,aACzEC,EAAMC,YAAcR,EACpBZ,EAAejM,YAAYoN,GAE3BN,EAASlL,SAAQwB,IACf,MAAMkK,EAAW5S,SAASqF,cAAc,MACxCuN,EAAS7J,UAAY,0CAA0CwJ,EAAaC,YAG5E,IAAInI,EAAO,0DACPgI,IAAahI,EAAO,4DACpBiI,IAAgBjI,EAAO,qDAE3BuI,EAASjQ,UAAY,GAAG0H,KAAQ3B,EAAQG,cAExC+J,EAASC,QAAU,KACjB,GAAIR,EAAa,CACf,MAAMlJ,EAAUnJ,SAAS0C,eAAe,YACxCyG,EAAQxG,UAAY,+CACpByG,EAAwBV,GACrBoK,OAAM,IAAM3J,EAAQxG,UAAY,0DAChC0G,MAAKC,IAAUH,EAAQxG,UAAY2G,CAAI,GAC5C,MAEEyJ,EAAerK,EAASA,EAAQ4G,sBAChCiC,EAAeG,iBACjB,EAGFH,EAAejM,YAAYsN,EAAS,GACpC,EAIJV,EAAc,aAAcF,GAC5BE,EAAc,UAAWH,GAAQ,GACjCG,EAAc,SAAUD,GAAW,GAAO,EAC5C,CAEA,GAAI9J,EAAc9H,OAAS,EAAG,CAC5B,MAAMgI,EAAerI,SAAS0C,eAAe,yBAC7C2F,EAAazC,UAAUC,OAAO,UAC9BwC,EAAazC,UAAUE,IAAI,WAC3BoC,EAAmBC,EAAeC,EACpC,CAGA,IAAI4K,EACJ1B,EAAUrI,iBAAiB,SAAS,KAClCgK,aAAaD,GACbA,EAAkBpQ,WAAW4O,EAAmB,IAAI,IAElDoK,GAAaA,EAAUvb,OAAS,GAClCkC,EAAQ,sCAAuC,UAEnD,CA91EI2d,GACA9X,EAAgBpC,EAAW,KAAEia,YAAYrO,QAAOuC,GAA4C,UAAjCA,EAAQ7E,sBAAqE,SAAjC6E,EAAQ7E,sBAAoE,SAAjC6E,EAAQ7E,uBAC1JlH,EAAclB,SAAStI,IACrB,GAAmB,IAAfA,EAAI+J,OAAc,CAGpB,IAAI1E,GACCA,EAAwC,OAH/B,qCAGKE,KAAKvF,EAAIuQ,gBAExBvQ,EAAIuQ,YAAcpJ,EAAuBnH,EAAIuQ,aAC7CvQ,EAAIyQ,UAAYzQ,EAAIuQ,YACpBvQ,EAAIuhB,cAAe,EACnBvhB,EAAI0Q,qBAAuB,QAIjC,KAGF+K,EAAUnT,SAAQ,CAACtI,EAAK0B,KAGtB,IAAI2D,GACCA,EAAwC,OAH/B,qCAGKE,KAAKvF,EAAIuQ,gBAExBvQ,EAAIuQ,YAAcpJ,EAAuBnH,EAAIuQ,aAC7CvQ,EAAIyQ,UAAYzQ,EAAIuQ,YACpBvQ,EAAIuhB,cAAe,EACnBvhB,EAAI0Q,qBAAuB,QAG/B,IAgENvO,iBACE,IACE,MAAM0b,EAASnS,eAAeyS,QAAQ,WAAa,GAG7C/W,QLpWHjF,eAA6B0b,EAAgBvb,GAClD,MAAMC,QAAiBC,MAAM,GAAGN,oBAA0B2b,IAAU,CAClEpb,OAAQ,MACRC,QAAS,CACP,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,+BAIlB,aADwBY,EAASQ,MAEnC,CKsVuBye,CAAc3D,EAAQvb,GAErC8E,EAAK6X,QAAU7X,EAAK4S,KACtB8D,EAAa1W,EAAW,KAExBO,QAAQ8Z,KAAK,8CAEjB,CAAE,MAAO/Z,GACT,CACF,CA1EIga,GAqoEJvf,iBACE,IACE,MAAMiF,QL3yEHjF,eAAqCG,GAC1C,MAAMC,QAAiBC,MAAM,GAAGN,4BAAmC,CACjEO,OAAQ,MACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CK4xEuB4e,CAAsBrf,GACrC8E,EAAK6X,QAAU7X,EAAK4S,OACtBkD,EAAoB9V,EAAK4S,KAG7B,CAAE,MAAOtS,GACPC,QAAQD,MAAM,mCAAoCA,EACpD,CACF,CA9oEIka,GACApP,EAAahJ,GACbpI,SAAS0C,eAAe,QAAQuG,iBAAiB,SAASlI,UACnDmS,IACC8I,SACIyE,KAGRrP,EAAahJ,GACf,IAGFpI,SAAS0C,eAAe,YAAYuG,iBAAiB,SAAS,KACxDqT,GA+5BVvb,iBACOqb,IAEHpc,SAAS0C,eAAe,YAAYC,UAAY,mIAOhD+d,KAIJ,CA56BQC,EACF,IAGF3gB,SAAS0C,eAAe,qBAAqBuG,iBAAiB,SAAS,KAChEiK,GACH0N,IACF,IAKF5gB,SAAS0C,eAAe,oBAAoBuG,iBAAiB,SAAS,KAChEnK,OAAOmI,KAAKoV,GAAoBhc,OAAS,GAgPnDU,iBACE,IAAKqb,EAAe,CACdJ,SACIyE,KAER,MAAMI,EAAW,w8BA6BjB7gB,SAAS0C,eAAe,YAAYC,UAAYke,EAChDC,KAE+C,OAA3CzE,EAAmB,qBACgB,YAArCA,EAAmB,gBACArc,SAAS0C,eAAe,mBAAmBC,UAAY,8HAI5E3C,SAAS0C,eAAe,gBAAgBuG,iBAAiB,QAAS8X,IAClE/gB,SAAS0C,eAAe,iBAAiBuG,iBAAiB,QAAS2X,GAErE,CACF,CA9RQI,EACF,IAIFhhB,SAAS0C,eAAe,gBAAgBuG,iBAAiB,SAAS,KAChEjB,GAAkB,UAAVA,GAAoB,OAAS,QACrCuB,EAAkBvB,IAElBhI,SAASuB,KAAKqE,UAAUsX,OAAO,aAAwB,SAAVlV,IAC7ChI,SAASuB,KAAKqE,UAAUsX,OAAO,cAAyB,UAAVlV,IAC9CoC,GAAiB,IAInBpK,SAAS0C,eAAe,UAAUuG,iBAAiB,SAASlI,UACrDmS,IACC8I,SACIyE,KAuehB1f,iBACMib,SACIyE,KAERnW,eAAe2W,QACf1hB,OAAOQ,SAASnC,KAAO,QACvBie,GAAc,EACd7b,SAAS0C,eAAe,eAAeC,UAAY,GACnDka,IACF,CA7eQqE,GACF,GAIJ,CAAE,MAAO5a,GACPC,QAAQD,MAAM,gCAAiCA,EACjD,CACF,CAoBOvF,eAAe6f,KACpB,IAAKxE,EAAe,CACdJ,SACIyE,KAER,MAAMI,EAAW,2qCA6BjB7gB,SAAS0C,eAAe,YAAYC,UAAYke,EACD,IAA3C/hB,OAAOmI,KAAKoV,GAAoBhc,SACZL,SAAS0C,eAAe,kBAChCZ,MAAMoc,QAAU,QAIhC,MAAMiD,EAAcnhB,SAAS0C,eAAe,YAK5C,GAJKye,EAAYvb,UAAUwb,SAAS,kBAClCD,EAAYvb,UAAUE,IAAI,iBAGxBwW,EACF+E,UAGA,GAAgC,OAA5BhF,EAAmBiF,WAA6CljB,IAA5Bie,EAAmBiF,MACxB,UAAjCjF,EAAmBkF,gBAA0DnjB,IAAjCie,EAAmBkF,WACnC,OAA5BlF,EAAmBmF,WAA6CpjB,IAA5Bie,EAAmBmF,MACnB,OAApCnF,EAAmB,mBAA6Dje,IAApCie,EAAmB,cACpB,KAA3CA,EAAmB,0BAAyEje,IAA3Cie,EAAmB,qBAC/B,KAArCA,EAAmB,oBAA6Dje,IAArCie,EAAmB,cAA6B,CACxErc,SAAS0C,eAAe,eAChCC,UAAY,gDACvB,MAAM8e,EAAkBzhB,SAAS0C,eAAe,oBAG3C+e,EAAgB7b,UAAUwb,SAAS,kBACtCK,EAAgB7b,UAAUE,IAAI,gBAElC,MAC0B9F,SAAS0C,eAAe,oBAChCkD,UAAUC,OAAO,iBACjCib,KAKJ9gB,SAAS0C,eAAe,sBAAsBuG,iBAAiB,QAASyY,IAExE,MAAMC,EAAsB3hB,SAAS0C,eAAe,yBAChD6Z,IACFoF,EAAoBrI,SAAU,EAC9B+H,MAGFM,EAAoB1Y,iBAAiB,UAAU,KAC7C,GAAI0Y,EAAoBrI,QACtBiD,GAA0B,EAC1B8E,SACK,CACcrhB,SAAS0C,eAAe,sBAChCsV,UAAW,EACtBuE,GAA0B,EAC1BD,GAAc,EACd,MAAM6E,EAAcnhB,SAAS0C,eAAe,YACvCye,EAAYvb,UAAUwb,SAAS,kBAClCD,EAAYvb,UAAUE,IAAI,gBAE9B,IAGJ,CACF,CAIA,SAASgb,KACPxE,GAAc,EACd,MAAMsF,EAAa5hB,SAAS0C,eAAe,eAC3Ckf,EAAWjf,UAAY,GAEvB,IAAK,MAAO/D,EAAKsG,KAAUpG,OAAOwI,QAAQ+U,GAQtCuF,EAAWjf,WAPA,eAAR/D,GAAgC,qBAARA,IAA+BsG,EAOlC,eAAetG,eAAiBsG,SANhC,yBACRtG,cAAgBsG,0FACgDA,2DAOtF,CAEA,SAASmc,KACPhF,EAAqB,CAAC,EACArc,SAAS0C,eAAe,kBAChCZ,MAAMoc,QAAU,OAE9B5B,GAAc,EACMtc,SAAS0C,eAAe,YAChCkD,UAAUC,OAAO,iBACV7F,SAAS0C,eAAe,sBAChCsV,UAAW,EAGtB,MAAMyJ,EAAkBzhB,SAAS0C,eAAe,oBAC3C+e,EAAgB7b,UAAUwb,SAAS,kBACtCK,EAAgB7b,UAAUE,IAAI,iBAEhCS,QAAQsb,IAAI,+BACd,CAEA9gB,eAAe2gB,KACb,UACQxe,KAAKuH,KAAI1J,UACb,MACM8D,EADY8F,EAAQ3K,SAAS4K,eACZ/F,KAoBvB,GAnBAA,EAAKsG,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,gBAEtER,EAAQG,OAEduR,EAAqB,CACnBiF,KAAMzc,EAAKJ,KACXqd,OAAQjd,EAAKH,OACb6c,UAAW1c,EAAKF,UAChB6c,KAAM3c,EAAKkd,KACX,mBAAoBld,EAAKmd,eACzB,YAAand,EAAKhD,KAClB,aAAcgD,EAAKqI,OAKClN,SAAS0C,eAAe,kBAChCZ,MAAMoc,QAAU,QAEE,OAA5B7B,EAAmBiF,MACY,UAAjCjF,EAAmBkF,WACS,OAA5BlF,EAAmBmF,MACiB,OAApCnF,EAAmB,cACwB,KAA3CA,EAAmB,qBACkB,KAArCA,EAAmB,cAEnB,CACmBrc,SAAS0C,eAAe,eAChCC,UAAY,gDACvB,MAAM8e,EAAkBzhB,SAAS0C,eAAe,oBAC3C+e,EAAgB7b,UAAUwb,SAAS,kBACtCK,EAAgB7b,UAAUE,IAAI,gBAGlC,MAC0B9F,SAAS0C,eAAe,oBAChCkD,UAAUC,OAAO,iBACjCib,IACF,GAEJ,CAAE,MAAOxa,GACPC,QAAQD,MAAM,8BAA+BA,EAC/C,CACF,CAqDAvF,eAAeggB,KACb,UACQ7d,KAAKuH,KAAI1J,UAEOf,SAAS0C,eAAe,gBAChCC,UAAY,2DACT3C,SAAS0C,eAAe,gBAChCsV,UAAW,EAEAhY,SAAS0C,eAAe,iBAChCsV,UAAW,EACrB,MAAM3L,EAAa1B,EAAQ3K,SAASuB,KAAK8K,WACzCA,EAAWlB,KAAK,eAEVR,EAAQG,OAGd,IAAK,MAAM/H,KAAasJ,EAAWwB,MAGjC,GAA8B,KAA1B9K,EAAUM,KAAKI,OAAe,CAChC,MAAMwe,EAAalf,EAAUkH,MAAM,CAAC,MACpCgY,EAAW9W,KAAK,qBAEVR,EAAQG,OAEd,IAAK,MAAMG,KAASgX,EAAWpU,MAAO,CACpC,MAAMhJ,EAAOoG,EAAMpG,KACnBA,EAAKsG,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,gBAEtER,EAAQG,OAIZjG,EAAKmd,iBAAmB3F,EAAmB,qBAC3CxX,EAAKqI,QAAUmP,EAAmB,eAClCxX,EAAKJ,OAAS4X,EAAyB,MACvCxX,EAAKH,SAAW2X,EAA2B,QAC3CxX,EAAKkd,OAAS1F,EAAyB,MACvCxX,EAAKF,YAAc0X,EAA8B,WACjDxX,EAAKhD,OAASwa,EAAmB,eAGjCxX,EAAKmd,eAAiB,UACtBnd,EAAKqI,MAAQ,UACbrI,EAAKJ,MAAO,EACZI,EAAKH,QAAS,EACdG,EAAKF,UAAY,OACjB5B,EAAUsB,WAAW,IAAKnB,KAAKoB,eAAe9D,SAElD,CACF,OAGImK,EAAQG,OACduR,EAAqB,CAAC,EACArc,SAAS0C,eAAe,kBAChCZ,MAAMoc,QAAU,OAE9B5B,GAAc,EACdC,GAA0B,EACNvc,SAAS0C,eAAe,YAChCkD,UAAUC,OAAO,iBAC7B+a,IAAsB,GAE1B,CAAE,MAAOta,GACPC,QAAQD,MAAM,iCAAkCA,EAClD,CACF,CAGOvF,eAAe6U,GAAe7N,GACnC,IAEE,MAAM/B,QLzpBHjF,eAA4BmhB,EAAehhB,GAChD,MAAMC,QAAiBC,MAAM,GAAGN,2BAAiCohB,IAAS,CACxE7gB,OAAQ,MACRC,QAAS,CACP,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,+BAIlB,aADwBY,EAASQ,MAEnC,CK2oBuBwgB,CAAapa,EAAIa,GAAI1H,GAGxC,GAAI8E,EAAK6X,QAAU7X,EAAK4S,KAAM,CAC5B7Q,EAAI6R,wBAA0B5T,EAAW,MAAK,GAC9C+B,EAAI4N,gCAAkC,GACtC5N,EAAIqa,cAAgBra,EAAI6R,wBAAwB,GAAGtB,YACnD,MAAM+J,EAAkB9J,EAAW3G,QAAQ0Q,GACzCva,EAAIqa,cAAcvQ,SAASpU,OAAO6kB,EAAK5J,aAiBzC,OAdA3Q,EAAIqX,WAAaiD,EAAgBjb,KAAKC,GAC7BA,EAAK+X,aAEdrX,EAAIE,QAAUF,EAAIqX,WAAW3X,KAAK,KAClCM,EAAIwa,gBAAkBF,EAAgBjb,KAAKC,GAClCA,EAAKqR,SAAWjb,OAAO4J,EAAKqR,UAAYrR,EAAKiR,cAItDvQ,EAAI6R,wBAAwB1S,SAAQ,CAAC2S,EAAavZ,KAChDuZ,EAAY/C,SAAW7R,GAAa4U,EAAY/C,UAChD/O,EAAI4N,gCAAgCmE,QAAQD,EAAY,IAGnD9R,EAAI4N,+BAEb,CACEpP,QAAQ8Z,KAAK,2BAIjB,CAAE,MAAO/Z,GAEP,OADAC,QAAQD,MAAM,6BAA8BA,GACrC,EACT,CACF,CAEOvF,eAAesa,GAAWtT,EAAKya,GACpC,GAAe,KAAXA,GAAkBpG,EA6FpB7V,QAAQD,MAAM,+BA7FqB,CAEnC8V,GAAgB,EAEhB,MAAMqG,EAAcziB,SAAS0C,eAAe,oBAC5C+f,EAAY9f,UAAY,mDAExB,MAAM1B,EAAU,CACdyhB,aAAc3a,EAAI4N,gCAAgC,GAAG+M,aACrDC,WAAYxG,EAASyG,MACrBC,aAAc1G,EAAS0G,aACvBC,YAAa3G,EAAS2G,YACtBC,iBAAkB5G,EAAS6G,eAC3BC,qBAAsBlb,EAAI4N,gCAAgC,GAAGsN,qBAC7DC,SAAUnb,EAAImb,SACdC,YAAahH,EAASgH,YACtBC,UAAWjH,EAASiH,UACpBnH,UAAWA,EACXrF,OAAQ4L,EACRa,WAAY,EACZvM,SAAU,GACV4B,SAAUyD,EAASzD,SACnB7B,SAAU,EACVjO,GAAI,EACJ0P,YAAavQ,EAAIwa,gBAAkBxa,EAAIwa,gBAAkB,IAG3D,IACErP,GAAoB,EACpB,MAAMlN,QL1rBLjF,eAA4BE,EAAcC,GAC/C,MAAMC,QAAiBC,MAAM,GAAGN,8BAAqC,CACnEO,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,KAE7BK,KAAMC,KAAKC,UAAUR,KAGvB,IAAKE,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CK0qByB2hB,CAAariB,EAASC,GAEzC,GAAI8E,EAAW,MAAsB,UAAjBA,EAAW,KAAe,CAC5C+B,EAAI6R,wBAA0BpY,KAAK2E,MAAM3E,KAAKC,UAAUuE,EAAW,OACnE+B,EAAI4N,gCAAkC,GAEtC5N,EAAI6R,wBAAwB1S,SAAS2S,IACnCA,EAAY/C,SAAW7R,GAAa4U,EAAY/C,UAChD/O,EAAI4N,gCAAgCmE,QAAQD,EAAY,IAE1D,MAAMtD,EAAOxO,EAAI6R,wBAAwB,GACzCS,EAAUnT,SAAQiT,IAChB,GAAIA,EAAWvR,KAAOb,EAAIa,GAAI,CAC5B,MAAMwR,EAAqC,KAA3B7D,EAAKyD,kBACfD,EAAgBxD,EAAKyD,kBACvB,KAAOjU,EAAuBwQ,EAAKyD,mBACnCzD,EAAKO,SAGTqD,EAAW7K,qBAAuB8K,EAAU,QAAU,OACtDD,EAAW9K,UAAY0K,EACvBI,EAAWhL,YAAc4K,EACzBI,EAAW9W,KAAO0W,EAClBI,EAAW1E,UAAY1N,EAAI0N,SAE7B,KAGFrN,EAAclB,SAAQiT,IACpB,GAAIA,EAAWvR,KAAOb,EAAIa,GAAI,CAC5B,MAAMwR,EAAqC,KAA3B7D,EAAKyD,kBACfD,EAAgBxD,EAAKyD,kBACvB,KAAOjU,EAAuBwQ,EAAKyD,mBACnCzD,EAAKO,SACTqD,EAAW7K,qBAAuB8K,EAAU,QAAU,OACtDD,EAAW9K,UAAY0K,EACvBI,EAAWhL,YAAc4K,EACzBI,EAAW9W,KAAO0W,EAClBI,EAAW1E,UAAY1N,EAAI0N,SAE7B,KAKczV,SAAS0C,eAAe,YAChCC,gBAAkByG,EAAwBrB,GAClDmL,GAAoB,CAEtB,CAEAuP,EAAY9f,UAAY,+CACxB3C,SAAS0C,eAAe,aAAawC,MAAQ,GAC7CkX,GAAgB,EAChBlJ,GAAoB,CAGtB,CAAE,MAAO5M,GACPmc,EAAY9f,UAAY,+CACxByZ,GAAgB,EAChBlJ,GAAoB,EACpB3M,QAAQD,MAAM,2BAA4BA,EAC5C,CACF,CAGF,CA4COvF,eAAesS,KAEpB,OAAOnQ,KAAKuH,KAAI1J,UACd,IACE,MAAMQ,EAAOoJ,EAAQ3K,SAASuB,KAE9BoJ,EAAQQ,KAAK5J,EAAM,cACboJ,EAAQG,aAgDb/J,eACLQ,EACAoJ,GAEA3K,SAAS0C,eAAe,YAAYC,UAAY,+HAKhDJ,EAAQ,kCAAmC,QAE3C,IAAK,MAAMwF,KAAOsS,EAAW,CAE3B,GADAtS,EAAIoH,YAAclK,GAAa8C,EAAIoH,cAC9BpH,EAAIoH,aAAepH,EAAI0N,UAAW,SAEvC,MAAM8N,EAAUhiB,EAAKiiB,OAAO,IAAIzb,EAAIc,eAAgB,CAClD4a,WAAW,EACXC,gBAAgB,IAGlB/Y,EAAQQ,KAAKoY,EAAS,eAChB5Y,EAAQG,OAEd,IAAK,MAAMzD,KAAQkc,EAAQ1V,MAAO,CAKhC,MAAM8V,EAAStc,EAAKkT,SAAS,SAG7BlT,EAAK6T,eACCvQ,EAAQG,OAEd,IAAI9B,EAAS2a,EAETnJ,EAAmC,KACnCC,EAAiC,KAErC,MAAMC,EAAW9V,IACV4V,IACHA,EAAgB5V,EAAE2V,SAAS,UAE7BE,EAAc7V,EAAE2V,SAAS,MAAM,EAQjC,GAAiC,UAA7BxS,EAAIuH,qBAAkC,CACxC,MACMmE,GADS,IAAIC,WACAC,gBAAgB5L,EAAIoH,YAAa,aAC9CyU,EAAQld,MAAM+E,KAAKgI,EAAIlS,KAAKsS,YAElC,IAAK,MAAMC,KAAQ8P,EAGjB,GAAI9P,EAAKC,WAAaC,KAAKC,UAAW,CACpC,IAAI0G,EAAM7G,EAAKnB,aAAalP,OAC5B,IAAKkX,EAAK,SAEVA,EAAMA,EAAIna,QAAQ,QAAS,QAC3B,IAAK,MAAMwC,KAAQ2X,EAAI1Q,MAAM,MAAO,CAClC,IAAKjH,EAAKS,OAAQ,SAElB,MAAMhD,EAAIuI,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzDhS,EAA2BrC,EAAGuC,GAE9B0X,EAAQja,EAAE8Z,YACVvR,EAASvI,EAAE8Z,UACb,CACF,MAGK,GAAIzG,EAAKC,WAAaC,KAAKE,aAAc,CAC5C,MAAM0G,EAAK9G,EAGX,GAAiC,UAA7B8G,EAAGxG,QAAQ9L,cAA2B,CACxC,MAAMzB,EAAOH,MAAM+E,KAAKmP,EAAG7Q,iBAAiB,OAC5C,IAAKlD,EAAKxG,OAAQ,SAElB,MAAMkU,EAAUC,KAAKC,OAChB5N,EAAKO,KAAIxC,GACV8B,MAAM+E,KAAK7G,EAAEmF,iBAAiB,WAAW2K,QACvC,CAACmG,EAAGC,IACFD,EAAIxN,SAASyN,EAAElG,aAAa,YAAc,IAAK,KACjD,MAMAjN,EADIqB,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzCD,YACdhO,EAAKxG,OACLkU,EACArR,KAAKoB,eAAewQ,OAGhBC,EAAqBjE,EAAsBlD,IAKjD,GAJ2B,SAAvBmH,IACFpN,EAAM7F,MAAQiT,GAGZpI,GAAaqI,gBACT3J,EAAW1D,EAAOd,EAAM8D,OACzB,CACL,MAAMsK,EAA2B,IAAIvO,MAAM6N,GAASW,KAAK,GACzD,IAAI5J,GAAqB,EAEzBzE,EAAKK,SAAQ,CAACW,EAAK0D,KACjB,MAAMC,EAAQ9E,MAAM+E,KAAK5D,EAAIkC,iBAAiB,WAC9C,IAAI2B,EAAY,EAGZC,EAAe,GAkDnB,GAhDAH,EAAMtE,SAAS0E,IACb,KAAOqJ,EAAevJ,GAAa,GACjCuJ,EAAevJ,KACfA,IAGF,MAAMyJ,EAAWzO,MAAM+E,KAAKG,EAAKiI,YAC9BzM,KAAI0M,GACCA,EAAKC,WAAaC,KAAKC,UAClBH,EAAKnB,aAAalP,QAAU,GAC1BqQ,EAAKC,WAAaC,KAAKE,aACxBJ,EAAqBjI,UAAUpI,OAElC,KAERmO,QAAOvO,GAAQA,EAAKhD,OAAS,IAC7BoH,KAAK,KAEF2N,EAAU/H,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,IACxDS,EAAUhI,SAASzB,EAAKgJ,aAAa,YAAc,IAAK,IAG5C,IAAdlJ,IACFC,EAAewJ,EAAS1R,QAG1BkE,EAAMmE,QAAQP,EAAUG,GAAWxG,MAAQiQ,EAG3C,IAAK,IAAI7U,EAAI,EAAGA,EAAI8U,EAAS9U,IACvBoL,EAAYpL,EAAIiU,IAClB5M,EAAMmE,QAAQP,EAAUG,EAAYpL,GAAG4E,MAAQ,IAKnD,GAAImQ,EAAU,EACZ,IAAK,IAAI/U,EAAI,EAAGA,EAAI8U,EAAS9U,IACvBoL,EAAYpL,EAAIiU,IAClBU,EAAevJ,EAAYpL,GAAK+U,EAAU,GAKhD3J,GAAa0J,CAAO,IAIL,IAAb7J,EAKJ,GAAII,EAEFL,EAAoBC,OAGpB,IAA2B,IAAvBD,EAA0B,CAC5B,MAAMS,EAAUpE,EAAMmE,QAAQR,EAAmB,GAC3CU,EAAarE,EAAMmE,QAAQP,EAAU,GAG3CQ,EAAQE,MAAMD,GAGd,IACED,EAAQG,kBAAoBhJ,KAAKiJ,kBAAkBC,OACnDL,EAAQxK,KAAK8K,WAAWC,WAAWC,UAAYrJ,KAAKsJ,UAAUJ,MAChE,CAAE,MAAO9M,GACP,CAEJ,CACF,GAGJ,CAEAob,EAAQ/S,EAAM4S,YACdvR,EAASrB,EAAM4S,UACjB,KAGK,CACH,IAAII,EAAMC,EAAG/O,WAAWpI,OACxB,IAAKkX,EAAK,SAEVA,EAAMA,EAAIna,QAAQ,QAAS,QAC3B,IAAK,MAAMwC,KAAQ2X,EAAI1Q,MAAM,MAAO,CAClC,IAAKjH,EAAKS,OAAQ,SAElB,MAAMhD,EAAIuI,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzDhS,EAA2BrC,EAAGuC,GAE9B0X,EAAQja,EAAE8Z,YACVvR,EAASvI,EAAE8Z,UACb,CACF,CACF,CAEJ,MAGK,GAAiC,UAA7BxS,EAAIuH,qBAAkC,CAC7C,IAAIuU,EAAS9b,EAAIoH,YAEb0U,EAAOvgB,WAAW,sBACpBugB,QAAerU,EAAqBqU,GAC3BA,EAAOvgB,WAAW,gBAC3BugB,EAASA,EAAO5Z,MAAM,KAAK,IAG7B,MAAM6Z,EAAM9a,EAAOwM,8BACjBqO,EACA3gB,KAAKoB,eAAewQ,OAGtB4F,EAAQoJ,EAAIvJ,YACZvR,EAAS8a,EAAIvJ,UACf,KAGK,CACH,MAAMI,EAAM5S,EAAIoH,YACb3O,QAAQ,QAAS,QACjBiD,OAEH,IAAK,MAAMT,KAAQ2X,EAAI1Q,MAAM,MAAO,CAClC,IAAKjH,EAAKS,OAAQ,SAElB,MAAMhD,EAAIuI,EAAOqL,gBAAgB,GAAInR,KAAKoB,eAAewQ,OACzDhS,EAA2BrC,EAAGuC,GAE9B0X,EAAQja,EAAE8Z,YACVvR,EAASvI,EAAE8Z,UACb,CACF,CAOA,SALM5P,EAAQG,OAKV0P,GAAiBC,EAAa,CAChC,MAAMM,EAAe,KAAKhT,EAAIa,YAAYsO,MAC1CsD,EAAcQ,SAASP,GAAaQ,eAAeF,EACrD,CACF,CACF,CACyB,IAArBa,EAAUvb,QACZ+Q,EAAahJ,GAEf7F,EAAQ,gCAAiC,UAC3C,CA/TYwhB,CAAaxiB,EAAMoJ,SAU/B5J,eAA+BQ,EAAiBoJ,GAC9C,IAAK,IAAIrK,EAAI,EAAGA,EAAIsb,EAAUvb,OAAQC,IAAK,CACzC,MAAMyH,EAAM6T,EAAUtb,GAChB0jB,EAAgBziB,EAAKiiB,OAAO,IAAIzb,EAAIc,eAAgB,CACxD4a,WAAW,EACXC,gBAAgB,IAElB/Y,EAAQQ,KAAK6Y,EAAe,eACtBrZ,EAAQG,OAEd,IAAK,MAAMzD,KAAQ2c,EAAcnW,MAC/B,GAAwB,KAApB9F,EAAIoH,YAAoB,CAC1B,IAAIoG,EAAsBxN,EAAIoH,YAG9B,IAAKoG,EAAa,SAGdA,EAAYjS,WAAW,sBACzBiS,QAAoB/F,EAAqB+F,GAGlCA,EAAYjS,WAAW,gBAC9BiS,EAAcA,EAAYtL,MAAM,KAAK,IAGpB5C,EAAKkT,WACb/E,8BAA8BD,EAAarS,KAAKoB,eAAe9D,eACpEmK,EAAQG,MAChB,CAEJ,OACMH,EAAQG,OACdvI,EAAQ,gCAAiC,WACzC6O,EAAahJ,EACf,CA5CY6b,CAAgB1iB,EAAMoJ,EAC9B,CAAE,MAAOkG,GACPtO,EAAQ,uBAAwB,SAChCgE,QAAQD,MAAM,gCAAiCuK,GAC/CO,EAAahJ,EACf,IAEJ,CAqXA,SAASsY,KACP1gB,SAAS0C,eAAe,YAAYC,UAAY,8KAKhD3C,SAAS0C,eAAe,iBAAiBuG,iBAAiB,QAASib,GAGrE,CAIOnjB,eAAemjB,KACpBlkB,SAAS0C,eAAe,YAAYC,UAAY,mIAOhD,UAEQO,KAAKuH,KAAI1J,UAGb,MAAMQ,EAAOoJ,EAAQ3K,SAASuB,KAC9BA,EAAK4J,KAAK,cACJR,EAAQG,OAEd,MAAMqZ,EAAW,CACf,QAAW5iB,EAAK8B,KAAK7C,QAAQ,UAAW,MAE1C,IAEE,MAAMwF,QL3qCPjF,eAAqCyb,EAAkB2H,EAAejjB,GAC3E,MAAMC,QAAiBC,MAAM,GAAGN,qCAA2C0b,IAAY,CACrFnb,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,KAE7BK,KAAMC,KAAKC,UAAU0iB,KAGvB,IAAKhjB,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CK2pC2ByiB,CAAsBjI,GAAUoD,SAAU4E,EAAUjjB,GAEvEgb,EAAWlW,EAAK4S,KAEZ5S,EAAK4S,KAAKvY,OAAS,GACrB0b,EAAe/V,EAAK4S,KAAK,GAAGyL,iBAC5B3D,MAEA1gB,SAAS0C,eAAe,YAAYC,UAAY,yEAIpD,CAAE,MAAO2D,GACPC,QAAQD,MAAM,gCAAiCA,EACjD,CAEA4V,EAASoI,MAAK,CAAC5lB,EAAGgC,IAAMA,EAAE6jB,aAAalkB,OAAS3B,EAAE6lB,aAAalkB,SAE/D,MAAMmkB,EAAiB,IAAI5d,IAGrB6d,EAAgBvI,EAAStK,QAAO8S,IACpC,IAAK,MAAMC,KAAcH,EACvB,GAA0B,iBAAfG,GAA2BA,EAAW9S,SAAS6S,EAAKH,aAAajc,eAE1E,OADA/B,QAAQsb,IAAI,aAAa6C,EAAKH,uCAAuCI,OAC9D,EAIX,OADAH,EAAe1e,IAAI4e,EAAKH,aAAajc,gBAC9B,CAAI,IAGbkT,EAAuBiJ,QACjBhE,KAEN,MAAMmE,EAAc,IAAIC,IAElBC,EAAiBtJ,EAAqBpU,KAAIsd,IAC9C,MAAMV,EAAgBziB,EAAKiiB,OAAOkB,EAAKH,aAAc,CAAEd,WAAW,EAAOC,gBAAgB,IAEzF,OADAM,EAAc7Y,KAAK,SACZ6Y,CAAa,UAGhBrZ,EAAQG,OAEd,IAAK,MAAMkZ,KAAiBc,EAE1B,IAAK,MAAM7Z,KAAS+Y,EAAcnW,MAAO,CAEvC,IAAK5C,IAAUA,EAAM5H,KAAM,CACzBkD,QAAQsb,IAAI,8BACZ,QACF,CAGA,MAAMhd,EAAOoG,EAAMpG,KAOnB,GANAA,EAAKsG,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,UAC5EF,EAAME,KAAK,yBACLR,EAAQG,OAEUG,EAAM8Z,gBAAgBlX,MAAMxN,OAAS,EAG3DkG,QAAQsb,IAAI,aAAa5W,EAAM5H,wDAIjC,GAAIuhB,EAAYI,IAAI/Z,EAAM5H,MACxBkD,QAAQsb,IAAI,qCAAqC5W,EAAM5H,aADzD,CAOA,GAFAuhB,EAAYK,IAAIha,EAAM5H,MAAM,GAExB4H,EAAM8Z,iBAAmB9Z,EAAM8Z,gBAAgBlX,MAAMxN,OAAS,EAAG,CACnEkG,QAAQsb,IAAI,4CAA4C5W,EAAM5H,SAC9D,IAAK,MAAM6hB,KAAWja,EAAM8Z,gBAAgBlX,MAC1CqX,EAAQhK,QAAO,SAEXvQ,EAAQG,MAChB,CAEA,IAEE,MAAMqa,EAAiBla,EAAMma,uBAC7BD,EAAeE,MAAQ,GAAGpa,EAAM5H,OACJ,OAAxBwB,EAAKmd,iBACPmD,EAAepd,IAAM,GAAGlD,EAAKmd,kBAE/BmD,EAAetgB,KAAKmd,eAAiB,SACrCmD,EAAeG,WAAapiB,KAAKqiB,yBAAyBC,kBACpD7a,EAAQG,MAChB,CAAE,MAAOxE,GACPC,QAAQD,MAAM,6CAA6C2E,EAAM5H,SAAUiD,EAC7E,CAxBA,CAyBF,CAGF0V,GAAmB,EACnBhc,SAAS0C,eAAe,YAAYC,UAAY,6UAUzB3C,SAAS0C,eAAe,UAChCZ,MAAMoc,QAAU,aACzBvT,EAAQG,OACd9K,SAAS0C,eAAe,iBAAiBuG,iBAAiB,QAASwX,IACnExP,OAAOtG,QAAQ3K,SAASylB,gBACtBxU,OAAOyU,UAAUC,yBACjBC,GACD,IAMHrf,QAAQsb,IAAI,gCACd,CAAE,MAAOvb,GACPC,QAAQD,MAAM,2BAA4BA,GAE1CC,QAAQsb,IAAI,6CACd,CACF,CAGA9gB,eAAe6kB,WAIR7kB,iBACL,UACQmC,KAAKuH,KAAI1J,UACb,MAAMwS,EAAY5I,EAAQ3K,SAAS4K,eAQnC,GANA2I,EAAUpI,KAAK,mCAETR,EAAQG,OAIVyI,EAAUlQ,KAAM,CAClB,MAAMwiB,EAAS7lB,SAAS0C,eAAe,UACnCmjB,IACFA,EAAO/jB,MAAMoc,QAAU,SAEzB,MAAM4G,EAAiB5I,EAAS9U,KAAIsd,IAClC,MAAMV,EAAgBzQ,EAAUiQ,OAAOkB,EAAKH,aAAc,CAAEd,WAAW,EAAOC,gBAAgB,IAE9F,OADAM,EAAc7Y,KAAK,SACZ6Y,CAAa,UAGhBrZ,EAAQG,OACd,MAAMgb,EAAgB,GACtB,IAAK,MAAM9B,KAAiBc,EAE1B,IAAK,MAAM7Z,KAAS+Y,EAAcnW,MAAO,CACvC,MAAMhJ,EAAOoG,EAAMpG,KACnBA,EAAKsG,KAAK,CAAC,OAAQ,SAAU,YAAa,OAAQ,iBAAkB,OAAQ,gBAEtER,EAAQG,OAEZjG,EAAKmd,iBAAmB3F,EAAmB,qBAC3CxX,EAAKqI,QAAUmP,EAAmB,eAClCxX,EAAKJ,OAAS4X,EAAyB,MACvCxX,EAAKH,SAAW2X,EAA2B,QAC3CxX,EAAKkd,OAAS1F,EAAyB,MACvCxX,EAAKF,YAAc0X,EAA8B,WACjDxX,EAAKhD,OAASwa,EAAmB,cAEjCyJ,EAAc1f,KAAK6E,EAAM5H,KAG7B,EA+BV,SAAgC0iB,GAE9B,MAAMC,EAAiBhmB,SAAS0C,eAAe,oBAE/C,GAAIsjB,EAAgB,CAClBA,EAAerjB,UAAY,GAC3B,MAAMkjB,EAAS7lB,SAAS0C,eAAe,UACvCmjB,EAAO/jB,MAAMoc,QAAU,QAEvB,MAAM+H,EAAqD,CAAC,EAE5DF,EAAM7e,SAAQoM,IACZ4I,EAAShV,SAAQwd,IACXA,EAAKH,aAAajc,gBAAkBgL,EAAKhL,gBACtC2d,EAAavB,EAAKH,gBACrB0B,EAAavB,EAAKH,cAAgB,IAE/B0B,EAAavB,EAAKH,cAAc1S,SAAS6S,EAAKwB,UACjDD,EAAavB,EAAKH,cAAcne,KAAKse,EAAKwB,SAE9C,GACA,IAIJpnB,OAAOmI,KAAKgf,GAAc/e,SAAQif,IAEhC,MAAMC,EAAUpmB,SAASqF,cAAc,OACvC+gB,EAAQrd,UAAY,MAGpB,MAAMsd,EAAUrmB,SAASqF,cAAc,MACvCghB,EAAQ1T,YAAc,GAAGwT,MAAiBpK,KAC1CqK,EAAQ9gB,YAAY+gB,GAGpBJ,EAAaE,GAAcjf,SAAQof,IACjC,MAAMC,EAASvmB,SAASqF,cAAc,OACtCkhB,EAAOxd,UAAY,UACnBwd,EAAO5T,YAAc2T,EAGrBC,EAAOtd,iBAAiB,SAASlI,gBAgBzCA,eAAmColB,EAAsBG,GACvD,MAAMN,EAAiBhmB,SAAS0C,eAAe,UAC/CsjB,EAAelkB,MAAMoc,QAAU,QAE/B,UACQhb,KAAKuH,KAAI1J,UAEb,MAAMwS,EAAY5I,EAAQ3K,SAAS4K,eAInC,GAHA2I,EAAUpI,KAAK,cACTR,EAAQG,OAEVyI,EAAUlQ,KAAKiF,cAAcuJ,SAASsU,EAAa7d,eAAgB,CAErE,MAAM0b,EAAgBzQ,EAAUiQ,OAAO2C,EAAc,CAAE1C,WAAW,EAAOC,gBAAgB,IACzFM,EAAc7Y,KAAK,eAEbR,EAAQG,OAGd,IAAK,MAAMzD,KAAQ2c,EAAcnW,MAE/BxG,EAAKxC,KAAKsG,KAAK,CAAC,OAAQ,SAAU,YAAa,QAAS,iBAAkB,OAAQ,eAC5ER,EAAQG,OAGdzD,EAAKhD,WAAWiiB,EAAS,WAGzBjf,EAAKxC,KAAKJ,KAAO4C,EAAKxC,KAAKJ,KAC3B4C,EAAKxC,KAAKH,OAAS2C,EAAKxC,KAAKH,OAC7B2C,EAAKxC,KAAKF,UAAY0C,EAAKxC,KAAKF,UAChC0C,EAAKxC,KAAKqI,MAAQ7F,EAAKxC,KAAKqI,MAC5B7F,EAAKxC,KAAKmd,eAAiB,UAC3B3a,EAAKxC,KAAKkd,KAAO1a,EAAKxC,KAAKkd,KAC3B1a,EAAKxC,KAAKhD,KAAOwF,EAAKxC,KAAKhD,WAGvB8I,EAAQG,OACdkb,EAAelkB,MAAMoc,QAAU,OAC/B3X,QAAQsb,IAAI,aAAasE,YAAuBG,4CAClD,MACEN,EAAelkB,MAAMoc,QAAU,OAC/B3X,QAAQsb,IAAI,mCAAmCsE,MACjD,GAEJ,CAAE,MAAO7f,GACP0f,EAAelkB,MAAMoc,QAAU,OAC/B3X,QAAQD,MAAM,wBAAyBA,EACzC,CACF,CAhEgBkgB,CAAoBL,EAAcG,GAGxCF,EAAQvgB,QAAQ,IAGlBugB,EAAQ9gB,YAAYihB,EAAO,IAG7BP,EAAe1gB,YAAY8gB,EAAQ,IAErCP,EAAO/jB,MAAMoc,QAAU,MAEzB,CACF,CAlFQuI,CAAuBX,SAEjBnb,EAAQG,MAYhB,MACEvE,QAAQsb,IAAI,uBACd,GAEJ,CAAE,MAAOvb,GACPC,QAAQD,MAAM,6BAA8BA,EAC9C,CACF,CAzEQogB,EACR,CA0LO3lB,eAAe0f,KACpB,UACQvd,KAAKuH,KAAI1J,UACbf,SAAS0C,eAAe,YAAYC,UAAY,iIAIhD,MAGMoiB,EAHOpa,EAAQ3K,SAASuB,KAGDwjB,gBAI7B,GAHAA,EAAgB5Z,KAAK,eACfR,EAAQG,OAEuB,IAAjCia,EAAgBlX,MAAMxN,OAA1B,CAKA,IAAK,MAAM6kB,KAAWH,EAAgBlX,MACpC,GAAIqX,EAAQG,OAAS7J,EAAqBtB,MAAKwK,GAAQA,EAAKH,aAAajc,gBAAkB4c,EAAQG,MAAM/c,gBAAgB,CACvH,MAAM2C,EAAQia,EAAQ3K,WACtBtP,EAAME,KAAK,cACLR,EAAQG,OACVoa,EAAQnd,KAAO,oBAAoBjK,KAAKonB,EAAQnd,KAClDkD,EAAMpG,KAAKmd,eAAiBkD,EAAQnd,IAEpCkD,EAAMpG,KAAKmd,eAAiB,WAExBrX,EAAQG,OACdoa,EAAQhK,QAAO,EACjB,CAGFlb,SAAS0C,eAAe,YAAYC,UAAY,kLAM1CgI,EAAQG,OACdkR,GAAmB,EACnBhc,SAAS0C,eAAe,iBAAiBuG,iBAAiB,QAASib,GAzBnE,MAFE3d,QAAQsb,IAAI,6BA2BmE,GAErF,CAAE,MAAOvb,GACPC,QAAQD,MAAM,mCAAoCA,EACpD,CACF,CAaOvF,eAAeoS,KAEpB,IAAKiJ,EAAe,CAEdJ,SACIyE,KAGR,IAAIkG,EAAiBjK,EAAW9K,QAAOvK,GAAQA,EAAKuB,KAAO4T,IAYvDoK,EATiB,IAChB,IAAI/B,IACL1I,EAASgD,eACNvN,QAAOvK,GAAQA,EAAKqR,SAAW,IAC/BtR,KAAIC,GAAQ,CAACA,EAAKwf,aAAc,CAAE5X,KAAM5H,EAAKyf,WAAYle,GAAIvB,EAAKwf,kBACrEE,UAI+B3f,KAAKlH,GAC/B,kMAGwDA,EAAI0I,iBAAiB1I,EAAI0I,6EACxB1I,EAAI0I,OAAO1I,EAAI+O,kDAG9ExH,KAAK,IAEJuf,EAAiBtK,EAAWtV,KAAI6f,IAClC,MAAMC,EAAmBP,EAAezM,MAAKiN,GAAYA,EAASve,KAAOqe,EAAOre,KAChF,MAAO,mMAGwDqe,EAAOre,kBAAkBqe,EAAOre,OAAOse,EAAmB,mBAAqB,6EAC7ED,EAAOre,OAAOqe,EAAOhY,+CAE9E,IACPxH,KAAK,IAERzH,SAAS0C,eAAe,YAAYC,UAAYE,EAGhD7C,SAAS0C,eAAe,gBAAgBC,UHttD5C,SAAoBqkB,EAAeJ,GA6GjC,MA5Ga,k8DAyCCA,k9EAoDAI,wZAgBhB,CGwmDwDI,CAAWJ,EAAgBJ,GDpyC5E7lB,eAAoCkX,EAAW6D,GAGlD,IAAIuL,EAAU,GACVC,EAAe,GAGfC,EAAa,GAIjBtP,EAAUtV,UAAY,23BAuBtB,MAAM6kB,EAAiBvP,EAAUtS,cAAc,0BACzC8hB,EAAWxP,EAAUtS,cAAc,aACnC+hB,EAAWzP,EAAUtS,cAAc,aACnCgiB,EAAa1P,EAAUtS,cAAc,YACrCiiB,EAAkB3P,EAAUtS,cAAc,oBAC1CkiB,EAAmB5P,EAAUtS,cAAc,qBAC3CmiB,EAAgB7P,EAAUtS,cAAc,kBAoE9C,SAASoiB,IACL,MAAMC,EAAwC,CAAC,EAE/CT,EAAWrgB,SAAS+gB,IAChB,MAAMnI,EAAKmI,EAAMC,MACXC,EAAU,IAAIrI,KAEpB,IAAI5a,EAAQ,GACZ,MAAMiP,EAAUnU,SAAS0C,eAAeod,GAEpC3L,IACAjP,EAASiP,aAAmBiU,kBAAoBjU,aAAmBkU,kBAC7DlU,EAAQjP,MACR,IAGV8iB,EAAWG,GAAWjjB,GAAgBijB,CAAO,IAGjD,IAAIG,EAAchB,EAClB,IAAK,MAAOa,EAASjjB,KAAUpG,OAAOwI,QAAQ0gB,GAC1CM,EAAcA,EAAY9nB,QAAQ,IAAI+nB,OAAOJ,EAAS,KAAMjjB,GAGhEmiB,EAAUiB,EACVX,EAAWhV,YAAc0U,EACzBQ,EAAiB/lB,MAAMoc,QAAUmJ,EAAU,QAAU,OACrDI,EAASzP,SAAuB,KAAZqP,CACxB,CA7FAvL,EAAkB5U,SAASG,IACvB,MAAMmhB,EAASxoB,SAASqF,cAAc,UACtCmjB,EAAOtjB,MAAQmC,EAAKuB,GAAGyO,WACvBmR,EAAO7V,YAActL,EAAK4H,KAC1BuY,EAAeliB,YAAYkjB,EAAO,IAGtChB,EAAeve,iBAAiB,UAAUlI,UACtC,MAAM0nB,EAAajB,EAAetiB,MAC5BhE,EAAMoJ,eAAeyS,QAAQ,UAAY,GAEzC/W,QJ5SPjF,eAAqC+e,EAAY5e,GACtD,MAAMC,QAAiBC,MAAM,GAAGN,yBAA+Bgf,SAAW,CACxEze,OAAQ,MACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,OAI/B,IAAKC,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CI6R2B+mB,CAAsBD,EAAYvnB,GACjD8E,EAAK6X,QAAU7X,EAAK4S,OACpB2O,EAAavhB,EAAK4S,KAClByO,EAAUvL,EAAkBtT,MAAMnB,GAASA,EAAKuB,GAAGyO,aAAeoR,IAAYE,SAE9ErB,EAAexL,EAAkBtT,MAAMnB,GAASA,EAAKuB,GAAGyO,aAAeoR,IAAYE,UAElFF,GAKLX,EAAcliB,UAAUE,IAAI,UAO5B8hB,EAAgBjlB,UAAY,GAE5B4kB,EAAWrgB,SAAS+gB,IAChB,MAAMW,EAAM5oB,SAASqF,cAAc,OACnCujB,EAAI7f,UAAY,2BAEhB,MAAM2J,EAAQ1S,SAASqF,cAAc,SAIrC,GAHAqN,EAAMC,YAAcsV,EAAMC,MAC1BU,EAAItjB,YAAYoN,GAEG,IAAfuV,EAAMY,KAAY,CAClB,MAAMja,EAAQ5O,SAASqF,cAAc,SACrCuJ,EAAMnM,KAAO,OACbmM,EAAM7F,UAAY,eAClB6F,EAAMkR,GAAKmI,EAAMC,MACjBtZ,EAAM3F,iBAAiB,QAAS8e,GAChCa,EAAItjB,YAAYsJ,EACpB,MAAO,GAAmB,IAAfqZ,EAAMY,KAAY,CACzB,MAAMtjB,EAASvF,SAASqF,cAAc,UACtCE,EAAOwD,UAAY,eACnBxD,EAAOua,GAAKmI,EAAMC,MAClBD,EAAMa,yBAAyB5hB,SAAS6hB,IACpC,MAAMP,EAASxoB,SAASqF,cAAc,UACtCmjB,EAAOtjB,MAAQ6jB,EAAIC,KACnBR,EAAO7V,YAAcoW,EAAIE,OACzB1jB,EAAOD,YAAYkjB,EAAO,IAE9BjjB,EAAO0D,iBAAiB,SAAU8e,GAClCa,EAAItjB,YAAYC,EACpB,CAEAqiB,EAAgBtiB,YAAYsjB,EAAI,IAmCpCb,KA7EID,EAAcliB,UAAUC,OAAO,SAOpB,IAuGnB6hB,EAASze,iBAAiB,SA9B1B,WAEIse,EAAWrgB,SAAS+gB,IAChB,MAAM9T,EAAUnU,SAAS0C,eAAeulB,EAAMC,OAC1C/T,IACIA,aAAmBiU,iBACnBjU,EAAQjP,MAAQ,GACTiP,aAAmBkU,oBAC1BlU,EAAQ+U,cAAgB,GAEhC,IAIJvB,EAAWhV,YAAc2U,EACzBD,EAAUC,CACd,IAeAG,EAASxe,iBAAiB,SAZ1B,WACI,IAAKoe,EAAS,OAEd,MAAM8B,EAAiBnpB,SAAS0C,eAAe,UAC3CymB,IACAA,EAAejkB,MAAQmiB,EACvB3hB,IAGR,GAIJ,CCynCI0jB,CAD8BppB,SAAS0C,eAAe,uBACVoZ,GAE5C9b,SAAS0C,eAAe,WAAWuG,iBAAiB,SAAS,IAAMvD,MACnE1F,SAAS0C,eAAe,cAAcuG,iBAAiB,SAAS,KFnnDlEjJ,SAAS2F,cAAc,qBAAqBC,UAAUC,OAAO,UAC7D7F,SAAS2F,cAAc,0BAA0BC,UAAUC,OAAO,OAAQ,UAG1E7F,SAAS0C,eAAe,cAAckD,UAAUE,IAAI,eACpD9F,SAAS0C,eAAe,uBAAuBkD,UAAUE,IAAI,OAAQ,aEgnDnEyV,GAAkB,SAAU,mBAAoB,OAEhD,MAAM8N,EAAOrpB,SAAS0C,eAAe,cAC/B4mB,EAAYtpB,SAAS0C,eAAe,QACpC6mB,EAAmBvpB,SAAS0C,eAAe,eAC3C8mB,EAAcxpB,SAAS0C,eAAe,UAGtC+mB,EAAuBzpB,SAAS0C,eAAe,gBAE/CgnB,EAA0B1pB,SAAS0C,eAAe,qBAClDinB,EAAwB3pB,SAAS0C,eAAe,mBAChDknB,EAAuB5pB,SAAS+J,iBAAiB,4CAGjD8f,EAAuB7pB,SAAS0C,eAAe,kBAC/ConB,EAAsB9pB,SAAS+J,iBAAiB,2CAOtD,GALA/J,SAAS0C,eAAe,qBAAqBuG,iBAAiB,SAAS,KAChEiK,GAAmB9B,EAAahJ,EAAc,IAIjDihB,GAAQC,GAAaE,GAAeI,EAAqBvpB,OAAS,GAAKypB,EAAoBzpB,OAAS,EAAG,CAEzG,MAAM0pB,EAA6BA,KACjC,GAAIL,EAAwBpQ,QAC1BqQ,EAAsBhX,YAAc+J,EAAWtV,KAAI4iB,GAAKA,EAAE/a,OAAMxH,KAAK,UAChE,CACL,MAAMU,EAAgBzB,MAAM+E,KAAKme,GAC9BhY,QAAOqY,GAAMA,EAAG3Q,SAAqB,qBAAV2Q,EAAGnK,KAC9B1Y,KAAI6iB,GAAMA,EAAGC,cAAcvX,YAAYlP,SAE1CkmB,EAAsBhX,YAAcxK,EAAc9H,OAC9C8H,EAAcV,KAAK,MACnB,iBACN,GAGI0iB,EAA4BA,KAChC,MAAMhiB,EAAgBzB,MAAM+E,KAAKqe,GAC9BlY,QAAOqY,GAAMA,EAAG3Q,SAAqB,oBAAV2Q,EAAGnK,KAC9B1Y,KAAI6iB,GAAMA,EAAGC,cAAcvX,YAAYlP,SAE1ComB,EAAqBlX,YAAcxK,EAAc9H,OAC7C8H,EAAcV,KAAK,MACnB,qBAAqB,EAI3B4hB,EAAKpgB,iBAAiB,UAAUlI,UAC9BzB,EAAE8d,iBAEFiM,EAAKtf,iBAAiB,eAAe7C,SAAQ5G,GAAKA,EAAEsF,UAAUC,OAAO,gBAErE,IAAIukB,GAAQ,EAEPd,EAAUpkB,MAAMzB,SAAU6lB,EAAU1jB,UAAUE,IAAI,cAAeskB,GAAQ,GACzEZ,EAAYtkB,MAAMzB,SAAU+lB,EAAY5jB,UAAUE,IAAI,cAAeskB,GAAQ,GAGlF,MAAMC,EAAyB3jB,MAAM+E,KAAKqe,GACvClY,QAAOqY,GAAMA,EAAG3Q,SAAqB,oBAAV2Q,EAAGnK,KAC9B1Y,KAAI6iB,GAAMA,EAAG/kB,QAShB,GAPKmlB,EAAuBhqB,OAI1BL,SAAS0C,eAAe,sBAAsBZ,MAAMoc,QAAU,QAH9Dle,SAAS0C,eAAe,sBAAsBZ,MAAMoc,QAAU,QAC9DkM,GAAQ,IAKLA,EAAO,OAEZ,MAAME,EAAmB5jB,MAAM+E,KAAKme,GACjChY,QAAOqY,GAAMA,EAAG3Q,SAAqB,qBAAV2Q,EAAGnK,KAC9B1Y,KAAI6iB,GAAMvN,EAAWlU,MAAKsS,GAAKA,EAAElS,IAAMqhB,EAAG/kB,UAEvCqlB,EAAoBb,EAAwBpQ,QAC5CkR,EAAiBf,EAAqBnQ,QACtCmR,EAAUtO,EAASsD,MAAMjX,MAAKoS,GAAyB,YAAnBA,EAAG/R,cAEvC6hB,EAAW,CACf7hB,YAAaygB,EAAUpkB,MAAMzB,OAC7BmT,OAAQ4S,EAAYtkB,MAAMzB,OAC1BknB,YAAapB,EAAiBrkB,MAAMzB,OACpCmnB,eAAgBN,EAChBO,UAAWN,EAAoB,EAAI,EACnCO,aAAcN,EACdO,YAAa,IACbC,uBAAwB,IACxBC,yBAA0B,IAC1BtiB,OAAQ,EACRuiB,eAAgB/O,EAAS+O,eACzBxI,aAAcvG,EAASvT,GAGvBie,aAAcwD,EAAuB5iB,KAAK,KAE1C0jB,kBAAmBV,EAAQ7hB,GAC3BwiB,mBAAoB,SAmP9BrqB,eAAgCE,GAC9B,IACE,MAAMwhB,EAAcziB,SAAS0C,eAAe,iBACtC2oB,EAAiBrrB,SAAS0C,eAAe,qBAG9C2oB,EAAqCrT,UAAW,EACjDyK,EAAY9f,UAAY,4DACvB8f,EAAkCzK,UAAW,EAC9C9E,GAAoB,EAEpB,MAAMlN,QLz6DHjF,eAA2BE,EAAcC,GAC9C,MAAMC,QAAiBC,MAAM,GAAGN,6BAAoC,CAClEO,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUJ,KAE7BK,KAAMC,KAAKC,UAAUR,KAGvB,IAAKE,EAASO,GACZ,MAAM,IAAInB,MAAM,gCAIlB,aADwBY,EAASQ,MAEnC,CKy5DuB2pB,CAAYrqB,EAASC,GACxCgS,GAAoB,EAEhBlN,EAAW,MAAKA,EAAa,QAC/BmY,KACA5b,EAAQ,qBAAsB,aAE7B8oB,EAAqCrT,UAAW,EAChDyK,EAAkCzK,UAAW,EAC9CyK,EAAY9f,UAAY,8CACxBJ,EAAQ,uBAAwB,SAIpC,CAAE,MAAO+D,GACP/D,EAAQ,uBAAwB,SAChCgE,QAAQD,MAAM,sCAAuCA,EACvD,CACF,CA7QcilB,CAAiBb,EAAS,IAGlC,MAAMc,EAA0BA,KAC9B5B,EAAqB1iB,SAAQ+iB,IACtBA,EAAGjS,WACNiS,EAAG3Q,SAAU,EACb2Q,EAAGjS,UAAW,EAChB,IAEF+R,GAA4B,EAGxB0B,EAAiBA,KACrB7B,EAAqB1iB,SAAQ+iB,IACFtD,EAAezM,MAAKwR,GAAOA,EAAI9iB,KAAOyE,SAAS4c,EAAG/kB,WACpD+kB,EAAGjS,UAAW,EAAK,IAE5C+R,GAA4B,EAG9BN,EAAqBxgB,iBAAiB,UAAU,WACzCiK,IACC9T,KAAKka,SACPoQ,EAAwB1R,UAAW,EACnC2R,EAAsB3R,UAAW,IAEjCyT,IACA/B,EAAwBpQ,SAAU,EAClCoQ,EAAwB1R,UAAW,EACnC2R,EAAsB3R,UAAW,EAEjC4R,EAAqB1iB,SAAQ+iB,IACtBA,EAAGjS,WACNiS,EAAG3Q,SAAU,EACb2Q,EAAGjS,UAAW,EAChB,IAGF+R,KAGN,IAIAL,EAAwBzgB,iBAAiB,UAAU,WAC5CiK,IACH9T,KAAKka,QAAUkS,IAA4BC,IAE/C,IAGAhC,EAAqBnQ,SAAU,EAC/BoQ,EAAwBpQ,SAAU,EAElCmQ,EAAqBkC,cAAc,IAAIC,MAAM,WAC7ClC,EAAwBiC,cAAc,IAAIC,MAAM,WAChD5rB,SAAS+J,iBAAiB,0BAA0B7C,SAAQG,IAC1DA,EAAK4B,iBAAiB,SAAS,SAAU3J,GACvCA,EAAEusB,kBACF,MAAM3S,EAAW9Z,KAAKuG,cAAc,4CACpC,GAAKuT,EAAL,CAEA,GAAoB,qBAAhBA,EAAS4G,GAA2B,CACtC,MAAM3G,EAAYD,EAASI,QAC3BsQ,EAAqB1iB,SAAQ+iB,IACtBA,EAAGjS,WAAUiS,EAAG3Q,QAAUH,EAAS,GAE5C,CAEA4Q,GATqB,CAUvB,GAAE,IAGJ/pB,SAAS+J,iBAAiB,yBAAyB7C,SAAQG,IACzDA,EAAK4B,iBAAiB,SAAS,SAAU3J,GACvCA,EAAEusB,kBACF,MAAM3S,EAAW9Z,KAAKuG,cAAc,2CACpC,IAAKuT,EAAU,OAEf,GAAoB,oBAAhBA,EAAS4G,GAA0B,CACrC,MAAM3G,EAAYD,EAASI,QAC3BwQ,EAAoB5iB,SAAQ+iB,IAC1BA,EAAG3Q,QAAUH,CAAS,GAE1B,CAEAgR,IACA,MAAM2B,EAAgBplB,MAAM+E,KAAKqe,GAC9BlY,QAAOqY,GAAMA,EAAG3Q,UAASjZ,OAG1BL,SAAS0C,eAAe,sBAAsBZ,MAAMoc,QADhC,IAAlB4N,EAC4D,QAEA,MAGlE,GAAE,IAGJ/B,IACAI,IAEA,CAACb,EAAWE,GAAatiB,SAAQ+gB,IAC/BA,EAAMhf,iBAAiB,SAAS,WAC1B7J,KAAKwG,UAAUwb,SAAS,eAAiBhiB,KAAK8F,MAAMzB,QACtDrE,KAAKwG,UAAUC,OAAO,aAE1B,GAAE,GAGN,MACEU,QAAQD,MAAM,6BAElB,CACF,CAGOvF,eAAeqS,GAAe3Q,GACnC,MAAMwV,EAAYjY,SAAS0C,eAAe,sBAC1C,IAAKuV,EAAW,OAEhB,MAAM8T,EAAkBzhB,eAAeyS,QAAQ,gBAAkB,GAC3DiP,EAAe1hB,eAAeyS,QAAQ,iBAAmBnP,GAC/D,IAAIqe,EAAyB,WAATxpB,EAAoBspB,EAAkBC,EAC1D/T,EAAUtV,UHtzDZ,SAA6BupB,EAAuBzpB,GAClD,MAAM+G,EAAmB,SAAVxB,GACTmkB,EAAa3iB,EAAS,qBAAuB,qBAG7C4iB,EAA0B,WAAT3pB,EAAmB,GAAG,8JAgD7C,MAAO,iHAGuB0pB,+EArDP,WAAT1pB,EAAoB,oBAAsB,wHAIpB0pB,gDAHR,WAAT1pB,EAAoBma,GAAmBhb,GAKnDwF,KAAI2hB,IACH,MAAM7jB,EAAiB,WAATzC,EAAoBsmB,EAAI9Z,KAAO8Z,EAAIjnB,MAIjD,MAAO,kBAAkBoD,MAHNA,IAAUgnB,EAGmB,WAAa,4BAFvC,WAATzpB,EAAoBsmB,EAAI9Z,KAAO8Z,EAAIjnB,oCAI9B,IAEnB2F,KAAK,+0BA8CJ2kB,mHAI0C5iB,EAAS,YAAc,8NAO3E,CG2uDwB6iB,CAAoBJ,EAAUxpB,GAEpD,MAAM6pB,EAAYtsB,SAAS0C,eAAe,6BACpC6pB,EAAQvsB,SAAS0C,eAAe,8BAChC8pB,EAAWxsB,SAAS0C,eAAe,+BACnC+pB,EAAezsB,SAAS0C,eAAe,oCAEvCgqB,EAAaA,KACjB,IAAKF,IAAaC,EAAc,OAChC,IAAIR,EAOJ,GALEA,EADW,WAATxpB,EACSma,GAAiBpU,MAAKqS,GAAKA,EAAE5L,OAASud,EAAStnB,QAE/CtD,EAAgB4G,MAAKqS,GAAKA,EAAE/Y,QAAU0qB,EAAStnB,QAGxD+mB,GAAqB,QAATxpB,EAAgB,CAQ9B,GANAiE,MAAM+E,KAAKghB,EAAa5lB,MAAMK,SAAQW,IACpCnB,MAAM+E,KAAK5D,EAAI2D,OAAOtE,SAAQ0E,GAASA,EAA8B+gB,gBAAgB,UAAS,IAG5FV,EAASjqB,aAAYyqB,EAAa3qB,MAAM8qB,QAAUX,EAASjqB,YAE3DiqB,EAASlqB,YAAa,CACxB,MAAM8qB,EAAQJ,EAAa9mB,cAAc,SACrCknB,GACFnmB,MAAM+E,KAAKohB,EAAMhmB,MAAMK,SAAQW,IAC7BnB,MAAM+E,KAAK5D,EAAI2D,OAAOtE,SAAQ0E,IAC3BA,EAA8B9J,MAAM8qB,QAAUX,EAASlqB,WAAY,GACpE,GAGR,CAEIkqB,EAAS9pB,YAAc8pB,EAAShqB,UAClCyE,MAAM+E,KAAKghB,EAAa5lB,MAAMK,SAAQ,CAACW,EAAKzD,KAC1CsC,MAAM+E,KAAK5D,EAAI2D,OAAOtE,SAAQ,CAAC0E,EAAMF,KACjB,IAAdA,GAA6B,IAAVtH,IACpBwH,EAA8B9J,MAAM8qB,QAAU,oBACjD,GACA,IAIkB,UAApBX,EAAS/pB,QAAsB+pB,EAAShqB,SAC1CyE,MAAM+E,KAAKghB,EAAa5lB,MAAMK,SAAQ,CAACW,EAAKzD,KACtCA,EAAQ,GAAM,IAAIyD,EAA4B/F,MAAM8qB,QAAUX,EAAShqB,SAAS,IAEzD,YAApBgqB,EAAS/pB,QAAwB+pB,EAAShqB,SACnDyE,MAAM+E,KAAKghB,EAAa5lB,MAAMK,SAAQ,CAACW,EAAKzD,KAC1CsC,MAAM+E,KAAK5D,EAAI2D,OAAOtE,SAAQ,CAAC0E,EAAMF,KACjB,IAAdA,EACDE,EAA8B9J,MAAM8qB,QAAUX,EAAS9pB,WACpD8pB,EAASjqB,WAAc,oBACvBiqB,EAASjqB,WACJoC,EAAQ,GAAM,IACtBwH,EAA8B9J,MAAM8qB,QAAUX,EAAShqB,SAC1D,GACA,IAEyB,SAApBgqB,EAAS/pB,QAClBwE,MAAM+E,KAAKghB,EAAa5lB,MAAMK,SAAQ,CAACW,EAAKzD,KAC1CsC,MAAM+E,KAAK5D,EAAI2D,OAAOtE,SAAQ,CAAC0E,EAAMF,KACnC,MAAM3J,EAAwB,IAAVqC,EAAc6nB,EAASlqB,YAAe,GACxC,IAAd2J,GAAmBugB,EAAS9pB,WAC7ByJ,EAA8B9J,MAAM8qB,QACnCX,EAASjqB,WAAc,oBAAsBD,EAE9C6J,EAA8B9J,MAAM8qB,QAAUX,EAASjqB,WAAcD,CACxE,GACA,GAGR,MAEE0qB,EAAa9pB,UAFJspB,EAEgBA,EAASa,QAET,EAC3B,EAIFJ,IACAF,GAAUvjB,iBAAiB,SAAUyjB,GAEjCJ,GAAWA,EAAUrjB,iBAAiB,SAAS,IAAOgP,EAAUtV,UAAY,KAC5E4pB,GAASC,GACXD,EAAMtjB,iBAAiB,SAAS,KAC9B,GAAa,WAATxG,EAAmB,CACrB,MAAMwpB,EAAWrP,GAAiBpU,MAAKqS,GAAKA,EAAE5L,OAASud,EAAStnB,QAChEyH,GAAaoB,OAASke,EAASpN,QAAQC,YACvCnS,GAAamB,QAAUme,EAASpN,QAAQE,aACxCpS,GAAaqB,UAAYie,EAASpN,QAAQG,eAC1CrS,GAAaqI,WAAY,EACzBrI,GAAaE,iBAAmBof,EAASpN,QAAQhS,iBACjDF,GAAaC,aAAeqf,EAASpN,QAAQjS,aAC7CtC,eAAeC,QAAQ,cAAe0hB,EAAShd,MAC/CrB,GAAaqe,EAASpN,QAAQI,SAChC,MACEtS,GAAaqI,WAAY,EACzBpH,GAAa4e,EAAStnB,MACtBoF,eAAeC,QAAQ,eAAgBqD,IAIzCtD,eAAeC,QAAQ,eAAgB/I,KAAKC,UAAUkL,KACtDrC,eAAeC,QAAQ,aAAcqD,IAErCqK,EAAUtV,UAAY,EAAE,GAG9B,CAkCO,SAAS4Y,GAAkBwR,EAAYC,EAAY5O,GAQxD,IAAI6O,GAAoB,EAExB,MAAMzD,EAAcxpB,SAAS0C,eAAe,GAAGqqB,KACzCG,EAAkBltB,SAAS0C,eAAe,GAAGsqB,KACnD,GAAIxD,EAAa,CAgFf,SAAS2D,EAAsBrN,GAC7B,MAAMjS,EAAQ7N,SAAS+J,iBAAiB,IAAI+V,oBAEtCsN,GADWptB,SAAS0C,eAAe,GAAGod,KACzBjS,EAAMxN,QAMzB,GAHAwN,EAAM3G,SAAQG,GAAQA,EAAKzB,UAAUC,OAAO,YAGxConB,GAAoB,GAAKA,EAAmBG,EAAY,CAC1D,MAAMC,EAAkBxf,EAAMof,GAC9BI,EAAgBznB,UAAUE,IAAI,UAG9BunB,EAAgBC,eAAe,CAC7BC,SAAU,SACVC,MAAO,WAEX,CACF,CAhGAhE,EAAYvgB,iBAAiB,SAAU3J,IACrC,MAAMmuB,EAAiBjE,EAAYkE,eAC7BC,EAAmBnE,EAAYtkB,MAAMiM,MAAM,EAAGsc,GAC9CG,EAAcD,EAAiBE,YAAY,KACjD,IAAqB,IAAjBD,EAAoB,CACtB,MAAME,EAAQH,EAAiBxc,MAAMyc,EAAc,GAAGnqB,OACtD,GAAIqqB,EAAMztB,OAAS,EAAG,CACpB,MAAM+R,EArBU0b,IAEL1lB,EAAcwJ,QAAOvK,GAAwB,IAAhBA,EAAKsB,SAAciJ,QAAOvK,GACtEA,EAAKwB,YAAYP,cAAcuJ,SAASic,EAAMxlB,iBAkBzBylB,CAAeD,GAEhC,GAAI1b,EAAS/R,OAAS,EAAG,CACvB6sB,EAAgBvqB,UAAYyP,EAAShL,KAAIC,IACvC,IAAI2mB,EAAc,GAOlB,OALEA,EADa,QAAX5P,EACY,IAAI/W,EAAKwB,eAETxB,EAAK8H,aAAe,IAAI9H,EAAKwB,eAGtC,gDAAgDmlB,MAAgB3mB,EAAKwB,kBAAkB,IAC7FpB,KAAK,IAGR,MAAMwmB,EAAezE,EAAY0E,wBACjChB,EAAgBprB,MAAMqsB,KAAO,GAAGF,EAAaE,SAC7CjB,EAAgBprB,MAAMuM,OAAS,OAC/B6e,EAAgBprB,MAAMoc,QAAU,OAClC,MACEgP,EAAgBprB,MAAMoc,QAAU,MAEpC,MACEgP,EAAgBprB,MAAMoc,QAAU,MAEpC,MACEgP,EAAgBprB,MAAMoc,QAAU,MAClC,IAKFsL,EAAYvgB,iBAAiB,WAAY3J,IACvC,MAAMuO,EAAQ7N,SAAS+J,iBAAiB,IAAIijB,oBACtCI,EAAavf,EAAMxN,OAEzB,GAAc,cAAVf,EAAEV,IAEJU,EAAE8d,iBAGE6P,EAAmBG,EAAa,EAClCH,IAEAA,EAAmB,EAErBE,EAAsB,GAAGH,UACpB,GAAc,YAAV1tB,EAAEV,IAEXU,EAAE8d,iBAGE6P,EAAmB,EACrBA,IAEAA,EAAmBG,EAAa,EAElCD,EAAsB,GAAGH,UACpB,GAAc,UAAV1tB,EAAEV,MAAyC,IAAtBquB,EAAyB,CAEvD,MAAMmB,EAAevgB,EAAMof,GACvBmB,IACFC,EAAcD,EAAaxZ,aAAa,sBACxCsY,EAAgBprB,MAAMoc,QAAU,OAChC5e,EAAE8d,iBAEN,KA4BF8P,EAAgBjkB,iBAAiB,SAAU3J,IACzC,GAAIA,EAAE+Z,QAAU/Z,EAAE+Z,OAAOiV,QAAQ,MAAO,CACtC,MAAMN,EAAc1uB,EAAE+Z,OAAOzE,aAAa,qBAC1CyZ,EAAcL,GACdd,EAAgBprB,MAAMoc,QAAU,MAClC,KAIF,MAAMmQ,EAAiBL,IACrB,MAAMO,EAAWvuB,SAAS0C,eAAe,GAAGqqB,KACtCyB,EAAeD,EAASrpB,MACxBuoB,EAAiBc,EAASb,eAE1Be,EAAaD,EAAard,MAAM,EAAGsc,GACnCiB,EAAYF,EAAard,MAAMsc,GAE/BkB,EAAmBF,EAAWZ,YAAY,KAC1Ce,EAAoBH,EAAWtd,MAAM,EAAGwd,GAE9CJ,EAASrpB,MAAQ,GAAG0pB,IAAoBZ,IAAcU,IACtD,MAAMG,EAAoBD,EAAkBvuB,OAAS2tB,EAAY3tB,OACjEkuB,EAASO,kBAAkBD,EAAmBA,EAAkB,EAIlE7uB,SAASiJ,iBAAiB,SAAU3J,IAC7B4tB,EAAgB9L,SAAS9hB,EAAE+Z,SAAW/Z,EAAE+Z,SAAWmQ,IACtD0D,EAAgBprB,MAAMoc,QAAU,OAClC,GAEJ,CACF,CAEA,SAASjZ,GAAaC,GACpB,OAAOA,EACHA,EACC1E,QAAQ,SAAU,IAClBA,QAAQ,OAAQ,IAChBA,QAAQ,QAAS,IACjBA,QAAQ,OAAQ,IACjB,EACN,CAQA,SAAS8e,GAAsBpa,GAC7B,IAAKA,GAA0B,KAAjBA,EAAMzB,OAClB,OAAOyB,EAGT,MAAM6pB,EAAQ7pB,EAAM+E,MAAM,KAC1B,OAAI8kB,EAAM1uB,QAAU,EACX6E,EAGF6pB,EAAM5d,MAAM,GAAG1J,KAAK,KAAKjH,QAAQ,OAAQ,KAAKA,QAAQ,OAAQ,IACvE,CAIO,SAAS8a,GAA0BvT,GACxC,MAAMyB,EAAmB,SAAVxB,GACTgnB,EAAWxlB,EAAS,+BAAiC,6BACrDylB,EAAoBzlB,EAAS,kCAAoC,4BACjEgJ,EAAYhJ,EAAS,qBAAuB,qBAG5C0lB,EAAiB3W,EAAW7D,QAAO,CAACya,EAAQ3W,KAC3C2W,EAAO3W,EAAOsO,cAAaqI,EAAO3W,EAAOsO,YAAc,IAC5DqI,EAAO3W,EAAOsO,YAAY1gB,KAAKoS,GACxB2W,IACN,CAAC,GAEEC,EAAkB,kPAMHJ,mcAQYC,8MAGMzc,+VAQ7B1T,OAAOmI,KAAKioB,GACjB9nB,KAAI,CAACioB,EAAOC,KACX,MAAMC,EAAaL,EAAeG,GAC/BjoB,KACC,CAACoR,EAAQpU,IAAU,qDACmBoO,wDAAgE8c,KAAclrB,mJAEjCoU,EAAO4G,0BAA0BkQ,KAAclrB,6FACvDkrB,KAAclrB,MAAUoU,EAAO4G,8FAK3G3X,KAAK,IAER,MAAO,+FAEgC+K,2BAAmC8c,8IAEUD,gBAAoBC,+EACvCA,MAAeD,+EAGtEE,mBACH,IAER9nB,KAAK,mSAWJ+nB,EAAgBxvB,SAAS0C,eAAe,cAC9C8sB,EAAc7sB,UAAYysB,EAE1B,IAAI/M,EAAkB,GAEtB,MAAMoN,EAAoBzvB,SAAS0C,eAAe,aAC5CgtB,EAAkB1vB,SAAS+J,iBAAiB,mBAC5C4lB,EAAuB3vB,SAAS+J,iBAAiB,oBACjD6lB,EAAsB5vB,SAAS0C,eAAe,uBAEpD,SAASmtB,IACPD,EAAoB/jB,UAAYwW,EAAgBhiB,OAAS,EAAIgiB,EAAgB5a,KAAK,MAAQ,GAC5F,CAGAgoB,EAAkBxmB,iBAAiB,UAAU,WAC3C,MAAMqQ,EAAUla,KAAKka,QACrBoW,EAAgBxoB,SAAQ+iB,GAAMA,EAAG3Q,QAAUA,IAC3CqW,EAAqBzoB,SAAQ+iB,IAC3BA,EAAG3Q,QAAUA,EACTA,IAAY+I,EAAgBxQ,SAASoY,EAAG/kB,QAC1Cmd,EAAgBjc,KAAK6jB,EAAG/kB,OAErBoU,IACH+I,EAAkB,GACpB,IAEFwN,GACF,IAGAH,EAAgBxoB,SAAQ4oB,IACtBA,EAAQ7mB,iBAAiB,UAAU,WACjC,MAAMqmB,EAAalwB,KAAK0gB,GAAG7V,MAAM,KAAK,GACnBjK,SAAS+J,iBAAiB,8BAA8BulB,yBAEhEpoB,SAAQ+iB,IACjBA,EAAG3Q,QAAUla,KAAKka,QACdla,KAAKka,UAAY+I,EAAgBxQ,SAASoY,EAAG/kB,QAC/Cmd,EAAgBjc,KAAK6jB,EAAG/kB,OAErB9F,KAAKka,UACR+I,EAAkBA,EAAgBzQ,QAAOiJ,GAAKA,IAAMoP,EAAG/kB,QACzD,IAIFuqB,EAAkBnW,QAAU5S,MAAM+E,KAAKkkB,GAAsBI,OAAMC,GAASA,EAAM1W,UAClFuW,GACF,GAAE,IAIJF,EAAqBzoB,SAAQ+iB,IAC3BA,EAAGhhB,iBAAiB,UAAU,WACxBghB,EAAG3Q,QACA+I,EAAgBxQ,SAASoY,EAAG/kB,QAAQmd,EAAgBjc,KAAK6jB,EAAG/kB,OAEjEmd,EAAkBA,EAAgBzQ,QAAOiJ,GAAKA,IAAMoP,EAAG/kB,QAIzD,MAAMoqB,EAAarF,EAAGnK,GAAG7V,MAAM,KAAK,GAC9BslB,EAAavvB,SAAS+J,iBAAiB,8BAA8BulB,yBACrDtvB,SAAS0C,eAAe,SAAS4sB,KACzChW,QAAU5S,MAAM+E,KAAK8jB,GAAYQ,OAAMC,GAASA,EAAM1W,UAGpEmW,EAAkBnW,QAAU5S,MAAM+E,KAAKkkB,GAAsBI,OAAMC,GAASA,EAAM1W,UAElFuW,GACF,GAAE,IAIA9nB,EAAIE,SAAWF,EAAIE,QAAQ5H,OAAS,IACtCsvB,EAAqBzoB,SAAQ+iB,IACvBliB,EAAIE,QAAQ4J,SAASoY,EAAG/kB,SAC1B+kB,EAAG3Q,SAAU,EACb+I,EAAgBjc,KAAK6jB,EAAG/kB,OAC1B,IAIFwqB,EAAgBxoB,SAAQ4oB,IACtB,MAAMR,EAAaQ,EAAQhQ,GAAG7V,MAAM,KAAK,GACnCslB,EAAavvB,SAAS+J,iBAAiB,8BAA8BulB,yBAC3EQ,EAAQxW,QAAU5S,MAAM+E,KAAK8jB,GAAYQ,OAAMC,GAASA,EAAM1W,SAAQ,IAIxEmW,EAAkBnW,QAAU5S,MAAM+E,KAAKkkB,GAAsBI,OAAMC,GAASA,EAAM1W,UAClFuW,KAIF7vB,SAAS0C,eAAe,cAAcuG,iBAAiB,SAAS,WAC9DlB,EAAIE,QAAU,IAAIoa,GAClB,MAAM4N,EAAgB1X,EAAW3G,QAAO4G,GAAU6J,EAAgBxQ,SAAS2G,EAAO4G,cAClFrX,EAAIwa,gBAAkB0N,EAAc7oB,KAAKC,GAChCA,EAAKqR,SAAWjb,OAAO4J,EAAKqR,UAAYrR,EAAKiR,cAGtDvQ,EAAIqX,WAAa6Q,EAAc7oB,KAAKC,GAC3BA,EAAK+X,aAGdrX,EAAIqa,cAAgB6N,EAAc7oB,KAAKC,GAC9B5J,OAAO4J,EAAKqR,YAGrB3Q,EAAIuQ,YAAc2X,EACf7oB,KAAIoR,GAAUA,EAAOF,cACxBkX,EAAc7sB,UAAYmF,EAAWC,GACrCkP,EAA0BlP,EAAK7G,EAAKkH,EACtC,IAGApI,SAAS0C,eAAe,kBAAkBuG,iBAAiB,SAAS,WAClEumB,EAAc7sB,UAAYmF,EAAWC,GACrCkP,EAA0BlP,EAAK7G,EAAKkH,EACtC,GACF,CAsEA,SAAS8nB,GAAkBruB,GACzB,OAAOA,EAAKoI,MAAM,WAAW,GAAGzJ,QAAQ,KAAM,IAChD,CAr+EAjB,OAAO0J,iBAAiB,cAAc,KAEvB,gBADA1J,OAAOQ,SAASnC,MACCie,IAC5BA,GAAc,EAmLhBY,EAAShE,OAAOnO,eAAeyS,QAAQ,WAEvCoB,KAlLA,IAIFlN,OAAOkf,SAASC,IACVA,EAAKC,OAASpf,OAAOqf,SAASptB,OAChClD,SAAS0C,eAAe,YAAYZ,MAAMoc,QAAU,OACpDle,SAAS0C,eAAe,UAAUmJ,UAAY,KAAK8Q,0CACpC3c,SAAS0C,eAAe,UAEvCnD,OAAOQ,SAASnC,KAAO,UAiB3BmD,iBACE,UACQmC,KAAKuH,KAAI1J,UACb,MAAMwvB,EAAa5lB,EAAQ3K,SAASuwB,WAAWC,iBAC/CD,EAAWplB,KAAK,eAEVR,EAAQG,OACd,MAAM2lB,EAAWF,EAAW1iB,MAAMrF,MAAK/I,GAAqB,eAAbA,EAAKb,MAC9C8xB,EAAUH,EAAW1iB,MAAMrF,MAAK/I,GAAqB,iBAAbA,EAAKb,MACnD,IAAI6xB,IAAYC,EAQd,OAHA1wB,SAAS0C,eAAe,YAAYC,UAAY,sHAEhD4D,QAAQsb,IAAI,2CACL,KAPPnG,EAAa+U,EAASvrB,MACtByW,EAAmB+U,EAAQxrB,MAC3B2X,IAMF,GAEJ,CAAE,MAAOvW,GACPC,QAAQD,MAAM,oCAAqCA,EACrD,CAEF,CAxCIqqB,GAEA1f,OAAOtG,QAAQ3K,SAASylB,gBACtBxU,OAAOyU,UAAUC,0BACjB,MAw5EN5kB,iBACSmC,KAAKuH,KAAI1J,UAEd,MAAM6vB,QA2CV7vB,eAAyC4J,GACvC,MACMD,EADYC,EAAQ3K,SAAS4K,eACPC,eAE5B,aADMF,EAAQG,OACPJ,EAAUxF,OAAS,EAC5B,CAhD+B2rB,CAA0BlmB,GAC/CD,EAsDV,SAA+BA,GAK7B,OAHmBhE,MAAM+E,KAAK,IAAI7E,IAAI8D,EAAUtD,IAAI8oB,MAGlCte,QAAO/P,GACvBuG,EAAc8R,MACZ3S,GAAkB,IAAbA,EAAEoB,SACJpB,EAAEsB,YAAYP,gBAAkBzG,EAAKyG,eACpC,KAAKf,EAAEqB,KAAKN,gBAAkBzG,EAAKyG,kBAG7C,CAlEsBwoB,CAAsBF,GAExC,GAAyB,IAArBlmB,EAAUrK,OAAd,CASA,GAHAL,SAAS0C,eAAe,0BACpBkD,UAAUpF,QAAQ,SAAU,WAE5BkK,EAAUrK,OAAS,EAGrB,OAFA8H,EAAgBuC,OAChBxC,EAAmBC,EAAeC,GAMpC,GADiBpI,SAAS0C,eAAe,cAC3B,CACZ,MAAMquB,EAAgBrmB,EAAU,GAChCvC,EAAgB,CAAC4oB,GACjB7nB,EAAoC6nB,GAEpC,MAAMtoB,EAAQL,EAAcI,MAAKjB,GAClB,IAAbA,EAAEoB,SACDpB,EAAEsB,YAAYP,gBAAkByoB,EAAczoB,eAC7C,KAAKf,EAAEqB,KAAKN,gBAAkByoB,EAAczoB,iBAGhD,IAAKG,EAAO,OAEZ,MAAMU,EAAUnJ,SAAS0C,eAAe,YACxCyG,EAAQxG,UAAY,+CAEpBwG,EAAQxG,gBAAkByG,EAAwBX,EACpD,CA9BA,MAHEzI,SAAS0C,eAAe,0BACpBkD,UAAUpF,QAAQ,UAAW,SAgCnC,GAIJ,CAn8EQwwB,EAAyB,IAG/B,G,wBf5EE7zB,EAA6B,IAAI6S,IAAI,cACrC5S,EAA6B,IAAI4S,IAAI,cAEH,IAAyC7S,GACzC,IAAyCC,E","sources":["webpack://office-addin-taskpane/./src/taskpane/index.html","webpack://office-addin-taskpane/./node_modules/html-loader/dist/runtime/getUrl.js","webpack://office-addin-taskpane/webpack/bootstrap","webpack://office-addin-taskpane/webpack/runtime/compat get default export","webpack://office-addin-taskpane/webpack/runtime/define property getters","webpack://office-addin-taskpane/webpack/runtime/global","webpack://office-addin-taskpane/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane/webpack/runtime/publicPath","webpack://office-addin-taskpane/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane/./src/taskpane/data.ts","webpack://office-addin-taskpane/./src/taskpane/api.ts","webpack://office-addin-taskpane/./src/taskpane/components/tablestyles.ts","webpack://office-addin-taskpane/./src/taskpane/components/bodyelements.ts","webpack://office-addin-taskpane/./src/taskpane/functions.ts","webpack://office-addin-taskpane/./src/taskpane/components/home.ts","webpack://office-addin-taskpane/./src/taskpane/taskpane.ts"],"sourcesContent":["// Imports\nimport ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___ from \"../../node_modules/html-loader/dist/runtime/getUrl.js\";\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\nvar ___HTML_LOADER_IMPORT_1___ = new URL(\"./css/bootstrap3.css\", import.meta.url);\n// Module\nvar ___HTML_LOADER_REPLACEMENT_0___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_0___);\nvar ___HTML_LOADER_REPLACEMENT_1___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_1___);\nvar code = \" <!DOCTYPE html> <html> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>Link addin</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css\\\"/> <link href=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" integrity=\\\"sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65\\\" crossorigin=\\\"anonymous\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\\\"> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_0___ + \"\\\" rel=\\\"stylesheet\\\"/> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_1___ + \"\\\" rel=\\\"stylesheet\\\"/> <\" + \"script src=\\\"https://kit.fontawesome.com/5aabee8816.js\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css\\\"/> <\" + \"script src=\\\"https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js\\\"><\" + \"/script> </head> <body class=\\\"ms-font-m ms-welcome ms-Fabric\\\"> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\\\" integrity=\\\"sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <div id=\\\"header-nav\\\"> <div class=\\\"logo-header d-flex w-100 justify-content-between align-items-center bg-light\\\" id=\\\"logo-header\\\"> </div> </div> <main id=\\\"app-body\\\" class=\\\"d-block mh-34\\\"> <div id=\\\"ai-tag-list-container\\\" class=\\\"accordion\\\"></div> </main> <section id=\\\"confirmation-popup\\\"></section> <section id=\\\"toastr\\\"></section> <div id=\\\"footer\\\" class=\\\"py-2 text-center footer\\\"> </div> </body> </html>\";\n// Exports\nexport default code;","\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    // eslint-disable-next-line no-param-reassign\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n  url = String(url.__esModule ? url.default : url);\n  if (options.hash) {\n    // eslint-disable-next-line no-param-reassign\n    url += options.hash;\n  }\n  if (options.maybeNeedQuotes && /[\\t\\n\\f\\r \"'=<>`]/.test(url)) {\n    return \"\\\"\".concat(url, \"\\\"\");\n  }\n  return url;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","const dataUrl='https://plsdevapp.azurewebsites.net'\r\nconst storeUrl='https://akhil-pws.github.io/ApplyGlossaryWordPane'\r\nconst versionLink='2.4.4'\r\nexport {dataUrl,storeUrl,versionLink};","import { dataUrl } from \"./data\";\r\n\r\n// api.ts\r\nconst baseUrl = dataUrl // Set your actual base URL\r\n\r\nexport async function loginUser(organization: string, username: string, password: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/user/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      ClientName: organization,\r\n      Username: username,\r\n      Password: password\r\n    })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\n// api.ts\r\n\r\nexport async function getReportById(documentID: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/id/${documentID}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAllClients(userId: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/client/all/${userId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAiHistory(tagId: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/${tagId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function updateGroupKey(tag: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/head/groupkey`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(tag)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function addAiHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function updateAiHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/update`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function fetchGlossaryTemplate(clientId: string, bodyText: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/glossary-template/client-id/${clientId}`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(bodyText)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function addGroupKey(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/group-key/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAllPromptTemplates(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/prompt-template/all`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getPromptTemplateById(id: string, jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/prompt-template/${id}/data`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function updatePromptTemplate(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/groupkey/update-prompt`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function getAllCustomTables(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/custom-table/all`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function getGeneralImages(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/image/general`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function getReportHeadImageById(id: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/image/report-head/${id}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n  const data: any = await response.json();\r\n  return data;\r\n};","export const wordTableStyles = [\r\n  // Plain Tables\r\n  {\r\n    name: \"Plain White Table\",\r\n    style: \"Table Grid\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #000;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: false\r\n  },\r\n  {\r\n    name: \"Plain Table with Gray Alternating Rows\",\r\n    style: \"Plain Table 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #000;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n\r\n  // Grid Table 1 Variants (Header + Alternating Rows)\r\n  {\r\n    name: \"Plain Header Table with Light Gray Alternating Rows\",\r\n    style: \"Grid Table 2\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Blue Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 1\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#dbe5f1;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Pink Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 2\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#f2dbdb;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Green Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 3\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#eaf1dd;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Purple Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 4\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#e5dfec;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Teal Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 5\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#daeef3;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Orange Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 6\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#fde9d9;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n\r\n  // Header Only Tables\r\n  {\r\n    name: \"Black Header Only Table with White Rows\",\r\n    style: \"List Table 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Blue Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Red Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 2\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Green Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Purple Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Teal Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 5\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Orange Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 6\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n\r\n  // Grid Table 4 Variants\r\n  {\r\n    name: \"Black Header Table with Light Gray Alternating Rows\",\r\n    style: \"Grid Table 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Blue Header Table with Light Blue Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#dbe5f1;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Red Header Table with Pink Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 2\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2dbdb;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Green Header Table with Light Green Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#eaf1dd;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Purple Header Table with Light Purple Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#e5dfec;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Teal Header Table with Light Teal Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 5\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#daeef3;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n  {\r\n    name: \"Orange Header Table with Light Orange Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 6\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#fde9d9;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true\r\n  },\r\n\r\n  // Grid Table 5 Variants (Partial)\r\n\r\n  {\r\n    \"name\": \"Black Header Table with Light Gray Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#f2f2f2;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Blue Header Table with Light Blue Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark - Accent 1\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#dbe5f1;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Red Header Table with Pink Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark - Accent 2\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#f2dbdb;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Green Header Table with Light Green Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark - Accent 3\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#eaf1dd;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Purple Header Table with Light Purple Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark - Accent 4\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#e5dfec;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Teal Header Table with Light Teal Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark - Accent 5\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#daeef3;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Orange Header Table with Light Orange Alternating Rows - Side header same color\",\r\n    \"style\": \"Grid Table 5 Dark - Accent 6\",\r\n    \"headerClass\": \"\",\r\n    \"tableClass\": \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#fde9d9;color:#000000;\",\r\n    \"format\": \"partial\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Black Table - Whole table is black\",\r\n    \"style\": \"List Table 5 Dark\",\r\n    \"headerClass\": \"border:1px solid #000000; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#f2f2f2;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Blue Table - Whole table is blue\",\r\n    \"style\": \"List Table 5 Dark - Accent 1\",\r\n    \"headerClass\": \"border:1px solid #4F81BD; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#dbe5f1;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Red Table - Whole table is red\",\r\n    \"style\": \"List Table 5 Dark - Accent 2\",\r\n    \"headerClass\": \"border:1px solid #c0504d; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#f2dbdb;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Green Table - Whole table is green\",\r\n    \"style\": \"List Table 5 Dark - Accent 3\",\r\n    \"headerClass\": \"border:1px solid #9bbb59; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#eaf1dd;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Purple Table - Whole table is purple\",\r\n    \"style\": \"List Table 5 Dark - Accent 4\",\r\n    \"headerClass\": \"border:1px solid #8064a2; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#e5dfec;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Teal Table - Whole table is teal\",\r\n    \"style\": \"List Table 5 Dark - Accent 5\",\r\n    \"headerClass\": \"border:1px solid #4bacc6; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#daeef3;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  },\r\n  {\r\n    \"name\": \"Orange Table - Whole table is orange\",\r\n    \"style\": \"List Table 5 Dark - Accent 6\",\r\n    \"headerClass\": \"border:1px solid #f79646; border-bottom: none;\",\r\n    \"tableClass\": \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    \"rowClass\": \"background-color:#fde9d9;color:#000000;\",\r\n    \"format\": \"full\",\r\n    \"sideHeader\": true\r\n  }\r\n]\r\n\r\n\r\nexport const wordTableStyleLocales: Record<\r\n  \"en\" | \"de\" ,\r\n  Record<string, string>\r\n> = {\r\n  en: {\r\n    \"Table Grid\": \"Table Grid\",\r\n    \"Table Grid 1\": \"Table Grid\",\r\n    \"Plain Table 1\": \"Plain Table 1\",\r\n\r\n    \"Grid Table 2\": \"Grid Table 2\",\r\n    \"Grid Table 2 - Accent 1\": \"Grid Table 2 - Accent 1\",\r\n    \"Grid Table 2 - Accent 2\": \"Grid Table 2 - Accent 2\",\r\n    \"Grid Table 2 - Accent 3\": \"Grid Table 2 - Accent 3\",\r\n    \"Grid Table 2 - Accent 4\": \"Grid Table 2 - Accent 4\",\r\n    \"Grid Table 2 - Accent 5\": \"Grid Table 2 - Accent 5\",\r\n    \"Grid Table 2 - Accent 6\": \"Grid Table 2 - Accent 6\",\r\n\r\n    \"List Table 3\": \"List Table 3\",\r\n    \"List Table 3 - Accent 1\": \"List Table 3 - Accent 1\",\r\n    \"List Table 3 - Accent 2\": \"List Table 3 - Accent 2\",\r\n    \"List Table 3 - Accent 3\": \"List Table 3 - Accent 3\",\r\n    \"List Table 3 - Accent 4\": \"List Table 3 - Accent 4\",\r\n    \"List Table 3 - Accent 5\": \"List Table 3 - Accent 5\",\r\n    \"List Table 3 - Accent 6\": \"List Table 3 - Accent 6\",\r\n\r\n    \"Grid Table 4\": \"Grid Table 4\",\r\n    \"Grid Table 4 - Accent 1\": \"Grid Table 4 - Accent 1\",\r\n    \"Grid Table 4 - Accent 2\": \"Grid Table 4 - Accent 2\",\r\n    \"Grid Table 4 - Accent 3\": \"Grid Table 4 - Accent 3\",\r\n    \"Grid Table 4 - Accent 4\": \"Grid Table 4 - Accent 4\",\r\n    \"Grid Table 4 - Accent 5\": \"Grid Table 4 - Accent 5\",\r\n    \"Grid Table 4 - Accent 6\": \"Grid Table 4 - Accent 6\",\r\n\r\n    \"Grid Table 5 Dark\": \"Grid Table 5 Dark\",\r\n    \"Grid Table 5 Dark - Accent 1\": \"Grid Table 5 Dark - Accent 1\",\r\n    \"Grid Table 5 Dark - Accent 2\": \"Grid Table 5 Dark - Accent 2\",\r\n    \"Grid Table 5 Dark - Accent 3\": \"Grid Table 5 Dark - Accent 3\",\r\n    \"Grid Table 5 Dark - Accent 4\": \"Grid Table 5 Dark - Accent 4\",\r\n    \"Grid Table 5 Dark - Accent 5\": \"Grid Table 5 Dark - Accent 5\",\r\n    \"Grid Table 5 Dark - Accent 6\": \"Grid Table 5 Dark - Accent 6\",\r\n\r\n    \"List Table 5 Dark\": \"List Table 5 Dark\",\r\n    \"List Table 5 Dark - Accent 1\": \"List Table 5 Dark - Accent 1\",\r\n    \"List Table 5 Dark - Accent 2\": \"List Table 5 Dark - Accent 2\",\r\n    \"List Table 5 Dark - Accent 3\": \"List Table 5 Dark - Accent 3\",\r\n    \"List Table 5 Dark - Accent 4\": \"List Table 5 Dark - Accent 4\",\r\n    \"List Table 5 Dark - Accent 5\": \"List Table 5 Dark - Accent 5\",\r\n    \"List Table 5 Dark - Accent 6\": \"List Table 5 Dark - Accent 6\"\r\n  },\r\n\r\n  /* ===================== GERMAN ===================== */\r\n  de: {\r\n    \"Table Grid\": \"Tabellenraster\",\r\n    \"Table Grid 1\": \"Tabellenraster\",\r\n    \"Plain Table 1\": \"Einfache Tabelle 1\",\r\n    \"Plain Table 2\": \"Einfache Tabelle 2\",\r\n    \"Plain Table 3\":\"Einfache Tabelle 3\",\r\n    \"Plain Table 5\" : \"Einfache Tabelle 5\",\r\n    \"Grid Table 2\": \"Gitternetztabelle 2\",\r\n    \"Grid Table 2 - Accent 1\": \"Gitternetztabelle 2  Akzent 1\",\r\n    \"Grid Table 2 - Accent 2\": \"Gitternetztabelle 2  Akzent 2\",\r\n    \"Grid Table 2 - Accent 3\": \"Gitternetztabelle 2  Akzent 3\",\r\n    \"Grid Table 2 - Accent 4\": \"Gitternetztabelle 2  Akzent 4\",\r\n    \"Grid Table 2 - Accent 5\": \"Gitternetztabelle 2  Akzent 5\",\r\n    \"Grid Table 2 - Accent 6\": \"Gitternetztabelle 2  Akzent 6\",\r\n\r\n    \"List Table 2\": \"Listentabelle 2\",\r\n    \"List Table 3\": \"Listentabelle 3\",\r\n    \"List Table 3 - Accent 1\": \"Listentabelle 3  Akzent 1\",\r\n    \"List Table 3 - Accent 2\": \"Listentabelle 3  Akzent 2\",\r\n    \"List Table 3 - Accent 3\": \"Listentabelle 3  Akzent 3\",\r\n    \"List Table 3 - Accent 4\": \"Listentabelle 3  Akzent 4\",\r\n    \"List Table 3 - Accent 5\": \"Listentabelle 3  Akzent 5\",\r\n    \"List Table 3 - Accent 6\": \"Listentabelle 3  Akzent 6\",\r\n\r\n    \"Grid Table 4\": \"Gitternetztabelle 4\",\r\n    \"Grid Table 4 - Accent 1\": \"Gitternetztabelle 4  Akzent 1\",\r\n    \"Grid Table 4 - Accent 2\": \"Gitternetztabelle 4  Akzent 2\",\r\n    \"Grid Table 4 - Accent 3\": \"Gitternetztabelle 4  Akzent 3\",\r\n    \"Grid Table 4 - Accent 4\": \"Gitternetztabelle 4  Akzent 4\",\r\n    \"Grid Table 4 - Accent 5\": \"Gitternetztabelle 4  Akzent 5\",\r\n    \"Grid Table 4 - Accent 6\": \"Gitternetztabelle 4  Akzent 6\",\r\n\r\n    \"Grid Table 5 Dark\": \"Gitternetztabelle 5 dunkel\",\r\n    \"Grid Table 5 Dark - Accent 1\": \"Gitternetztabelle 5 dunkel   Akzent 1\",\r\n    \"Grid Table 5 Dark - Accent 2\": \"Gitternetztabelle 5 dunkel   Akzent 2\",\r\n    \"Grid Table 5 Dark - Accent 3\": \"Gitternetztabelle 5 dunkel   Akzent 3\",\r\n    \"Grid Table 5 Dark - Accent 4\": \"Gitternetztabelle 5 dunkel   Akzent 4\",\r\n    \"Grid Table 5 Dark - Accent 5\": \"Gitternetztabelle 5 dunkel   Akzent 5\",\r\n    \"Grid Table 5 Dark - Accent 6\": \"Gitternetztabelle 5 dunkel   Akzent 6\",\r\n\r\n    \"List Table 5 Dark\": \"Listentabelle 5 dunkel\",\r\n    \"List Table 5 Dark - Accent 1\": \"Listentabelle 5 dunkel   Akzent 1\",\r\n    \"List Table 5 Dark - Accent 2\": \"Listentabelle 5 dunkel   Akzent 2\",\r\n    \"List Table 5 Dark - Accent 3\": \"Listentabelle 5 dunkel   Akzent 3\",\r\n    \"List Table 5 Dark - Accent 4\": \"Listentabelle 5 dunkel   Akzent 4\",\r\n    \"List Table 5 Dark - Accent 5\": \"Listentabelle 5 dunkel   Akzent 5\",\r\n    \"List Table 5 Dark - Accent 6\": \"Listentabelle 5 dunkel   Akzent 6\"\r\n  },\r\n};\r\n","import { colorPallete, customTableStyle, theme } from \"../taskpane\";\r\nimport { wordTableStyles } from \"./tablestyles\";\r\n\r\nfunction addtagbody(sponsorOptions,sourceOptions) {\r\n  const body = `<div class=\"modal-dialog\">\r\n  <div class=\"modal-content\">\r\n    <div class=\"modal-body p-3 pt-0\">\r\n      <form id=\"genai-form\" autocomplete=\"off\" novalidate>\r\n        <!-- Name Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"name\" class=\"form-label\"><span class=\"text-danger\">*</span> Name</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"name\" required>\r\n          <div class=\"invalid-feedback\">Name is required.</div>\r\n          <div id=\"submition-error\" class=\"invalid-feedback\" style=\"display: none;\"></div>\r\n\r\n        </div>\r\n\r\n        <!-- Description Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"description\" class=\"form-label\">Description</label>\r\n          <textarea class=\"form-control\" id=\"description\" rows=\"6\"></textarea>\r\n        </div>\r\n\r\n      \r\n\r\n        <div class=\"mb-3\">\r\n          <label for=\"source\" class=\"form-label\"><span class=\"text-danger\">*</span> Primary Source Type</label>\r\n          <div class=\"dropdown w-100\">\r\n            <button \r\n              class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n              type=\"button\" \r\n              id=\"sourceDropdown\" \r\n              data-bs-toggle=\"dropdown\" \r\n              aria-expanded=\"false\" \r\n              >\r\n              <span id=\"sponsorDropdownLabel\">Select Source</span>\r\n              <span class=\"dropdown-toggle-icon\"></span>\r\n            </button>\r\n            <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sourceDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n              <li class=\"source-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"sourceSelectAll\">\r\n                  <label class=\"form-check-label\" for=\"sourceSelectAll\">Select All</label>\r\n                </div>\r\n              </li>\r\n              ${sourceOptions}\r\n            </ul>\r\n          </div>\r\n          <div class=\"invalid-feedback\" id=\"primarySourceError\" style=\"display:none;\">\r\n            Primary Source is required.\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <!-- Prompt Field -->\r\n        <div class=\"mb-3 prompt-box\">\r\n          <label for=\"prompt\" class=\"form-label\"><span class=\"text-danger\">*</span> Prompt \r\n            <small class=\"text-secondary\">(Note: Use # tag for content suggestions)</small>\r\n          </label>\r\n          <textarea class=\"form-control\" id=\"prompt\" rows=\"6\"  required></textarea>\r\n          <div class=\"invalid-feedback\">Prompt is required.</div>\r\n          <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n        </div>\r\n\r\n        <!-- Save Globally Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"saveGlobally\">\r\n          <label class=\"form-check-label\" for=\"saveGlobally\">Save Globally</label>\r\n        </div>\r\n\r\n        <!-- Available to All Sponsors Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"isAvailableForAll\" disabled>\r\n          <label class=\"form-check-label\" for=\"isAvailableForAll\">Available to All Sponsors</label>\r\n        </div>\r\n\r\n        <!-- Sponsor Dropdown -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"sponsor\" class=\"form-label\"><span class=\"text-danger\">*</span> Sponsor</label>\r\n          <div class=\"dropdown w-100\">\r\n            <button \r\n              class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n              type=\"button\" \r\n              id=\"sponsorDropdown\" \r\n              data-bs-toggle=\"dropdown\" \r\n              aria-expanded=\"false\" \r\n              disabled>\r\n              <span id=\"sponsorDropdownLabel\">Select Sponsors</span>\r\n              <span class=\"dropdown-toggle-icon\"></span>\r\n            </button>\r\n            <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sponsorDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n              <li class=\"sponsor-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"sponsorSelectAll\">\r\n                  <label class=\"form-check-label\" for=\"sponsorSelectAll\">Select All</label>\r\n                </div>\r\n              </li>\r\n              ${sponsorOptions}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Action Buttons -->\r\n        <div class=\"mt-3 d-flex justify-content-between\">\r\n          <span id=\"cancel-btn-gen-ai\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n          <button type=\"submit\" class=\"btn btn-primary\" id=\"text-gen-save\">Save</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>`\r\n\r\n  return body\r\n}\r\n\r\n\r\n\r\nfunction Confirmationpopup(content: string) {\r\n  const isDark = theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  const body = `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header border-0\">\r\n        <h5 class=\"fw-bold\">Confirmation</h5>\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        <p>${content}</p>\r\n      </div>\r\n\r\n      <div class=\"modal-footer border-0\">\r\n        <button type=\"button\" class=\"btn btn-link ${isDark ? 'text-info' : 'text-primary'}\" id=\"confirmation-popup-cancel\">Cancel</button>\r\n        <button type=\"button\" class=\"btn btn-primary text-white\" id=\"confirmation-popup-confirm\">Ok</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>`;\r\n  return body;\r\n}\r\n\r\n\r\nfunction customizeTablePopup(selectedValue: string, type: string) {\r\n  const isDark = theme === \"Dark\";\r\n  const popupClass = isDark ? \"bg-dark text-light\" : \"bg-light text-dark\";\r\n  const header= type === \"Custom\" ? \"Customized Tables\" : \"Default Tables\";\r\n  const sourceList = type === \"Custom\" ? customTableStyle : wordTableStyles;\r\n  const warningContent = type === \"Custom\"? '':'<small class=\"text-secondary font-italic\">Warning: The previewed table colors may vary depending on the accent or theme currently selected in Word.</small>'\r\n  const dropdown = `\r\n    <select class=\"form-select mb-2 ${popupClass}\" id=\"confirmation-popup-dropdown\">\r\n      ${sourceList\r\n        .map(opt => {\r\n          const value = type === \"Custom\" ? opt.Name : opt.style;\r\n          const isSelected = value === selectedValue;\r\n          const text = type === \"Custom\" ? opt.Name : opt.style;\r\n\r\n          return `<option value=\"${value}\" ${isSelected ? \"selected\" : \"\"}>\r\n                    ${text}\r\n                  </option>`;\r\n        })\r\n        .join(\"\")}\r\n    </select>\r\n  `;\r\n\r\n  const tablePreview = `\r\n    <div class=\"table-responsive\">\r\n      <table class=\"table table-bordered table-sm\" id=\"confirmation-popup-table-preview\">\r\n        <thead>\r\n          <tr>\r\n            <th>Header 1</th>\r\n            <th>Header 2</th>\r\n            <th>Header 3</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr style=\"color:black;\">\r\n            <td>Data 1</td>\r\n            <td>Data 2</td>\r\n            <td>Data 3</td>\r\n          </tr>\r\n          <tr style=\"background-color:white;color:black;\">\r\n            <td>Data 4</td>\r\n            <td>Data 5</td>\r\n            <td>Data 6</td>\r\n          </tr>\r\n          <tr style=\"color:black;\" >\r\n            <td>Data 7</td>\r\n            <td>Data 8</td>\r\n            <td>Data 9</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  `;\r\n\r\n  return `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header border-0\">\r\n        <h5 class=\"fw-bold\">${header}</h5>\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        ${dropdown}\r\n        ${tablePreview}\r\n        ${warningContent}\r\n      </div>\r\n\r\n      <div class=\"modal-footer border-0\">\r\n        <button type=\"button\" class=\"btn btn-link ${isDark ? \"text-info\" : \"text-primary\"}\" id=\"confirmation-popup-cancel\">Cancel</button>\r\n        <button type=\"button\" class=\"btn btn-primary text-white\" id=\"confirmation-popup-confirm\">Ok</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n  `;\r\n}\r\n\r\nfunction DataModalPopup(selectedData) {\r\n  const isDark = theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  return `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog modal-lg\">\r\n    <div class=\"modal-content p-2 ${popupClass}\">\r\n      <div class=\"modal-header flex-column align-items-start border-0\">\r\n        <span class=\"fw-bold mb-3\">${selectedData?.Name || ''}</span>\r\n        <span class=\"d-block list-height\">${selectedData?.UserValue || ''}</span>\r\n        ${selectedData?.Sources ? `\r\n        <hr class=\"${isDark ? 'border-light' : 'border-dark'}\">\r\n        <div class=\"d-flex align-items-start flex-wrap\">\r\n          <span class=\"fw-bold me-2\">Selected Sources :</span>\r\n          <div class=\"d-flex flex-wrap gap-1\">\r\n            ${selectedData.Sources.map(source => `\r\n              <span class=\"badge ${isDark ? 'text-bg-secondary' : 'text-bg-info'}\">${source.FileName}</span>\r\n            `).join('')}\r\n          </div>\r\n        </div>` : ''}\r\n      </div>\r\n\r\n      <div class=\"modal-body p-3 add-ai-gen\">\r\n        <div class=\"row g-2 list-height\">\r\n          ${selectedData?.Data?.map(item => `\r\n            <div class=\"col-md-12 mt-3\">\r\n              <div class=\"border rounded p-2 ${isDark ? 'bg-secondary text-light' : 'bg-light text-dark'} shadow-sm h-100\">\r\n                <div class=\"fw-bold small text-truncate\" title=\"${item.FileName}\">\r\n                  ${item.FileName}\r\n                </div>\r\n                <div class=\"text-muted small mb-1\">Page: ${item.PageNumber}</div>\r\n                <div class=\"small\" style=\"white-space: normal;\">\r\n                  ${item.Sentence}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n\r\n        <div class=\"d-flex w-100 justify-content-end mt-3 align-items-center\">\r\n          <button type=\"button\" class=\"btn btn-primary text-white\" id=\"datamodel-popup-ok\">OK</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>`;\r\n}\r\n\r\n\r\n\r\nfunction toaster(message: string, type: string) {\r\n  const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';\r\n  // const color = type === 'success' ? '#28a745' : '#dc3545';\r\n  const color = `#ffffff`\r\n  const body = `<div class=\"toast show\" style=\"position: fixed; top: 10px; right: 10px; z-index: 1050; max-width: fit-content; background-color: #808080; color: #ffffff;\">\r\n    <div class=\"toast-body\">\r\n         <i class=\"fa ${icon} me-2\" style=\"color: ${color};\"></i> ${message}\r\n    </div>\r\n  </div>`;\r\n\r\n  document.getElementById('toastr').innerHTML = body;\r\n  setTimeout(() => {\r\n    document.getElementById('toastr').innerHTML = ``;\r\n  }, 4000);\r\n}\r\n\r\nfunction logoheader(storedUrl) {\r\n  const themeicon = theme === 'Dark' ? 'fa-sun' : 'fa-moon'\r\n  const body = `\r\n    <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n    <div class=\"icon-nav me-3\">\r\n      <i class=\"fa fa-home c-pointer me-3\" title=\"Home\" id=\"home\"></i>\r\n      <div class=\"dropdown d-inline\">\r\n        <i class=\"fa fa-tools c-pointer me-3\" id=\"settingsDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Settings\"></i>\r\n        <ul class=\"dropdown-menu\" aria-labelledby=\"settingsDropdown\">\r\n        <li>\r\n        <li>\r\n            <a class=\"dropdown-item\" href=\"#\" id=\"define-formatting\">\r\n              <i class=\"fa fa-sliders-h me-2\" aria-hidden=\"true\"></i> Define Formatting\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"glossary\" tabindex=\"-1\" aria-disabled=\"true\">\r\n              <i class=\"fa fa-book me-2\" aria-hidden=\"true\"></i> Apply Glossary\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"removeFormatting\" tabindex=\"-1\" aria-disabled=\"true\">\r\n              <i class=\"fa fa-eraser me-2\" aria-hidden=\"true\"></i> Remove Formatting\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- Theme Toggle Icon -->\r\n      <span id=\"theme-toggle\"><i class=\"fa ${themeicon} c-pointer me-3\" title=\"Toggle Theme\"></i></span>\r\n\r\n      <i class=\"fa fa-sign-out c-pointer me-3\" id=\"logout\" title=\"Logout\"></i>\r\n    </div>    \r\n  `\r\n  return body;\r\n}\r\n\r\nconst navTabs = `<ul class=\"nav nav-tabs\" id=\"tabList\" role=\"tablist\">\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link active\" id=\"tag-tab\" data-bs-toggle=\"tab\" href=\"#tag\" role=\"tab\">Tag</a>\r\n  </li>\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link\" id=\"prompt-tab\" data-bs-toggle=\"tab\" href=\"#prompt\" role=\"tab\">Prompt builder</a>\r\n  </li>\r\n</ul>\r\n\r\n<div class=\"tab-content p-3 border border-top-0\">\r\n  <div class=\"tab-pane fade show active\" id=\"add-tag-body\" role=\"tabpanel\" aria-labelledby=\"tag-tab\">\r\n  </div>\r\n  <div class=\"tab-pane fade\" id=\"add-prompt-template\" role=\"tabpanel\" aria-labelledby=\"prompt-tab\">\r\n  </div>\r\n</div>\r\n`\r\n\r\n\r\n\r\nconst promptbuilderbody = `<div>hi</div>`\r\n\r\n\r\nexport { navTabs, addtagbody, promptbuilderbody, logoheader, Confirmationpopup, toaster, DataModalPopup, customizeTablePopup };","import { toaster } from \"./components/bodyelements\";\r\nimport { generateCheckboxHistory } from \"./components/home\";\r\nimport { wordTableStyleLocales } from \"./components/tablestyles\";\r\nimport { colorPallete, tableStyle, theme, UserRole } from \"./taskpane\";\r\n\r\nexport function insertLineWithHeadingStyle(\r\n  paragraph: Word.Paragraph,\r\n  line: string\r\n) {\r\n  let builtInStyle: Word.BuiltInStyleName = Word.BuiltInStyleName.normal;\r\n  let text = line;\r\n\r\n  if (line.startsWith(\"###### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading6;\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith(\"##### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading5;\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith(\"#### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading4;\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith(\"### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading3;\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith(\"## \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading2;\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith(\"# \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading1;\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  //  THIS is the important line\r\n  paragraph.styleBuiltIn = builtInStyle;\r\n\r\n  const regex = /(\\*\\*(.+?)\\*\\*)|(\\*(.+?)\\*)|(_(.+?)_)/g;\r\n  let lastIndex = 0;\r\n  let match;\r\n\r\n  while ((match = regex.exec(text)) !== null) {\r\n    if (match.index > lastIndex) {\r\n      paragraph.insertText(\r\n        text.substring(lastIndex, match.index),\r\n        Word.InsertLocation.end\r\n      );\r\n    }\r\n\r\n    let content = \"\";\r\n    let bold = false;\r\n    let italic = false;\r\n    let underline = false;\r\n\r\n    if (match[1]) {\r\n      content = match[2];\r\n      bold = true;\r\n    } else if (match[3]) {\r\n      content = match[4];\r\n      italic = true;\r\n    } else if (match[5]) {\r\n      content = match[6];\r\n      underline = true;\r\n    }\r\n\r\n    const r = paragraph.insertText(content, Word.InsertLocation.end);\r\n    r.font.bold = bold;\r\n    r.font.italic = italic;\r\n    r.font.underline = underline\r\n      ? Word.UnderlineType.single\r\n      : Word.UnderlineType.none;\r\n\r\n    lastIndex = regex.lastIndex;\r\n  }\r\n\r\n  if (lastIndex < text.length) {\r\n    paragraph.insertText(\r\n      text.substring(lastIndex),\r\n      Word.InsertLocation.end\r\n    );\r\n  }\r\n}\r\n\r\nexport function removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\n\r\n\r\nexport function copyText(text: string) {\r\n  // Copy text to clipboard logic\r\n  const tempTextArea = document.createElement('textarea');\r\n  tempTextArea.value = text;\r\n  document.body.appendChild(tempTextArea);\r\n  tempTextArea.select();\r\n  document.execCommand('copy');\r\n  document.body.removeChild(tempTextArea);\r\n  toaster('Copied to clipboard successfully!', 'success')\r\n\r\n}\r\n\r\n\r\nexport function switchToPromptBuilder() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('prompt-tab').classList.add('active');\r\n  document.getElementById('add-prompt-template').classList.add('show', 'active');\r\n}\r\n\r\n\r\nexport function switchToAddTag() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('tag-tab').classList.add('active');\r\n  document.getElementById('add-tag-body').classList.add('show', 'active');\r\n}\r\n\r\nexport function updateEditorFinalTable(data) {\r\n  const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n  let match;\r\n  let tables = [];\r\n\r\n  while ((match = regex.exec(data)) !== null) {\r\n    try {\r\n      const parsedContent = JSON.parse(match[1]);\r\n      tables.push(jsonToHtmlTable(parsedContent));\r\n    } catch (error) {\r\n      console.error(\"Failed to parse JSON:\", error, match[1]);\r\n    }\r\n  }\r\n\r\n  let tableIndex = 0;\r\n  return data.replace(regex, () => tables[tableIndex++] || \"\");\r\n}\r\n\r\nfunction jsonToHtmlTable(jsonData) {\r\n  if (!jsonData || (Array.isArray(jsonData) && jsonData.length === 0)) {\r\n    return '<p>No data available</p>';\r\n  }\r\n\r\n  let headers = new Set();\r\n  let rows = [];\r\n\r\n  function flattenObject(obj, prefix = \"\", result = {}) {\r\n    Object.keys(obj).forEach(key => {\r\n      const value = obj[key];\r\n      const newKey = prefix ? `${prefix} > ${key}` : key;\r\n\r\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n        flattenObject(value, newKey, result);\r\n      } else if (Array.isArray(value)) {\r\n        result[newKey] = value.map(item => {\r\n          return typeof item === 'object'\r\n            ? Object.entries(item).map(([k, v]) => `<strong>${k}:</strong> ${v}`).join('<br>')\r\n            : item;\r\n        }).join('<br>');\r\n      } else {\r\n        result[newKey] = value;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  if (!Array.isArray(jsonData)) {\r\n    jsonData = Object.entries(jsonData).map(([key, value]) => ({ [key]: value }));\r\n  }\r\n\r\n  jsonData.forEach(item => {\r\n    let flattenedItem = flattenObject(item);\r\n    Object.keys(flattenedItem).forEach(key => headers.add(key));\r\n    rows.push(flattenedItem);\r\n  });\r\n\r\n  let table = '<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">';\r\n  table += '<tr>' + [...headers].map(header => `<th>${header}</th>`).join('') + '</tr>';\r\n  rows.forEach(row => {\r\n    table += '<tr>' + [...headers].map(header => `<td>${row[header]}</td>`).join('') + '</tr>';\r\n  });\r\n\r\n  table += '</table>';\r\n  return table;\r\n}\r\n\r\n\r\n\r\nexport function generateChatHistoryHtml(chatList: any[]): string {\r\n  const promptclass = theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n  const globalPromptUpdate = UserRole.UserRoleEntityAccessList.find(\r\n    (item: any) => item.UserRoleEntity === 'Global Prompt Update'\r\n  );\r\n\r\n  return chatList.map((chat, index) => {\r\n    const includeSaveIcon = globalPromptUpdate?.UserRoleAccessID === 3;\r\n    const includeReferenceIcon = chat.Evidences && chat.Evidences.length > 0;\r\n\r\n    return `\r\n      <div class=\"row chat-entry m-0 p-0\">\r\n        <div class=\"col-md-12 mt-2 p-2\">\r\n          <div class=\"d-flex justify-content-between align-items-start\">\r\n            <!-- Prompt Box -->\r\n            <div class=\"form-control h-34 d-flex align-items-center dynamic-height prompt-text ${promptclass}\" style=\"width: 95%;\">\r\n              ${chat.Prompt}\r\n            </div>\r\n\r\n            <!-- Icons Stack -->\r\n            <div class=\"d-flex flex-column align-items-center ms-2\">\r\n              <i class=\"fa fa-copy text-secondary c-pointer mb-2\" title=\"Copy Prompt\" id=\"copyPrompt-${index}\"></i>\r\n              ${includeSaveIcon ? `<i class=\"fa fa-save text-secondary c-pointer\" title=\"Save Prompt\" id=\"savePrompt-${index}\"></i>` : ''}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-12 mb-2 p-2 d-flex\">\r\n          <span class=\"d-flex align-items-baseline w-100\">\r\n            <div class=\"flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response\" id=\"responseContainer-${index}\">\r\n              <input\r\n                class=\"form-check-input c-pointer me-2 response-checkbox\"\r\n                type=\"checkbox\"\r\n                id=\"checkbox-${index}\"\r\n                ${chat.Selected === 1 ? 'checked' : ''}>\r\n              <span id=\"responseText-${index}\">${chat.Response}</span>\r\n              <i class=\"fa fa-copy text-secondary c-pointer ms-2\"\r\n                title=\"Copy Response\"\r\n                id=\"copyResponse-${index}\"></i>\r\n              ${includeReferenceIcon\r\n        ? `<i class=\"fa fa-folder-gear text-secondary c-pointer ms-2\"\r\n                    title=\"Open Reference\"\r\n                    id=\"openRefferance-${index}\"></i>`\r\n        : ''}\r\n            </div>\r\n          </span>\r\n        </div>\r\n      </div>`;\r\n  }).join('');\r\n}\r\n\r\n\r\n\r\nexport function chatfooter(tag: any) {\r\n  const promptclass = theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n  const tooltipButton = tag.Sources && tag.Sources.length > 0\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n  return ` <textarea class=\"form-control ${promptclass}\"\r\n                      rows=\"5\"\r\n                      id=\"chatInput\"\r\n                      ></textarea>\r\n            <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n            <div class=\"d-flex flex-column align-self-end me-3\">\r\n              <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insertTagButton\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\"></i>\r\n              </button>\r\n             <div class=\"ngb-tooltip d-inline-block\">\r\n                 ${tooltipButton}\r\n                <button class=\"btn btn-secondary ms-2 mb-2 text-white\" id=\"changeSourceButton\">\r\n                  <i class=\"fa fa-file-lines text-white\"></i>\r\n                </button>\r\n              </div>\r\n\r\n              <button type=\"submit\" class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\" id=\"sendPromptButton\">\r\n                <span class=\"tooltiptext\">Send</span>\r\n                <i class=\"fa fa-paper-plane text-white\"></i>\r\n              </button>\r\n            </div>`\r\n}\r\n\r\nexport function renderSelectedTags(selectedNames, availableKeys) {\r\n  const badgeWrapper = document.getElementById('tag-badge-wrapper');\r\n  if (badgeWrapper) {\r\n    badgeWrapper.innerHTML = '';\r\n    // Filter out duplicates (case-insensitive)\r\n    const uniqueNames = [...new Set(\r\n      selectedNames.map(name => name.toLowerCase())\r\n    )].map(lowerName =>\r\n      selectedNames.find(name => name.toLowerCase() === lowerName)\r\n    );\r\n\r\n\r\n    uniqueNames.forEach(name => {\r\n      let aiTag;\r\n\r\n      if (/^ID\\d+$/i.test(name)) {\r\n        aiTag = availableKeys.find(\r\n          mention => mention.AIFlag === 1 && `id${mention.ID}`.toLowerCase() === name.toLowerCase()\r\n        );\r\n      } else {\r\n        aiTag = availableKeys.find(\r\n          mention => mention.AIFlag === 1 && mention.DisplayName.toLowerCase() === name.toLowerCase()\r\n        );\r\n      }\r\n      if (aiTag?.DisplayName) {\r\n\r\n        const badge = document.createElement('span');\r\n        badge.className = 'badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable';\r\n        badge.style.cursor = 'pointer';\r\n        badge.innerHTML = `${aiTag.DisplayName} <i class=\"fa-solid fa-microchip-ai ms-2 text-muted\" aria-label=\"AI Suggested\"></i>`;\r\n        badge.addEventListener('click', async () => {\r\n          await selectMatchingBookmarkFromSelection(name);\r\n\r\n          if (aiTag) {\r\n            const appBody = document.getElementById('app-body');\r\n            appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n\r\n            generateCheckboxHistory(aiTag).then(html => {\r\n              appBody.innerHTML = html;\r\n            });\r\n          }\r\n        });\r\n        badgeWrapper.appendChild(badge);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\nexport function applyThemeClasses(theme) {\r\n  const isDark = theme === 'Dark';\r\n  const isLight = theme === 'Light';\r\n\r\n  const safeApplyClass = (selector, darkClasses, lightClasses) => {\r\n    const elements = document.querySelectorAll(selector);\r\n    const darkClassList = darkClasses.split(' ');\r\n    const lightClassList = lightClasses.split(' ');\r\n\r\n    elements.forEach(elem => {\r\n      if (!elem) return;\r\n      // Remove all related theme classes\r\n      elem.classList.remove(...darkClassList);\r\n      elem.classList.remove(...lightClassList);\r\n      // Add only the relevant set\r\n      if (isDark) elem.classList.add(...darkClassList);\r\n      if (isLight) elem.classList.add(...lightClassList);\r\n    });\r\n  };\r\n\r\n  // Now use it for different elements\r\n  safeApplyClass('#app-body', 'bg-dark text-light', 'bg-white text-dark');\r\n  safeApplyClass('#search-box', 'bg-secondary text-light border-0', 'bg-white text-dark border');\r\n  safeApplyClass('.dropdown-menu', 'bg-dark text-light border-light', 'bg-white text-dark border');\r\n  safeApplyClass('.list-group-item', 'bg-dark text-light', 'bg-white text-dark');\r\n  safeApplyClass('.dropdown-toggle', 'bg-dark text-light border-0', 'bg-white text-dark border');\r\n  safeApplyClass('.dropdown-item', 'bg-dark text-light', 'bg-white text-dark');\r\n  // container for the suggestion list\r\n  safeApplyClass(\r\n    '.list-group-item-action',\r\n    'bg-dark text-light list-hover-dark',\r\n    'bg-light text-dark list-hover-light'\r\n  );\r\n\r\n  safeApplyClass('#close-ai-window', 'fa-solid fa-circle-xmark bg-dark text-light', 'fa-solid fa-circle-xmark bg-light text-dark');\r\n  safeApplyClass('#chatInput', 'bg-secondary text-light', 'bg-white text-dark');\r\n  safeApplyClass('.prompt-text', 'bg-secondary text-light', 'bg-white text-dark');\r\n\r\n\r\n}\r\n\r\nexport function swicthThemeIcon() {\r\n  const themeToggle = document.getElementById('theme-toggle');\r\n  const icon = themeToggle.querySelector('i');\r\n\r\n  if (theme === 'Dark') {\r\n    icon.classList.remove('fa-moon');\r\n    icon.classList.add('fa-sun');\r\n    sessionStorage.setItem('theme', 'Dark');\r\n  } else if (theme === 'Light') {\r\n    icon.classList.remove('fa-sun');\r\n    icon.classList.add('fa-moon');\r\n    sessionStorage.setItem('theme', 'Light');\r\n  }\r\n}\r\n\r\nexport async function selectMatchingBookmarkFromSelection(displayName) {\r\n  return Word.run(async (context) => {\r\n    const selection = context.document.getSelection();\r\n    const bookmarks = selection.getBookmarks(); // ClientResult<string[]>\r\n    await context.sync();\r\n\r\n    const targetBookmarkName = bookmarks.value.find(bookmark => {\r\n      const cleanName = bookmark.split('_Split_')[0].replace(/_/g, ' ');\r\n      return cleanName.toLowerCase() === displayName.toLowerCase();\r\n    });\r\n\r\n    if (targetBookmarkName) {\r\n      const range = context.document.getBookmarkRangeOrNullObject(targetBookmarkName);\r\n      range.load('isNullObject');\r\n      await context.sync();\r\n\r\n      if (!range.isNullObject) {\r\n        range.select(); // Select the entire bookmark\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport async function colorTable(table: any, rows: any, context: any) {\r\n\r\n  // ------------------------------------------------------------\r\n  // 1) Copy cell values DOM -> Word + MERGE FIRST COLUMN GROUPS\r\n  // ------------------------------------------------------------\r\n  let lastParamRowIndex = -1; // last row index where 1st col had value\r\n\r\n  rows.forEach((row, rowIndex) => {\r\n    const cells = Array.from(row.querySelectorAll(\"td, th\"));\r\n    let cellIndex = 0;\r\n\r\n    let firstColText = \"\";\r\n\r\n    cells.forEach((cell) => {\r\n      const text = cell.innerText.trim();\r\n\r\n      // capture first column text\r\n      if (cellIndex === 0) {\r\n        firstColText = text;\r\n      }\r\n\r\n      table.getCell(rowIndex, cellIndex).value = text;\r\n      cellIndex++;\r\n    });\r\n\r\n    //  Merge first column when empty (skip header row)\r\n    if (rowIndex > 0) {\r\n      if (firstColText) {\r\n        // new group starts\r\n        lastParamRowIndex = rowIndex;\r\n      } else {\r\n        // empty first col = merge with last non-empty parameter row\r\n        if (lastParamRowIndex !== -1) {\r\n          const topCell = table.getCell(lastParamRowIndex, 0);\r\n          const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n          topCell.merge(bottomCell);\r\n\r\n          //  center align merged parameter cell\r\n          try {\r\n            topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n            topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n          } catch (e) {\r\n            // ignore\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  await context.sync();\r\n\r\n  // ------------------------------------------------------------\r\n  // 2) Load rows for formatting\r\n  // ------------------------------------------------------------\r\n  table.rows.load(\"items\");\r\n  await context.sync();\r\n\r\n  // Helper to check if color is dark\r\n  const isColorDark = (hexColor: string): boolean => {\r\n    const hex = hexColor.replace(\"#\", \"\");\r\n    const r = parseInt(hex.substring(0, 2), 16);\r\n    const g = parseInt(hex.substring(2, 4), 16);\r\n    const b = parseInt(hex.substring(4, 6), 16);\r\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\r\n    return luminance < 0.5;\r\n  };\r\n\r\n  const applyBoldIfNeeded = (cell: any, rowIndex: number, cellIndex: number) => {\r\n    let weight = \"Normal\";\r\n\r\n    if (colorPallete.IsHeaderBold && rowIndex === 0) weight = \"Bold\";\r\n    if (colorPallete.IsSideHeaderBold && cellIndex === 0) weight = \"Bold\";\r\n\r\n    cell.body.font.bold = weight === \"Bold\";\r\n  };\r\n\r\n  // Helper to apply shading, font color, and border to a row or cell\r\n  const applyColor = (cellOrRow: any, bgColor: string) => {\r\n    cellOrRow.shadingColor = bgColor;\r\n    try {\r\n      cellOrRow.font.color = isColorDark(bgColor) ? \"#FFFFFF\" : \"#000000\";\r\n\r\n      // Apply thin light grey border for all sides\r\n      const borderColor = \"#D3D3D3\"; // light grey\r\n      if (cellOrRow.getBorder) {\r\n        [\"Top\", \"Bottom\", \"Left\", \"Right\"].forEach((side) => {\r\n          cellOrRow.getBorder(side).type = \"Single\";\r\n          cellOrRow.getBorder(side).color = borderColor;\r\n          cellOrRow.getBorder(side).width = 1; // 1pt thin\r\n        });\r\n      }\r\n    } catch (e) {\r\n      // row objects might not have font directly\r\n    }\r\n  };\r\n\r\n  // Determine base table type\r\n  const base = tableStyle.split(\" - \")[0].trim();\r\n\r\n  // ------------------------------------------------------------\r\n  // Plain Table 3\r\n  // ------------------------------------------------------------\r\n  if (base === \"Plain Table 3\") {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = colorPallete.Primary;\r\n\r\n        if (rowIndex === 0 || cellIndex === 0) {\r\n          bgColor = colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? colorPallete.Primary\r\n            : colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Plain Table 2\r\n  // ------------------------------------------------------------\r\n  else if (base === \"Plain Table 2\") {\r\n\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    const rowCount = table.rows.items.length;\r\n    const firstGapIndex = 0;             // gap between row 0 and row 1\r\n    const lastGapIndex = rowCount - 1;   // gap between last-2 and last row\r\n\r\n    // STEP 2  Turn OFF all gaps EXCEPT first + last\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      // rowIndex = gap BELOW this row\r\n      if (rowIndex !== firstGapIndex && rowIndex !== lastGapIndex) {\r\n        const bottom = row.getBorder(Word.BorderLocation.bottom);\r\n        bottom.type = Word.BorderType.none;\r\n      }\r\n    });\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = colorPallete.Primary;\r\n\r\n        if (rowIndex === 0) {\r\n          bgColor = colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? colorPallete.Primary\r\n            : colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n\r\n    await context.sync();\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Plain Table 5\r\n  // ------------------------------------------------------------\r\n  else if (base === \"Plain Table 5\") {\r\n    table.getBorder(Word.BorderLocation.insideVertical).type = Word.BorderType.none;\r\n\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = colorPallete.Primary;\r\n\r\n        if (rowIndex === 0) {\r\n          bgColor = colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? colorPallete.Primary\r\n            : colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Table Grid\r\n  // ------------------------------------------------------------\r\n  else if (base === \"Table Grid\") {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n    table.rows.items.forEach((row, i) => {\r\n      const bg = colorPallete.Header;\r\n      applyColor(row, bg);\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n\r\n    });\r\n  }\r\n  else if (base === \"Table Grid 1\") {\r\n    table.rows.items.forEach(r => r.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, i) => {\r\n      const bg = colorPallete.Header;\r\n      applyColor(row, bg);\r\n\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n    });\r\n\r\n    //  ONE full width double border under header row\r\n    const headerRow = table.rows.items[0];\r\n    const bottom = headerRow.getBorder(Word.BorderLocation.bottom);\r\n    bottom.type = Word.BorderType.double;\r\n    bottom.width = 0.5;\r\n    bottom.color = \"000000\";\r\n\r\n    await context.sync();\r\n  }\r\n\r\n\r\n  // ------------------------------------------------------------\r\n  // Grid Table 4\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"Grid Table 4\")) {\r\n    const headerRow = table.rows.items[0];\r\n    applyColor(headerRow, colorPallete.Header);\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n    table.rows.items.forEach((row, i) => {\r\n      if (i > 0) {\r\n        const bg = i % 2 === 0 ? colorPallete.Secondary : colorPallete.Primary;\r\n        applyColor(row, bg);\r\n      }\r\n\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Grid Table 5 Dark\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"Grid Table 5 Dark\")) {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = colorPallete.Primary;\r\n\r\n        if (rowIndex === 0 || cellIndex === 0) {\r\n          bgColor = colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? colorPallete.Primary\r\n            : colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // List Table 3\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"List Table 3\")) {\r\n    const headerRow = table.rows.items[0];\r\n    applyColor(headerRow, colorPallete.Header);\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n    table.rows.items.forEach((row, i) => {\r\n      if (i > 0) applyColor(row, colorPallete.Primary);\r\n\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // List Table 2\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"List Table 2\")) {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = colorPallete.Primary;\r\n\r\n        if (rowIndex === 0) {\r\n          bgColor = colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? colorPallete.Primary\r\n            : colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // default\r\n  // ------------------------------------------------------------\r\n  else {\r\n    table.rows.items.forEach((row) => applyColor(row, colorPallete.Primary));\r\n  }\r\n\r\n  await context.sync();\r\n}\r\n\r\n\r\nexport function mapImagesToComponentObjects(input: any): any[] {\r\n  if (!input) return [];\r\n\r\n  // 1 Flatten ALL three arrays into a single list\r\n  const flatImages = [\r\n    ...(input.Flowchart || []),\r\n    ...(input.Graph || []),\r\n    ...(input.Image || [])\r\n  ];\r\n\r\n  // 2 Map to required structure\r\n  return flatImages.map(img => ({\r\n    Name: img.ImageName,\r\n    DisplayName: img.ImageName,\r\n    EditorValue: img.ImageData,\r\n    UserValue: img.ImageData,\r\n    ComponentKeyDataType: \"IMAGE\",\r\n    AIFlag: 0,\r\n    IsImage: true\r\n  }));\r\n}\r\n\r\nexport async function svgBase64ToPngBase64(svgBase64: string): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      const svgBlob = new Blob(\r\n        [atob(svgBase64.split(',')[1])],\r\n        { type: \"image/svg+xml\" }\r\n      );\r\n      const url = URL.createObjectURL(svgBlob);\r\n\r\n      const img = new Image();\r\n      img.crossOrigin = \"anonymous\";\r\n\r\n      img.onload = function () {\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = img.width || 1200;\r\n        canvas.height = img.height || 800;\r\n\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) return reject(\"Canvas unsupported.\");\r\n\r\n        ctx.drawImage(img, 0, 0);\r\n\r\n        const pngBase64 = canvas.toDataURL(\"image/png\").split(\",\")[1];\r\n        resolve(pngBase64);\r\n\r\n        URL.revokeObjectURL(url);\r\n      };\r\n\r\n      img.onerror = () => reject(\"SVG load failed.\");\r\n      img.src = url;\r\n\r\n    } catch (err) {\r\n      reject(err);\r\n    }\r\n  });\r\n}\r\n\r\nexport function resolveWordTableStyle(englishStyle: string): string {\r\n  const lang =\r\n    Office.context.displayLanguage?.toLowerCase().slice(0, 2) || \"en\";\r\n\r\n  return (\r\n    wordTableStyleLocales[lang]?.[englishStyle] ??\r\n    wordTableStyleLocales.en[englishStyle] ??\r\n    'none'\r\n  );\r\n}\r\n","import { getPromptTemplateById, updateGroupKey, updateAiHistory, updatePromptTemplate } from \"../api\";\r\nimport { chatfooter, copyText, generateChatHistoryHtml, insertLineWithHeadingStyle, removeQuotes, renderSelectedTags, switchToAddTag, updateEditorFinalTable, colorTable, svgBase64ToPngBase64, resolveWordTableStyle } from \"../functions\";\r\nimport { addGenAITags, aiTagList, applyTagFn, availableKeys, colorPallete, createMultiSelectDropdown, customizeTable, fetchAIHistory, isPendingResponse, jwt, mentionDropdownFn, selectedNames, sendPrompt, sourceList, tableStyle, theme } from \"../taskpane\";\r\nimport { Confirmationpopup, DataModalPopup, toaster } from \"./bodyelements\";\r\n\r\nlet preview = '';\r\n\r\n\r\nexport function loadHomepage(availableKeys) {\r\n    const searchBoxClass = theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-3\">\r\n        <div class=\"d-flex justify-content-end px-2\">\r\n            <div class=\"dropdown\">\r\n                <button class=\"btn btn-default dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                    Action\r\n                </button>\r\n                <ul class=\"dropdown-menu\">\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"add-btn-tag\">\r\n                            <i class=\"fa fa-plus me-2\" aria-hidden=\"true\"></i> Add\r\n                        </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"apply-btn-tag\">\r\n                            <i class=\"fa-solid fa-circle-check me-2\"></i> Apply\r\n                        </a>\r\n                    </li>\r\n\r\n                     <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"predefined-table\">\r\n                            <i class=\"fa fa-table me-2\" aria-hidden=\"true\"></i> Default Tables\r\n                        </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"customized-table\">\r\n                            <i class=\"fa fa-brush me-2\" aria-hidden=\"true\"></i> Customized Tables\r\n                        </a>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"form-group px-2 pt-2\">\r\n            <input type=\"text\" id=\"search-box\" class=\"form-control ${searchBoxClass}\" placeholder=\"Search Tags...\" autocomplete=\"off\" />\r\n        </div>\r\n\r\n        <ul id=\"suggestion-list\" class=\"list-group mt-2 px-2\"></ul>\r\n        \r\n        <div id=\"tags-in-selected-text\" class=\"mt-2 px-2 selected-text-box d-none\">\r\n            <label class=\"form-label mb-2 fw-bold\">Tags in Selected Text</label>\r\n            <div class=\"tag-panel d-flex flex-wrap gap-2\" id=\"tag-badge-wrapper\"></div>\r\n        </div>\r\n    </div>`;\r\n\r\n    const searchBox = document.getElementById('search-box');\r\n    const suggestionList = document.getElementById('suggestion-list');\r\n\r\n    function updateSuggestions() {\r\n        const searchTerm = searchBox.value.trim().toLowerCase();\r\n        suggestionList.replaceChildren();\r\n\r\n        if (searchTerm === '') {\r\n            suggestionList.innerHTML = '';\r\n            return;\r\n        }\r\n\r\n        const filteredMentions = availableKeys.filter(m =>\r\n            m.DisplayName.toLowerCase().includes(searchTerm)\r\n        );\r\n\r\n        // Split groups\r\n        const nonAITags = filteredMentions.filter(m => m.AIFlag === 0);\r\n        const aiTags = filteredMentions.filter(m => m.AIFlag === 1);\r\n\r\n        // Further split non-AI tags into: TEXT + IMAGE\r\n        const propertiesTags = nonAITags.filter(m => m.ComponentKeyDataType === \"TEXT\" || m.ComponentKeyDataType === \"TABLE\");\r\n        const imageTags = nonAITags.filter(m => m.ComponentKeyDataType === \"IMAGE\" && m.IsImage);\r\n\r\n        const createSection = (labelText, mentions, isAISection = false, isImageSection = false) => {\r\n            if (mentions.length === 0) return;\r\n\r\n            const themeClasses = theme === 'Dark'\r\n                ? { itemClass: 'bg-dark text-light list-hover-dark', labelClass: 'bg-dark text-light' }\r\n                : { itemClass: 'bg-light text-dark list-hover-light', labelClass: 'bg-light text-dark' };\r\n\r\n            const label = document.createElement('li');\r\n            label.className = `list-group-item fw-bold text-secondary ${themeClasses.labelClass}`;\r\n            label.textContent = labelText;\r\n            suggestionList.appendChild(label);\r\n\r\n            mentions.forEach(mention => {\r\n                const listItem = document.createElement('li');\r\n                listItem.className = `list-group-item list-group-item-action ${themeClasses.itemClass}`;\r\n\r\n                // ICON LOGIC\r\n                let icon = `<i class=\"fa-solid fa-layer-group text-muted me-2\"></i>`; // default (TEXT)\r\n                if (isAISection) icon = `<i class=\"fa-solid fa-microchip-ai text-muted me-2\"></i>`;\r\n                if (isImageSection) icon = `<i class=\"fa-solid fa-image text-muted me-2\"></i>`;\r\n\r\n                listItem.innerHTML = `${icon} ${mention.DisplayName}`;\r\n\r\n                listItem.onclick = () => {\r\n                    if (isAISection) {\r\n                        const appBody = document.getElementById('app-body');\r\n                        appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n                        generateCheckboxHistory(mention)\r\n                            .catch(() => appBody.innerHTML = '<div class=\"text-danger p-2\">Error loading data</div>')\r\n                            .then(html => { appBody.innerHTML = html; });\r\n                    } else {\r\n                        // Properties + Images behave same\r\n                        replaceMention(mention, mention.ComponentKeyDataType);\r\n                        suggestionList.replaceChildren();\r\n                    }\r\n                };\r\n\r\n                suggestionList.appendChild(listItem);\r\n            });\r\n        };\r\n\r\n        // Render in desired order\r\n        createSection('Properties', propertiesTags);\r\n        createSection('AI Tags', aiTags, true);\r\n        createSection('Images', imageTags, false, true);\r\n    }\r\n\r\n    if (selectedNames.length > 0) {\r\n        const badgeWrapper = document.getElementById('tags-in-selected-text');\r\n        badgeWrapper.classList.remove('d-none');\r\n        badgeWrapper.classList.add('d-block');\r\n        renderSelectedTags(selectedNames, availableKeys);\r\n    }\r\n\r\n    // Add input event listener to the search box\r\n    let debounceTimeout;\r\n    searchBox.addEventListener('input', () => {\r\n        clearTimeout(debounceTimeout);\r\n        debounceTimeout = setTimeout(updateSuggestions, 300); // Delay input handling by 300ms\r\n    });\r\n\r\n    document.getElementById('add-btn-tag').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            addGenAITags();\r\n        }\r\n    });\r\n\r\n    document.getElementById('customized-table').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            customizeTable('Custom');\r\n        }\r\n    })\r\n\r\n    document.getElementById('predefined-table').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            customizeTable('Pre');\r\n        }\r\n    })\r\n\r\n    document.getElementById('apply-btn-tag').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            applyTagFn();\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) {\r\n                throw new Error('Selection is invalid or not found.');\r\n            }\r\n\r\n            let newSelection = selection;\r\n\r\n            if (type === 'TABLE') {\r\n                const parser = new DOMParser();\r\n                const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n                const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                await context.sync();\r\n\r\n                for (const node of bodyNodes) {\r\n                    if (node.nodeType === Node.TEXT_NODE) {\r\n                        let textContent = node.textContent?.trim();\r\n                        if (textContent) {\r\n                            textContent = textContent.replace(/\\n- /g, \"\\n \");\r\n\r\n                            textContent.split('\\n').forEach(line => {\r\n                                if (line.trim()) {\r\n                                    insertLineWithHeadingStyle(selection, line);\r\n                                }\r\n                            });\r\n                        }\r\n                    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        const element = node as HTMLElement;\r\n\r\n                        if (element.tagName.toLowerCase() === 'table') {\r\n                            const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                            if (rows.length === 0) {\r\n                                selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                                continue;\r\n                            }\r\n\r\n                            const maxCols = Math.max(...rows.map(row => {\r\n                                return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                                }, 0);\r\n                            }));\r\n\r\n                            const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                            await context.sync();\r\n\r\n                            const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                            const resolvedTableStyle = resolveWordTableStyle(tableStyle);\r\n                            if (resolvedTableStyle !== 'none') {\r\n                                table.style = resolvedTableStyle;\r\n                            }  // Apply built-in Word table style\r\n\r\n                            await context.sync();\r\n                            if (colorPallete.Customize) {\r\n                                await colorTable(table, rows, context);\r\n                            }\r\n                            else {\r\n                                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n                                let lastParamRowIndex = -1; // row index of last non-empty Parameter cell\r\n\r\n                                rows.forEach((row, rowIndex) => {\r\n                                    const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                    let cellIndex = 0;\r\n\r\n                                    // track first column text in HTML row\r\n                                    let firstColText = \"\";\r\n\r\n                                    cells.forEach((cell) => {\r\n                                        while (rowspanTracker[cellIndex] > 0) {\r\n                                            rowspanTracker[cellIndex]--;\r\n                                            cellIndex++;\r\n                                        }\r\n\r\n                                        const cellText = Array.from(cell.childNodes)\r\n                                            .map(node => {\r\n                                                if (node.nodeType === Node.TEXT_NODE) {\r\n                                                    return node.textContent?.trim() || '';\r\n                                                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                    return (node as HTMLElement).innerText.trim();\r\n                                                }\r\n                                                return '';\r\n                                            })\r\n                                            .filter(text => text.length > 0)\r\n                                            .join(' ');\r\n\r\n                                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                                        // save first column text if this is first column\r\n                                        if (cellIndex === 0) {\r\n                                            firstColText = cellText.trim();\r\n                                        }\r\n\r\n                                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                        // colspan blank filling\r\n                                        for (let i = 1; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                            }\r\n                                        }\r\n\r\n                                        // rowspan tracking\r\n                                        if (rowspan > 1) {\r\n                                            for (let i = 0; i < colspan; i++) {\r\n                                                if (cellIndex + i < maxCols) {\r\n                                                    rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        cellIndex += colspan;\r\n                                    });\r\n\r\n                                    //  AFTER filling the row  apply merge logic for 1st column\r\n                                    if (rowIndex === 0) {\r\n                                        // header row typically\r\n                                        return;\r\n                                    }\r\n\r\n                                    if (firstColText) {\r\n                                        // new parameter starts\r\n                                        lastParamRowIndex = rowIndex;\r\n                                    } else {\r\n                                        // empty parameter row  merge vertically with previous parameter row\r\n                                        if (lastParamRowIndex !== -1) {\r\n                                            const topCell = table.getCell(lastParamRowIndex, 0);\r\n                                            const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n                                            // merge bottom into top\r\n                                            topCell.merge(bottomCell);\r\n\r\n                                            //  center align merged cell\r\n                                            try {\r\n                                                topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n                                                topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n                                            } catch (e) {\r\n                                                // ignore (safe fallback)\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                });\r\n\r\n                            }\r\n\r\n                            newSelection = table.getCell(0, 0); // Set the cursor to the start of the table\r\n                        } else {\r\n                            let elementText = element.innerText.trim();\r\n                            if (elementText) {\r\n                                elementText = elementText.replace(/\\n- /g, \"\\n \");\r\n\r\n                                elementText.split('\\n').forEach(line => {\r\n                                    if (line.trim()) {\r\n                                        insertLineWithHeadingStyle(selection, line);\r\n                                    }\r\n                                });\r\n                            }\r\n                            newSelection = selection; // If it's not a table, just use the existing selection.\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (type === \"IMAGE\") {\r\n                let base64Image: string = word.EditorValue;\r\n\r\n                if (base64Image.startsWith(\"data:image/svg+xml\")) {\r\n                    // Convert SVG  PNG\r\n                    base64Image = await svgBase64ToPngBase64(base64Image);\r\n                } else if (base64Image.startsWith(\"data:image\")) {\r\n                    base64Image = base64Image.split(\",\")[1]; // strip prefix\r\n                }\r\n\r\n                selection.insertInlinePictureFromBase64(base64Image, Word.InsertLocation.replace);\r\n                newSelection = selection;\r\n            } else {\r\n                if (word.EditorValue === '' || word.IsApplied) {\r\n                    selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n                } else {\r\n                    let content = removeQuotes(word.EditorValue);\r\n                    let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n                    lines.forEach(line => {\r\n                        selection.insertParagraph(line, Word.InsertLocation.before);\r\n                    });\r\n                }\r\n                newSelection = selection; // After inserting the text, set selection to it.\r\n            }\r\n\r\n            // Move the cursor to the next line after content insertion\r\n            const nextLineParagraph = selection.insertParagraph(\"\", Word.InsertLocation.after);\r\n            await context.sync();\r\n\r\n            // Set the new cursor position after content\r\n            newSelection = nextLineParagraph;\r\n            selection.select(); // Select the new paragraph where the cursor will be\r\n            await context.sync();\r\n\r\n        } catch (error) {\r\n            console.error('Detailed error:', error);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport async function openAITag(tag) {\r\n    tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n    });\r\n\r\n\r\n}\r\n\r\nexport async function generateCheckboxHistory(tag) {\r\n    if (!tag.FilteredReportHeadAIHistoryList || tag.FilteredReportHeadAIHistoryList.length === 0) {\r\n        await fetchAIHistory(tag);\r\n    }\r\n\r\n    const history = tag.FilteredReportHeadAIHistoryList;\r\n\r\n    if (history.length === 0) {\r\n        return '<div>No AI history available.</div>';\r\n    }\r\n\r\n    // Check current theme\r\n    const isDark = theme === 'Dark';\r\n    const closeBtnClass = isDark\r\n        ? 'fa-solid fa-circle-xmark bg-dark text-light'\r\n        : 'fa-solid fa-circle-xmark bg-light text-dark';\r\n\r\n    const closeBar = `\r\n    <div class=\"chat-header sticky-top bg-white z-3\">\r\n        <div class=\"d-flex justify-content-between align-items-center px-2 pt-3\">\r\n            <div class=\"d-flex align-items-center ms-3\">\r\n                <i class=\"fa fa-microchip-ai text-muted me-2\"></i>\r\n                <span class=\"fw-bold\">${tag.DisplayName}</span>\r\n            </div>\r\n            <div class=\"d-flex justify-content-center align-items-center me-3 c-pointer\" id=\"close-btn-tag\">\r\n                <i class=\"${closeBtnClass}\" id=\"close-ai-window\"></i>\r\n            </div>\r\n        </div>\r\n        <hr class=\"mt-2 mb-1 mx-3\">\r\n        </div>\r\n    `;\r\n\r\n    const chatBody = `\r\n        <div class=\"chat-body flex-grow-1 overflow-auto\">\r\n            ${generateChatHistoryHtml(history)}\r\n        </div>\r\n    `;\r\n\r\n    const chatFooterHtml = `\r\n        <div class=\"d-flex align-items-end justify-content-end chatbox p-2\" id=\"chatFooter\">\r\n            ${chatfooter(tag)}\r\n        </div>\r\n    `;\r\n\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n\r\n    return `${closeBar}${chatBody}${chatFooterHtml}`;\r\n}\r\n\r\n\r\n\r\n\r\nexport async function setupPromptBuilderUI(container, promptBuilderList) {\r\n\r\n    // Static template and field definitions\r\n    let preview = '';\r\n    let templateText = '';\r\n\r\n    // Field configs (can be extended)\r\n    let fieldsList = [];\r\n\r\n    // Create the form container\r\n    // Create the form container\r\n    container.innerHTML = `\r\n  <div class=\"form-group mb-3 p-3 pt-0\">\r\n    <label class='form-label'><span class=\"text-danger\">*</span> Prompt Builder Template</label>\r\n    <select id=\"promptBuilderTemplate\" class=\"form-control\">\r\n      <option value=\"\" disabled selected>Select a template</option>\r\n    </select>\r\n    <div id=\"templateError\" class=\"invalid-feedback d-none\">Type is required.</div>\r\n  </div>\r\n\r\n  <div id=\"fieldsContainer\"></div>\r\n\r\n  <div class=\"form-group mb-3 p-3 pt-0\" id=\"previewContainer\" style=\"display: none;\">\r\n    <label class=\"mb-2\">Preview</label>\r\n    <div id=\"preview\" class=\"form-control\"></div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-between px-3 align-items-center mt-3\">\r\n    <span id=\"resetBtn\" class=\"text-primary fw-bold\" style=\"cursor: pointer;\">Reset</span>\r\n    <button id=\"applyBtn\" class=\"btn btn-primary text-white\" disabled>Apply Prompt</button>\r\n  </div>\r\n`;\r\n\r\n    // Element references\r\n    const templateSelect = container.querySelector('#promptBuilderTemplate') as HTMLSelectElement;\r\n    const applyBtn = container.querySelector('#applyBtn') as HTMLButtonElement;\r\n    const resetBtn = container.querySelector('#resetBtn') as HTMLSpanElement;\r\n    const previewDiv = container.querySelector('#preview') as HTMLDivElement;\r\n    const fieldsContainer = container.querySelector('#fieldsContainer') as HTMLDivElement;\r\n    const previewContainer = container.querySelector('#previewContainer') as HTMLDivElement;\r\n    const templateError = container.querySelector('#templateError') as HTMLDivElement;\r\n\r\n    // Populate template dropdown\r\n    promptBuilderList.forEach((item) => {\r\n        const option = document.createElement('option');\r\n        option.value = item.ID.toString();\r\n        option.textContent = item.Name;\r\n        templateSelect.appendChild(option);\r\n    });\r\n\r\n    templateSelect.addEventListener('change', async () => {\r\n        const templateId = templateSelect.value;\r\n        const jwt = sessionStorage.getItem('token') || '';\r\n\r\n        const data = await getPromptTemplateById(templateId, jwt);\r\n        if (data.Status && data.Data) {\r\n            fieldsList = data.Data;\r\n            preview = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n\r\n            templateText = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n        }\r\n        if (!templateId) {\r\n            templateError.classList.remove('d-none');\r\n            return;\r\n        }\r\n\r\n        templateError.classList.add('d-none');\r\n\r\n        renderFields();\r\n        updatePreview();\r\n    });\r\n\r\n    function renderFields() {\r\n        fieldsContainer.innerHTML = '';\r\n\r\n        fieldsList.forEach((field) => {\r\n            const div = document.createElement('div');\r\n            div.className = 'form-group mb-3 p-3 pt-0';\r\n\r\n            const label = document.createElement('label');\r\n            label.textContent = field.Label;\r\n            div.appendChild(label);\r\n\r\n            if (field.Type === 1) {\r\n                const input = document.createElement('input');\r\n                input.type = 'text';\r\n                input.className = 'form-control';\r\n                input.id = field.Label;\r\n                input.addEventListener('input', replaceKeywordsManually);\r\n                div.appendChild(input);\r\n            } else if (field.Type === 2) {\r\n                const select = document.createElement('select');\r\n                select.className = 'form-control';\r\n                select.id = field.Label;\r\n                field.PromptTemplateOptionList.forEach((opt: any) => {\r\n                    const option = document.createElement('option');\r\n                    option.value = opt.Text;\r\n                    option.textContent = opt.Option;\r\n                    select.appendChild(option);\r\n                });\r\n                select.addEventListener('change', replaceKeywordsManually);\r\n                div.appendChild(select);\r\n            }\r\n\r\n            fieldsContainer.appendChild(div);\r\n        });\r\n    }\r\n\r\n    function replaceKeywordsManually() {\r\n        const keywordMap: { [key: string]: string } = {};\r\n\r\n        fieldsList.forEach((field) => {\r\n            const id = field.Label;\r\n            const keyword = `#${id}#`;\r\n\r\n            let value = '';\r\n            const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement;\r\n\r\n            if (element) {\r\n                value = (element instanceof HTMLInputElement || element instanceof HTMLSelectElement)\r\n                    ? element.value\r\n                    : '';\r\n            }\r\n\r\n            keywordMap[keyword] = value ? value : keyword;\r\n        });\r\n\r\n        let insertValue = templateText;\r\n        for (const [keyword, value] of Object.entries(keywordMap)) {\r\n            insertValue = insertValue.replace(new RegExp(keyword, 'g'), value);\r\n        }\r\n\r\n        preview = insertValue;\r\n        previewDiv.textContent = preview;\r\n        previewContainer.style.display = preview ? 'block' : 'none';\r\n        applyBtn.disabled = preview === '';\r\n    }\r\n\r\n    function updatePreview() {\r\n        replaceKeywordsManually();\r\n    }\r\n\r\n    function resetForm() {\r\n        // Reset only the dynamic field values\r\n        fieldsList.forEach((field) => {\r\n            const element = document.getElementById(field.Label) as HTMLInputElement | HTMLSelectElement;\r\n            if (element) {\r\n                if (element instanceof HTMLInputElement) {\r\n                    element.value = '';\r\n                } else if (element instanceof HTMLSelectElement) {\r\n                    element.selectedIndex = 0; // optional: reset to first option\r\n                }\r\n            }\r\n        });\r\n\r\n        // Clear preview\r\n        previewDiv.textContent = templateText;\r\n        preview = templateText;\r\n    }\r\n\r\n\r\n    function applyPrompt() {\r\n        if (!preview) return;\r\n\r\n        const promptTextarea = document.getElementById('prompt') as HTMLTextAreaElement;\r\n        if (promptTextarea) {\r\n            promptTextarea.value = preview;\r\n            switchToAddTag()\r\n        }\r\n\r\n    }\r\n\r\n    resetBtn.addEventListener('click', resetForm);\r\n    applyBtn.addEventListener('click', applyPrompt);\r\n}\r\n\r\n\r\nexport async function insertTagPrompt(tag) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) throw new Error(\"Invalid selection\");\r\n\r\n            /* --------------------------------------------------\r\n               1 Create invisible anchor at cursor\r\n            -------------------------------------------------- */\r\n            const anchorChar = selection.insertText(\r\n                \"\\u200B\", // zero-width space\r\n                Word.InsertLocation.replace\r\n            );\r\n            await context.sync();\r\n\r\n            let cursor = anchorChar.getRange();\r\n\r\n            let bookmarkStart: Word.Range | null = null;\r\n            let bookmarkEnd: Word.Range | null = null;\r\n\r\n            const include = (r: Word.Range) => {\r\n                if (!bookmarkStart) {\r\n                    bookmarkStart = r.getRange(\"Start\");\r\n                }\r\n                bookmarkEnd = r.getRange(\"End\");\r\n            };\r\n\r\n            /* --------------------------------------------------\r\n               2 Insert content\r\n            -------------------------------------------------- */\r\n            if (tag.ComponentKeyDataType === \"TABLE\") {\r\n                const parser = new DOMParser();\r\n                const doc = parser.parseFromString(tag.EditorValue, \"text/html\");\r\n                const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                for (const node of bodyNodes) {\r\n\r\n                    // TEXT NODE\r\n                    if (node.nodeType === Node.TEXT_NODE) {\r\n                        let txt = node.textContent?.trim();\r\n                        if (!txt) continue;\r\n\r\n                        txt = txt.replace(/\\n- /g, \"\\n \");\r\n                        for (const line of txt.split(\"\\n\")) {\r\n                            if (!line.trim()) continue;\r\n\r\n                            const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                            insertLineWithHeadingStyle(p, line);\r\n                            include(p.getRange());\r\n                            cursor = p.getRange();\r\n                        }\r\n                    }\r\n\r\n                    // ELEMENT NODE\r\n                    else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        const el = node as HTMLElement;\r\n\r\n                        // TABLE\r\n                        if (el.tagName.toLowerCase() === \"table\") {\r\n                            const rows = Array.from(el.querySelectorAll(\"tr\"));\r\n                            if (!rows.length) continue;\r\n\r\n                            const maxCols = Math.max(\r\n                                ...rows.map(r =>\r\n                                    Array.from(r.querySelectorAll(\"td, th\"))\r\n                                        .reduce(\r\n                                            (s, c) => s + parseInt(c.getAttribute(\"colspan\") || \"1\"),\r\n                                            0\r\n                                        )\r\n                                )\r\n                            );\r\n\r\n                            const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                            const table = p.insertTable(\r\n                                rows.length,\r\n                                maxCols,\r\n                                Word.InsertLocation.after\r\n                            );\r\n\r\n                            const resolvedTableStyle = resolveWordTableStyle(tableStyle);\r\n                            if (resolvedTableStyle !== 'none') {\r\n                                table.style = resolvedTableStyle;\r\n                            }\r\n\r\n                            if (colorPallete.Customize) {\r\n                                await colorTable(table, rows, context);\r\n                            } else {\r\n                                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n                                let lastParamRowIndex = -1; // row index of last non-empty Parameter cell\r\n\r\n                                rows.forEach((row, rowIndex) => {\r\n                                    const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                    let cellIndex = 0;\r\n\r\n                                    // track first column text in HTML row\r\n                                    let firstColText = \"\";\r\n\r\n                                    cells.forEach((cell) => {\r\n                                        while (rowspanTracker[cellIndex] > 0) {\r\n                                            rowspanTracker[cellIndex]--;\r\n                                            cellIndex++;\r\n                                        }\r\n\r\n                                        const cellText = Array.from(cell.childNodes)\r\n                                            .map(node => {\r\n                                                if (node.nodeType === Node.TEXT_NODE) {\r\n                                                    return node.textContent?.trim() || '';\r\n                                                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                    return (node as HTMLElement).innerText.trim();\r\n                                                }\r\n                                                return '';\r\n                                            })\r\n                                            .filter(text => text.length > 0)\r\n                                            .join(' ');\r\n\r\n                                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                                        // save first column text if this is first column\r\n                                        if (cellIndex === 0) {\r\n                                            firstColText = cellText.trim();\r\n                                        }\r\n\r\n                                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                        // colspan blank filling\r\n                                        for (let i = 1; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                            }\r\n                                        }\r\n\r\n                                        // rowspan tracking\r\n                                        if (rowspan > 1) {\r\n                                            for (let i = 0; i < colspan; i++) {\r\n                                                if (cellIndex + i < maxCols) {\r\n                                                    rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        cellIndex += colspan;\r\n                                    });\r\n\r\n                                    //  AFTER filling the row  apply merge logic for 1st column\r\n                                    if (rowIndex === 0) {\r\n                                        // header row typically\r\n                                        return;\r\n                                    }\r\n\r\n                                    if (firstColText) {\r\n                                        // new parameter starts\r\n                                        lastParamRowIndex = rowIndex;\r\n                                    } else {\r\n                                        // empty parameter row  merge vertically with previous parameter row\r\n                                        // empty parameter row  merge vertically with previous parameter row\r\n                                        if (lastParamRowIndex !== -1) {\r\n                                            const topCell = table.getCell(lastParamRowIndex, 0);\r\n                                            const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n                                            // merge bottom into top\r\n                                            topCell.merge(bottomCell);\r\n\r\n                                            //  center align merged cell\r\n                                            try {\r\n                                                topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n                                                topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n                                            } catch (e) {\r\n                                                // ignore (safe fallback)\r\n                                            }\r\n                                        }\r\n\r\n                                    }\r\n                                });\r\n\r\n                            }\r\n\r\n                            include(table.getRange());\r\n                            cursor = table.getRange();\r\n                        }\r\n\r\n                        // OTHER HTML ELEMENTS\r\n                        else {\r\n                            let txt = el.innerText?.trim();\r\n                            if (!txt) continue;\r\n\r\n                            txt = txt.replace(/\\n- /g, \"\\n \");\r\n                            for (const line of txt.split(\"\\n\")) {\r\n                                if (!line.trim()) continue;\r\n\r\n                                const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                                insertLineWithHeadingStyle(p, line);\r\n                                include(p.getRange());\r\n                                cursor = p.getRange();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // NON-TABLE CONTENT\r\n            else {\r\n                const txt = tag.EditorValue.replace(/\\n- /g, \"\\n \").trim();\r\n\r\n                for (const line of txt.split(\"\\n\")) {\r\n                    if (!line.trim()) continue;\r\n\r\n                    const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                    insertLineWithHeadingStyle(p, line);\r\n                    include(p.getRange());\r\n                    cursor = p.getRange();\r\n                }\r\n            }\r\n\r\n            await context.sync();\r\n\r\n            /* --------------------------------------------------\r\n               3 Create ONE bookmark covering everything\r\n            -------------------------------------------------- */\r\n            if (bookmarkStart && bookmarkEnd) {\r\n                const bookmarkName =\r\n                    `ID${tag.ID}_Split_${getDateTimeStamp()}`;\r\n\r\n                bookmarkStart\r\n                    .expandTo(bookmarkEnd)\r\n                    .insertBookmark(bookmarkName);\r\n            }\r\n\r\n            /* --------------------------------------------------\r\n               4 Remove invisible anchor\r\n            -------------------------------------------------- */\r\n            anchorChar.delete();\r\n\r\n            await context.sync();\r\n            toaster(\"Inserted successfully\", \"success\");\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            toaster(\"Something went wrong\", \"error\");\r\n        }\r\n    });\r\n}\r\n\r\nexport function getDateTimeStamp() {\r\n    const d = new Date();\r\n\r\n    const pad = (n) => n.toString().padStart(2, \"0\");\r\n\r\n    return `${d.getFullYear()}${pad(d.getMonth() + 1)}${pad(d.getDate())}_` +\r\n        `${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;\r\n}\r\n\r\n\r\n\r\n\r\nexport function initializeAIHistoryEvents(tag: any, jwt: string, availableKeys: any) {\r\n    setTimeout(() => {\r\n        tag.FilteredReportHeadAIHistoryList.forEach((chat: any, index: number) => {\r\n            // Copy buttons\r\n            if (tag.textareavalue) {\r\n                (document.getElementById(`chatInput`) as HTMLTextAreaElement).value = tag.textareavalue;\r\n                delete (tag.textareavalue)\r\n            }\r\n\r\n            // After initializing buttons inside setTimeout\r\n            const chatInput = document.getElementById(\"chatInput\") as HTMLTextAreaElement;\r\n            const changeSourceButton = document.getElementById(\"changeSourceButton\") as HTMLButtonElement;\r\n\r\n            if (chatInput && changeSourceButton) {\r\n                // Run once on load\r\n                changeSourceButton.disabled = chatInput.value.trim().length === 0;\r\n\r\n                // Listen for changes in textarea\r\n                chatInput.addEventListener(\"input\", () => {\r\n                    if (chatInput.value.trim().length > 0) {\r\n                        changeSourceButton.disabled = false;\r\n                    } else {\r\n                        changeSourceButton.disabled = true;\r\n                    }\r\n                });\r\n            };\r\n            document.getElementById(`copyPrompt-${index}`)?.addEventListener('click', () => copyText(chat.Prompt));\r\n            const savePromptele = document.getElementById(`savePrompt-${index}`);\r\n            if (savePromptele) {\r\n                document.getElementById(`savePrompt-${index}`)?.addEventListener('click', () => {\r\n                    const container = document.getElementById('confirmation-popup');\r\n                    if (container) {\r\n                        container.innerHTML = Confirmationpopup('Do you want to save the current prompt as a global default?');\r\n\r\n                        // Wait for DOM to update and then attach cancel button listener\r\n                        setTimeout(() => {\r\n                            document.getElementById('confirmation-popup-cancel')?.addEventListener('click', () => {\r\n                                container.innerHTML = '';\r\n                            });\r\n\r\n                            document.getElementById('confirmation-popup-confirm')?.addEventListener('click', async () => {\r\n                                try {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'true');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'true');\r\n                                    let updatedTag = JSON.parse(JSON.stringify(tag));\r\n                                    updatedTag.Prompt = chat.Prompt;\r\n                                    const data = await updatePromptTemplate(updatedTag, jwt);\r\n                                    if (data['Status']) {\r\n                                        toaster('Updated Succesfully', 'success');\r\n                                        container.innerHTML = '';\r\n                                    } else {\r\n                                        document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                        document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                        toaster('Something went wrong', 'error');\r\n\r\n\r\n                                    }\r\n                                } catch (error) {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                    toaster('Something went wrong', 'error');\r\n                                }\r\n                            });\r\n                        }, 0);\r\n                    }\r\n                });\r\n            }\r\n\r\n            const openRefferance = document.getElementById(`openRefferance-${index}`);\r\n            if (openRefferance) {\r\n                document.getElementById(`openRefferance-${index}`)?.addEventListener('click', () => {\r\n                    const container = document.getElementById('confirmation-popup');\r\n                    if (container) {\r\n                        const chatSources = chat.SourceValue.map((item: any) => {\r\n                            return sourceList.find(\r\n                                (source: any) => Number(item) === source.VectorID\r\n                            );\r\n                        });\r\n\r\n                        const sources = chatSources.filter((src: any) => !!src);\r\n                        const popupData = {\r\n                            Data: chat.Evidences,\r\n                            Name: tag.DisplayName,\r\n                            UserValue: chat.Response,\r\n                            Sources: sources\r\n                        }\r\n\r\n                        container.innerHTML = DataModalPopup(popupData);\r\n\r\n                        // Wait for DOM to update and then attach cancel button listener\r\n                        setTimeout(() => {\r\n                            document.getElementById('confirmation-popup-cancel')?.addEventListener('click', () => {\r\n                                container.innerHTML = '';\r\n                            });\r\n\r\n                            document.getElementById('confirmation-popup-confirm')?.addEventListener('click', async () => {\r\n                                try {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'true');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'true');\r\n                                    let updatedTag = JSON.parse(JSON.stringify(tag));\r\n                                    updatedTag.Prompt = chat.Prompt;\r\n                                    const data = await updatePromptTemplate(updatedTag, jwt);\r\n                                    if (data['Status']) {\r\n                                        toaster('Updated Succesfully', 'success');\r\n                                        container.innerHTML = '';\r\n                                    } else {\r\n                                        document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                        document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                        toaster('Something went wrong', 'error');\r\n\r\n\r\n                                    }\r\n                                } catch (error) {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                    toaster('Something went wrong', 'error');\r\n                                }\r\n                            });\r\n\r\n                            document.getElementById('datamodel-popup-ok')?.addEventListener('click', async () => {\r\n                                container.innerHTML = ''\r\n                            })\r\n                        }, 0);\r\n                    }\r\n                });\r\n            }\r\n\r\n\r\n            document.getElementById(`copyResponse-${index}`)?.addEventListener('click', () => copyText(chat.Response));\r\n\r\n            // Close button\r\n            document.getElementById(`close-btn-tag`)?.addEventListener('click', () => loadHomepage(availableKeys));\r\n\r\n            // Checkbox logic\r\n            const checkbox = document.getElementById(`checkbox-${index}`) as HTMLInputElement;\r\n            if (checkbox) {\r\n                checkbox.addEventListener('change', async (event: Event) => {\r\n                    const isChecked = (event.target as HTMLInputElement).checked;\r\n\r\n                    // Reset all\r\n                    tag.FilteredReportHeadAIHistoryList.forEach((_: any, otherIndex: number) => {\r\n                        const otherCheckbox = document.getElementById(`checkbox-${otherIndex}`) as HTMLInputElement;\r\n                        const responseContainer = document.getElementById(`responseContainer-${otherIndex}`);\r\n                        if (otherCheckbox) otherCheckbox.checked = false;\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.remove('ai-selected-response');\r\n                            responseContainer.classList.add('bg-light');\r\n                        }\r\n                        tag.FilteredReportHeadAIHistoryList[otherIndex].Selected = 0;\r\n                    });\r\n\r\n                    // Set selected\r\n                    if (isChecked) {\r\n                        checkbox.checked = true;\r\n                        const responseContainer = document.getElementById(`responseContainer-${index}`);\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.add('ai-selected-response');\r\n                            responseContainer.classList.remove('bg-light');\r\n                        }\r\n                        chat.Selected = 1;\r\n                    } else {\r\n                        chat.Selected = 0;\r\n                    }\r\n\r\n                    try {\r\n                        const data = await updateAiHistory(chat, jwt);\r\n                        if (data['Data']) {\r\n                            tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n                            tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n                            tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                                historyList.Response = removeQuotes(historyList.Response);\r\n                                tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                            });\r\n\r\n                            const finalResponse = chat.FormattedResponse\r\n                                ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                : chat.Response;\r\n\r\n                            tag.ComponentKeyDataType = chat.FormattedResponse ? 'TABLE' : 'TEXT';\r\n                            tag.UserValue = finalResponse;\r\n                            tag.EditorValue = finalResponse;\r\n                            tag.text = finalResponse;\r\n\r\n                            const currentlySelected = tag.FilteredReportHeadAIHistoryList.some((item: any) => item.Selected === 1);\r\n                            tag.IsApplied = !currentlySelected;\r\n                            availableKeys.forEach(currentTag => {\r\n                                if (currentTag.ID === tag.ID) {\r\n                                    const isTable = chat.FormattedResponse !== '';\r\n                                    const finalResponse = chat.FormattedResponse\r\n                                        ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                        : chat.Response;\r\n                                    currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n                                    currentTag.UserValue = finalResponse;\r\n                                    currentTag.EditorValue = finalResponse;\r\n                                    currentTag.text = finalResponse;\r\n                                    currentTag.IsApplied = tag.IsApplied;\r\n                                }\r\n                            })\r\n\r\n                            aiTagList.forEach(currentTag => {\r\n                                if (currentTag.ID === tag.ID) {\r\n                                    const isTable = chat.FormattedResponse !== '';\r\n                                    const finalResponse = chat.FormattedResponse\r\n                                        ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                        : chat.Response;\r\n\r\n\r\n                                    currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n                                    currentTag.UserValue = finalResponse;\r\n                                    currentTag.EditorValue = finalResponse;\r\n                                    currentTag.text = finalResponse;\r\n                                    currentTag.IsApplied = tag.IsApplied;\r\n                                }\r\n                            });\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('Failed to update AI history:', err);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        // Button: Insert Tag\r\n        document.getElementById(`insertTagButton`)?.addEventListener('click', () => {\r\n            if (!tag.IsApplied) {\r\n                insertTagPrompt(tag);\r\n            }\r\n        });\r\n\r\n        // Button: Send Prompt\r\n        document.getElementById(`sendPromptButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            sendPrompt(tag, textareaValue);\r\n        });\r\n\r\n        // Button: Change Source\r\n        document.getElementById(`changeSourceButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            tag.textareavalue = textareaValue;\r\n            createMultiSelectDropdown(tag);\r\n        });\r\n\r\n        // Mention dropdown\r\n        mentionDropdownFn(`chatInput`, `mention-dropdown`, 'edit');\r\n    }, 0);\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\nimport { dataUrl, storeUrl, versionLink } from \"./data\";\r\nimport { generateCheckboxHistory, getDateTimeStamp, initializeAIHistoryEvents, loadHomepage, replaceMention, setupPromptBuilderUI } from \"./components/home\";\r\nimport { applyThemeClasses, chatfooter, colorTable, insertLineWithHeadingStyle, mapImagesToComponentObjects, renderSelectedTags, resolveWordTableStyle, selectMatchingBookmarkFromSelection, svgBase64ToPngBase64, swicthThemeIcon, switchToAddTag, switchToPromptBuilder, updateEditorFinalTable } from \"./functions\";\r\nimport { addtagbody, customizeTablePopup, logoheader, navTabs, toaster } from \"./components/bodyelements\";\r\nimport { addAiHistory, addGroupKey, fetchGlossaryTemplate, getAiHistory, getAllClients, getAllCustomTables, getAllPromptTemplates, getGeneralImages, getReportById, getReportHeadImageById, loginUser, updateGroupKey } from \"./api\";\r\nimport { wordTableStyles } from \"./components/tablestyles\";\r\nexport let jwt = '';\r\nexport let UserRole: any = {};\r\nlet storedUrl = storeUrl\r\nlet documentID = ''\r\nlet organizationName = ''\r\nexport let aiTagList = [];\r\nexport let imageList = [];\r\nlet initialised = true;\r\nexport let availableKeys = [];\r\nlet promptBuilderList = [];\r\nlet glossaryName = ''\r\nlet isGlossaryActive: boolean = false;\r\nlet GroupName: string = '';\r\nlet layTerms = [];\r\nlet dataList: any = []\r\nlet isTagUpdating: boolean = false;\r\nlet capturedFormatting: any = {};\r\nlet emptyFormat: boolean = false;\r\nlet isNoFormatTextAvailable: boolean = false;\r\nlet clientId = '0';\r\nlet userId = 0;\r\nlet clientList = [];\r\nlet version = versionLink;\r\nlet currentYear = new Date().getFullYear();\r\nexport let sourceList;\r\nlet filteredGlossaryTerm;\r\nexport let selectedNames = [];\r\nexport let isPendingResponse = false;\r\nexport let theme = 'Light';\r\nexport let tableStyle = 'Plain Table 5';\r\nexport let colorPallete: any = {\r\n  \"Header\": '#FFFFFF',\r\n  \"Primary\": '#FFFFFF',\r\n  \"Secondary\": '#FFFFFF',\r\n  \"Customize\": true,\r\n  \"IsHeaderBold\": true,\r\n  \"IsSideHeaderBold\": false\r\n};\r\n\r\nexport let customTableStyle = [];\r\n\r\n/* global document, Office, Word */\r\n\r\nwindow.addEventListener('hashchange', () => {\r\n  const hash = window.location.hash;\r\n  if (hash === '#/dashboard' && initialised) {\r\n    initialised = false;\r\n    displayMenu();\r\n\r\n  }\r\n});\r\n\r\n\r\nOffice.onReady((info) => {\r\n  if (info.host === Office.HostType.Word) {\r\n    document.getElementById(\"app-body\").style.display = \"flex\";\r\n    document.getElementById(\"footer\").innerText = ` ${currentYear} - TrialAssure LINK AI Assistant ${version}`\r\n    const editor = document.getElementById('editor');\r\n\r\n    window.location.hash = '#/login';\r\n    retrieveDocumentProperties()\r\n\r\n    Office.context.document.addHandlerAsync(\r\n      Office.EventType.DocumentSelectionChanged,\r\n      () => {\r\n        logBookmarksInSelection();\r\n      }\r\n    );\r\n  }\r\n});\r\n\r\n\r\n// Example usage:\r\n\r\n\r\n\r\nasync function retrieveDocumentProperties() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const properties = context.document.properties.customProperties;\r\n      properties.load(\"items\");\r\n\r\n      await context.sync();\r\n      const property = properties.items.find(prop => prop.key === 'DocumentID');\r\n      const orgName = properties.items.find(prop => prop.key === 'Organization');\r\n      if (property && orgName) {\r\n        documentID = property.value;\r\n        organizationName = orgName.value;\r\n        login()\r\n      } else {\r\n        document.getElementById('app-body').innerHTML = `\r\n        <p class=\"px-3 text-center\">Export a document from the LINK AI application to use this functionality.</p>`\r\n        console.log(`Custom property \"documentID\" not found.`);\r\n        return null;\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error retrieving custom property:\", error);\r\n  }\r\n\r\n}\r\n\r\nasync function login() {\r\n  // document.getElementById('header').innerHTML = ``\r\n  const sessionToken = sessionStorage.getItem('token');\r\n  if (sessionToken) {\r\n    UserRole = JSON.parse(sessionStorage.getItem('userRole')) || ''\r\n    jwt = sessionToken;\r\n    window.location.hash = '#/dashboard';\r\n    const style = sessionStorage.getItem('tableStyle');\r\n    if (style) {\r\n      tableStyle = style;\r\n    }\r\n    const localPallete = sessionStorage.getItem('colorPallete');\r\n    if (localPallete) {\r\n      colorPallete = JSON.parse(localPallete);\r\n    }\r\n\r\n  } else {\r\n    loadLoginPage();\r\n  }\r\n}\r\n\r\nfunction loadLoginPage() {\r\n\r\n  document.getElementById('logo-header').innerHTML = `\r\n  <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n  <div class=\"icon-nav me-3\">\r\n    <span id=\"theme-toggle\"><i class=\"fa fa-moon c-pointer me-3\"  title=\"Toggle Theme\"></i><span>\r\n  </div>\r\n`;\r\n\r\n  document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-2\">\r\n      <form id=\"login-form\" class=\"p-4 border rounded\">\r\n        <div class=\"mb-3\">\r\n          <label for=\"organization\" class=\"form-label fw-bold\">Organization</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"organization\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"username\" class=\"form-label fw-bold\">Username</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"username\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"password\" class=\"form-label fw-bold\">Password</label>\r\n          <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n        </div>\r\n        <div class=\"d-grid\">\r\n          <button type=\"submit\" class=\"btn btn-primary bg-primary-clr\">Login</button>\r\n        </div>\r\n      <div id=\"login-error\" class=\"mt-3 text-danger\" style=\"display: none;\"></div>\r\n\r\n      </form>\r\n    </div>\r\n  `;\r\n  document.getElementById('theme-toggle').addEventListener('click', () => {\r\n    theme = theme === 'Light' ? 'Dark' : 'Light';\r\n    applyThemeClasses(theme)\r\n\r\n    document.body.classList.toggle('dark-theme', theme === 'Dark');\r\n    document.body.classList.toggle('light-theme', theme === 'Light');\r\n    swicthThemeIcon()\r\n  }\r\n  );\r\n  document.getElementById('login-form').addEventListener('submit', handleLogin);\r\n}\r\n\r\nasync function handleLogin(event) {\r\n  event.preventDefault();\r\n\r\n  // Get the values from the form fields\r\n  const organization = (document.getElementById('organization') as HTMLInputElement).value;\r\n  const username = (document.getElementById('username') as HTMLInputElement).value;\r\n  const password = (document.getElementById('password') as HTMLInputElement).value;\r\n  if (organization.toLowerCase().trim() === organizationName.toLocaleLowerCase().trim()) {\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n          </div\r\n`\r\n    try {\r\n      const data = await loginUser(organization, username, password);\r\n      if (data.Status === true && data['Data']) {\r\n        if (data['Data'].ResponseStatus) {\r\n          jwt = data.Data.Token;\r\n          const style = sessionStorage.getItem('tableStyle');\r\n          if (style) {\r\n            tableStyle = style;\r\n          }\r\n\r\n          const localPallete = sessionStorage.getItem('colorPallete');\r\n          if (localPallete) {\r\n            colorPallete = JSON.parse(localPallete);\r\n          }\r\n          UserRole = data.Data.UserRole;\r\n          sessionStorage.setItem('userRole', JSON.stringify(data.Data.UserRole));\r\n          sessionStorage.setItem('token', jwt)\r\n          sessionStorage.setItem('userId', data.Data.ID);\r\n          toaster('You are successfully logged in', 'success');\r\n          window.location.hash = '#/dashboard';\r\n        } else {\r\n          showLoginError(\"An error occurred during login. Please try again.\")\r\n        }\r\n      } else {\r\n        showLoginError(\"An error occurred during login. Please try again.\")\r\n      }\r\n    } catch (error) {\r\n      showLoginError(\"An error occurred during login. Please try again.\")\r\n      console.error('Error during login:', error);\r\n      // Handle login error (e.g., show an error message)\r\n    }\r\n  } else {\r\n    showLoginError(\"The organization specified is not associated with this document\")\r\n  }\r\n}\r\n\r\nfunction showLoginError(message) {\r\n  loadLoginPage();  // Reload the form UI\r\n  const errorDiv = document.getElementById('login-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction displayMenu() {\r\n  userId = Number(sessionStorage.getItem('userId'))\r\n  // document.getElementById('aitag').addEventListener('click', redirectAI);\r\n  fetchDocument('Init');\r\n\r\n}\r\n\r\nasync function getTableStyle() {\r\n  const tableStyleObj = await getAllCustomTables(jwt);\r\n  customTableStyle = tableStyleObj['Data'];\r\n  const selectedTable = customTableStyle.find(style => style.ID === dataList.TableCustomizationID);\r\n  if (selectedTable) {\r\n    sessionStorage.setItem(\"CustomStyle\", selectedTable ? selectedTable.Name : '');\r\n    colorPallete = {\r\n      \"Header\": selectedTable.Setting.HeaderColor,\r\n      \"Primary\": selectedTable.Setting.PrimaryColor,\r\n      \"Secondary\": selectedTable.Setting.SecondaryColor,\r\n      \"Customize\": true,\r\n      \"IsHeaderBold\": selectedTable.Setting.IsHeaderBold,\r\n      \"IsSideHeaderBold\": selectedTable.Setting.IsSideHeaderBold\r\n    };\r\n    tableStyle = selectedTable.Setting.BaseStyle;\r\n  }\r\n\r\n}\r\n\r\nasync function fetchDocument(action) {\r\n  try {\r\n\r\n    const data = await getReportById(documentID, jwt);\r\n\r\n    document.getElementById('app-body').innerHTML = ``\r\n    document.getElementById('logo-header').innerHTML = logoheader(storedUrl);\r\n\r\n    dataList = data['Data'];\r\n    const ts = sessionStorage.getItem('tableStyle');\r\n    if (ts) {\r\n      tableStyle = ts;\r\n    } else {\r\n      tableStyle = 'Plain Table 5';\r\n    }\r\n\r\n    const cp = sessionStorage.getItem('colorPallete');\r\n    if (cp) {\r\n      colorPallete = JSON.parse(cp);\r\n    } else {\r\n      colorPallete = {\r\n        \"Header\": '#FFFFFF',\r\n        \"Primary\": '#FFFFFF',\r\n        \"Secondary\": '#FFFFFF',\r\n        \"Customize\": true,\r\n        \"IsHeaderBold\": true,\r\n        \"IsSideHeaderBold\": false\r\n      };\r\n    }\r\n\r\n    getTableStyle();\r\n    sourceList = dataList?.SourceTypeList?.filter(\r\n      (item) => item.SourceValue !== ''\r\n        && item.AIFlag === 1\r\n    ).map((item) => ({\r\n      ...item, // Spread the existing properties\r\n      SourceName: decodeURIComponent(transformDocumentName(item.SourceValue))\r\n    }));\r\n    clientId = dataList.ClientID;\r\n    const aiGroup = data['Data'].Group.find(element => element.DisplayName === 'AIGroup');\r\n    GroupName = aiGroup ? aiGroup.Name : '';\r\n    aiTagList = aiGroup ? aiGroup.GroupKey : [];\r\n    getImages();\r\n    availableKeys = data['Data'].GroupKeyAll.filter(element => element.ComponentKeyDataType === 'TABLE' || element.ComponentKeyDataType === 'TEXT' || element.ComponentKeyDataType === 'TEXT');\r\n    availableKeys.forEach((key) => {\r\n      if (key.AIFlag === 1) {\r\n        const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n        let match;\r\n        if ((match = regex.exec(key.EditorValue) !== null)) {\r\n          {\r\n            key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n            key.UserValue = key.EditorValue;\r\n            key.InitialTable = true;\r\n            key.ComponentKeyDataType = 'TABLE';\r\n          }\r\n\r\n        }\r\n      }\r\n    });\r\n\r\n    aiTagList.forEach((key, i) => {\r\n      const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n      let match;\r\n      if ((match = regex.exec(key.EditorValue) !== null)) {\r\n        {\r\n          key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n          key.UserValue = key.EditorValue;\r\n          key.InitialTable = true;\r\n          key.ComponentKeyDataType = 'TABLE';\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    );\r\n    fetchClients();\r\n    loadPromptTemplates();\r\n    loadHomepage(availableKeys);\r\n    document.getElementById('home').addEventListener('click', async () => {\r\n      if (!isPendingResponse) {\r\n        if (isGlossaryActive) {\r\n          await removeMatchingContentControls();\r\n        }\r\n\r\n        loadHomepage(availableKeys);\r\n      }\r\n    });\r\n\r\n    document.getElementById('glossary').addEventListener('click', () => {\r\n      if (emptyFormat) {\r\n        fetchGlossary();\r\n      }\r\n    });\r\n\r\n    document.getElementById('define-formatting').addEventListener('click', () => {\r\n      if (!isPendingResponse) {\r\n        formatOptionsDisplay()\r\n      }\r\n    }\r\n    );\r\n\r\n\r\n    document.getElementById('removeFormatting').addEventListener('click', () => {\r\n      if (Object.keys(capturedFormatting).length > 0) {\r\n        removeOptionsConfirmation();\r\n      }\r\n    });\r\n\r\n\r\n    document.getElementById('theme-toggle').addEventListener('click', () => {\r\n      theme = theme === 'Light' ? 'Dark' : 'Light';\r\n      applyThemeClasses(theme)\r\n\r\n      document.body.classList.toggle('dark-theme', theme === 'Dark');\r\n      document.body.classList.toggle('light-theme', theme === 'Light');\r\n      swicthThemeIcon()\r\n    }\r\n    );\r\n\r\n    document.getElementById('logout').addEventListener('click', async () => {\r\n      if (!isPendingResponse) {\r\n        if (isGlossaryActive) {\r\n          await removeMatchingContentControls();\r\n        }\r\n\r\n        logout()\r\n      }\r\n    }\r\n    );\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching glossary data:', error);\r\n  }\r\n}\r\n\r\nasync function fetchClients() {\r\n  try {\r\n    const userId = sessionStorage.getItem('userId') || '';\r\n\r\n\r\n    const data = await getAllClients(userId, jwt);\r\n\r\n    if (data.Status && data.Data) {\r\n      clientList = data['Data'];\r\n    } else {\r\n      console.warn(\"Failed to load clients or no clients found.\");\r\n    }\r\n  } catch (error) {\r\n  }\r\n}\r\n\r\n\r\n\r\nexport async function formatOptionsDisplay() {\r\n  if (!isTagUpdating) { // Check if isTagUpdating is false\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n    const htmlBody = `\r\n      <div class=\"container pt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n               <!-- Buttons for Capture and Empty Format -->\r\n            <div class=\"d-flex justify-content-end\">\r\n              <button id=\"capture-format-btn\" class=\"btn btn-primary bg-primary-clr\"><i class=\"fa fa-border-style me-1\"></i>  Capture Format</button>\r\n            </div>\r\n            <!-- <h5 class=\"card-title\">Formatting Options</h5> -->\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div class=\"formating-checkbox\">\r\n               <input type=\"checkbox\" id=\"empty-format-checkbox\" class=\"form-check-input\">\r\n              <label for=\"empty-format-checkbox\" class=\"form-check-label empty-format-checkbox-label\" style=\"flex: 1;\">\r\n                   Skip ignoring and removing format-based text\r\n              </label>\r\n            </div>\r\n\r\n            <!-- Section to display captured formatting -->\r\n            <div id=\"format-details\">\r\n              <h5 class=\"my-3\">Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled\"></ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    if (Object.keys(capturedFormatting).length === 0) {\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // The object is not empty\r\n    }\r\n\r\n    const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n    if (!glossaryBtn.classList.contains('disabled-link')) {\r\n      glossaryBtn.classList.add('disabled-link');\r\n    }\r\n\r\n    if (emptyFormat) {\r\n      clearCapturedFormatting();\r\n    }\r\n    else {\r\n      if (capturedFormatting.Bold === null || capturedFormatting.Bold === undefined ||\r\n        capturedFormatting.Underline === 'Mixed' || capturedFormatting.Underline === undefined ||\r\n        capturedFormatting.Size === null || capturedFormatting.Size === undefined ||\r\n        capturedFormatting[\"Font Name\"] === null || capturedFormatting[\"Font Name\"] === undefined ||\r\n        capturedFormatting[\"Background Color\"] === '' || capturedFormatting[\"Background Color\"] === undefined ||\r\n        capturedFormatting[\"Text Color\"] === '' || capturedFormatting[\"Text Color\"] === undefined) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n\r\n\r\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n          removeFormatBtn.classList.add('disabled-link');\r\n        }\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.classList.remove('disabled-link');\r\n        displayCapturedFormatting();\r\n      }\r\n    }\r\n    // Event listeners for the buttons\r\n\r\n    document.getElementById(\"capture-format-btn\").addEventListener(\"click\", captureFormatting);\r\n\r\n    const emptyFormatCheckbox = document.getElementById(\"empty-format-checkbox\") as HTMLInputElement;\r\n    if (isNoFormatTextAvailable) {\r\n      emptyFormatCheckbox.checked = true;\r\n      clearCapturedFormatting();\r\n    }\r\n\r\n    emptyFormatCheckbox.addEventListener(\"change\", () => {\r\n      if (emptyFormatCheckbox.checked) {\r\n        isNoFormatTextAvailable = true;\r\n        clearCapturedFormatting();\r\n      } else {\r\n        const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n        CaptureBtn.disabled = false;\r\n        isNoFormatTextAvailable = false;\r\n        emptyFormat = false;\r\n        const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n        if (!glossaryBtn.classList.contains('disabled-link')) {\r\n          glossaryBtn.classList.add('disabled-link');\r\n        }\r\n      }\r\n    });\r\n\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayCapturedFormatting() {\r\n  emptyFormat = false;\r\n  const formatList = document.getElementById(\"format-list\");\r\n  formatList.innerHTML = \"\"; // Clear the list before adding new items\r\n\r\n  for (const [key, value] of Object.entries(capturedFormatting)) {\r\n    if ((key === \"Text Color\" || key === \"Background Color\") && value) {\r\n      formatList.innerHTML += `\r\n        <li><strong>${key}:</strong>${value}\r\n          <span style=\"display:inline-block;width:15px;height:15px;background-color:${value};border:1px solid black;\"></span>\r\n        </li>\r\n      `;\r\n    } else {\r\n      formatList.innerHTML += `<li><strong>${key}:</strong> ${value}</li>`;\r\n    }\r\n  }\r\n}\r\n\r\nfunction clearCapturedFormatting() {\r\n  capturedFormatting = {}; // Clear the captured formatting object\r\n  const formatDetails = document.getElementById(\"format-details\");\r\n  formatDetails.style.display = 'none';\r\n  // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n  emptyFormat = true;\r\n  const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n  glossaryBtn.classList.remove('disabled-link');\r\n  const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n  CaptureBtn.disabled = true;\r\n\r\n\r\n  const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n  if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n    removeFormatBtn.classList.add('disabled-link');\r\n  }\r\n  console.log(\"Captured formatting cleared.\");\r\n}\r\n\r\nasync function captureFormatting() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n      const font = selection.font;\r\n      font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n\r\n      await context.sync();\r\n\r\n      capturedFormatting = {\r\n        Bold: font.bold,\r\n        Italic: font.italic,\r\n        Underline: font.underline,\r\n        Size: font.size,\r\n        \"Background Color\": font.highlightColor,\r\n        \"Font Name\": font.name,\r\n        'Text Color': font.color\r\n      };\r\n\r\n\r\n\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'block';\r\n\r\n      if (capturedFormatting.Bold === null ||\r\n        capturedFormatting.Underline === 'Mixed' ||\r\n        capturedFormatting.Size === null ||\r\n        capturedFormatting[\"Font Name\"] === null ||\r\n        capturedFormatting[\"Background Color\"] === '' ||\r\n        capturedFormatting[\"Text Color\"] === ''\r\n\r\n      ) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n          removeFormatBtn.classList.add('disabled-link');\r\n        }\r\n\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.classList.remove('disabled-link');\r\n        displayCapturedFormatting();\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error capturing formatting:\", error);\r\n  }\r\n}\r\n\r\n\r\n\r\nasync function removeOptionsConfirmation() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    } // Check if isTagUpdating is false\r\n    const htmlBody = `\r\n      <div class=\"container pt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n            <h5 class=\"card-title\">Are you sure you want to remove formatted text ?</h5>\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div id=\"format-details\">\r\n              <h5>Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled mb-3\"></ul>\r\n              <small class=\"text-secondary font-italic\" id=\"warning-rem-fmt\"></small>\r\n             \r\n            </div>\r\n               <!-- Buttons for Capture and Empty Format -->\r\n\r\n            <div class=\"mt-3 d-flex justify-content-between\">\r\n              <span id=\"change-ft-btn\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n              <button id=\"clear-ft-btn\" class=\"btn btn-primary px-3\"><i class=\"fa fa-check-circle me-2\"></i>Yes</button>\r\n\r\n            </div>\r\n\r\n            \r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    displayCapturedFormatting();\r\n\r\n    if (capturedFormatting['Background Color'] === null &&\r\n      capturedFormatting['Text Color'] === '#000000') {\r\n      const warningEle = document.getElementById('warning-rem-fmt').innerHTML = 'Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?'\r\n    }\r\n\r\n    // Event listeners for the buttons\r\n    document.getElementById(\"clear-ft-btn\").addEventListener(\"click\", removeFormattedText);\r\n    document.getElementById(\"change-ft-btn\").addEventListener(\"click\", formatOptionsDisplay);\r\n\r\n  }\r\n}\r\n\r\nasync function removeFormattedText() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n\r\n      const iconelement = document.getElementById(`clear-ft-btn`);\r\n      iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Yes`;\r\n      const clrBtn = document.getElementById('clear-ft-btn') as HTMLButtonElement;\r\n      clrBtn.disabled = true;\r\n\r\n      const changeBtn = document.getElementById('change-ft-btn') as HTMLButtonElement;\r\n      changeBtn.disabled = true;\r\n      const paragraphs = context.document.body.paragraphs;\r\n      paragraphs.load(\"items\"); // Load paragraphs from the body\r\n\r\n      await context.sync();\r\n\r\n      // Iterate through each paragraph in the document body\r\n      for (const paragraph of paragraphs.items) {\r\n\r\n        // Check if the paragraph contains text\r\n        if (paragraph.text.trim() !== \"\") {\r\n          const textRanges = paragraph.split([\" \"]); // Split paragraph into individual words/segments\r\n          textRanges.load(\"items, font\");\r\n\r\n          await context.sync();\r\n\r\n          for (const range of textRanges.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n\r\n            // Check if the text range matches the captured formatting\r\n            if (\r\n              font.highlightColor === capturedFormatting['Background Color'] &&\r\n              font.color === capturedFormatting['Text Color'] &&\r\n              font.bold === capturedFormatting['Bold'] &&\r\n              font.italic === capturedFormatting['Italic'] &&\r\n              font.size === capturedFormatting['Size'] &&\r\n              font.underline === capturedFormatting['Underline'] &&\r\n              font.name === capturedFormatting['Font Name']\r\n            ) {\r\n              // Clear the range whether it's a full word or part of a word\r\n              font.highlightColor = \"#FFFFFF\"; // Set new background color\r\n              font.color = \"#000000\"; // Set new text color\r\n              font.bold = false; // Reset bold if needed\r\n              font.italic = false; // Reset italic if needed\r\n              font.underline = \"None\";\r\n              paragraph.insertText(\" \", Word.InsertLocation.replace);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n      capturedFormatting = {}; // Clear the captured formatting object\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n      emptyFormat = true;\r\n      isNoFormatTextAvailable = true;\r\n      const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n      glossaryBtn.classList.remove('disabled-link');\r\n      formatOptionsDisplay()\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing formatted text:\", error);\r\n  }\r\n}\r\n\r\n\r\nexport async function fetchAIHistory(tag) {\r\n  try {\r\n\r\n    const data = await getAiHistory(tag.ID, jwt);\r\n\r\n\r\n    if (data.Status && data.Data) {\r\n      tag.ReportHeadAIHistoryList = data['Data'] || [];\r\n      tag.FilteredReportHeadAIHistoryList = [];\r\n      tag.SourceValueID = tag.ReportHeadAIHistoryList[0].SourceValue;\r\n      const selectedSources = sourceList.filter((list) =>\r\n        tag.SourceValueID.includes(String(list.VectorID))\r\n      );\r\n\r\n      tag.SourceName = selectedSources.map((item) => {\r\n        return item.SourceName;\r\n      });\r\n      tag.Sources = tag.SourceName.join(',');\r\n      tag.TempSourceValue = selectedSources.map((item) => {\r\n        return item.VectorID ? String(item.VectorID) : item.SourceValue;\r\n      });\r\n\r\n\r\n      tag.ReportHeadAIHistoryList.forEach((historyList, i) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n\r\n      });\r\n      return tag.FilteredReportHeadAIHistoryList;\r\n      // Use the data here\r\n    } else {\r\n      console.warn(\"No AI history available.\");\r\n    }\r\n\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching AI history:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function sendPrompt(tag, prompt) {\r\n  if (prompt !== '' && !isTagUpdating) {\r\n\r\n    isTagUpdating = true;\r\n\r\n    const iconelement = document.getElementById(`sendPromptButton`);\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`;\r\n\r\n    const payload = {\r\n      ReportHeadID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadID,\r\n      DocumentID: dataList.NCTID,\r\n      DocumentType: dataList.DocumentType,\r\n      TextSetting: dataList.TextSetting,\r\n      DocumentTemplate: dataList.ReportTemplate,\r\n      ReportHeadGroupKeyID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,\r\n      ThreadID: tag.ThreadID,\r\n      AssistantID: dataList.AssistantID,\r\n      Container: dataList.Container,\r\n      GroupName: GroupName,\r\n      Prompt: prompt,\r\n      PromptType: 1,\r\n      Response: '',\r\n      VectorID: dataList.VectorID,\r\n      Selected: 0,\r\n      ID: 0,\r\n      SourceValue: tag.TempSourceValue ? tag.TempSourceValue : []\r\n    };\r\n\r\n    try {\r\n      isPendingResponse = true;\r\n      const data = await addAiHistory(payload, jwt);\r\n\r\n      if (data['Data'] && data['Data'] !== 'false') {\r\n        tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n        tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n        tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n          historyList.Response = removeQuotes(historyList.Response);\r\n          tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n        });\r\n        const chat = tag.ReportHeadAIHistoryList[0];\r\n        aiTagList.forEach(currentTag => {\r\n          if (currentTag.ID === tag.ID) {\r\n            const isTable = chat.FormattedResponse !== '';\r\n            const finalResponse = chat.FormattedResponse\r\n              ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n              : chat.Response;\r\n\r\n\r\n            currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n            currentTag.UserValue = finalResponse;\r\n            currentTag.EditorValue = finalResponse;\r\n            currentTag.text = finalResponse;\r\n            currentTag.IsApplied = tag.IsApplied;\r\n\r\n          }\r\n        });\r\n\r\n        availableKeys.forEach(currentTag => {\r\n          if (currentTag.ID === tag.ID) {\r\n            const isTable = chat.FormattedResponse !== '';\r\n            const finalResponse = chat.FormattedResponse\r\n              ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n              : chat.Response;\r\n            currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n            currentTag.UserValue = finalResponse;\r\n            currentTag.EditorValue = finalResponse;\r\n            currentTag.text = finalResponse;\r\n            currentTag.IsApplied = tag.IsApplied;\r\n\r\n          }\r\n        })\r\n\r\n\r\n\r\n        const appbody = document.getElementById('app-body')\r\n        appbody.innerHTML = await generateCheckboxHistory(tag);\r\n        isPendingResponse = false;\r\n\r\n      }\r\n\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      document.getElementById(`chatInput`).value = '';\r\n      isTagUpdating = false;\r\n      isPendingResponse = false;\r\n      // sourceListBtn.disabled = false;\r\n\r\n    } catch (error) {\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      isTagUpdating = false;\r\n      isPendingResponse = false;\r\n      console.error('Error sending AI prompt:', error);\r\n    }\r\n  } else {\r\n    console.error('No empty prompt allowed');\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n// Your existing copyText function\r\n\r\n\r\n\r\nasync function logout() {\r\n  if (isGlossaryActive) {\r\n    await removeMatchingContentControls();\r\n  }\r\n  sessionStorage.clear();\r\n  window.location.hash = '#/new';\r\n  initialised = true;\r\n  document.getElementById('logo-header').innerHTML = ``;\r\n  login();\r\n}\r\n\r\nfunction addAccordionListeners() {\r\n  const accordionButtons = document.querySelectorAll('.accordion-button');\r\n\r\n  accordionButtons.forEach(button => {\r\n    button.addEventListener('click', function () {\r\n      const collapseElement = this.nextElementSibling;\r\n\r\n      // Check if the element exists before accessing its classList\r\n      if (collapseElement && collapseElement.classList) {\r\n        collapseElement.classList.toggle('show');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction addCopyListeners() {\r\n  const copyIcons = document.querySelectorAll('.fa-copy');\r\n  copyIcons.forEach(icon => {\r\n    icon.addEventListener('click', function () {\r\n      const textToCopy = this.closest('.p-2').querySelector('.form-control').textContent;\r\n    });\r\n  });\r\n}\r\n\r\nexport async function applyTagFn() {\r\n\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const body = context.document.body;\r\n\r\n      context.load(body, 'text');\r\n      await context.sync();\r\n      await applyAITagFn(body, context);\r\n      await applyImageTagFn(body, context);\r\n    } catch (err) {\r\n      toaster(\"Something went wrong\", \"error\")\r\n      console.error(\"Error during tag application:\", err);\r\n      loadHomepage(availableKeys);\r\n    }\r\n  });\r\n}\r\n\r\nasync function applyImageTagFn(body: Word.Body, context: Word.RequestContext) {\r\n  for (let i = 0; i < imageList.length; i++) {\r\n    const tag = imageList[i];\r\n    const searchResults = body.search(`$${tag.DisplayName}$`, {\r\n      matchCase: false,\r\n      matchWholeWord: false,\r\n    });\r\n    context.load(searchResults, 'items');\r\n    await context.sync();\r\n\r\n    for (const item of searchResults.items) {\r\n      if (tag.EditorValue !== \"\") {\r\n        let base64Image: string = tag.EditorValue;\r\n\r\n        // Clean base64\r\n        if (!base64Image) continue;\r\n\r\n        // Convert SVG  PNG\r\n        if (base64Image.startsWith(\"data:image/svg+xml\")) {\r\n          base64Image = await svgBase64ToPngBase64(base64Image);\r\n        }\r\n        // Already PNG/JPEG  strip data prefix\r\n        else if (base64Image.startsWith(\"data:image\")) {\r\n          base64Image = base64Image.split(\",\")[1];\r\n        }\r\n\r\n        const imageRange = item.getRange();\r\n        imageRange.insertInlinePictureFromBase64(base64Image, Word.InsertLocation.replace);\r\n        await context.sync();\r\n      }\r\n    }\r\n  }\r\n  await context.sync();\r\n  toaster(\"AI tag application completed!\", \"success\");\r\n  loadHomepage(availableKeys);\r\n}\r\n\r\nexport async function applyAITagFn(\r\n  body: Word.Body,\r\n  context: Word.RequestContext\r\n) {\r\n  document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n    <div class=\"loader\" id=\"loader\"></div>\r\n    <div id=\"highlighted-text\"></div>\r\n  </div>`\r\n  toaster(\"Please wait... applying AI tags\", \"info\");\r\n\r\n  for (const tag of aiTagList) {\r\n    tag.EditorValue = removeQuotes(tag.EditorValue);\r\n    if (!tag.EditorValue || tag.IsApplied) continue;\r\n\r\n    const results = body.search(`#${tag.DisplayName}#`, {\r\n      matchCase: false,\r\n      matchWholeWord: false\r\n    });\r\n\r\n    context.load(results, \"items\");\r\n    await context.sync();\r\n\r\n    for (const item of results.items) {\r\n\r\n      /* --------------------------------------------------\r\n         1 Anchor correctly (NO invisible chars)\r\n      -------------------------------------------------- */\r\n      const anchor = item.getRange(\"Start\");\r\n\r\n      // Remove placeholder text completely\r\n      item.delete();\r\n      await context.sync();\r\n\r\n      let cursor = anchor;\r\n\r\n      let bookmarkStart: Word.Range | null = null;\r\n      let bookmarkEnd: Word.Range | null = null;\r\n\r\n      const include = (r: Word.Range) => {\r\n        if (!bookmarkStart) {\r\n          bookmarkStart = r.getRange(\"Start\");\r\n        }\r\n        bookmarkEnd = r.getRange(\"End\");\r\n      };\r\n\r\n      /* --------------------------------------------------\r\n         2 Insert content forward from anchor\r\n      -------------------------------------------------- */\r\n\r\n      // TABLE CONTENT\r\n      if (tag.ComponentKeyDataType === \"TABLE\") {\r\n        const parser = new DOMParser();\r\n        const doc = parser.parseFromString(tag.EditorValue, \"text/html\");\r\n        const nodes = Array.from(doc.body.childNodes);\r\n\r\n        for (const node of nodes) {\r\n\r\n          // TEXT NODE\r\n          if (node.nodeType === Node.TEXT_NODE) {\r\n            let txt = node.textContent?.trim();\r\n            if (!txt) continue;\r\n\r\n            txt = txt.replace(/\\n- /g, \"\\n \");\r\n            for (const line of txt.split(\"\\n\")) {\r\n              if (!line.trim()) continue;\r\n\r\n              const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n              insertLineWithHeadingStyle(p, line);\r\n\r\n              include(p.getRange());\r\n              cursor = p.getRange();\r\n            }\r\n          }\r\n\r\n          // ELEMENT NODE\r\n          else if (node.nodeType === Node.ELEMENT_NODE) {\r\n            const el = node as HTMLElement;\r\n\r\n            // TABLE\r\n            if (el.tagName.toLowerCase() === \"table\") {\r\n              const rows = Array.from(el.querySelectorAll(\"tr\"));\r\n              if (!rows.length) continue;\r\n\r\n              const maxCols = Math.max(\r\n                ...rows.map(r =>\r\n                  Array.from(r.querySelectorAll(\"td, th\")).reduce(\r\n                    (s, c) =>\r\n                      s + parseInt(c.getAttribute(\"colspan\") || \"1\", 10),\r\n                    0\r\n                  )\r\n                )\r\n              );\r\n\r\n              const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n              const table = p.insertTable(\r\n                rows.length,\r\n                maxCols,\r\n                Word.InsertLocation.after\r\n              );\r\n\r\n              const resolvedTableStyle = resolveWordTableStyle(tableStyle);\r\n              if (resolvedTableStyle !== 'none') {\r\n                table.style = resolvedTableStyle;\r\n              }\r\n\r\n              if (colorPallete.Customize) {\r\n                await colorTable(table, rows, context);\r\n              } else {\r\n                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n                let lastParamRowIndex = -1; // row index of last non-empty Parameter cell\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  // track first column text in HTML row\r\n                  let firstColText = \"\";\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                    // save first column text if this is first column\r\n                    if (cellIndex === 0) {\r\n                      firstColText = cellText.trim();\r\n                    }\r\n\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    // colspan blank filling\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < maxCols) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    // rowspan tracking\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < maxCols) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n\r\n                  //  AFTER filling the row  apply merge logic for 1st column\r\n                  if (rowIndex === 0) {\r\n                    // header row typically\r\n                    return;\r\n                  }\r\n\r\n                  if (firstColText) {\r\n                    // new parameter starts\r\n                    lastParamRowIndex = rowIndex;\r\n                  } else {\r\n                    // empty parameter row  merge vertically with previous parameter row\r\n                    if (lastParamRowIndex !== -1) {\r\n                      const topCell = table.getCell(lastParamRowIndex, 0);\r\n                      const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n                      // merge bottom into top\r\n                      topCell.merge(bottomCell);\r\n\r\n                      //  center align merged cell\r\n                      try {\r\n                        topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n                        topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n                      } catch (e) {\r\n                        // ignore (safe fallback)\r\n                      }\r\n                    }\r\n                  }\r\n                });\r\n\r\n              }\r\n\r\n              include(table.getRange());\r\n              cursor = table.getRange();\r\n            }\r\n\r\n            // OTHER ELEMENTS\r\n            else {\r\n              let txt = el.innerText?.trim();\r\n              if (!txt) continue;\r\n\r\n              txt = txt.replace(/\\n- /g, \"\\n \");\r\n              for (const line of txt.split(\"\\n\")) {\r\n                if (!line.trim()) continue;\r\n\r\n                const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                insertLineWithHeadingStyle(p, line);\r\n\r\n                include(p.getRange());\r\n                cursor = p.getRange();\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // IMAGE CONTENT\r\n      else if (tag.ComponentKeyDataType === \"IMAGE\") {\r\n        let base64 = tag.EditorValue;\r\n\r\n        if (base64.startsWith(\"data:image/svg+xml\")) {\r\n          base64 = await svgBase64ToPngBase64(base64);\r\n        } else if (base64.startsWith(\"data:image\")) {\r\n          base64 = base64.split(\",\")[1];\r\n        }\r\n\r\n        const pic = cursor.insertInlinePictureFromBase64(\r\n          base64,\r\n          Word.InsertLocation.after\r\n        );\r\n\r\n        include(pic.getRange());\r\n        cursor = pic.getRange();\r\n      }\r\n\r\n      // TEXT CONTENT\r\n      else {\r\n        const txt = tag.EditorValue\r\n          .replace(/\\n- /g, \"\\n \")\r\n          .trim();\r\n\r\n        for (const line of txt.split(\"\\n\")) {\r\n          if (!line.trim()) continue;\r\n\r\n          const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n          insertLineWithHeadingStyle(p, line);\r\n\r\n          include(p.getRange());\r\n          cursor = p.getRange();\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n\r\n      /* --------------------------------------------------\r\n         3 Create SINGLE bookmark\r\n      -------------------------------------------------- */\r\n      if (bookmarkStart && bookmarkEnd) {\r\n        const bookmarkName = `ID${tag.ID}_Split_${getDateTimeStamp()}`;\r\n        bookmarkStart.expandTo(bookmarkEnd).insertBookmark(bookmarkName);\r\n      }\r\n    }\r\n  }\r\n  if (imageList.length === 0) {\r\n    loadHomepage(availableKeys);\r\n  }\r\n  toaster(\"AI tag application completed!\", \"success\");\r\n}\r\n\r\n\r\nexport async function normalizeBlankLines(\r\n  context: Word.RequestContext\r\n) {\r\n  const paragraphs = context.document.body.paragraphs;\r\n  context.load(paragraphs, \"items, text\");\r\n  await context.sync();\r\n\r\n  let previousWasEmpty = false;\r\n\r\n  for (const p of paragraphs.items) {\r\n    const isEmpty = !p.text || p.text.trim() === \"\";\r\n\r\n    if (isEmpty && previousWasEmpty) {\r\n      p.delete();\r\n    }\r\n\r\n    previousWasEmpty = isEmpty;\r\n  }\r\n\r\n  await context.sync();\r\n}\r\n\r\nexport async function removeTrailingEmptyParagraphs(\r\n  context: Word.RequestContext\r\n) {\r\n  const paragraphs = context.document.body.paragraphs;\r\n  context.load(paragraphs, \"items, text\");\r\n  await context.sync();\r\n\r\n  for (let i = paragraphs.items.length - 1; i >= 0; i--) {\r\n    const p = paragraphs.items[i];\r\n\r\n    if (!p.text || p.text.trim() === \"\") {\r\n      p.delete();\r\n    } else {\r\n      break; // stop once real content is found\r\n    }\r\n  }\r\n\r\n  await context.sync();\r\n}\r\n\r\nasync function fetchGlossary() {\r\n  if (!isTagUpdating) {\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n    loadGlossary()\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction loadGlossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n        <div id=\"button-container\">\r\n          <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n        </div>\r\n  `\r\n  document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport async function applyglossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n  try {\r\n\r\n    await Word.run(async (context) => {\r\n\r\n\r\n      const body = context.document.body;\r\n      body.load(\"text\");\r\n      await context.sync(); // Sync to get the text content\r\n\r\n      const bodyText = {\r\n        \"Content\": body.text.replace(/[\\n\\r]/g, ' ')\r\n      };\r\n      try {\r\n\r\n        const data = await fetchGlossaryTemplate(dataList?.ClientID, bodyText, jwt);\r\n\r\n        layTerms = data.Data;\r\n\r\n        if (data.Data.length > 0) {\r\n          glossaryName = data.Data[0].GlossaryTemplate;\r\n          loadGlossary();\r\n        } else {\r\n          document.getElementById('app-body').innerHTML = `\r\n            <p class=\"text-center\">Data not available</p>\r\n          `;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching glossary data:', error);\r\n      }\r\n      // Sort terms by length (longest first)\r\n      layTerms.sort((a, b) => b.ClinicalTerm.length - a.ClinicalTerm.length);\r\n\r\n      const processedTerms = new Set(); // Track added larger terms\r\n\r\n      // Filter out smaller terms if they are included in a larger term\r\n      const filteredTerms = layTerms.filter(term => {\r\n        for (const biggerTerm of processedTerms) {\r\n          if (typeof biggerTerm === 'string' && biggerTerm.includes(term.ClinicalTerm.toLowerCase())) {\r\n            console.log(`Skipping \"${term.ClinicalTerm}\" because it's part of \"${biggerTerm}\"`);\r\n            return false; // Exclude this smaller term\r\n          }\r\n        }\r\n        processedTerms.add(term.ClinicalTerm.toLowerCase());\r\n        return true;\r\n      });\r\n\r\n      filteredGlossaryTerm = filteredTerms;\r\n      await removeMatchingContentControls();\r\n\r\n      const foundRanges = new Map(); // Track words already processed\r\n\r\n      const searchPromises = filteredGlossaryTerm.map(term => {\r\n        const searchResults = body.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load(\"items\");\r\n        return searchResults;\r\n      });\r\n\r\n      await context.sync();\r\n\r\n      for (const searchResults of searchPromises) {\r\n\r\n        for (const range of searchResults.items) {\r\n\r\n          if (!range || !range.text) {\r\n            console.log(\"Invalid range. Skipping...\");\r\n            continue;\r\n          }\r\n\r\n          // Load existing content controls inside this range\r\n          const font = range.font;\r\n          font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n          range.load(\"contentControls\");\r\n          await context.sync();\r\n\r\n          const existingControl = range.contentControls.items.length > 0;\r\n\r\n          if (existingControl) {\r\n            console.log(`Skipping \"${range.text}\" because it already has a content control.`);\r\n            continue; // Skip if content control is already present\r\n          }\r\n          // Check if we've already processed this term at this range\r\n          if (foundRanges.has(range.text)) {\r\n            console.log(`Skipping duplicate occurrence of \"${range.text}\"`);\r\n            continue;\r\n          }\r\n          // Mark this word as processed\r\n          foundRanges.set(range.text, true);\r\n          // Remove existing content controls if any\r\n          if (range.contentControls && range.contentControls.items.length > 0) {\r\n            console.log(`Removing existing content control from: \"${range.text}\"`);\r\n            for (const control of range.contentControls.items) {\r\n              control.delete(false); // 'false' keeps the text, only removes the control\r\n            }\r\n            await context.sync(); // Ensure deletion is applied before adding a new one\r\n          }\r\n\r\n          try {\r\n            // Insert a new content control\r\n            const contentControl = range.insertContentControl();\r\n            contentControl.title = `${range.text}`;\r\n            if (font.highlightColor !== null) {\r\n              contentControl.tag = `${font.highlightColor}`;\r\n            }\r\n            contentControl.font.highlightColor = \"yellow\"; // Highlight the control\r\n            contentControl.appearance = Word.ContentControlAppearance.boundingBox;\r\n            await context.sync();\r\n          } catch (error) {\r\n            console.error(`Error inserting content control for term \"${range.text}\":`, error);\r\n          }\r\n        }\r\n      }\r\n      // document.getElementById('glossarycheck').style.display='block';\r\n      isGlossaryActive = true;\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 clear-glossary btn-sm\" id=\"clearGlossary\">Clear Glossary</button>\r\n      </div>\r\n\r\n      <div id=\"highlighted-text\"></div>\r\n      <div class=\"d-flex justify-content-center box-loader\">\r\n       <div class=\"loader\" id=\"loader\"></div></div>\r\n      \r\n`\r\n      const displayElement = document.getElementById('loader');\r\n      displayElement.style.display = 'none';\r\n      await context.sync();\r\n      document.getElementById('clearGlossary').addEventListener('click', removeMatchingContentControls);\r\n      Office.context.document.addHandlerAsync(\r\n        Office.EventType.DocumentSelectionChanged,\r\n        handleSelectionChange\r\n      );\r\n\r\n\r\n    });\r\n\r\n    // Optional: Notify user of completion\r\n    console.log('Glossary applied successfully');\r\n  } catch (error) {\r\n    console.error('Error applying glossary:', error);\r\n    // Optional: Notify user of error\r\n    console.log('Error applying glossary. Please try again.');\r\n  }\r\n}\r\n\r\n\r\nasync function handleSelectionChange() {\r\n  await checkGlossary();\r\n}\r\n\r\nexport async function checkGlossary() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n\r\n      selection.load(\"text, font.highlightColor\");\r\n\r\n      await context.sync();\r\n\r\n\r\n\r\n      if (selection.text) {\r\n        const loader = document.getElementById('loader');\r\n        if (loader) {\r\n          loader.style.display = 'block';\r\n        }\r\n        const searchPromises = layTerms.map(term => {\r\n          const searchResults = selection.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n          searchResults.load(\"items\");\r\n          return searchResults;\r\n        });\r\n\r\n        await context.sync();\r\n        const selectedWords = []\r\n        for (const searchResults of searchPromises) {\r\n\r\n          for (const range of searchResults.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n            if (\r\n              font.highlightColor !== capturedFormatting['Background Color'] ||\r\n              font.color !== capturedFormatting['Text Color'] ||\r\n              font.bold !== capturedFormatting['Bold'] ||\r\n              font.italic !== capturedFormatting['Italic'] ||\r\n              font.size !== capturedFormatting['Size'] ||\r\n              font.underline !== capturedFormatting['Underline'] ||\r\n              font.name !== capturedFormatting['Font Name']\r\n            ) {\r\n              selectedWords.push(range.text);\r\n            }\r\n\r\n          }\r\n        }\r\n        // searchPromises.forEach(searchResults => {\r\n        //   searchResults.items.forEach(item => {\r\n        //   });\r\n        // });\r\n        displayHighlightedText(selectedWords)\r\n\r\n        await context.sync();\r\n\r\n\r\n\r\n\r\n        // const highlightColor = selection.font.highlightColor;\r\n\r\n        // if (highlightColor === \"red\") {\r\n        //   displayHighlightedText(selection.text);\r\n        // } else {\r\n        //   console.log('Selected text is not highlighted.');\r\n        // }\r\n      } else {\r\n        console.log('No text is selected.');\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error displaying glossary:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayHighlightedText(words: string[]) {\r\n\r\n  const displayElement = document.getElementById('highlighted-text');\r\n\r\n  if (displayElement) {\r\n    displayElement.innerHTML = ''; // Clear previous content\r\n    const loader = document.getElementById('loader');\r\n    loader.style.display = 'block';\r\n    // Group lay terms by their clinical term\r\n    const groupedTerms: { [clinicalTerm: string]: string[] } = {};\r\n\r\n    words.forEach(word => {\r\n      layTerms.forEach(term => {\r\n        if (term.ClinicalTerm.toLowerCase() === word.toLowerCase()) {\r\n          if (!groupedTerms[term.ClinicalTerm]) {\r\n            groupedTerms[term.ClinicalTerm] = [];\r\n          }\r\n          if (!groupedTerms[term.ClinicalTerm].includes(term.LayTerm)) {\r\n            groupedTerms[term.ClinicalTerm].push(term.LayTerm);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // Create a box for each clinical term\r\n    Object.keys(groupedTerms).forEach(clinicalTerm => {\r\n      // Create the main box for the clinical term\r\n      const mainBox = document.createElement('div');\r\n      mainBox.className = 'box'; // Add box class for styling\r\n\r\n      // Create a heading for the clinical term\r\n      const heading = document.createElement('h3');\r\n      heading.textContent = `${clinicalTerm} (${glossaryName})`;\r\n      mainBox.appendChild(heading);\r\n\r\n      // Create sub-boxes for each lay term\r\n      groupedTerms[clinicalTerm].forEach(layTerm => {\r\n        const subBox = document.createElement('div');\r\n        subBox.className = 'sub-box'; // Add class for sub-box styling\r\n        subBox.textContent = layTerm;\r\n\r\n        // Add click event listener to replace ClinicalTerm with LayTerm\r\n        subBox.addEventListener('click', async () => {\r\n          await replaceClinicalTerm(clinicalTerm, layTerm);\r\n\r\n          // Remove the main box containing the clicked sub-box\r\n          mainBox.remove();\r\n        });\r\n\r\n        mainBox.appendChild(subBox);\r\n      });\r\n\r\n      displayElement.appendChild(mainBox);\r\n    });\r\n    loader.style.display = 'none';\r\n\r\n  }\r\n}\r\nasync function replaceClinicalTerm(clinicalTerm: string, layTerm: string) {\r\n  const displayElement = document.getElementById('loader');\r\n  displayElement.style.display = 'block';\r\n\r\n  try {\r\n    await Word.run(async (context) => {\r\n      // Get the current selection\r\n      const selection = context.document.getSelection();\r\n      selection.load('text');\r\n      await context.sync();\r\n\r\n      if (selection.text.toLowerCase().includes(clinicalTerm.toLowerCase())) {\r\n        // Search for the clinicalTerm in the document\r\n        const searchResults = selection.search(clinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load('items');\r\n\r\n        await context.sync();\r\n\r\n        // Replace each occurrence of the clinicalTerm with the layTerm\r\n        for (const item of searchResults.items) {\r\n          // Load the font properties\r\n          item.font.load(['bold', 'italic', 'underline', 'color', 'highlightColor', 'size', 'name']);\r\n          await context.sync();  // Ensure the properties are loaded before accessing them\r\n\r\n          // Insert the layTerm while keeping the formatting\r\n          item.insertText(layTerm, 'replace');\r\n\r\n          // Apply the original formatting to the new text\r\n          item.font.bold = item.font.bold;\r\n          item.font.italic = item.font.italic;\r\n          item.font.underline = item.font.underline;\r\n          item.font.color = item.font.color;\r\n          item.font.highlightColor = '#c7c7c7';\r\n          item.font.size = item.font.size;\r\n          item.font.name = item.font.name;\r\n        }\r\n\r\n        await context.sync();\r\n        displayElement.style.display = 'none';\r\n        console.log(`Replaced '${clinicalTerm}' with '${layTerm}' and preserved the original formatting.`);\r\n      } else {\r\n        displayElement.style.display = 'none';\r\n        console.log(`Selected text does not contain '${clinicalTerm}'.`);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    displayElement.style.display = 'none';\r\n    console.error('Error replacing term:', error);\r\n  }\r\n}\r\n\r\n\r\nexport async function removeMatchingContentControls() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <div class=\"loader\" id=\"loader\"></div>\r\n        <div id=\"highlighted-text\"></div>`;\r\n      const body = context.document.body;\r\n\r\n      // Load all content controls\r\n      const contentControls = body.contentControls;\r\n      contentControls.load(\"items\");\r\n      await context.sync();\r\n\r\n      if (contentControls.items.length === 0) {\r\n        console.log(\"No content controls found.\");\r\n        return;\r\n      }\r\n\r\n      for (const control of contentControls.items) {\r\n        if (control.title && filteredGlossaryTerm.some(term => term.ClinicalTerm.toLowerCase() === control.title.toLowerCase())) {\r\n          const range = control.getRange();\r\n          range.load(\"text\");\r\n          await context.sync();\r\n          if (control.tag && /^#[0-9A-Fa-f]{6}$/.test(control.tag)) {\r\n            range.font.highlightColor = control.tag;\r\n          } else {\r\n            range.font.highlightColor = null\r\n          }\r\n          await context.sync();\r\n          control.delete(true);\r\n        }\r\n      }\r\n\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n      </div>\r\n      `;\r\n\r\n      await context.sync();\r\n      isGlossaryActive = false;\r\n      document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing content controls:\", error);\r\n  }\r\n}\r\n\r\n\r\nasync function displayMentions() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n\r\n  }\r\n}\r\n\r\nexport async function addGenAITags() {\r\n\r\n  if (!isTagUpdating) {\r\n\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n    let selectedClient = clientList.filter(item => item.ID === clientId);\r\n\r\n    // Build Primary Source List\r\n    let sourceTypeList = [\r\n      ...new Map(\r\n        dataList.SourceTypeList\r\n          .filter(item => item.VectorID > 0)\r\n          .map(item => [item.SourceTypeID, { Name: item.SourceType, ID: item.SourceTypeID }])\r\n      ).values()\r\n    ];\r\n\r\n\r\n    let sourceOptions = sourceTypeList.map((src: any) => {\r\n      return `\r\n        <li class=\"source-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\r\n          <div class=\"form-check\">\r\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${src.ID}\" id=\"source${src.ID}\">\r\n            <label class=\"form-check-label text-prewrap\" for=\"source${src.ID}\">${src.Name}</label>\r\n          </div>\r\n        </li>`;\r\n    }).join(\"\");\r\n\r\n    let sponsorOptions = clientList.map(client => {\r\n      const isSelectedClient = selectedClient.some(selected => selected.ID === client.ID);\r\n      return `\r\n        <li class=\"sponsor-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\r\n          <div class=\"form-check\">\r\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${client.ID}\" id=\"sponsor${client.ID}\" ${isSelectedClient ? 'checked disabled' : ''}>\r\n            <label class=\"form-check-label text-prewrap\" for=\"sponsor${client.ID}\">${client.Name}</label>\r\n          </div>\r\n        </li>`;\r\n    }).join(\"\");\r\n\r\n    document.getElementById('app-body').innerHTML = navTabs;\r\n\r\n    // Inject modal\r\n    document.getElementById('add-tag-body').innerHTML = addtagbody(sponsorOptions, sourceOptions);\r\n\r\n    const promptTemplateElement = document.getElementById('add-prompt-template');\r\n    setupPromptBuilderUI(promptTemplateElement, promptBuilderList);\r\n\r\n    document.getElementById('tag-tab').addEventListener('click', () => switchToAddTag());\r\n    document.getElementById('prompt-tab').addEventListener('click', () => switchToPromptBuilder());\r\n\r\n    mentionDropdownFn('prompt', 'mention-dropdown', 'add');\r\n\r\n    const form = document.getElementById('genai-form');\r\n    const nameField = document.getElementById('name');\r\n    const descriptionField = document.getElementById('description');\r\n    const promptField = document.getElementById('prompt');\r\n    // const primarySourceField = document.getElementById('primarySource');\r\n\r\n    const saveGloballyCheckbox = document.getElementById('saveGlobally');\r\n\r\n    const availableForAllCheckbox = document.getElementById('isAvailableForAll');\r\n    const sponsorDropdownButton = document.getElementById('sponsorDropdown');\r\n    const sponsorDropdownItems = document.querySelectorAll('.sponsor-dropdown-item .form-check-input');\r\n\r\n\r\n    const sourceDropdownButton = document.getElementById('sourceDropdown');\r\n    const sourceDropdownItems = document.querySelectorAll('.source-dropdown-item .form-check-input');\r\n\r\n    document.getElementById('cancel-btn-gen-ai').addEventListener('click', () => {\r\n      if (!isPendingResponse) loadHomepage(availableKeys);\r\n    });\r\n\r\n\r\n    if (form && nameField && promptField && sponsorDropdownItems.length > 0 && sourceDropdownItems.length > 0) {\r\n\r\n      const updateSponsorDropdownLabel = () => {\r\n        if (availableForAllCheckbox.checked) {\r\n          sponsorDropdownButton.textContent = clientList.map(x => x.Name).join(\", \");\r\n        } else {\r\n          const selectedNames = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'sponsorSelectAll')\r\n            .map(cb => cb.parentElement.textContent.trim());\r\n\r\n          sponsorDropdownButton.textContent = selectedNames.length\r\n            ? selectedNames.join(\", \")\r\n            : \"Select Sponsors\";\r\n        }\r\n      };\r\n\r\n      const updateSourceDropdownLabel = () => {\r\n        const selectedNames = Array.from(sourceDropdownItems)\r\n          .filter(cb => cb.checked && cb.id !== 'sourceSelectAll')\r\n          .map(cb => cb.parentElement.textContent.trim());\r\n\r\n        sourceDropdownButton.textContent = selectedNames.length\r\n          ? selectedNames.join(\", \")\r\n          : \"Select Source Types\";\r\n      }\r\n\r\n      // Submit Handler\r\n      form.addEventListener('submit', async (e) => {\r\n        e.preventDefault();\r\n\r\n        form.querySelectorAll('.is-invalid').forEach(i => i.classList.remove('is-invalid'));\r\n\r\n        let valid = true;\r\n\r\n        if (!nameField.value.trim()) { nameField.classList.add('is-invalid'); valid = false; }\r\n        if (!promptField.value.trim()) { promptField.classList.add('is-invalid'); valid = false; }\r\n\r\n        // PRIMARY SOURCE VALIDATION\r\n        const selectedPrimarySources = Array.from(sourceDropdownItems)\r\n          .filter(cb => cb.checked && cb.id !== 'sourceSelectAll')\r\n          .map(cb => cb.value);\r\n\r\n        if (!selectedPrimarySources.length) {\r\n          document.getElementById(\"primarySourceError\").style.display = \"block\";\r\n          valid = false;\r\n        } else {\r\n          document.getElementById(\"primarySourceError\").style.display = \"none\";\r\n        }\r\n\r\n        if (!valid) return;\r\n\r\n        const selectedSponsors = Array.from(sponsorDropdownItems)\r\n          .filter(cb => cb.checked && cb.id !== 'sponsorSelectAll')\r\n          .map(cb => clientList.find(c => c.ID == cb.value));\r\n\r\n        const isAvailableForAll = availableForAllCheckbox.checked;\r\n        const isSaveGlobally = saveGloballyCheckbox.checked;\r\n        const aigroup = dataList.Group.find(el => el.DisplayName === 'AIGroup');\r\n\r\n        const formData = {\r\n          DisplayName: nameField.value.trim(),\r\n          Prompt: promptField.value.trim(),\r\n          Description: descriptionField.value.trim(),\r\n          GroupKeyClient: selectedSponsors,\r\n          AllClient: isAvailableForAll ? 1 : 0,\r\n          SaveGlobally: isSaveGlobally,\r\n          UserDefined: '1',\r\n          ComponentKeyDataTypeID: '1',\r\n          ComponentKeyDataAccessID: '3',\r\n          AIFlag: 1,\r\n          DocumentTypeID: dataList.DocumentTypeID,\r\n          ReportHeadID: dataList.ID,\r\n\r\n          // MULTI SELECT SOURCE TYPE\r\n          SourceTypeID: selectedPrimarySources.join(\",\"),\r\n\r\n          ReportHeadGroupID: aigroup.ID,\r\n          ReportHeadSourceID: 0\r\n        };\r\n\r\n        await createTextGenTag(formData);\r\n      });\r\n\r\n      const checkAndDisableSponsors = () => {\r\n        sponsorDropdownItems.forEach(cb => {\r\n          if (!cb.disabled) {\r\n            cb.checked = true;\r\n            cb.disabled = true;\r\n          }\r\n        });\r\n        updateSponsorDropdownLabel();\r\n      };\r\n\r\n      const enableSponsors = () => {\r\n        sponsorDropdownItems.forEach(cb => {\r\n          const isSelectedClient = selectedClient.some(sel => sel.ID === parseInt(cb.value));\r\n          if (!isSelectedClient) cb.disabled = false;\r\n        });\r\n        updateSponsorDropdownLabel();\r\n      };\r\n\r\n      saveGloballyCheckbox.addEventListener('change', function () {\r\n        if (!isPendingResponse) {\r\n          if (this.checked) {\r\n            availableForAllCheckbox.disabled = false;\r\n            sponsorDropdownButton.disabled = false;\r\n          } else {\r\n            enableSponsors();\r\n            availableForAllCheckbox.checked = false;\r\n            availableForAllCheckbox.disabled = true;\r\n            sponsorDropdownButton.disabled = true;\r\n\r\n            sponsorDropdownItems.forEach(cb => {\r\n              if (!cb.disabled) {\r\n                cb.checked = false;\r\n                cb.disabled = false;\r\n              }\r\n            });\r\n\r\n            updateSponsorDropdownLabel();\r\n          }\r\n        }\r\n      });\r\n\r\n\r\n\r\n      availableForAllCheckbox.addEventListener('change', function () {\r\n        if (!isPendingResponse) {\r\n          this.checked ? checkAndDisableSponsors() : enableSponsors();\r\n        }\r\n      });\r\n\r\n\r\n      saveGloballyCheckbox.checked = true;\r\n      availableForAllCheckbox.checked = true;\r\n      //  Trigger its logic so sponsor dropdown activates properly\r\n      saveGloballyCheckbox.dispatchEvent(new Event(\"change\"));\r\n      availableForAllCheckbox.dispatchEvent(new Event(\"change\"));\r\n      document.querySelectorAll('.sponsor-dropdown-item').forEach(item => {\r\n        item.addEventListener('click', function (e) {\r\n          e.stopPropagation();\r\n          const checkbox = this.querySelector('.sponsor-dropdown-item .form-check-input');\r\n          if (!checkbox) return;\r\n\r\n          if (checkbox.id === 'sponsorSelectAll') {\r\n            const isChecked = checkbox.checked;\r\n            sponsorDropdownItems.forEach(cb => {\r\n              if (!cb.disabled) cb.checked = isChecked;\r\n            });\r\n          }\r\n\r\n          updateSponsorDropdownLabel();\r\n        });\r\n      });\r\n\r\n      document.querySelectorAll('.source-dropdown-item').forEach(item => {\r\n        item.addEventListener('click', function (e) {\r\n          e.stopPropagation();\r\n          const checkbox = this.querySelector('.source-dropdown-item .form-check-input');\r\n          if (!checkbox) return;\r\n\r\n          if (checkbox.id === 'sourceSelectAll') {\r\n            const isChecked = checkbox.checked;\r\n            sourceDropdownItems.forEach(cb => {\r\n              cb.checked = isChecked;\r\n            });\r\n          }\r\n\r\n          updateSourceDropdownLabel();\r\n          const selectedCount = Array.from(sourceDropdownItems)\r\n            .filter(cb => cb.checked).length;\r\n\r\n          if (selectedCount === 0) {\r\n            document.getElementById(\"primarySourceError\").style.display = \"block\";\r\n          } else {\r\n            document.getElementById(\"primarySourceError\").style.display = \"none\";\r\n          }\r\n\r\n        });\r\n      });\r\n\r\n      updateSponsorDropdownLabel();\r\n      updateSourceDropdownLabel();\r\n\r\n      [nameField, promptField].forEach(field => {\r\n        field.addEventListener('input', function () {\r\n          if (this.classList.contains('is-invalid') && this.value.trim()) {\r\n            this.classList.remove('is-invalid');\r\n          }\r\n        });\r\n      });\r\n\r\n    } else {\r\n      console.error(\"Required elements missing.\");\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport async function customizeTable(type: string) {\r\n  const container = document.getElementById(\"confirmation-popup\");\r\n  if (!container) return;\r\n\r\n  const customStyleName = sessionStorage.getItem(\"CustomStyle\") || \"\";\r\n  const defaultStyle = sessionStorage.getItem(\"DefaultStyle\") || tableStyle;\r\n  let styleObj: any = type === \"Custom\" ? customStyleName : defaultStyle;\r\n  container.innerHTML = customizeTablePopup(styleObj, type);\r\n\r\n  const cancelBtn = document.getElementById(\"confirmation-popup-cancel\");\r\n  const okBtn = document.getElementById(\"confirmation-popup-confirm\");\r\n  const dropdown = document.getElementById(\"confirmation-popup-dropdown\") as HTMLSelectElement;\r\n  const tablePreview = document.getElementById(\"confirmation-popup-table-preview\") as HTMLTableElement;\r\n\r\n  const applyStyle = () => {\r\n    if (!dropdown || !tablePreview) return;\r\n    let styleObj: any;\r\n    if (type === \"Custom\") {\r\n      styleObj = customTableStyle.find(s => s.Name === dropdown.value);\r\n    } else {\r\n      styleObj = wordTableStyles.find(s => s.style === dropdown.value);\r\n    }\r\n\r\n    if (styleObj && type === 'Pre') {\r\n      // Clear existing styles\r\n      Array.from(tablePreview.rows).forEach(row => {\r\n        Array.from(row.cells).forEach(cell => (cell as HTMLTableCellElement).removeAttribute(\"style\"));\r\n      });\r\n\r\n      if (styleObj.tableClass) tablePreview.style.cssText = styleObj.tableClass;\r\n\r\n      if (styleObj.headerClass) {\r\n        const thead = tablePreview.querySelector(\"thead\");\r\n        if (thead) {\r\n          Array.from(thead.rows).forEach(row => {\r\n            Array.from(row.cells).forEach(cell => {\r\n              (cell as HTMLTableCellElement).style.cssText = styleObj.headerClass!;\r\n            });\r\n          });\r\n        }\r\n      }\r\n\r\n      if (styleObj.sideHeader && styleObj.rowClass) {\r\n        Array.from(tablePreview.rows).forEach((row, index) => {\r\n          Array.from(row.cells).forEach((cell, cellIndex) => {\r\n            if (cellIndex === 0 && index !== 0) {\r\n              (cell as HTMLTableCellElement).style.cssText = \"font-weight:bold;\";\r\n            }\r\n          });\r\n        });\r\n      }\r\n\r\n      if (styleObj.format === \"empty\" && styleObj.rowClass) {\r\n        Array.from(tablePreview.rows).forEach((row, index) => {\r\n          if (index % 2 === 1) (row as HTMLTableRowElement).style.cssText = styleObj.rowClass!;\r\n        });\r\n      } else if (styleObj.format === \"partial\" && styleObj.rowClass) {\r\n        Array.from(tablePreview.rows).forEach((row, index) => {\r\n          Array.from(row.cells).forEach((cell, cellIndex) => {\r\n            if (cellIndex === 0) {\r\n              (cell as HTMLTableCellElement).style.cssText = styleObj.sideHeader\r\n                ? styleObj.tableClass! + \"font-weight:bold;\"\r\n                : styleObj.tableClass!;\r\n            } else if (index % 2 === 1) {\r\n              (cell as HTMLTableCellElement).style.cssText = styleObj.rowClass!;\r\n            }\r\n          });\r\n        });\r\n      } else if (styleObj.format === \"full\") {\r\n        Array.from(tablePreview.rows).forEach((row, index) => {\r\n          Array.from(row.cells).forEach((cell, cellIndex) => {\r\n            const headerClass = index === 0 ? styleObj.headerClass! : \"\";\r\n            if (cellIndex === 0 && styleObj.sideHeader) {\r\n              (cell as HTMLTableCellElement).style.cssText =\r\n                styleObj.tableClass! + \"font-weight:bold;\" + headerClass;\r\n            } else {\r\n              (cell as HTMLTableCellElement).style.cssText = styleObj.tableClass! + headerClass;\r\n            }\r\n          });\r\n        });\r\n      }\r\n    } else if (styleObj) {\r\n\r\n      tablePreview.innerHTML = styleObj.Preview;\r\n    } else {\r\n      tablePreview.innerHTML = '';\r\n    }\r\n  };\r\n\r\n  // Initial preview\r\n  applyStyle();\r\n  dropdown?.addEventListener(\"change\", applyStyle);\r\n\r\n  if (cancelBtn) cancelBtn.addEventListener(\"click\", () => (container.innerHTML = \"\"));\r\n  if (okBtn && dropdown) {\r\n    okBtn.addEventListener(\"click\", () => {\r\n      if (type === \"Custom\") {\r\n        const styleObj = customTableStyle.find(s => s.Name === dropdown.value);\r\n        colorPallete.Header = styleObj.Setting.HeaderColor;\r\n        colorPallete.Primary = styleObj.Setting.PrimaryColor;\r\n        colorPallete.Secondary = styleObj.Setting.SecondaryColor;\r\n        colorPallete.Customize = true;\r\n        colorPallete.IsSideHeaderBold = styleObj.Setting.IsSideHeaderBold;\r\n        colorPallete.IsHeaderBold = styleObj.Setting.IsHeaderBold;\r\n        sessionStorage.setItem(\"CustomStyle\", styleObj.Name);\r\n        tableStyle = styleObj.Setting.BaseStyle; // stores full object as \r\n      } else {\r\n        colorPallete.Customize = false;\r\n        tableStyle = dropdown.value; // normal style string\r\n        sessionStorage.setItem(\"DefaultStyle\", tableStyle);\r\n\r\n      }\r\n\r\n      sessionStorage.setItem(\"colorPallete\", JSON.stringify(colorPallete));\r\n      sessionStorage.setItem(\"tableStyle\", tableStyle);\r\n\r\n      container.innerHTML = \"\";\r\n    });\r\n  }\r\n}\r\n\r\nasync function createTextGenTag(payload) {\r\n  try {\r\n    const iconelement = document.getElementById(`text-gen-save`);\r\n    const cancelBtnGenAi = document.getElementById('cancel-btn-gen-ai');\r\n\r\n\r\n    (cancelBtnGenAi as HTMLButtonElement).disabled = true;\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Save`;\r\n    (iconelement as HTMLButtonElement).disabled = true;\r\n    isPendingResponse = true;\r\n\r\n    const data = await addGroupKey(payload, jwt);\r\n    isPendingResponse = false;\r\n\r\n    if (data['Data'] && data['Status']) {\r\n      fetchDocument('AIpanel');\r\n      toaster('Saved successfully', 'success');\r\n    } else {\r\n      (cancelBtnGenAi as HTMLButtonElement).disabled = false;\r\n      (iconelement as HTMLButtonElement).disabled = false;\r\n      iconelement.innerHTML = `<i class=\"fa fa-check-circle me-2\"></i>Save`;\r\n      toaster('Something went wrong', 'error');\r\n      // showAddTagError(data['Data']);\r\n    }\r\n\r\n  } catch (error) {\r\n    toaster('Something went wrong', 'error');\r\n    console.error('Error creating text generation tag:', error);\r\n  }\r\n}\r\n\r\n\r\nexport function mentionDropdownFn(textareaId, DropdownId, action) {\r\n  const filterMentions = (query) => {\r\n    // Assuming availableKeys is an array of objects with DisplayName and EditorValue properties\r\n    const filtered = availableKeys.filter(item => item.AIFlag === 0).filter(item =>\r\n      item.DisplayName.toLowerCase().includes(query.toLowerCase())\r\n    );\r\n    return filtered;\r\n  };\r\n  let highlightedIndex = -1;\r\n\r\n  const promptField = document.getElementById(`${textareaId}`);\r\n  const mentionDropdown = document.getElementById(`${DropdownId}`);\r\n  if (promptField) {\r\n\r\n    // Handle input events on prompt field for mentions\r\n    promptField.addEventListener('input', (e) => {\r\n      const cursorPosition = promptField.selectionStart;\r\n      const textBeforeCursor = promptField.value.slice(0, cursorPosition);\r\n      const lastHashtag = textBeforeCursor.lastIndexOf('#');\r\n      if (lastHashtag !== -1) {\r\n        const query = textBeforeCursor.slice(lastHashtag + 1).trim();\r\n        if (query.length > 0) {\r\n          const mentions = filterMentions(query);\r\n\r\n          if (mentions.length > 0) {\r\n            mentionDropdown.innerHTML = mentions.map(item => {\r\n              let editorValue = '';\r\n              if (action === 'add') {\r\n                editorValue = `#${item.DisplayName}#`;\r\n              } else {\r\n                editorValue = item.EditorValue || `#${item.DisplayName}#`;\r\n              }\r\n\r\n              return `<li class=\"dropdown-item\" data-editor-value=\"${editorValue}\">${item.DisplayName}</li>`;\r\n            }).join('');\r\n\r\n            // Get the position of the textarea and place the dropdown above it\r\n            const textareaRect = promptField.getBoundingClientRect();\r\n            mentionDropdown.style.left = `${textareaRect.left}px`;\r\n            mentionDropdown.style.bottom = `75px`; // Position above the textarea\r\n            mentionDropdown.style.display = 'block';\r\n          } else {\r\n            mentionDropdown.style.display = 'none';\r\n          }\r\n        } else {\r\n          mentionDropdown.style.display = 'none';\r\n        }\r\n      } else {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n\r\n    });\r\n\r\n    // Handle keyboard navigation in the dropdown\r\n    promptField.addEventListener('keydown', (e) => {\r\n      const items = document.querySelectorAll(`#${DropdownId} .dropdown-item`);\r\n      const totalItems = items.length;\r\n\r\n      if (e.key === 'ArrowDown') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight down and wrap around to the top if at the end\r\n        if (highlightedIndex < totalItems - 1) {\r\n          highlightedIndex++;\r\n        } else {\r\n          highlightedIndex = 0; // Wrap to the first item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'ArrowUp') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight up and wrap around to the bottom if at the top\r\n        if (highlightedIndex > 0) {\r\n          highlightedIndex--;\r\n        } else {\r\n          highlightedIndex = totalItems - 1; // Wrap to the last item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'Enter' && highlightedIndex !== -1) {\r\n        // Select the highlighted item\r\n        const selectedItem = items[highlightedIndex];\r\n        if (selectedItem) {\r\n          selectMention(selectedItem.getAttribute('data-editor-value'));\r\n          mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n          e.preventDefault();  // Prevent form submission on Enter key\r\n        }\r\n      }\r\n    });\r\n\r\n    // Function to highlight the selected item\r\n    function updateHighlightedItem(id) {\r\n      const items = document.querySelectorAll(`#${id} .dropdown-item`);\r\n      const dropdown = document.getElementById(`${id}`);\r\n      const totalItems = items.length;\r\n\r\n      // Remove the 'active' class from all items\r\n      items.forEach(item => item.classList.remove('active'));\r\n\r\n      // Add the 'active' class to the currently highlighted item\r\n      if (highlightedIndex >= 0 && highlightedIndex < totalItems) {\r\n        const highlightedItem = items[highlightedIndex];\r\n        highlightedItem.classList.add('active');\r\n\r\n        // Ensure the highlighted item is visible within the dropdown\r\n        highlightedItem.scrollIntoView({\r\n          behavior: 'smooth',    // Smooth scroll\r\n          block: 'nearest'      // Scroll only if necessary\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n\r\n    // Handle selecting an item from the dropdown via mouse click\r\n    mentionDropdown.addEventListener('click', (e) => {\r\n      if (e.target && e.target.matches('li')) {\r\n        const editorValue = e.target.getAttribute('data-editor-value');\r\n        selectMention(editorValue);\r\n        mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n      }\r\n    });\r\n\r\n    // Function to insert the selected mention into the prompt field\r\n    const selectMention = (editorValue) => {\r\n      const textarea = document.getElementById(`${textareaId}`);\r\n      const currentValue = textarea.value;\r\n      const cursorPosition = textarea.selectionStart;\r\n\r\n      const textBefore = currentValue.slice(0, cursorPosition);\r\n      const textAfter = currentValue.slice(cursorPosition);\r\n\r\n      const lastHashPosition = textBefore.lastIndexOf('#');\r\n      const updatedTextBefore = textBefore.slice(0, lastHashPosition); // Removing '#' symbol\r\n\r\n      textarea.value = `${updatedTextBefore}${editorValue}${textAfter}`;\r\n      const newCursorPosition = updatedTextBefore.length + editorValue.length;\r\n      textarea.setSelectionRange(newCursorPosition, newCursorPosition);\r\n    };\r\n\r\n    // Hide the dropdown if clicked outside\r\n    document.addEventListener('click', (e) => {\r\n      if (!mentionDropdown.contains(e.target) && e.target !== promptField) {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\nfunction showAddTagError(message) {\r\n  const errorDiv = document.getElementById('submition-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction transformDocumentName(value: string): string {\r\n  if (!value || value.trim() === '') {\r\n    return value; // Return the input value unchanged\r\n  }\r\n\r\n  const parts = value.split('_');\r\n  if (parts.length <= 1) {\r\n    return value; // Return the input value unchanged if no underscores are present\r\n  }\r\n\r\n  return parts.slice(1).join('_').replace(/%20/g, ' ').replace(/%25/g, '%');\r\n}\r\n\r\n\r\n\r\nexport function createMultiSelectDropdown(tag) {\r\n  const isDark = theme === 'Dark';\r\n  const btnClass = isDark ? 'btn-dark text-light border-0' : 'btn-light text-dark border';\r\n  const dropdownMenuClass = isDark ? 'bg-dark text-light border-light' : 'bg-white text-dark border';\r\n  const itemClass = isDark ? 'bg-dark text-light' : 'bg-white text-dark';\r\n\r\n  // Group sources by SourceType\r\n  const groupedSources = sourceList.reduce((groups, source) => {\r\n    if (!groups[source.SourceType]) groups[source.SourceType] = [];\r\n    groups[source.SourceType].push(source);\r\n    return groups;\r\n  }, {});\r\n\r\n  const multiSelectHTML = `\r\n  <div class='p-3 w-100'>\r\n    <div class=\"mb-3\">\r\n      <label for=\"source-select\" class=\"form-label\"><span class=\"text-danger\">*</span> Select Sources</label>\r\n      <div class=\"dropdown w-100\">\r\n        <button \r\n          class=\"btn ${btnClass} w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources\" \r\n          type=\"button\" \r\n          id=\"sourceDropdown\" \r\n          data-bs-toggle=\"dropdown\" \r\n          aria-expanded=\"false\">\r\n          <span id=\"sourceDropdownLabel\" class='sourceDropdownLabel'></span>\r\n          <span class=\"dropdown-toggle-icon dropdown-toggle-icon-s\"></span>\r\n        </button>\r\n        <ul class=\"dropdown-menu ${dropdownMenuClass} w-100 p-2\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000; max-height: 300px; overflow-y: auto;\">\r\n          \r\n          <!-- Select All -->\r\n          <li class=\"dropdown-item p-2 ${itemClass}\" data-checkbox-id=\"selectAll\">\r\n            <div class=\"form-check\">\r\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\r\n              <label class=\"form-check-label w-100\" for=\"selectAll\">Select All</label>\r\n            </div>\r\n          </li>\r\n\r\n          <!-- Grouped Sources -->\r\n          ${Object.keys(groupedSources)\r\n      .map((group, groupIndex) => {\r\n        const groupItems = groupedSources[group]\r\n          .map(\r\n            (source, index) => `\r\n                  <li class=\"dropdown-item ps-4 ${itemClass}\" style=\"cursor: pointer;\" data-checkbox-id=\"source-${groupIndex}-${index}\">\r\n                    <div class=\"form-check\">\r\n                      <input class=\"form-check-input source-checkbox\" type=\"checkbox\" value=\"${source.SourceName}\" id=\"source-${groupIndex}-${index}\">\r\n                      <label class=\"form-check-label w-100 text-prewrap\" for=\"source-${groupIndex}-${index}\">${source.SourceName}</label>\r\n                    </div>\r\n                  </li>\r\n                `\r\n          )\r\n          .join('');\r\n\r\n        return `\r\n                <!-- Group Header -->\r\n                <li class=\"dropdown-item p-2 ${itemClass}\" data-group-id=\"group-${groupIndex}\">\r\n                  <div class=\"form-check\">\r\n                    <input class=\"form-check-input group-checkbox\" type=\"checkbox\" value=\"${group}\" id=\"group-${groupIndex}\">\r\n                    <label class=\"form-check-label fw-bold\" for=\"group-${groupIndex}\">${group}</label>\r\n                  </div>\r\n                </li>\r\n                ${groupItems}\r\n              `;\r\n      })\r\n      .join('')}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n    <div class=\"mt-3 d-flex justify-content-between\">\r\n      <span id=\"cancel-src-btn\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n      <button id=\"ok-src-btn\" class=\"btn btn-primary\">Save</button>\r\n    </div>\r\n  </div>\r\n  `;\r\n\r\n  const accordionBody = document.getElementById(`chatFooter`);\r\n  accordionBody.innerHTML = multiSelectHTML;\r\n\r\n  let selectedSources = [];\r\n\r\n  const selectAllCheckbox = document.getElementById(`selectAll`);\r\n  const groupCheckboxes = document.querySelectorAll(`.group-checkbox`);\r\n  const individualCheckboxes = document.querySelectorAll(`.source-checkbox`);\r\n  const sourceDropdownLabel = document.getElementById(`sourceDropdownLabel`);\r\n\r\n  function updateLabel() {\r\n    sourceDropdownLabel.innerText = selectedSources.length > 0 ? selectedSources.join(', ') : ' ';\r\n  }\r\n\r\n  // Select All logic\r\n  selectAllCheckbox.addEventListener(\"change\", function () {\r\n    const checked = this.checked;\r\n    groupCheckboxes.forEach(cb => cb.checked = checked);\r\n    individualCheckboxes.forEach(cb => {\r\n      cb.checked = checked;\r\n      if (checked && !selectedSources.includes(cb.value)) {\r\n        selectedSources.push(cb.value);\r\n      }\r\n      if (!checked) {\r\n        selectedSources = [];\r\n      }\r\n    });\r\n    updateLabel();\r\n  });\r\n\r\n  // Group checkbox logic\r\n  groupCheckboxes.forEach(groupCb => {\r\n    groupCb.addEventListener(\"change\", function () {\r\n      const groupIndex = this.id.split('-')[1];\r\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\r\n\r\n      groupItems.forEach(cb => {\r\n        cb.checked = this.checked;\r\n        if (this.checked && !selectedSources.includes(cb.value)) {\r\n          selectedSources.push(cb.value);\r\n        }\r\n        if (!this.checked) {\r\n          selectedSources = selectedSources.filter(s => s !== cb.value);\r\n        }\r\n      });\r\n\r\n      // Update Select All state\r\n      selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => child.checked);\r\n      updateLabel();\r\n    });\r\n  });\r\n\r\n  // Individual checkbox logic\r\n  individualCheckboxes.forEach(cb => {\r\n    cb.addEventListener(\"change\", function () {\r\n      if (cb.checked) {\r\n        if (!selectedSources.includes(cb.value)) selectedSources.push(cb.value);\r\n      } else {\r\n        selectedSources = selectedSources.filter(s => s !== cb.value);\r\n      }\r\n\r\n      // Update parent group checkbox\r\n      const groupIndex = cb.id.split(\"-\")[1];\r\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\r\n      const groupCheckbox = document.getElementById(`group-${groupIndex}`);\r\n      groupCheckbox.checked = Array.from(groupItems).every(child => child.checked);\r\n\r\n      // Update Select All checkbox\r\n      selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => child.checked);\r\n\r\n      updateLabel();\r\n    });\r\n  });\r\n\r\n  // Initialize with pre-selected sources\r\n  if (tag.Sources && tag.Sources.length > 0) {\r\n    individualCheckboxes.forEach(cb => {\r\n      if (tag.Sources.includes(cb.value)) {\r\n        cb.checked = true;\r\n        selectedSources.push(cb.value);\r\n      }\r\n    });\r\n\r\n    // Update group checkboxes\r\n    groupCheckboxes.forEach(groupCb => {\r\n      const groupIndex = groupCb.id.split(\"-\")[1];\r\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\r\n      groupCb.checked = Array.from(groupItems).every(child => child.checked);\r\n    });\r\n\r\n    // Update Select All\r\n    selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => child.checked);\r\n    updateLabel();\r\n  }\r\n\r\n  // Save\r\n  document.getElementById(`ok-src-btn`).addEventListener(\"click\", function () {\r\n    tag.Sources = [...selectedSources];\r\n    const receivedEntry = sourceList.filter(source => selectedSources.includes(source.SourceName));\r\n    tag.TempSourceValue = receivedEntry.map((item) => {\r\n      return item.VectorID ? String(item.VectorID) : item.SourceValue;\r\n    });\r\n\r\n    tag.SourceName = receivedEntry.map((item) => {\r\n      return item.SourceName;\r\n    });\r\n\r\n    tag.SourceValueID = receivedEntry.map((item) => {\r\n      return String(item.VectorID);\r\n    });\r\n\r\n    tag.SourceValue = receivedEntry\r\n      .map(source => source.SourceValue);\r\n    accordionBody.innerHTML = chatfooter(tag);\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n  });\r\n\r\n  // Cancel\r\n  document.getElementById(`cancel-src-btn`).addEventListener(\"click\", function () {\r\n    accordionBody.innerHTML = chatfooter(tag);\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n  });\r\n}\r\n\r\n\r\n\r\nasync function loadPromptTemplates() {\r\n  try {\r\n    const data = await getAllPromptTemplates(jwt);\r\n    if (data.Status && data.Data) {\r\n      promptBuilderList = data.Data;\r\n    }\r\n    // Do something with the data\r\n  } catch (error) {\r\n    console.error('Error fetching prompt templates:', error);\r\n  }\r\n}\r\n\r\nasync function logBookmarksInSelection() {\r\n  return Word.run(async (context) => {\r\n\r\n    const rawBookmarks = await getBookmarksFromSelection(context);\r\n    const bookmarks = pickRelevantBookmarks(rawBookmarks);\r\n\r\n    if (bookmarks.length === 0) {\r\n      document.getElementById('tags-in-selected-text')\r\n        ?.classList.replace('d-block', 'd-none');\r\n      return;\r\n    }\r\n\r\n    document.getElementById('tags-in-selected-text')\r\n      ?.classList.replace('d-none', 'd-block');\r\n\r\n    if (bookmarks.length > 1) {\r\n      selectedNames = bookmarks;\r\n      renderSelectedTags(selectedNames, availableKeys);\r\n      return;\r\n    }\r\n\r\n    // Single bookmark\r\n    const seachBox = document.getElementById('search-box') as HTMLInputElement;\r\n    if (seachBox) {\r\n      const processedName = bookmarks[0];\r\n      selectedNames = [processedName];\r\n      selectMatchingBookmarkFromSelection(processedName);\r\n\r\n      const aiTag = availableKeys.find(k =>\r\n        k.AIFlag === 1 &&\r\n        (k.DisplayName.toLowerCase() === processedName.toLowerCase() ||\r\n          `id${k.ID}`.toLowerCase() === processedName.toLowerCase())\r\n      );\r\n\r\n      if (!aiTag) return;\r\n\r\n      const appBody = document.getElementById('app-body');\r\n      appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n\r\n      appBody.innerHTML = await generateCheckboxHistory(aiTag);\r\n    }\r\n\r\n\r\n  });\r\n}\r\n\r\nasync function getBookmarksFromSelection(context: Word.RequestContext): Promise<string[]> {\r\n  const selection = context.document.getSelection();\r\n  const bookmarks = selection.getBookmarks();\r\n  await context.sync();\r\n  return bookmarks.value || [];\r\n}\r\n\r\n\r\nfunction normalizeBookmark(name: string) {\r\n  return name.split('_Split_')[0].replace(/_/g, ' ');\r\n}\r\n\r\nfunction pickRelevantBookmarks(bookmarks: string[]) {\r\n  // Remove duplicates & internal splits\r\n  const normalized = Array.from(new Set(bookmarks.map(normalizeBookmark)));\r\n\r\n  // Prefer AI tags only\r\n  return normalized.filter(name =>\r\n    availableKeys.some(\r\n      k => k.AIFlag === 1 &&\r\n        (k.DisplayName.toLowerCase() === name.toLowerCase() ||\r\n          `id${k.ID}`.toLowerCase() === name.toLowerCase())\r\n    )\r\n  );\r\n}\r\n\r\nasync function getImages() {\r\n  const generalImages = await getGeneralImages(jwt);\r\n  const ID = dataList.ID;\r\n  const documentImages = await getReportHeadImageById(ID, jwt);\r\n  let mappedDocumentImages = mapImagesToComponentObjects(documentImages['Data']);\r\n  let mappedImages = mapImagesToComponentObjects(generalImages['Data']);\r\n  dataList.GroupKeyAll.push(...mappedImages);\r\n  dataList.GroupKeyAll.push(...mappedDocumentImages);\r\n  availableKeys.push(...mappedImages);\r\n  availableKeys.push(...mappedDocumentImages);\r\n  imageList = dataList.GroupKeyAll.filter(element => element.ComponentKeyDataType === 'IMAGE');\r\n  const searchBox = document.getElementById('search-box');\r\n  const suggestionList = document.getElementById('suggestion-list');\r\n  if (!searchBox || !suggestionList) return;\r\n  function updateSuggestions() {\r\n    const searchTerm = searchBox.value.trim().toLowerCase();\r\n    suggestionList.replaceChildren();\r\n\r\n    if (searchTerm === '') {\r\n      suggestionList.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    const filteredMentions = availableKeys.filter(m =>\r\n      m.DisplayName.toLowerCase().includes(searchTerm)\r\n    );\r\n\r\n    // Split groups\r\n    const nonAITags = filteredMentions.filter(m => m.AIFlag === 0);\r\n    const aiTags = filteredMentions.filter(m => m.AIFlag === 1);\r\n\r\n    // Further split non-AI tags into: TEXT + IMAGE\r\n    const propertiesTags = nonAITags.filter(m => m.ComponentKeyDataType === \"TEXT\" || m.ComponentKeyDataType === \"TABLE\");\r\n    const imageTags = nonAITags.filter(m => m.ComponentKeyDataType === \"IMAGE\" && m.IsImage);\r\n\r\n    const createSection = (labelText, mentions, isAISection = false, isImageSection = false) => {\r\n      if (mentions.length === 0) return;\r\n\r\n      const themeClasses = theme === 'Dark'\r\n        ? { itemClass: 'bg-dark text-light list-hover-dark', labelClass: 'bg-dark text-light' }\r\n        : { itemClass: 'bg-light text-dark list-hover-light', labelClass: 'bg-light text-dark' };\r\n\r\n      const label = document.createElement('li');\r\n      label.className = `list-group-item fw-bold text-secondary ${themeClasses.labelClass}`;\r\n      label.textContent = labelText;\r\n      suggestionList.appendChild(label);\r\n\r\n      mentions.forEach(mention => {\r\n        const listItem = document.createElement('li');\r\n        listItem.className = `list-group-item list-group-item-action ${themeClasses.itemClass}`;\r\n\r\n        // ICON LOGIC\r\n        let icon = `<i class=\"fa-solid fa-layer-group text-muted me-2\"></i>`; // default (TEXT)\r\n        if (isAISection) icon = `<i class=\"fa-solid fa-microchip-ai text-muted me-2\"></i>`;\r\n        if (isImageSection) icon = `<i class=\"fa-solid fa-image text-muted me-2\"></i>`;\r\n\r\n        listItem.innerHTML = `${icon} ${mention.DisplayName}`;\r\n\r\n        listItem.onclick = () => {\r\n          if (isAISection) {\r\n            const appBody = document.getElementById('app-body');\r\n            appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n            generateCheckboxHistory(mention)\r\n              .catch(() => appBody.innerHTML = '<div class=\"text-danger p-2\">Error loading data</div>')\r\n              .then(html => { appBody.innerHTML = html; });\r\n          } else {\r\n            // Properties + Images behave same\r\n            replaceMention(mention, mention.ComponentKeyDataType);\r\n            suggestionList.replaceChildren();\r\n          }\r\n        };\r\n\r\n        suggestionList.appendChild(listItem);\r\n      });\r\n    };\r\n\r\n    // Render in desired order\r\n    createSection('Properties', propertiesTags);\r\n    createSection('AI Tags', aiTags, true);\r\n    createSection('Images', imageTags, false, true);\r\n  }\r\n\r\n  if (selectedNames.length > 0) {\r\n    const badgeWrapper = document.getElementById('tags-in-selected-text');\r\n    badgeWrapper.classList.remove('d-none');\r\n    badgeWrapper.classList.add('d-block');\r\n    renderSelectedTags(selectedNames, availableKeys);\r\n  }\r\n\r\n  // Add input event listener to the search box\r\n  let debounceTimeout;\r\n  searchBox.addEventListener('input', () => {\r\n    clearTimeout(debounceTimeout);\r\n    debounceTimeout = setTimeout(updateSuggestions, 300); // Delay input handling by 300ms\r\n  });\r\n  if (imageList && imageList.length > 0) {\r\n    toaster('Images are loaded and ready for use', 'success');\r\n  }\r\n}\r\n"],"names":["___HTML_LOADER_IMPORT_0___","___HTML_LOADER_IMPORT_1___","module","exports","url","options","String","__esModule","default","hash","maybeNeedQuotes","test","concat","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","m","n","getter","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","b","baseURI","self","href","baseUrl","async","updatePromptTemplate","payload","jwt","response","fetch","method","headers","body","JSON","stringify","ok","json","wordTableStyles","name","style","headerClass","tableClass","rowClass","format","sideHeader","wordTableStyleLocales","en","de","toaster","message","type","getElementById","innerHTML","setTimeout","navTabs","insertLineWithHeadingStyle","paragraph","line","builtInStyle","Word","BuiltInStyleName","normal","text","startsWith","heading6","substring","trim","heading5","heading4","heading3","heading2","heading1","styleBuiltIn","regex","match","lastIndex","exec","index","insertText","InsertLocation","end","content","bold","italic","underline","r","font","UnderlineType","single","none","removeQuotes","value","copyText","tempTextArea","createElement","appendChild","select","execCommand","removeChild","switchToAddTag","querySelector","classList","remove","add","updateEditorFinalTable","data","tables","parsedContent","parse","push","jsonToHtmlTable","error","console","tableIndex","jsonData","Array","isArray","Set","rows","flattenObject","prefix","result","keys","forEach","newKey","map","item","entries","k","v","join","flattenedItem","table","header","row","chatfooter","tag","theme","Sources","renderSelectedTags","selectedNames","availableKeys","badgeWrapper","toLowerCase","lowerName","find","aiTag","mention","AIFlag","ID","DisplayName","badge","className","cursor","addEventListener","selectMatchingBookmarkFromSelection","appBody","generateCheckboxHistory","then","html","applyThemeClasses","isDark","isLight","safeApplyClass","selector","darkClasses","lightClasses","elements","querySelectorAll","darkClassList","split","lightClassList","elem","swicthThemeIcon","icon","sessionStorage","setItem","displayName","run","bookmarks","context","getSelection","getBookmarks","sync","targetBookmarkName","bookmark","range","getBookmarkRangeOrNullObject","load","isNullObject","colorTable","lastParamRowIndex","rowIndex","cells","from","cellIndex","firstColText","cell","innerText","getCell","topCell","bottomCell","merge","verticalAlignment","VerticalAlignment","center","paragraphs","getFirst","alignment","Alignment","applyBoldIfNeeded","weight","colorPallete","IsHeaderBold","IsSideHeaderBold","applyColor","cellOrRow","bgColor","shadingColor","color","hexColor","hex","parseInt","isColorDark","borderColor","getBorder","side","width","base","tableStyle","items","Primary","Header","Secondary","rowCount","firstGapIndex","lastGapIndex","BorderLocation","bottom","BorderType","insideVertical","bg","double","headerRow","mapImagesToComponentObjects","input","Flowchart","Graph","Image","img","Name","ImageName","EditorValue","ImageData","UserValue","ComponentKeyDataType","IsImage","svgBase64ToPngBase64","svgBase64","Promise","resolve","reject","svgBlob","Blob","atob","URL","createObjectURL","crossOrigin","onload","canvas","height","ctx","getContext","drawImage","pngBase64","toDataURL","revokeObjectURL","onerror","err","resolveWordTableStyle","englishStyle","lang","Office","displayLanguage","slice","loadHomepage","searchBoxClass","searchBox","suggestionList","updateSuggestions","searchTerm","replaceChildren","filteredMentions","filter","includes","nonAITags","aiTags","propertiesTags","imageTags","createSection","labelText","mentions","isAISection","isImageSection","themeClasses","itemClass","labelClass","label","textContent","listItem","onclick","catch","replaceMention","debounceTimeout","clearTimeout","isPendingResponse","addGenAITags","customizeTable","applyTagFn","word","selection","newSelection","doc","DOMParser","parseFromString","bodyNodes","childNodes","node","nodeType","Node","TEXT_NODE","ELEMENT_NODE","element","tagName","insertParagraph","before","maxCols","Math","max","reduce","sum","getAttribute","insertTable","after","resolvedTableStyle","Customize","rowspanTracker","fill","cellText","colspan","rowspan","elementText","base64Image","insertInlinePictureFromBase64","IsApplied","nextLineParagraph","FilteredReportHeadAIHistoryList","fetchAIHistory","history","closeBtnClass","closeBar","chatBody","chatList","promptclass","globalPromptUpdate","UserRole","UserRoleEntityAccessList","UserRoleEntity","chat","includeSaveIcon","UserRoleAccessID","includeReferenceIcon","Evidences","Prompt","Selected","Response","generateChatHistoryHtml","chatFooterHtml","initializeAIHistoryEvents","getDateTimeStamp","Date","pad","toString","padStart","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","textareavalue","chatInput","changeSourceButton","disabled","container","Confirmationpopup","setAttribute","updatedTag","sources","SourceValue","sourceList","source","Number","VectorID","popupData","Data","selectedData","FileName","PageNumber","Sentence","DataModalPopup","checkbox","isChecked","event","target","checked","_","otherIndex","otherCheckbox","responseContainer","updateAiHistory","ReportHeadAIHistoryList","historyList","unshift","finalResponse","FormattedResponse","currentlySelected","some","currentTag","isTable","aiTagList","anchorChar","getRange","bookmarkStart","bookmarkEnd","include","txt","el","s","c","bookmarkName","expandTo","insertBookmark","delete","insertTagPrompt","textareaValue","sendPrompt","createMultiSelectDropdown","mentionDropdownFn","filteredGlossaryTerm","storedUrl","documentID","organizationName","imageList","initialised","promptBuilderList","glossaryName","isGlossaryActive","GroupName","layTerms","dataList","isTagUpdating","capturedFormatting","emptyFormat","isNoFormatTextAvailable","clientId","userId","clientList","currentYear","customTableStyle","login","sessionToken","getItem","localPallete","loadLoginPage","toggle","handleLogin","preventDefault","organization","username","password","toLocaleLowerCase","ClientName","Username","Password","loginUser","Status","ResponseStatus","Token","showLoginError","errorDiv","display","fetchDocument","action","getReportById","logoheader","ts","cp","tableStyleObj","getAllCustomTables","selectedTable","TableCustomizationID","Setting","HeaderColor","PrimaryColor","SecondaryColor","BaseStyle","getTableStyle","SourceTypeList","SourceName","decodeURIComponent","transformDocumentName","ClientID","aiGroup","Group","GroupKey","generalImages","getGeneralImages","mappedDocumentImages","id","getReportHeadImageById","mappedImages","GroupKeyAll","getImages","InitialTable","getAllClients","warn","fetchClients","getAllPromptTemplates","loadPromptTemplates","removeMatchingContentControls","loadGlossary","fetchGlossary","formatOptionsDisplay","htmlBody","displayCapturedFormatting","removeFormattedText","removeOptionsConfirmation","clear","logout","glossaryBtn","contains","clearCapturedFormatting","Bold","Underline","Size","removeFormatBtn","captureFormatting","emptyFormatCheckbox","formatList","log","Italic","size","highlightColor","textRanges","tagId","getAiHistory","SourceValueID","selectedSources","list","TempSourceValue","prompt","iconelement","ReportHeadID","DocumentID","NCTID","DocumentType","TextSetting","DocumentTemplate","ReportTemplate","ReportHeadGroupKeyID","ThreadID","AssistantID","Container","PromptType","addAiHistory","results","search","matchCase","matchWholeWord","anchor","nodes","base64","pic","applyAITagFn","searchResults","applyImageTagFn","applyglossary","bodyText","fetchGlossaryTemplate","GlossaryTemplate","sort","ClinicalTerm","processedTerms","filteredTerms","term","biggerTerm","foundRanges","Map","searchPromises","contentControls","has","set","control","contentControl","insertContentControl","title","appearance","ContentControlAppearance","boundingBox","addHandlerAsync","EventType","DocumentSelectionChanged","handleSelectionChange","loader","selectedWords","words","displayElement","groupedTerms","LayTerm","clinicalTerm","mainBox","heading","layTerm","subBox","replaceClinicalTerm","displayHighlightedText","checkGlossary","selectedClient","sourceOptions","SourceTypeID","SourceType","values","sponsorOptions","client","isSelectedClient","selected","addtagbody","preview","templateText","fieldsList","templateSelect","applyBtn","resetBtn","previewDiv","fieldsContainer","previewContainer","templateError","replaceKeywordsManually","keywordMap","field","Label","keyword","HTMLInputElement","HTMLSelectElement","insertValue","RegExp","option","templateId","getPromptTemplateById","Template","div","Type","PromptTemplateOptionList","opt","Text","Option","selectedIndex","promptTextarea","setupPromptBuilderUI","form","nameField","descriptionField","promptField","saveGloballyCheckbox","availableForAllCheckbox","sponsorDropdownButton","sponsorDropdownItems","sourceDropdownButton","sourceDropdownItems","updateSponsorDropdownLabel","x","cb","parentElement","updateSourceDropdownLabel","valid","selectedPrimarySources","selectedSponsors","isAvailableForAll","isSaveGlobally","aigroup","formData","Description","GroupKeyClient","AllClient","SaveGlobally","UserDefined","ComponentKeyDataTypeID","ComponentKeyDataAccessID","DocumentTypeID","ReportHeadGroupID","ReportHeadSourceID","cancelBtnGenAi","addGroupKey","createTextGenTag","checkAndDisableSponsors","enableSponsors","sel","dispatchEvent","Event","stopPropagation","selectedCount","customStyleName","defaultStyle","styleObj","selectedValue","popupClass","warningContent","customizeTablePopup","cancelBtn","okBtn","dropdown","tablePreview","applyStyle","removeAttribute","cssText","thead","Preview","textareaId","DropdownId","highlightedIndex","mentionDropdown","updateHighlightedItem","totalItems","highlightedItem","scrollIntoView","behavior","block","cursorPosition","selectionStart","textBeforeCursor","lastHashtag","lastIndexOf","query","filterMentions","editorValue","textareaRect","getBoundingClientRect","left","selectedItem","selectMention","matches","textarea","currentValue","textBefore","textAfter","lastHashPosition","updatedTextBefore","newCursorPosition","setSelectionRange","parts","btnClass","dropdownMenuClass","groupedSources","groups","multiSelectHTML","group","groupIndex","groupItems","accordionBody","selectAllCheckbox","groupCheckboxes","individualCheckboxes","sourceDropdownLabel","updateLabel","groupCb","every","child","receivedEntry","normalizeBookmark","onReady","info","host","HostType","properties","customProperties","property","orgName","retrieveDocumentProperties","rawBookmarks","getBookmarksFromSelection","pickRelevantBookmarks","processedName","logBookmarksInSelection"],"sourceRoot":""}