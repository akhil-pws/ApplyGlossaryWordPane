{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane/./src/taskpane/index.html","webpack://office-addin-taskpane/./node_modules/html-loader/dist/runtime/getUrl.js","webpack://office-addin-taskpane/webpack/bootstrap","webpack://office-addin-taskpane/webpack/runtime/compat get default export","webpack://office-addin-taskpane/webpack/runtime/define property getters","webpack://office-addin-taskpane/webpack/runtime/global","webpack://office-addin-taskpane/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane/webpack/runtime/publicPath","webpack://office-addin-taskpane/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane/./src/taskpane/utils/config.ts","webpack://office-addin-taskpane/./src/taskpane/draft/draft.api.ts","webpack://office-addin-taskpane/./src/taskpane/services/auth.service.ts","webpack://office-addin-taskpane/./src/taskpane/services/store.service.ts","webpack://office-addin-taskpane/./src/taskpane/components/tablestyles.ts","webpack://office-addin-taskpane/./src/taskpane/components/bodyelements.ts","webpack://office-addin-taskpane/./src/taskpane/summary/summary.api.ts","webpack://office-addin-taskpane/./src/taskpane/services/ai.service.ts","webpack://office-addin-taskpane/./src/taskpane/summary/summary.ts","webpack://office-addin-taskpane/./src/taskpane/services/summary.service.ts","webpack://office-addin-taskpane/./src/taskpane/draft/home.ts","webpack://office-addin-taskpane/./src/taskpane/draft/draft-functions.ts","webpack://office-addin-taskpane/./src/taskpane/services/document.service.ts","webpack://office-addin-taskpane/./src/taskpane/services/ui.service.ts","webpack://office-addin-taskpane/./src/taskpane/taskpane.ts"],"sourcesContent":["// Imports\nimport ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___ from \"../../node_modules/html-loader/dist/runtime/getUrl.js\";\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\nvar ___HTML_LOADER_IMPORT_1___ = new URL(\"./css/bootstrap3.css\", import.meta.url);\n// Module\nvar ___HTML_LOADER_REPLACEMENT_0___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_0___);\nvar ___HTML_LOADER_REPLACEMENT_1___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_1___);\nvar code = \" <!DOCTYPE html> <html> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>Link addin</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1/hosted/office.js\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-core/11.1.0/css/fabric.min.css\\\"/> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_0___ + \"\\\" rel=\\\"stylesheet\\\"/> <link rel=\\\"stylesheet\\\" href=\\\"https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css\\\"/> <link href=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" integrity=\\\"sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65\\\" crossorigin=\\\"anonymous\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\\\"> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_1___ + \"\\\" rel=\\\"stylesheet\\\"/> <\" + \"script src=\\\"https://kit.fontawesome.com/5aabee8816.js\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css\\\"/> <\" + \"script src=\\\"https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js\\\"><\" + \"/script> </head> <body class=\\\"ms-font-m ms-welcome ms-Fabric\\\"> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\\\" integrity=\\\"sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <div id=\\\"header-nav\\\"> <div class=\\\"logo-header d-flex w-100 justify-content-between align-items-center bg-light\\\" id=\\\"logo-header\\\"> </div> </div> <div class=\\\"loader-wrapper\\\" id=\\\"page-loader\\\" style=\\\"display:none\\\"> <div class=\\\"loader\\\"></div> </div> <main id=\\\"app-body\\\" class=\\\"d-block mh-34\\\"> <div id=\\\"ai-tag-list-container\\\" class=\\\"accordion\\\"></div> </main> <section id=\\\"confirmation-popup\\\"></section> <section id=\\\"toastr\\\"></section> <div id=\\\"footer\\\" class=\\\"py-2 text-center footer\\\"> </div> </body> </html>\";\n// Exports\nexport default code;","\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    // eslint-disable-next-line no-param-reassign\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n  url = String(url.__esModule ? url.default : url);\n  if (options.hash) {\n    // eslint-disable-next-line no-param-reassign\n    url += options.hash;\n  }\n  if (options.maybeNeedQuotes && /[\\t\\n\\f\\r \"'=<>`]/.test(url)) {\n    return \"\\\"\".concat(url, \"\\\"\");\n  }\n  return url;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","export const CONFIG = {\r\n    dataUrl: 'https://plsdevapp.azurewebsites.net',\r\n    storeUrl: 'https://linkwordplugin-aphgcwcgbfdqeccs.eastus-01.azurewebsites.net',\r\n    version: '2.4.4'\r\n};\r\n","import { CONFIG } from \"../utils/config\";\r\n\r\n// api.ts\r\nconst baseUrl = CONFIG.dataUrl // Set your actual base URL\r\n\r\nexport async function loginUser(organization: string, username: string, password: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/user/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      ClientName: organization,\r\n      Username: username,\r\n      Password: password\r\n    })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\n// api.ts\r\n\r\nexport async function getReportById(documentID: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/id/${documentID}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAllClients(userId: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/client/all/${userId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAiHistory(tagId: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/${tagId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function updateGroupKey(tag: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/head/groupkey`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(tag)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function addAiHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function updateAiHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/update`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function fetchGlossaryTemplate(clientId: string, bodyText: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/glossary-template/client-id/${clientId}`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(bodyText)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function addGroupKey(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/group-key/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAllPromptTemplates(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/prompt-template/all`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getPromptTemplateById(id: string, jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/prompt-template/${id}/data`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function updatePromptTemplate(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/groupkey/update-prompt`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function getAllCustomTables(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/custom-table/all`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function getGeneralImages(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/image/general`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function getReportHeadImageById(id: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/image/report-head/${id}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n  const data: any = await response.json();\r\n  return data;\r\n};","import { CONFIG } from \"../utils/config\";\r\nimport { UserProfile } from \"../models/user.model\";\r\nimport { loginUser } from \"../draft/draft.api\";\r\n\r\nexport class AuthService {\r\n    private static readonly TOKEN_KEY = 'user_token';\r\n    private static readonly USER_ROLE_KEY = 'userRole';\r\n    private static readonly STYLE_KEY = 'tableStyle';\r\n    private static readonly PALETTE_KEY = 'colorPallete';\r\n\r\n    static getStoredToken(): string | null {\r\n        return sessionStorage.getItem('token'); // Legacy code used sessionStorage for token\r\n    }\r\n\r\n    static restoreSession(): any {\r\n        const sessionToken = sessionStorage.getItem('token');\r\n        if (sessionToken) {\r\n            return {\r\n                jwt: sessionToken,\r\n                userRole: JSON.parse(sessionStorage.getItem(this.USER_ROLE_KEY) || '{}'),\r\n                tableStyle: sessionStorage.getItem(this.STYLE_KEY),\r\n                colorPallete: JSON.parse(sessionStorage.getItem(this.PALETTE_KEY) || 'null'),\r\n                userId: sessionStorage.getItem('userId')\r\n            };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async login(organization: string, username: string, password: string): Promise<{ success: boolean, message?: string, data?: any }> {\r\n        try {\r\n            console.log(`Logging in to ${CONFIG.dataUrl}`);\r\n            const data = await loginUser(organization, username, password);\r\n\r\n            if (data.Status === true && data['Data']) {\r\n                if (data['Data'].ResponseStatus) {\r\n                    const jwt = data.Data.Token;\r\n                    const userRole = data.Data.UserRole;\r\n                    const userId = data.Data.ID;\r\n\r\n                    // Store interactions in Session\r\n                    sessionStorage.setItem('token', jwt);\r\n                    sessionStorage.setItem(this.USER_ROLE_KEY, JSON.stringify(userRole));\r\n                    sessionStorage.setItem('userId', userId);\r\n\r\n                    // Note: tableStyle and colorPallete are typically stored sequentially or retrieved from profile\r\n                    // For now, we just ensure session is clean or updated as per legacy flow which checked sessionStorage items?\r\n                    // Legacy flow: \r\n                    // const style = sessionStorage.getItem('tableStyle');\r\n                    // const localPallete = sessionStorage.getItem('colorPallete');\r\n                    // It seems legacy flow READS from session storage if available, it doesn't SET them from login response?\r\n                    // Actually, it seemed to just re-read them.\r\n\r\n                    return {\r\n                        success: true,\r\n                        data: {\r\n                            token: jwt,\r\n                            userRole: userRole,\r\n                            userId: userId,\r\n                            raw: data.Data\r\n                        }\r\n                    };\r\n                } else {\r\n                    return { success: false, message: \"An error occurred during login. Please try again.\" };\r\n                }\r\n            } else {\r\n                return { success: false, message: \"An error occurred during login. Please try again.\" };\r\n            }\r\n        } catch (error) {\r\n            console.error('Error during login:', error);\r\n            return { success: false, message: \"An error occurred during login. Please try again.\" };\r\n        }\r\n    }\r\n\r\n    static logout(): void {\r\n        sessionStorage.removeItem('token');\r\n        sessionStorage.removeItem(this.USER_ROLE_KEY);\r\n        // Add other keys\r\n        console.log(\"Logged out\");\r\n    }\r\n}\r\n","\r\nexport class StoreService {\r\n    private static instance: StoreService;\r\n\r\n    // State Variables\r\n    public jwt: string = '';\r\n    public UserRole: any = {};\r\n    public documentID: string = '';\r\n    public organizationName: string = '';\r\n    public aiTagList: any[] = [];\r\n    public imageList: any[] = [];\r\n    public initialised: boolean = true;\r\n    public availableKeys: any[] = [];\r\n    public promptBuilderList: any[] = [];\r\n    public glossaryName: string = '';\r\n    public isGlossaryActive: boolean = false;\r\n    public GroupName: string = '';\r\n    public layTerms: any[] = [];\r\n    public dataList: any = [];\r\n    public isTagUpdating: boolean = false;\r\n    public capturedFormatting: any = {};\r\n    public emptyFormat: boolean = false;\r\n    public isNoFormatTextAvailable: boolean = false;\r\n    public clientId: string = '0';\r\n    public userId: number = 0;\r\n    public clientList: any[] = [];\r\n    public currentYear: number = new Date().getFullYear();\r\n    public sourceList: any;\r\n    public sourceSummaryList: any;\r\n    public filteredGlossaryTerm: any;\r\n    public selectedNames: any[] = [];\r\n    public isPendingResponse: boolean = false;\r\n    public theme: string = 'Light';\r\n    public mode: string = 'Home';\r\n    public tableStyle: string = 'Plain Table 5';\r\n    public colorPallete: any = {\r\n        \"Header\": '#FFFFFF',\r\n        \"Primary\": '#FFFFFF',\r\n        \"Secondary\": '#FFFFFF',\r\n        \"Customize\": true,\r\n        \"IsHeaderBold\": true,\r\n        \"IsSideHeaderBold\": false\r\n    };\r\n    public customTableStyle: any[] = [];\r\n\r\n    private constructor() { }\r\n\r\n    public static getInstance(): StoreService {\r\n        if (!StoreService.instance) {\r\n            StoreService.instance = new StoreService();\r\n        }\r\n        return StoreService.instance;\r\n    }\r\n}\r\n","export const wordTableStyles = [\r\n  // Plain Tables\r\n  {\r\n    name: \"Plain White Table\",\r\n    style: \"Table Grid\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #000;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: false,\r\n  },\r\n  {\r\n    name: \"Plain Table with Gray Alternating Rows\",\r\n    style: \"Plain Table 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #000;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n\r\n  // Grid Table 1 Variants (Header + Alternating Rows)\r\n  {\r\n    name: \"Plain Header Table with Light Gray Alternating Rows\",\r\n    style: \"Grid Table 2\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Blue Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 1\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#dbe5f1;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Pink Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 2\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#f2dbdb;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Green Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 3\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#eaf1dd;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Purple Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 4\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#e5dfec;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Teal Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 5\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#daeef3;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Plain Header Table with Light Orange Alternating Rows\",\r\n    style: \"Grid Table 2 - Accent 6\",\r\n    headerClass: \"border:1px solid white;\",\r\n    tableClass: \"background-color:#ffffff;border:1px solid #d4d4d1ff;\",\r\n    rowClass: \"background-color:#fde9d9;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n\r\n  // Header Only Tables\r\n  {\r\n    name: \"Black Header Only Table with White Rows\",\r\n    style: \"List Table 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Blue Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Red Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 2\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Green Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Purple Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Teal Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 5\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Orange Header Only Table with White Rows\",\r\n    style: \"List Table 3 - Accent 6\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#ffffff;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n\r\n  // Grid Table 4 Variants\r\n  {\r\n    name: \"Black Header Table with Light Gray Alternating Rows\",\r\n    style: \"Grid Table 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#000000;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Blue Header Table with Light Blue Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#dbe5f1;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Red Header Table with Pink Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 2\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2dbdb;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Green Header Table with Light Green Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#eaf1dd;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Purple Header Table with Light Purple Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#e5dfec;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Teal Header Table with Light Teal Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 5\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#daeef3;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Orange Header Table with Light Orange Alternating Rows\",\r\n    style: \"Grid Table 4 - Accent 6\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#fde9d9;color:#000000;\",\r\n    format: \"empty\",\r\n    sideHeader: true,\r\n  },\r\n\r\n  // Grid Table 5 Variants (Partial)\r\n  {\r\n    name: \"Black Header Table with Light Gray Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Blue Header Table with Light Blue Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark - Accent 1\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#dbe5f1;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Red Header Table with Pink Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark - Accent 2\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2dbdb;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Green Header Table with Light Green Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark - Accent 3\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#eaf1dd;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Purple Header Table with Light Purple Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark - Accent 4\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#e5dfec;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Teal Header Table with Light Teal Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark - Accent 5\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#daeef3;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Orange Header Table with Light Orange Alternating Rows - Side header same color\",\r\n    style: \"Grid Table 5 Dark - Accent 6\",\r\n    headerClass: \"\",\r\n    tableClass: \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#fde9d9;color:#000000;\",\r\n    format: \"partial\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Black Table - Whole table is black\",\r\n    style: \"List Table 5 Dark\",\r\n    headerClass: \"border:1px solid #000000; border-bottom: none;\",\r\n    tableClass: \"background-color:#000000;border:1px solid #f2f2f2;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2f2f2;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Blue Table - Whole table is blue\",\r\n    style: \"List Table 5 Dark - Accent 1\",\r\n    headerClass: \"border:1px solid #4F81BD; border-bottom: none;\",\r\n    tableClass: \"background-color:#4F81BD;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#dbe5f1;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Red Table - Whole table is red\",\r\n    style: \"List Table 5 Dark - Accent 2\",\r\n    headerClass: \"border:1px solid #c0504d; border-bottom: none;\",\r\n    tableClass: \"background-color:#c0504d;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#f2dbdb;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Green Table - Whole table is green\",\r\n    style: \"List Table 5 Dark - Accent 3\",\r\n    headerClass: \"border:1px solid #9bbb59; border-bottom: none;\",\r\n    tableClass: \"background-color:#9bbb59;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#eaf1dd;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Purple Table - Whole table is purple\",\r\n    style: \"List Table 5 Dark - Accent 4\",\r\n    headerClass: \"border:1px solid #8064a2; border-bottom: none;\",\r\n    tableClass: \"background-color:#8064a2;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#e5dfec;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Teal Table - Whole table is teal\",\r\n    style: \"List Table 5 Dark - Accent 5\",\r\n    headerClass: \"border:1px solid #4bacc6; border-bottom: none;\",\r\n    tableClass: \"background-color:#4bacc6;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#daeef3;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  },\r\n  {\r\n    name: \"Orange Table - Whole table is orange\",\r\n    style: \"List Table 5 Dark - Accent 6\",\r\n    headerClass: \"border:1px solid #f79646; border-bottom: none;\",\r\n    tableClass: \"background-color:#f79646;border:1px solid #d4d4d1ff;color:#ffffff;\",\r\n    rowClass: \"background-color:#fde9d9;color:#000000;\",\r\n    format: \"full\",\r\n    sideHeader: true,\r\n  }\r\n]\r\n\r\n\r\n\r\nexport const wordTableStyleLocales: Record<\r\n  \"en\" | \"de\" | \"fr\" | \"es\",\r\n  Record<string, string>\r\n> = {\r\n  /* ===================== ENGLISH (source of truth) ===================== */\r\n  en: {\r\n    \"Table Grid\": \"Table Grid\",\r\n    \"Table Grid 1\": \"Table Grid\",\r\n    \"Plain Table 1\": \"Plain Table 1\",\r\n\r\n    \"Grid Table 2\": \"Grid Table 2\",\r\n    \"Grid Table 2 - Accent 1\": \"Grid Table 2 - Accent 1\",\r\n    \"Grid Table 2 - Accent 2\": \"Grid Table 2 - Accent 2\",\r\n    \"Grid Table 2 - Accent 3\": \"Grid Table 2 - Accent 3\",\r\n    \"Grid Table 2 - Accent 4\": \"Grid Table 2 - Accent 4\",\r\n    \"Grid Table 2 - Accent 5\": \"Grid Table 2 - Accent 5\",\r\n    \"Grid Table 2 - Accent 6\": \"Grid Table 2 - Accent 6\",\r\n\r\n    \"List Table 3\": \"List Table 3\",\r\n    \"List Table 3 - Accent 1\": \"List Table 3 - Accent 1\",\r\n    \"List Table 3 - Accent 2\": \"List Table 3 - Accent 2\",\r\n    \"List Table 3 - Accent 3\": \"List Table 3 - Accent 3\",\r\n    \"List Table 3 - Accent 4\": \"List Table 3 - Accent 4\",\r\n    \"List Table 3 - Accent 5\": \"List Table 3 - Accent 5\",\r\n    \"List Table 3 - Accent 6\": \"List Table 3 - Accent 6\",\r\n\r\n    \"Grid Table 4\": \"Grid Table 4\",\r\n    \"Grid Table 4 - Accent 1\": \"Grid Table 4 - Accent 1\",\r\n    \"Grid Table 4 - Accent 2\": \"Grid Table 4 - Accent 2\",\r\n    \"Grid Table 4 - Accent 3\": \"Grid Table 4 - Accent 3\",\r\n    \"Grid Table 4 - Accent 4\": \"Grid Table 4 - Accent 4\",\r\n    \"Grid Table 4 - Accent 5\": \"Grid Table 4 - Accent 5\",\r\n    \"Grid Table 4 - Accent 6\": \"Grid Table 4 - Accent 6\",\r\n\r\n    \"Grid Table 5 Dark\": \"Grid Table 5 Dark\",\r\n    \"Grid Table 5 Dark - Accent 1\": \"Grid Table 5 Dark - Accent 1\",\r\n    \"Grid Table 5 Dark - Accent 2\": \"Grid Table 5 Dark - Accent 2\",\r\n    \"Grid Table 5 Dark - Accent 3\": \"Grid Table 5 Dark - Accent 3\",\r\n    \"Grid Table 5 Dark - Accent 4\": \"Grid Table 5 Dark - Accent 4\",\r\n    \"Grid Table 5 Dark - Accent 5\": \"Grid Table 5 Dark - Accent 5\",\r\n    \"Grid Table 5 Dark - Accent 6\": \"Grid Table 5 Dark - Accent 6\",\r\n\r\n    \"List Table 5 Dark\": \"List Table 5 Dark\",\r\n    \"List Table 5 Dark - Accent 1\": \"List Table 5 Dark - Accent 1\",\r\n    \"List Table 5 Dark - Accent 2\": \"List Table 5 Dark - Accent 2\",\r\n    \"List Table 5 Dark - Accent 3\": \"List Table 5 Dark - Accent 3\",\r\n    \"List Table 5 Dark - Accent 4\": \"List Table 5 Dark - Accent 4\",\r\n    \"List Table 5 Dark - Accent 5\": \"List Table 5 Dark - Accent 5\",\r\n    \"List Table 5 Dark - Accent 6\": \"List Table 5 Dark - Accent 6\"\r\n  },\r\n\r\n  /* ===================== GERMAN ===================== */\r\n  de: {\r\n    \"Table Grid\": \"Tabellenraster\",\r\n    \"Table Grid 1\": \"Tabellenraster\",\r\n    \"Plain Table 1\": \"Einfache Tabelle 1\",\r\n    \"Plain Table 2\": \"Einfache Tabelle 2\",\r\n    \"Plain Table 3\":\"Einfache Tabelle 3\",\r\n    \"Plain Table 5\" : \"Einfache Tabelle 5\",\r\n    \"Grid Table 2\": \"Gitternetztabelle 2\",\r\n    \"Grid Table 2 - Accent 1\": \"Gitternetztabelle 2  Akzent 1\",\r\n    \"Grid Table 2 - Accent 2\": \"Gitternetztabelle 2  Akzent 2\",\r\n    \"Grid Table 2 - Accent 3\": \"Gitternetztabelle 2  Akzent 3\",\r\n    \"Grid Table 2 - Accent 4\": \"Gitternetztabelle 2  Akzent 4\",\r\n    \"Grid Table 2 - Accent 5\": \"Gitternetztabelle 2  Akzent 5\",\r\n    \"Grid Table 2 - Accent 6\": \"Gitternetztabelle 2  Akzent 6\",\r\n\r\n    \"List Table 2\": \"Listentabelle 2\",\r\n    \"List Table 3\": \"Listentabelle 3\",\r\n    \"List Table 3 - Accent 1\": \"Listentabelle 3  Akzent 1\",\r\n    \"List Table 3 - Accent 2\": \"Listentabelle 3  Akzent 2\",\r\n    \"List Table 3 - Accent 3\": \"Listentabelle 3  Akzent 3\",\r\n    \"List Table 3 - Accent 4\": \"Listentabelle 3  Akzent 4\",\r\n    \"List Table 3 - Accent 5\": \"Listentabelle 3  Akzent 5\",\r\n    \"List Table 3 - Accent 6\": \"Listentabelle 3  Akzent 6\",\r\n\r\n    \"Grid Table 4\": \"Gitternetztabelle 4\",\r\n    \"Grid Table 4 - Accent 1\": \"Gitternetztabelle 4  Akzent 1\",\r\n    \"Grid Table 4 - Accent 2\": \"Gitternetztabelle 4  Akzent 2\",\r\n    \"Grid Table 4 - Accent 3\": \"Gitternetztabelle 4  Akzent 3\",\r\n    \"Grid Table 4 - Accent 4\": \"Gitternetztabelle 4  Akzent 4\",\r\n    \"Grid Table 4 - Accent 5\": \"Gitternetztabelle 4  Akzent 5\",\r\n    \"Grid Table 4 - Accent 6\": \"Gitternetztabelle 4  Akzent 6\",\r\n\r\n    \"Grid Table 5 Dark\": \"Gitternetztabelle 5 dunkel\",\r\n    \"Grid Table 5 Dark - Accent 1\": \"Gitternetztabelle 5 dunkel   Akzent 1\",\r\n    \"Grid Table 5 Dark - Accent 2\": \"Gitternetztabelle 5 dunkel   Akzent 2\",\r\n    \"Grid Table 5 Dark - Accent 3\": \"Gitternetztabelle 5 dunkel   Akzent 3\",\r\n    \"Grid Table 5 Dark - Accent 4\": \"Gitternetztabelle 5 dunkel   Akzent 4\",\r\n    \"Grid Table 5 Dark - Accent 5\": \"Gitternetztabelle 5 dunkel   Akzent 5\",\r\n    \"Grid Table 5 Dark - Accent 6\": \"Gitternetztabelle 5 dunkel   Akzent 6\",\r\n\r\n    \"List Table 5 Dark\": \"Listentabelle 5 dunkel\",\r\n    \"List Table 5 Dark - Accent 1\": \"Listentabelle 5 dunkel   Akzent 1\",\r\n    \"List Table 5 Dark - Accent 2\": \"Listentabelle 5 dunkel   Akzent 2\",\r\n    \"List Table 5 Dark - Accent 3\": \"Listentabelle 5 dunkel   Akzent 3\",\r\n    \"List Table 5 Dark - Accent 4\": \"Listentabelle 5 dunkel   Akzent 4\",\r\n    \"List Table 5 Dark - Accent 5\": \"Listentabelle 5 dunkel   Akzent 5\",\r\n    \"List Table 5 Dark - Accent 6\": \"Listentabelle 5 dunkel   Akzent 6\"\r\n  },\r\n\r\n\r\n  /* ===================== FRENCH ===================== */\r\n  fr: {\r\n    \"Table Grid\": \"Quadrillage\",\r\n    \"Plain Table 1\": \"Tableau simple 1\",\r\n\r\n    \"Grid Table 2\": \"Tableau quadrill 2\",\r\n    \"Grid Table 2 - Accent 1\": \"Tableau quadrill 2 Accent 1\",\r\n    \"Grid Table 2 - Accent 2\": \"Tableau quadrill 2 Accent 2\",\r\n    \"Grid Table 2 - Accent 3\": \"Tableau quadrill 2 Accent 3\",\r\n    \"Grid Table 2 - Accent 4\": \"Tableau quadrill 2 Accent 4\",\r\n    \"Grid Table 2 - Accent 5\": \"Tableau quadrill 2 Accent 5\",\r\n    \"Grid Table 2 - Accent 6\": \"Tableau quadrill 2 Accent 6\",\r\n\r\n    \"List Table 3\": \"Tableau de liste 3\",\r\n    \"List Table 3 - Accent 1\": \"Tableau de liste 3 Accent 1\",\r\n    \"List Table 3 - Accent 2\": \"Tableau de liste 3 Accent 2\",\r\n    \"List Table 3 - Accent 3\": \"Tableau de liste 3 Accent 3\",\r\n    \"List Table 3 - Accent 4\": \"Tableau de liste 3 Accent 4\",\r\n    \"List Table 3 - Accent 5\": \"Tableau de liste 3 Accent 5\",\r\n    \"List Table 3 - Accent 6\": \"Tableau de liste 3 Accent 6\",\r\n\r\n    \"Grid Table 4\": \"Tableau quadrill 4\",\r\n    \"Grid Table 4 - Accent 1\": \"Tableau quadrill 4 Accent 1\",\r\n    \"Grid Table 4 - Accent 2\": \"Tableau quadrill 4 Accent 2\",\r\n    \"Grid Table 4 - Accent 3\": \"Tableau quadrill 4 Accent 3\",\r\n    \"Grid Table 4 - Accent 4\": \"Tableau quadrill 4 Accent 4\",\r\n    \"Grid Table 4 - Accent 5\": \"Tableau quadrill 4 Accent 5\",\r\n    \"Grid Table 4 - Accent 6\": \"Tableau quadrill 4 Accent 6\",\r\n\r\n    \"Grid Table 5 Dark\": \"Tableau quadrill 5 fonc\",\r\n    \"Grid Table 5 Dark - Accent 1\": \"Tableau quadrill 5 fonc Accent 1\",\r\n    \"Grid Table 5 Dark - Accent 2\": \"Tableau quadrill 5 fonc Accent 2\",\r\n    \"Grid Table 5 Dark - Accent 3\": \"Tableau quadrill 5 fonc Accent 3\",\r\n    \"Grid Table 5 Dark - Accent 4\": \"Tableau quadrill 5 fonc Accent 4\",\r\n    \"Grid Table 5 Dark - Accent 5\": \"Tableau quadrill 5 fonc Accent 5\",\r\n    \"Grid Table 5 Dark - Accent 6\": \"Tableau quadrill 5 fonc Accent 6\",\r\n\r\n    \"List Table 5 Dark\": \"Tableau de liste 5 fonc\",\r\n    \"List Table 5 Dark - Accent 1\": \"Tableau de liste 5 fonc Accent 1\",\r\n    \"List Table 5 Dark - Accent 2\": \"Tableau de liste 5 fonc Accent 2\",\r\n    \"List Table 5 Dark - Accent 3\": \"Tableau de liste 5 fonc Accent 3\",\r\n    \"List Table 5 Dark - Accent 4\": \"Tableau de liste 5 fonc Accent 4\",\r\n    \"List Table 5 Dark - Accent 5\": \"Tableau de liste 5 fonc Accent 5\",\r\n    \"List Table 5 Dark - Accent 6\": \"Tableau de liste 5 fonc Accent 6\"\r\n  },\r\n\r\n  /* ===================== SPANISH ===================== */\r\n  es: {\r\n    \"Table Grid\": \"Cuadrcula de tabla\",\r\n    \"Plain Table 1\": \"Tabla simple 1\",\r\n\r\n    \"Grid Table 2\": \"Tabla de cuadrcula 2\",\r\n    \"Grid Table 2 - Accent 1\": \"Tabla de cuadrcula 2 Acento 1\",\r\n    \"Grid Table 2 - Accent 2\": \"Tabla de cuadrcula 2 Acento 2\",\r\n    \"Grid Table 2 - Accent 3\": \"Tabla de cuadrcula 2 Acento 3\",\r\n    \"Grid Table 2 - Accent 4\": \"Tabla de cuadrcula 2 Acento 4\",\r\n    \"Grid Table 2 - Accent 5\": \"Tabla de cuadrcula 2 Acento 5\",\r\n    \"Grid Table 2 - Accent 6\": \"Tabla de cuadrcula 2 Acento 6\",\r\n\r\n    \"List Table 3\": \"Tabla de lista 3\",\r\n    \"List Table 3 - Accent 1\": \"Tabla de lista 3 Acento 1\",\r\n    \"List Table 3 - Accent 2\": \"Tabla de lista 3 Acento 2\",\r\n    \"List Table 3 - Accent 3\": \"Tabla de lista 3 Acento 3\",\r\n    \"List Table 3 - Accent 4\": \"Tabla de lista 3 Acento 4\",\r\n    \"List Table 3 - Accent 5\": \"Tabla de lista 3 Acento 5\",\r\n    \"List Table 3 - Accent 6\": \"Tabla de lista 3 Acento 6\",\r\n\r\n    \"Grid Table 4\": \"Tabla de cuadrcula 4\",\r\n    \"Grid Table 4 - Accent 1\": \"Tabla de cuadrcula 4 Acento 1\",\r\n    \"Grid Table 4 - Accent 2\": \"Tabla de cuadrcula 4 Acento 2\",\r\n    \"Grid Table 4 - Accent 3\": \"Tabla de cuadrcula 4 Acento 3\",\r\n    \"Grid Table 4 - Accent 4\": \"Tabla de cuadrcula 4 Acento 4\",\r\n    \"Grid Table 4 - Accent 5\": \"Tabla de cuadrcula 4 Acento 5\",\r\n    \"Grid Table 4 - Accent 6\": \"Tabla de cuadrcula 4 Acento 6\",\r\n\r\n    \"Grid Table 5 Dark\": \"Tabla de cuadrcula 5 oscuro\",\r\n    \"Grid Table 5 Dark - Accent 1\": \"Tabla de cuadrcula 5 oscuro Acento 1\",\r\n    \"Grid Table 5 Dark - Accent 2\": \"Tabla de cuadrcula 5 oscuro Acento 2\",\r\n    \"Grid Table 5 Dark - Accent 3\": \"Tabla de cuadrcula 5 oscuro Acento 3\",\r\n    \"Grid Table 5 Dark - Accent 4\": \"Tabla de cuadrcula 5 oscuro Acento 4\",\r\n    \"Grid Table 5 Dark - Accent 5\": \"Tabla de cuadrcula 5 oscuro Acento 5\",\r\n    \"Grid Table 5 Dark - Accent 6\": \"Tabla de cuadrcula 5 oscuro Acento 6\",\r\n\r\n    \"List Table 5 Dark\": \"Tabla de lista 5 oscuro\",\r\n    \"List Table 5 Dark - Accent 1\": \"Tabla de lista 5 oscuro Acento 1\",\r\n    \"List Table 5 Dark - Accent 2\": \"Tabla de lista 5 oscuro Acento 2\",\r\n    \"List Table 5 Dark - Accent 3\": \"Tabla de lista 5 oscuro Acento 3\",\r\n    \"List Table 5 Dark - Accent 4\": \"Tabla de lista 5 oscuro Acento 4\",\r\n    \"List Table 5 Dark - Accent 5\": \"Tabla de lista 5 oscuro Acento 5\",\r\n    \"List Table 5 Dark - Accent 6\": \"Tabla de lista 5 oscuro Acento 6\"\r\n  }\r\n};\r\n","import { StoreService } from \"../services/store.service\";\r\nimport { wordTableStyles } from \"./tablestyles\";\r\n\r\nfunction addtagbody(sponsorOptions, sourceOptions, isSummaryMode = false) {\r\n  const body = `<div class=\"modal-dialog\">\r\n  <div class=\"modal-content\">\r\n    <div class=\"modal-body p-3 pt-0\">\r\n      <form id=\"genai-form\" autocomplete=\"off\" novalidate>\r\n        <!-- Name Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"name\" class=\"form-label\"><span class=\"text-danger\">*</span> Name</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"name\" required>\r\n          <div class=\"invalid-feedback\">Name is required.</div>\r\n          <div id=\"submition-error\" class=\"invalid-feedback\" style=\"display: none;\"></div>\r\n\r\n        </div>\r\n\r\n        <!-- Description Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"description\" class=\"form-label\">Description</label>\r\n          <textarea class=\"form-control\" id=\"description\" rows=\"6\"></textarea>\r\n        </div>\r\n\r\n      \r\n\r\n        <div class=\"mb-3\" ${isSummaryMode ? 'style=\"display: none;\"' : ''}>\r\n          <label for=\"source\" class=\"form-label\"><span class=\"text-danger\">*</span> Primary Source Type</label>\r\n          <div class=\"dropdown w-100\">\r\n            <button \r\n              class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n              type=\"button\" \r\n              id=\"sourceDropdown\" \r\n              data-bs-toggle=\"dropdown\" \r\n              aria-expanded=\"false\" \r\n              >\r\n              <span id=\"sponsorDropdownLabel\">Select Source</span>\r\n              <span class=\"dropdown-toggle-icon\"></span>\r\n            </button>\r\n            <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sourceDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n              <li class=\"source-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"sourceSelectAll\">\r\n                  <label class=\"form-check-label\" for=\"sourceSelectAll\">Select All</label>\r\n                </div>\r\n              </li>\r\n              ${sourceOptions}\r\n            </ul>\r\n          </div>\r\n          <div class=\"invalid-feedback\" id=\"primarySourceError\" style=\"display:none;\">\r\n            Primary Source is required.\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <!-- Prompt Field -->\r\n        <div class=\"mb-3 prompt-box\">\r\n          <label for=\"prompt\" class=\"form-label\"><span class=\"text-danger\">*</span> Prompt \r\n            <small class=\"text-secondary\">(Note: Use # tag for content suggestions)</small>\r\n          </label>\r\n          <textarea class=\"form-control\" id=\"prompt\" rows=\"6\"  required></textarea>\r\n          <div class=\"invalid-feedback\">Prompt is required.</div>\r\n          <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n        </div>\r\n\r\n        <!-- Save Globally Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"saveGlobally\">\r\n          <label class=\"form-check-label\" for=\"saveGlobally\">Save Globally</label>\r\n        </div>\r\n\r\n        <!-- Available to All Sponsors Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"isAvailableForAll\" disabled>\r\n          <label class=\"form-check-label\" for=\"isAvailableForAll\">Available to All Sponsors</label>\r\n        </div>\r\n\r\n        <!-- Sponsor Dropdown -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"sponsor\" class=\"form-label\"><span class=\"text-danger\">*</span> Sponsor</label>\r\n          <div class=\"dropdown w-100\">\r\n            <button \r\n              class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n              type=\"button\" \r\n              id=\"sponsorDropdown\" \r\n              data-bs-toggle=\"dropdown\" \r\n              aria-expanded=\"false\" \r\n              disabled>\r\n              <span id=\"sponsorDropdownLabel\">Select Sponsors</span>\r\n              <span class=\"dropdown-toggle-icon\"></span>\r\n            </button>\r\n            <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sponsorDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n              <li class=\"sponsor-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"sponsorSelectAll\">\r\n                  <label class=\"form-check-label\" for=\"sponsorSelectAll\">Select All</label>\r\n                </div>\r\n              </li>\r\n              ${sponsorOptions}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Action Buttons -->\r\n        <div class=\"mt-3 d-flex justify-content-between\">\r\n          <span id=\"cancel-btn-gen-ai\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n          <button type=\"submit\" class=\"btn btn-primary\" id=\"text-gen-save\">Save</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>`\r\n\r\n  return body\r\n}\r\n\r\n\r\n\r\nfunction Confirmationpopup(content: string) {\r\n  const store = StoreService.getInstance();\r\n  const isDark = store.theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  const body = `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header border-0\">\r\n        <h5 class=\"fw-bold\">Confirmation</h5>\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        <p>${content}</p>\r\n      </div>\r\n\r\n      <div class=\"modal-footer border-0\">\r\n        <button type=\"button\" class=\"btn btn-link ${isDark ? 'text-info' : 'text-primary'}\" id=\"confirmation-popup-cancel\">Cancel</button>\r\n        <button type=\"button\" class=\"btn btn-primary text-white\" id=\"confirmation-popup-confirm\">Ok</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>`;\r\n  return body;\r\n}\r\n\r\n\r\nfunction customizeTablePopup(selectedValue: string, type: string) {\r\n  const store = StoreService.getInstance();\r\n  const isDark = store.theme === \"Dark\";\r\n  const popupClass = isDark ? \"bg-dark text-light\" : \"bg-light text-dark\";\r\n  const header = type === \"Custom\" ? \"Customized Tables\" : \"Default Tables\";\r\n  const sourceList = type === \"Custom\" ? store.customTableStyle : wordTableStyles;\r\n  const warningContent = type === \"Custom\" ? '' : '<small class=\"text-secondary font-italic\">Warning: The previewed table colors may vary depending on the accent or theme currently selected in Word.</small>'\r\n  const dropdown = `\r\n    <select class=\"form-select mb-2 ${popupClass}\" id=\"confirmation-popup-dropdown\">\r\n      ${sourceList\r\n      .map(opt => {\r\n        const value = type === \"Custom\" ? opt.Name : opt.style;\r\n        const isSelected = value === selectedValue;\r\n        const text = type === \"Custom\" ? opt.Name : opt.style;\r\n\r\n        return `<option value=\"${value}\" ${isSelected ? \"selected\" : \"\"}>\r\n                    ${text}\r\n                  </option>`;\r\n      })\r\n      .join(\"\")}\r\n    </select>\r\n  `;\r\n\r\n  const tablePreview = `\r\n    <div class=\"table-responsive\">\r\n      <table class=\"table table-bordered table-sm\" id=\"confirmation-popup-table-preview\">\r\n        <thead>\r\n          <tr>\r\n            <th>Header 1</th>\r\n            <th>Header 2</th>\r\n            <th>Header 3</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr style=\"color:black;\">\r\n            <td>Data 1</td>\r\n            <td>Data 2</td>\r\n            <td>Data 3</td>\r\n          </tr>\r\n          <tr style=\"background-color:white;color:black;\">\r\n            <td>Data 4</td>\r\n            <td>Data 5</td>\r\n            <td>Data 6</td>\r\n          </tr>\r\n          <tr style=\"color:black;\" >\r\n            <td>Data 7</td>\r\n            <td>Data 8</td>\r\n            <td>Data 9</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  `;\r\n\r\n  return `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header border-0\">\r\n        <h5 class=\"fw-bold\">${header}</h5>\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        ${dropdown}\r\n        ${tablePreview}\r\n        ${warningContent}\r\n      </div>\r\n\r\n      <div class=\"modal-footer border-0\">\r\n        <button type=\"button\" class=\"btn btn-link ${isDark ? \"text-info\" : \"text-primary\"}\" id=\"confirmation-popup-cancel\">Cancel</button>\r\n        <button type=\"button\" class=\"btn btn-primary text-white\" id=\"confirmation-popup-confirm\">Ok</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n  `;\r\n}\r\n\r\nfunction DataModalPopup(selectedData) {\r\n  const store = StoreService.getInstance();\r\n  const isDark = store.theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  return `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog modal-lg\">\r\n    <div class=\"modal-content p-2 ${popupClass}\">\r\n      <div class=\"modal-header flex-column align-items-start border-0\">\r\n        <span class=\"fw-bold mb-3\">${selectedData?.Name || ''}</span>\r\n        <span class=\"d-block list-height\">${selectedData?.UserValue || ''}</span>\r\n        ${selectedData?.Sources ? `\r\n        <hr class=\"${isDark ? 'border-light' : 'border-dark'}\">\r\n        <div class=\"d-flex align-items-start flex-wrap\">\r\n          <span class=\"fw-bold me-2\">Selected Sources :</span>\r\n          <div class=\"d-flex flex-wrap gap-1\">\r\n            ${selectedData.Sources.map(source => `\r\n              <span class=\"badge ${isDark ? 'text-bg-secondary' : 'text-bg-info'}\">${source.FileName}</span>\r\n            `).join('')}\r\n          </div>\r\n        </div>` : ''}\r\n      </div>\r\n\r\n      <div class=\"modal-body p-3 add-ai-gen\">\r\n        <div class=\"row g-2 list-height\">\r\n          ${selectedData?.Data?.map(item => `\r\n            <div class=\"col-md-12 mt-3\">\r\n              <div class=\"border rounded p-2 ${isDark ? 'bg-secondary text-light' : 'bg-light text-dark'} shadow-sm h-100\">\r\n                <div class=\"fw-bold small text-truncate\" title=\"${item.FileName}\">\r\n                  ${item.FileName}\r\n                </div>\r\n                <div class=\"text-muted small mb-1\">Page: ${item.PageNumber}</div>\r\n                <div class=\"small\" style=\"white-space: normal;\">\r\n                  ${item.Sentence}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n\r\n        <div class=\"d-flex w-100 justify-content-end mt-3 align-items-center\">\r\n          <button type=\"button\" class=\"btn btn-primary text-white\" id=\"datamodel-popup-ok\">OK</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>`;\r\n}\r\n\r\n\r\n\r\nfunction toaster(message: string, type: string) {\r\n  const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';\r\n  // const color = type === 'success' ? '#28a745' : '#dc3545';\r\n  const color = `#ffffff`\r\n  const body = `<div class=\"toast show\" style=\"position: fixed; top: 10px; right: 10px; z-index: 1050; max-width: fit-content; background-color: #808080; color: #ffffff;\">\r\n    <div class=\"toast-body\">\r\n         <i class=\"fa ${icon} me-2\" style=\"color: ${color};\"></i> ${message}\r\n    </div>\r\n  </div>`;\r\n\r\n  document.getElementById('toastr').innerHTML = body;\r\n  setTimeout(() => {\r\n    document.getElementById('toastr').innerHTML = ``;\r\n  }, 4000);\r\n}\r\n\r\nfunction logoheader(storedUrl) {\r\n  const store = StoreService.getInstance();\r\n  const themeicon = store.theme === 'Dark' ? 'fa-sun' : 'fa-moon'\r\n  const modeIcon = store.mode === 'Home' ? 'fa-home' : store.mode === 'Summary' ? 'fa-wand-magic-sparkles' : 'fa-magnifying-glass';\r\n  const body = `\r\n    <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n    <div class=\"icon-nav me-3\">\r\n    <div class=\"dropdown d-inline\">\r\n        <i class=\"fa ${modeIcon} c-pointer me-3\" id=\"modeDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Mode\"></i>\r\n        <ul class=\"dropdown-menu\" aria-labelledby=\"modeDropdown\" appendTo=\"body\">\r\n        <li>\r\n            <a class=\"dropdown-item\" href=\"#\" id=\"home\">\r\n              <i class=\"fa fa-home me-2\" aria-hidden=\"true\"></i> Draft Mode\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item\" href=\"#\" id=\"summary-mode\">\r\n              <i class=\"fa fa-wand-magic-sparkles me-2\" aria-hidden=\"true\"></i> Summary Mode\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"review-mode\">\r\n              <i class=\"fa fa-magnifying-glass me-2\" aria-hidden=\"true\"></i> Review Mode\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n\r\n      <div class=\"dropdown d-inline\">\r\n        <i class=\"fa fa-tools c-pointer me-3\" id=\"settingsDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Settings\"></i>\r\n        <ul class=\"dropdown-menu\" aria-labelledby=\"settingsDropdown\">\r\n        <li>\r\n            <a class=\"dropdown-item\" href=\"#\" id=\"define-formatting\">\r\n              <i class=\"fa fa-sliders-h me-2\" aria-hidden=\"true\"></i> Define Formatting\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"glossary\" tabindex=\"-1\" aria-disabled=\"true\">\r\n              <i class=\"fa fa-book me-2\" aria-hidden=\"true\"></i> Apply Glossary\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"removeFormatting\" tabindex=\"-1\" aria-disabled=\"true\">\r\n              <i class=\"fa fa-eraser me-2\" aria-hidden=\"true\"></i> Remove Formatting\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- Theme Toggle Icon -->\r\n      <span id=\"theme-toggle\"><i class=\"fa ${themeicon} c-pointer me-3\" title=\"Toggle Theme\"></i></span>\r\n\r\n      <i class=\"fa fa-sign-out c-pointer me-3\" id=\"logout\" title=\"Logout\"></i>\r\n    </div>    \r\n  `\r\n  return body;\r\n}\r\n\r\nconst navTabs = `<ul class=\"nav nav-tabs\" id=\"tabList\" role=\"tablist\">\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link active\" id=\"tag-tab\" data-bs-toggle=\"tab\" href=\"#tag\" role=\"tab\">Tag</a>\r\n  </li>\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link\" id=\"prompt-tab\" data-bs-toggle=\"tab\" href=\"#prompt\" role=\"tab\">Prompt builder</a>\r\n  </li>\r\n</ul>\r\n\r\n<div class=\"tab-content p-3 border border-top-0\">\r\n  <div class=\"tab-pane fade show active\" id=\"add-tag-body\" role=\"tabpanel\" aria-labelledby=\"tag-tab\">\r\n  </div>\r\n  <div class=\"tab-pane fade\" id=\"add-prompt-template\" role=\"tabpanel\" aria-labelledby=\"prompt-tab\">\r\n  </div>\r\n</div>\r\n`\r\n\r\n\r\n\r\nconst promptbuilderbody = `<div>hi</div>`\r\n\r\n\r\nexport { navTabs, addtagbody, promptbuilderbody, logoheader, Confirmationpopup, toaster, DataModalPopup, customizeTablePopup };","import { CONFIG } from \"../utils/config\";\r\n\r\n// api.ts\r\nconst baseUrl = CONFIG.dataUrl // Set your actual base URL\r\n\r\nexport async function getSummaryTagsByReportHeadId(reportHeadId: number | string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/summarytag/reportHead/${reportHeadId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n\r\n\r\nexport async function activateSummaryMode(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/activate-summarymode`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json(); // if API returns JSON\r\n}\r\nexport async function refreshSummaryMode(payload: { ReportHeadID: number; RefreshSummaryTag: boolean; ActiveDocument: string }, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/refresh-summarymode`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n\r\nexport async function getSummaryTagHistory(reportHeadSummaryTagID: number | string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/summarytag/history/${reportHeadSummaryTagID}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n\r\nexport async function getSummaryTagStatus(reportHeadSummaryTagID: number | string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/summarytag/status/${reportHeadSummaryTagID}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n\r\nexport async function addSummaryHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/summary-history/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n\r\nexport async function updateSummaryHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/summary-history/update`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n\r\nexport async function addSummaryTag(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/summary-tag/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\nexport async function updateSummaryTagPrompt(payload: { Name: string; Prompt: string }, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/summarytag/update-prompt`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  return await response.json();\r\n}\r\n","import { AITag } from \"../models/tag.model\";\r\nimport { CONFIG } from \"../utils/config\";\r\nimport { StoreService } from \"./store.service\";\r\nimport { getAiHistory, addAiHistory } from \"../draft/draft.api\";\r\nimport { removeQuotes, updateEditorFinalTable } from \"../draft/draft-functions\";\r\nimport { generateCheckboxHistory } from \"../draft/home\";\r\nimport { addSummaryHistory } from \"../summary/summary.api\";\r\n\r\nexport class AIService {\r\n\r\n    static async fetchAIHistory(tag: any): Promise<any[]> {\r\n        const store = StoreService.getInstance();\r\n        try {\r\n            const data = await getAiHistory(tag.ID, store.jwt);\r\n\r\n            if (data.Status && data.Data) {\r\n                tag.ReportHeadAIHistoryList = data['Data'] || [];\r\n                tag.FilteredReportHeadAIHistoryList = [];\r\n                tag.SourceValueID = tag.ReportHeadAIHistoryList[0].SourceValue;\r\n\r\n                const selectedSources = store.sourceList.filter((list: any) =>\r\n                    tag.SourceValueID.includes(String(list.VectorID))\r\n                );\r\n\r\n                tag.SourceName = selectedSources.map((item: any) => {\r\n                    return item.SourceName;\r\n                });\r\n                tag.Sources = tag.SourceName.join(',');\r\n                tag.TempSourceValue = selectedSources.map((item: any) => {\r\n                    return item.VectorID ? String(item.VectorID) : item.SourceValue;\r\n                });\r\n\r\n                tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                    historyList.Response = removeQuotes(historyList.Response);\r\n                    tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                });\r\n                return tag.FilteredReportHeadAIHistoryList;\r\n            } else {\r\n                console.warn(\"No AI history available.\");\r\n                return [];\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching AI history:', error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    static async sendPrompt(tag: any, prompt: string, type: \"Summary\" | \"AITag\" = \"AITag\"): Promise<void> {\r\n        const store = StoreService.getInstance();\r\n\r\n        if (prompt !== '' && !store.isTagUpdating) {\r\n            store.isTagUpdating = true;\r\n\r\n            // UI Updates via direct DOM or another UI service? \r\n            // For now, keeping direct DOM manipulation as in original code, but cleaner would be callbacks.\r\n            const iconelement = document.getElementById(`sendPromptButton`);\r\n            if (iconelement) iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`;\r\n\r\n            let payload: any;\r\n            if (type === 'Summary') {\r\n                payload = {\r\n                    ReportHeadID: store.dataList.ID,\r\n                    ReportHeadSummaryTagID: tag.ID,\r\n                    Prompt: prompt,\r\n                    Response: \"\",\r\n                    Selected: 1,\r\n                    SourceVector: tag.TempSourceValue ? tag.TempSourceValue.join(\",\") : \"\",\r\n                    Name: tag.Name\r\n                };\r\n            } else {\r\n                payload = {\r\n                    ReportHeadID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadID,\r\n                    DocumentID: store.dataList.NCTID,\r\n                    DocumentType: store.dataList.DocumentType,\r\n                    TextSetting: store.dataList.TextSetting,\r\n                    DocumentTemplate: store.dataList.ReportTemplate,\r\n                    ReportHeadGroupKeyID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,\r\n                    ThreadID: tag.ThreadID,\r\n                    AssistantID: store.dataList.AssistantID,\r\n                    Container: store.dataList.Container,\r\n                    GroupName: store.GroupName,\r\n                    Prompt: prompt,\r\n                    PromptType: 1,\r\n                    Response: '',\r\n                    VectorID: store.dataList.VectorID,\r\n                    Selected: 0,\r\n                    ID: 0,\r\n                    SourceValue: tag.TempSourceValue ? tag.TempSourceValue : []\r\n                };\r\n            }\r\n\r\n            try {\r\n                store.isPendingResponse = true;\r\n                const data = type === 'Summary'\r\n                    ? await addSummaryHistory(payload, store.jwt)\r\n                    : await addAiHistory(payload, store.jwt);\r\n\r\n                if (data['Data'] && data['Data'] !== 'false') {\r\n                    tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n                    tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n                    tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                        historyList.Response = removeQuotes(historyList.Response);\r\n                        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                    });\r\n                    const chat = tag.ReportHeadAIHistoryList[0];\r\n\r\n                    // Update lists in Store\r\n                    store.aiTagList.forEach((currentTag: any) => {\r\n                        if (currentTag.ID === tag.ID) {\r\n                            AIService.updateTagWithChat(currentTag, chat, tag.IsApplied);\r\n                        }\r\n                    });\r\n\r\n                    store.availableKeys.forEach((currentTag: any) => {\r\n                        if (currentTag.ID === tag.ID) {\r\n                            AIService.updateTagWithChat(currentTag, chat, tag.IsApplied);\r\n                        }\r\n                    });\r\n\r\n                    const appbody = document.getElementById('app-body');\r\n                    if (appbody) appbody.innerHTML = await generateCheckboxHistory(tag, type);\r\n                    store.isPendingResponse = false;\r\n                }\r\n\r\n                if (iconelement) iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n                const chatInput = document.getElementById(`chatInput`) as HTMLInputElement;\r\n                if (chatInput) chatInput.value = '';\r\n\r\n                store.isTagUpdating = false;\r\n                store.isPendingResponse = false;\r\n\r\n            } catch (error) {\r\n                if (iconelement) iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n                store.isTagUpdating = false;\r\n                store.isPendingResponse = false;\r\n                console.error('Error sending AI prompt:', error);\r\n            }\r\n        } else {\r\n            console.error('No empty prompt allowed or tag updating');\r\n        }\r\n    }\r\n\r\n    private static updateTagWithChat(currentTag: any, chat: any, isApplied: any) {\r\n        const isTable = chat.FormattedResponse !== '';\r\n        const finalResponse = chat.FormattedResponse\r\n            ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n            : chat.Response;\r\n\r\n        currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n        currentTag.UserValue = finalResponse;\r\n        currentTag.EditorValue = finalResponse;\r\n        currentTag.text = finalResponse;\r\n        currentTag.IsApplied = isApplied;\r\n    }\r\n}\r\n\r\n","import { generateCheckboxHistory } from \"../draft/home\";\r\nimport { addGenAITags } from \"../taskpane\";\r\nimport {\r\n  activateSummaryMode,\r\n  getSummaryTagsByReportHeadId,\r\n  getSummaryTagHistory,\r\n  getSummaryTagStatus,\r\n  refreshSummaryMode,\r\n  addSummaryHistory\r\n} from \"./summary.api\";\r\nimport { CONFIG } from \"../utils/config\";\r\nimport { UIService } from \"../services/ui.service\";\r\nimport { StoreService } from \"../services/store.service\";\r\nimport { Confirmationpopup, toaster } from \"../components/bodyelements\";\r\n\r\nexport var summarySelectedNames: string[] = [];\r\n\r\nlet isSummaryLoading = false;\r\nlet allSummaryTags: any[] = [];\r\nlet currentSummaryStatus = 0;\r\nlet currentSummaryInstance = 0;\r\n\r\nexport async function loadSummarypage(availableKeys: any[]) {\r\n  const instanceId = ++currentSummaryInstance;\r\n  const store = StoreService.getInstance();\r\n  const searchBoxClass = store.theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n\r\n  document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-3\">\r\n\r\n      <!-- Top bar -->\r\n      <div class=\"d-flex justify-content-end px-2\">\r\n        <div class=\"dropdown\">\r\n          <button class=\"btn btn-default dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n            Action\r\n          </button>\r\n          <ul class=\"dropdown-menu dropdown-menu-end\">\r\n            <li>\r\n              <a class=\"dropdown-item\" href=\"#\" id=\"add-btn-tag\">\r\n                <i class=\"fa-solid fa-plus me-2\"></i> Add\r\n              </a>\r\n            </li>\r\n\r\n            <li>\r\n              <a class=\"dropdown-item\" href=\"#\" id=\"reanalyze-draft\">\r\n                <i class=\"fa-solid fa-rotate-right me-2\"></i> Re-analyze Draft\r\n              </a>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Search -->\r\n      <div class=\"form-group px-2 pt-2\">\r\n        <div class=\"input-group\">\r\n          <input type=\"text\" id=\"search-box\"\r\n            class=\"form-control ${searchBoxClass}\"\r\n            placeholder=\"Search Summary Tags ...\"\r\n            autocomplete=\"off\" />\r\n          <span class=\"input-group-text\">\r\n            <i class=\"fa-solid fa-magnifying-glass text-muted\"></i>\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Card Panel (always visible now) -->\r\n      <div class=\"card mt-3 mx-2 mb-3\" id=\"summary-card\">\r\n        <div class=\"card-header fw-semibold\">Summary Tags</div>\r\n\r\n        <div class=\"list-group list-group-summary list-group-flush\" id=\"summary-tag-list\">\r\n          <div class=\"d-flex justify-content-center align-items-center p-5\">\r\n            <div class=\"loader\"></div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Pagination Footer -->\r\n        <div class=\"card-footer d-flex justify-content-between align-items-center flex-wrap gap-2\">\r\n          <div class=\"btn-group btn-group-sm\" role=\"group\" aria-label=\"pagination\">\r\n            <button class=\"btn btn-outline-secondary\" id=\"page-first\" title=\"First\">\r\n              <i class=\"fa-solid fa-backward-fast\"></i>\r\n            </button>\r\n            <button class=\"btn btn-outline-secondary\" id=\"page-prev\" title=\"Previous\">\r\n              <i class=\"fa-solid fa-backward-step\"></i>\r\n            </button>\r\n\r\n            <div class=\"btn-group btn-group-sm\" id=\"page-buttons\"></div>\r\n\r\n            <button class=\"btn btn-outline-secondary\" id=\"page-next\" title=\"Next\">\r\n              <i class=\"fa-solid fa-forward-step\"></i>\r\n            </button>\r\n            <button class=\"btn btn-outline-secondary\" id=\"page-last\" title=\"Last\">\r\n              <i class=\"fa-solid fa-forward-fast\"></i>\r\n            </button>\r\n          </div>\r\n\r\n          <div class=\"text-muted small\" id=\"page-count-label\"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const searchBox = document.getElementById('search-box') as HTMLInputElement;\r\n  const list = document.getElementById('summary-tag-list') as HTMLElement;\r\n  const pageButtons = document.getElementById('page-buttons') as HTMLElement;\r\n  const pageCountLabel = document.getElementById('page-count-label') as HTMLElement;\r\n\r\n  const btnFirst = document.getElementById('page-first') as HTMLButtonElement;\r\n  const btnPrev = document.getElementById('page-prev') as HTMLButtonElement;\r\n  const btnNext = document.getElementById('page-next') as HTMLButtonElement;\r\n  const btnLast = document.getElementById('page-last') as HTMLButtonElement;\r\n\r\n  const addBtn = document.getElementById('add-btn-tag') as HTMLAnchorElement;\r\n  const reanalyzeBtn = document.getElementById('reanalyze-draft') as HTMLAnchorElement;\r\n\r\n  function disableActionButtons(disabled: boolean) {\r\n    if (addBtn) addBtn.classList.toggle(\"disabled\", disabled);\r\n  }\r\n\r\n  function setReanalyzeButtonState(enabled: boolean) {\r\n    if (reanalyzeBtn) reanalyzeBtn.classList.toggle(\"disabled\", !enabled);\r\n  }\r\n\r\n  //  helper to normalize API response into string[]\r\n  function normalizeNames(res: any): string[] {\r\n    let names =\r\n      res?.Data ??\r\n      res?.SelectedNames ??\r\n      res?.selectedNames ??\r\n      res?.data ??\r\n      res ??\r\n      [];\r\n\r\n    if (typeof names === \"string\") {\r\n      return names.split(\",\").map((x: string) => x.trim()).filter(Boolean);\r\n    }\r\n\r\n    if (Array.isArray(names) && names.length > 0 && typeof names[0] === \"object\") {\r\n      return names\r\n        .map((x: any) => x.DisplayName || x.Name || x.TagName)\r\n        .filter(Boolean);\r\n    }\r\n\r\n    return Array.isArray(names) ? names : [];\r\n  }\r\n\r\n  //  Pagination + filter setup\r\n  const pageSize = 8;\r\n  let currentPage = 1;\r\n  let filtered = allSummaryTags;\r\n\r\n  function getTotalPages() {\r\n    return Math.max(1, Math.ceil(filtered.length / pageSize));\r\n  }\r\n\r\n  function slicePage() {\r\n    const start = (currentPage - 1) * pageSize;\r\n    return filtered.slice(start, start + pageSize);\r\n  }\r\n\r\n  function renderRows() {\r\n    list.replaceChildren();\r\n\r\n    const pageItems = slicePage();\r\n\r\n    if (pageItems.length === 0) {\r\n      if (isSummaryLoading) {\r\n        list.innerHTML = `<div class=\"d-flex justify-content-center align-items-center p-5\"><div class=\"loader\"></div></div>`;\r\n      } else {\r\n        list.innerHTML = `<div class=\"p-3 text-muted\">No tags found</div>`;\r\n      }\r\n      return;\r\n    }\r\n\r\n    pageItems.forEach(tag => {\r\n      const row = document.createElement('button');\r\n      row.type = 'button';\r\n\r\n      const isActive = currentSummaryStatus === 2;\r\n      const themeClasses = store.theme === 'Dark'\r\n        ? `bg-dark text-light ${isActive ? 'list-hover-dark' : 'opacity-50'}`\r\n        : `bg-light text-dark ${isActive ? 'list-hover-light' : 'opacity-50'}`;\r\n\r\n      row.className =\r\n        `list-group-item list-group-item-action d-flex justify-content-between align-items-center ${themeClasses}`;\r\n\r\n      if (!isActive) {\r\n        row.disabled = true;\r\n        row.style.cursor = 'not-allowed';\r\n      }\r\n\r\n      const tagStatus = (tag.Status === undefined || tag.Status === null) ? \"1\" : String(tag.Status);\r\n\r\n      let statusIcon = \"\";\r\n      if (tagStatus === \"0\") {\r\n        statusIcon = `<i class=\"fa fa-spinner fa-spin text-muted\"></i>`;\r\n      } else if (tagStatus === \"2\") {\r\n        statusIcon = `<i class=\"fa-solid fa-circle-info text-warning c-pointer\" id=\"reprocess-${tag.ID || tag.ReportHeadSummaryTagID}\" title=\"Click to Reprocess\"></i>`;\r\n      } else {\r\n        // Default or status 1\r\n        statusIcon = `<i class=\"fa-solid fa-circle-check light-navy-blue\"></i>`;\r\n      }\r\n\r\n      row.innerHTML = `\r\n        <div class=\"text-truncate pe-2\">${tag.Name}</div>\r\n        <div class=\"d-flex align-items-center gap-3\">\r\n          ${statusIcon}\r\n          <i class=\"fa-solid fa-angles-right text-muted\"></i>\r\n        </div>\r\n      `;\r\n\r\n      if (isActive) {\r\n        row.onclick = async () => {\r\n          try {\r\n            const appBody = document.getElementById('app-body');\r\n            appBody.innerHTML = `\r\n            <div id=\"button-container\">\r\n              <div class=\"loader\" id=\"loader\"></div>\r\n            </div>\r\n          `;\r\n            const html = await generateCheckboxHistory(tag, \"Summary\");\r\n            appBody.innerHTML = html;\r\n          } catch {\r\n            document.getElementById('app-body').innerHTML =\r\n              '<div class=\"text-danger p-2\">Error loading data</div>';\r\n          }\r\n        };\r\n      }\r\n\r\n      list.appendChild(row);\r\n\r\n      if (tagStatus === \"2\") {\r\n        const infoBtn = row.querySelector(`#reprocess-${tag.ID || tag.ReportHeadSummaryTagID}`);\r\n        if (infoBtn) {\r\n          infoBtn.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            reprocessTag(tag);\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  function renderPager() {\r\n    const totalPages = getTotalPages();\r\n    currentPage = Math.min(Math.max(1, currentPage), totalPages);\r\n\r\n    const startItem = filtered.length === 0 ? 0 : (currentPage - 1) * pageSize + 1;\r\n    const endItem = Math.min(currentPage * pageSize, filtered.length);\r\n    pageCountLabel.textContent = `${startItem} - ${endItem} of ${filtered.length} items`;\r\n\r\n    btnFirst.toggleAttribute('disabled', currentPage === 1);\r\n    btnPrev.toggleAttribute('disabled', currentPage === 1);\r\n    btnNext.toggleAttribute('disabled', currentPage === totalPages);\r\n    btnLast.toggleAttribute('disabled', currentPage === totalPages);\r\n\r\n    pageButtons.replaceChildren();\r\n\r\n    const maxButtons = 5;\r\n    let start = Math.max(1, currentPage - Math.floor(maxButtons / 2));\r\n    let end = Math.min(totalPages, start + maxButtons - 1);\r\n    start = Math.max(1, end - maxButtons + 1);\r\n\r\n    for (let p = start; p <= end; p++) {\r\n      const b = document.createElement('button');\r\n      b.className = `btn ${p === currentPage ? 'btn-primary' : 'btn-outline-secondary'}`;\r\n      b.textContent = String(p);\r\n      b.onclick = () => {\r\n        currentPage = p;\r\n        renderAll();\r\n      };\r\n      pageButtons.appendChild(b);\r\n    }\r\n  }\r\n\r\n  function renderAll() {\r\n    renderRows();\r\n    renderPager();\r\n  }\r\n\r\n  function applySearch() {\r\n    const term = searchBox.value.trim().toLowerCase();\r\n    filtered = term\r\n      ? allSummaryTags.filter(t => (t.Name || '').toLowerCase().includes(term))\r\n      : allSummaryTags;\r\n\r\n    currentPage = 1;\r\n    renderAll();\r\n  }\r\n\r\n  let debounceTimeout: any;\r\n  searchBox.addEventListener('input', () => {\r\n    clearTimeout(debounceTimeout);\r\n    debounceTimeout = setTimeout(applySearch, 250);\r\n  });\r\n\r\n  btnFirst.addEventListener('click', () => { currentPage = 1; renderAll(); });\r\n  btnPrev.addEventListener('click', () => { currentPage = Math.max(1, currentPage - 1); renderAll(); });\r\n  btnNext.addEventListener('click', () => { currentPage = Math.min(getTotalPages(), currentPage + 1); renderAll(); });\r\n  btnLast.addEventListener('click', () => { currentPage = getTotalPages(); renderAll(); });\r\n\r\n  //  Action button wiring\r\n  addBtn?.addEventListener('click', () => {\r\n    if (!isSummaryLoading) addGenAITags();\r\n  });\r\n\r\n  // --------------------------\r\n  //  NEW FLOW: First call GET tags API and read SummaryTagGenerated from it\r\n  // --------------------------\r\n  let hasActivated = false;\r\n  function deduplicateSummarySources(sources: any[]) {\r\n    const map = new Map();\r\n    sources.forEach(source => {\r\n      const key = source.FileName;\r\n      if (!map.has(key)) {\r\n        map.set(key, source);\r\n      } else {\r\n        const existing = map.get(key);\r\n        if (String(existing.Status) !== \"1\" && String(source.Status) === \"1\") {\r\n          map.set(key, source);\r\n        }\r\n      }\r\n    });\r\n    return Array.from(map.values());\r\n  }\r\n\r\n  async function firstLoadAndRender() {\r\n    isSummaryLoading = true;\r\n    disableActionButtons(true);\r\n\r\n    try {\r\n      setReanalyzeButtonState(false);\r\n\r\n      //  1) FIRST call GET tags API\r\n      const getRes = await getSummaryTagsByReportHeadId(store.documentID, store.jwt);\r\n\r\n      //  2) check Data.SummaryTagGenerated from GET API response\r\n      currentSummaryStatus = getRes?.Data?.SummaryTagGenerated;\r\n\r\n      //  3) Render tags immediately (no loader/table hide logic)\r\n      allSummaryTags = getRes?.Data?.SummaryTags || [];\r\n      store.sourceSummaryList = deduplicateSummarySources(getRes?.Data?.SummarySources || []);\r\n      filtered = allSummaryTags;\r\n      renderAll();\r\n\r\n      const summaryStatus = currentSummaryStatus;\r\n\r\n      if (summaryStatus === 2) {\r\n        setReanalyzeButtonState(true);\r\n\r\n        if (allSummaryTags && allSummaryTags.length > 0) {\r\n          summarySelectedNames = normalizeNames(allSummaryTags);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // status 0 -> activate once, then poll until 2\r\n      if (summaryStatus === 0) {\r\n        if (!hasActivated) {\r\n          hasActivated = true;\r\n\r\n          const base64Data = await getWordAsBase64();\r\n          const payload = {\r\n            ReportHeadID: store.documentID,\r\n            ActiveDocument: base64Data\r\n          };\r\n\r\n          await activateSummaryMode(payload, store.jwt);\r\n        }\r\n\r\n        await pollSummaryUntilDone();\r\n      }\r\n\r\n      // status 1 -> poll until 2\r\n      if (summaryStatus === 1) {\r\n        await pollSummaryUntilDone();\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error(\"Summary load failed:\", err);\r\n      if (list) list.innerHTML = `<div class=\"p-3 text-danger\">Failed to load Summary mode</div>`;\r\n    } finally {\r\n      isSummaryLoading = false;\r\n      disableActionButtons(false);\r\n    }\r\n  }\r\n\r\n  //  Reprocess a single tag\r\n  async function reprocessTag(tag: any) {\r\n    try {\r\n      tag.Status = \"0\"; // Show spinner immediately\r\n      renderAll();\r\n\r\n      const jwt = store.jwt;\r\n      const historyRes = await getSummaryTagHistory(tag.ID || tag.ReportHeadSummaryTagID, jwt);\r\n      const history = historyRes?.Data || [];\r\n\r\n      if (history.length === 0) {\r\n        toaster(\"No history found to reprocess\", \"error\");\r\n        tag.Status = \"2\";\r\n        renderAll();\r\n        return;\r\n      }\r\n\r\n      // Latest history is usually index 0 after unshift, but let's check or just take first in raw list\r\n      const lastHistory = history[0];\r\n      debugger\r\n      const payload = {\r\n        ReportHeadID: Number(store.documentID),\r\n        ReportHeadSummaryTagID: tag.ID || tag.ReportHeadSummaryTagID,\r\n        Prompt: lastHistory.Prompt,\r\n        Response: \"\",\r\n        Selected: 1,\r\n        SourceVector: lastHistory.SourceVector ? lastHistory.SourceVector : '',\r\n        Name: tag.Name\r\n      };\r\n\r\n      await addSummaryHistory(payload, jwt);\r\n\r\n      // Start polling if not already running (status 1)\r\n      if (currentSummaryStatus !== 1) {\r\n        currentSummaryStatus = 1;\r\n        pollSummaryUntilDone();\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error(\"Reprocess failed:\", err);\r\n      toaster(\"Reprocess failed\", \"error\");\r\n      tag.Status = \"2\";\r\n      renderAll();\r\n    }\r\n  }\r\n\r\n  //  Ping API every 10 sec until status becomes 2 and all tags processed\r\n  async function pollSummaryUntilDone() {\r\n    while (instanceId === currentSummaryInstance) {\r\n      const statusRes = await getSummaryTagStatus(store.documentID, store.jwt);\r\n      const data = statusRes?.Data;\r\n      const status = data?.SummaryTagGenerated;\r\n      const tagStatuses = data?.SummaryTagStatus || [];\r\n\r\n      currentSummaryStatus = status;\r\n\r\n      // Update individual tag statuses in our local list if they exist in the response\r\n      if (tagStatuses && tagStatuses.length > 0) {\r\n        tagStatuses.forEach((ts: any) => {\r\n          const matchingTag = allSummaryTags.find(t => (t.ReportHeadSummaryTagID || t.ID) === ts.ReportHeadSummaryTagID);\r\n          if (matchingTag) {\r\n            matchingTag.Status = ts.Status;\r\n          }\r\n        });\r\n        renderAll();\r\n      }\r\n\r\n      // Check if all tags are processed (status != \"0\")\r\n      // We consider it done only if status is 2 and there are no tags with Status \"0\"\r\n      const allTagsProcessed = tagStatuses.length > 0 ? tagStatuses.every((t: any) => String(t.Status) !== \"0\") : true;\r\n\r\n      if (status === 2 && allTagsProcessed) {\r\n        setReanalyzeButtonState(true);\r\n\r\n        // after done -> fetch tags again and render\r\n        const getRes2 = await getSummaryTagsByReportHeadId(store.documentID, store.jwt);\r\n        allSummaryTags = getRes2?.Data?.SummaryTags || [];\r\n        filtered = allSummaryTags;\r\n\r\n        if (allSummaryTags && allSummaryTags.length > 0) {\r\n          summarySelectedNames = normalizeNames(allSummaryTags);\r\n        }\r\n\r\n        renderAll();\r\n        break;\r\n      }\r\n\r\n      await new Promise(r => setTimeout(r, 10000));\r\n    }\r\n  }\r\n\r\n  //  Reanalyze wiring (same logic but triggers refresh + poll)\r\n  reanalyzeBtn?.addEventListener('click', async () => {\r\n    if (isSummaryLoading || reanalyzeBtn.classList.contains(\"disabled\")) return;\r\n\r\n    const popupContainer = document.getElementById(\"confirmation-popup\");\r\n    if (!popupContainer) return;\r\n\r\n    popupContainer.innerHTML = Confirmationpopup(\"Do you want to refresh all summary tags of the draft?\");\r\n\r\n    // Change button labels to No/Yes as requested\r\n    const cancelBtn = document.getElementById(\"confirmation-popup-cancel\");\r\n    const confirmBtn = document.getElementById(\"confirmation-popup-confirm\");\r\n\r\n    if (cancelBtn) cancelBtn.innerText = \"No\";\r\n    if (confirmBtn) confirmBtn.innerText = \"Yes\";\r\n\r\n    const handleAction = async (refresh: boolean) => {\r\n      popupContainer.innerHTML = \"\"; // Close popup\r\n      try {\r\n        setReanalyzeButtonState(false);\r\n        disableActionButtons(true);\r\n        isSummaryLoading = true;\r\n        currentSummaryStatus = 1;\r\n\r\n        // Start individual tag spinners immediately\r\n        allSummaryTags.forEach(t => t.Status = \"0\");\r\n        renderRows();\r\n\r\n        const base64Data = await getWordAsBase64();\r\n        const payload = {\r\n          ReportHeadID: Number(store.documentID),\r\n          RefreshSummaryTag: refresh,\r\n          ActiveDocument: base64Data\r\n        };\r\n\r\n        const res = await refreshSummaryMode(payload, store.jwt);\r\n\r\n        // Immediately update state and UI from response\r\n        if (res?.Data) {\r\n          allSummaryTags = res.Data.SummaryTags || [];\r\n          store.sourceSummaryList = deduplicateSummarySources(res.Data.SummarySources || []);\r\n          currentSummaryStatus = res.Data.SummaryTagGenerated;\r\n          filtered = allSummaryTags;\r\n\r\n          if (allSummaryTags && allSummaryTags.length > 0) {\r\n            summarySelectedNames = normalizeNames(allSummaryTags);\r\n          }\r\n\r\n          renderAll();\r\n        }\r\n\r\n        // poll again until done\r\n        await pollSummaryUntilDone();\r\n\r\n      } catch (err) {\r\n        console.error(\"Refresh failed:\", err);\r\n        setReanalyzeButtonState(true);\r\n      }\r\n    };\r\n\r\n    document.getElementById(\"confirmation-popup-confirm\")?.addEventListener(\"click\", () => handleAction(true));\r\n    document.getElementById(\"confirmation-popup-cancel\")?.addEventListener(\"click\", () => handleAction(false));\r\n  });\r\n\r\n  //  Final: run new logic\r\n  await firstLoadAndRender();\r\n}\r\n\r\n// ------------------ Base64 utils (unchanged) ------------------\r\n\r\nexport function getWordAsBase64(): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    Office.context.document.getFileAsync(\r\n      Office.FileType.Compressed,\r\n      { sliceSize: 1024 * 1024 },\r\n      result => {\r\n        if (result.status !== Office.AsyncResultStatus.Succeeded) {\r\n          reject(result.error);\r\n          return;\r\n        }\r\n\r\n        const file = result.value;\r\n        const slices: string[] = [];\r\n        let index = 0;\r\n\r\n        const getSlice = () => {\r\n          file.getSliceAsync(index, slice => {\r\n            if (slice.status !== Office.AsyncResultStatus.Succeeded) {\r\n              file.closeAsync();\r\n              reject(slice.error);\r\n              return;\r\n            }\r\n\r\n            const data = slice.value.data;\r\n\r\n            if (typeof data === \"string\") {\r\n              slices.push(data);\r\n            } else {\r\n              const bytes = new Uint8Array(data);\r\n              slices.push(uint8ToBase64(bytes));\r\n            }\r\n\r\n            index++;\r\n\r\n            if (index < file.sliceCount) {\r\n              getSlice();\r\n            } else {\r\n              file.closeAsync();\r\n              resolve(slices.join(\"\"));\r\n            }\r\n          });\r\n        };\r\n\r\n        getSlice();\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction uint8ToBase64(bytes: Uint8Array): string {\r\n  let binary = '';\r\n  const len = bytes.byteLength;\r\n  for (let i = 0; i < len; i++) {\r\n    binary += String.fromCharCode(bytes[i]);\r\n  }\r\n  return window.btoa(binary);\r\n}\r\n","import { removeQuotes } from \"../draft/draft-functions\";\r\nimport { getSummaryTagHistory } from \"../summary/summary.api\";\r\nimport { StoreService } from \"./store.service\";\r\n\r\nexport class summaryService {\r\n\r\n    static async fetchSummaryAIHistory(tag: any): Promise<any[]> {\r\n        const store = StoreService.getInstance();\r\n        try {\r\n            const data = await getSummaryTagHistory(tag.ID, store.jwt);\r\n\r\n            if (data.Status && data.Data) {\r\n                tag.ReportHeadAIHistoryList = data['Data'] || [];\r\n                tag.FilteredReportHeadAIHistoryList = [];\r\n                tag.SourceValueID = tag.ReportHeadAIHistoryList[0].SourceValue;\r\n                const selectedSources = store.sourceSummaryList.filter((list: any) =>\r\n                    tag.SourceVector.includes(String(list.VectorID))\r\n                );\r\n                tag.SourceName = selectedSources.map((item: any) => {\r\n                    return item.SourceName;\r\n                }\r\n                );\r\n                tag.Sources = tag.SourceName.join(',');\r\n                tag.TempSourceValue = selectedSources.map((item: any) => {\r\n                    return item.VectorID ? String(item.VectorID) : item.SourceValue;\r\n                }\r\n\r\n                );\r\n\r\n                tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                    historyList.Response = removeQuotes(historyList.Response);\r\n                    tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                }\r\n\r\n                );\r\n                return tag.FilteredReportHeadAIHistoryList;\r\n            } else {\r\n                console.warn(\"No Summary AI history available.\");\r\n\r\n                return [];\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching Summary AI history:', error);\r\n            return [];\r\n        }\r\n    }\r\n}\r\n","import { getPromptTemplateById, updateGroupKey, updateAiHistory, updatePromptTemplate } from \"./draft.api\";\r\nimport { chatfooter, copyText, generateChatHistoryHtml, insertLineWithHeadingStyle, removeQuotes, switchToAddTag, updateEditorFinalTable, colorTable, svgBase64ToPngBase64, resolveWordTableStyle, renderSelectedTags } from \"./draft-functions\";\r\nimport { addGenAITags, applyTagFn, createMultiSelectDropdown, customizeTable, mentionDropdownFn } from \"../taskpane\";\r\nimport { StoreService } from \"../services/store.service\";\r\nimport { AIService } from \"../services/ai.service\";\r\nimport { Confirmationpopup, DataModalPopup, toaster } from \"../components/bodyelements\";\r\nimport { loadSummarypage } from \"../summary/summary\";\r\nimport { summaryService } from \"../services/summary.service\";\r\nimport { updateSummaryHistory, updateSummaryTagPrompt } from \"../summary/summary.api\";\r\n\r\nlet preview = '';\r\n\r\n\r\nexport function loadHomepage(availableKeys) {\r\n    const store = StoreService.getInstance();\r\n    const searchBoxClass = store.theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-3\">\r\n        <div class=\"d-flex justify-content-end px-2\">\r\n            <div class=\"dropdown\">\r\n                <button class=\"btn btn-default dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                    Action\r\n                </button>\r\n                <ul class=\"dropdown-menu\">\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"add-btn-tag\">\r\n                            <i class=\"fa fa-plus me-2\" aria-hidden=\"true\"></i> Add\r\n                        </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"apply-btn-tag\">\r\n                            <i class=\"fa-solid fa-circle-check me-2\"></i> Apply\r\n                        </a>\r\n                    </li>\r\n\r\n                     <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"predefined-table\">\r\n                            <i class=\"fa fa-table me-2\" aria-hidden=\"true\"></i> Default Tables\r\n                        </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"customized-table\">\r\n                            <i class=\"fa fa-brush me-2\" aria-hidden=\"true\"></i> Customized Tables\r\n                        </a>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"form-group px-2 pt-2\">\r\n            <input type=\"text\" id=\"search-box\" class=\"form-control ${searchBoxClass}\" placeholder=\"Search Tags...\" autocomplete=\"off\" />\r\n        </div>\r\n\r\n        <ul id=\"suggestion-list\" class=\"list-group mt-2 px-2\"></ul>\r\n        \r\n        <div id=\"tags-in-selected-text\" class=\"mt-2 px-2 selected-text-box d-none\">\r\n            <label class=\"form-label mb-2 fw-bold\">Tags in Selected Text</label>\r\n            <div class=\"tag-panel d-flex flex-wrap gap-2\" id=\"tag-badge-wrapper\"></div>\r\n        </div>\r\n    </div>`;\r\n\r\n    const searchBox = document.getElementById('search-box') as HTMLInputElement;\r\n    const suggestionList = document.getElementById('suggestion-list');\r\n\r\n    function updateSuggestions() {\r\n        const searchTerm = searchBox.value.trim().toLowerCase();\r\n        suggestionList.replaceChildren();\r\n\r\n        if (searchTerm === '') {\r\n            suggestionList.innerHTML = '';\r\n            return;\r\n        }\r\n\r\n        const filteredMentions = availableKeys.filter(m =>\r\n            m.DisplayName.toLowerCase().includes(searchTerm)\r\n        );\r\n\r\n        // Split groups\r\n        const nonAITags = filteredMentions.filter(m => m.AIFlag === 0);\r\n        const aiTags = filteredMentions.filter(m => m.AIFlag === 1);\r\n\r\n        // Further split non-AI tags into: TEXT + IMAGE\r\n        const propertiesTags = nonAITags.filter(m => m.ComponentKeyDataType === \"TEXT\" || m.ComponentKeyDataType === \"TABLE\");\r\n        const imageTags = nonAITags.filter(m => m.ComponentKeyDataType === \"IMAGE\" && m.IsImage);\r\n\r\n        const createSection = (labelText, mentions, isAISection = false, isImageSection = false) => {\r\n            if (mentions.length === 0) return;\r\n\r\n            const themeClasses = store.theme === 'Dark'\r\n                ? { itemClass: 'bg-dark text-light list-hover-dark', labelClass: 'bg-dark text-light' }\r\n                : { itemClass: 'bg-light text-dark list-hover-light', labelClass: 'bg-light text-dark' };\r\n\r\n            const label = document.createElement('li');\r\n            label.className = `list-group-item fw-bold text-secondary ${themeClasses.labelClass}`;\r\n            label.textContent = labelText;\r\n            suggestionList.appendChild(label);\r\n\r\n            mentions.forEach(mention => {\r\n                const listItem = document.createElement('li');\r\n                listItem.className = `list-group-item list-group-item-action ${themeClasses.itemClass}`;\r\n\r\n                // ICON LOGIC\r\n                let icon = `<i class=\"fa-solid fa-layer-group text-muted me-2\"></i>`; // default (TEXT)\r\n                if (isAISection) icon = `<i class=\"fa-solid fa-microchip-ai text-muted me-2\"></i>`;\r\n                if (isImageSection) icon = `<i class=\"fa-solid fa-image text-muted me-2\"></i>`;\r\n\r\n                listItem.innerHTML = `${icon} ${mention.DisplayName}`;\r\n\r\n                listItem.onclick = () => {\r\n                    if (isAISection) {\r\n                        const appBody = document.getElementById('app-body');\r\n                        appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n                        generateCheckboxHistory(mention, \"AITag\")\r\n                            .catch(() => appBody.innerHTML = '<div class=\"text-danger p-2\">Error loading data</div>')\r\n                            .then(html => { appBody.innerHTML = html; });\r\n                    } else {\r\n                        // Properties + Images behave same\r\n                        replaceMention(mention, mention.ComponentKeyDataType);\r\n                        suggestionList.replaceChildren();\r\n                    }\r\n                };\r\n\r\n                suggestionList.appendChild(listItem);\r\n            });\r\n        };\r\n\r\n        // Render in desired order\r\n        createSection('Properties', propertiesTags);\r\n        createSection('AI Tags', aiTags, true);\r\n        createSection('Images', imageTags, false, true);\r\n    }\r\n\r\n    if (store.selectedNames.length > 0) {\r\n        const badgeWrapper = document.getElementById('tags-in-selected-text');\r\n        badgeWrapper.classList.remove('d-none');\r\n        badgeWrapper.classList.add('d-block');\r\n        renderSelectedTags(store.selectedNames, availableKeys);\r\n    }\r\n\r\n    // Add input event listener to the search box\r\n    let debounceTimeout;\r\n    searchBox.addEventListener('input', () => {\r\n        clearTimeout(debounceTimeout);\r\n        debounceTimeout = setTimeout(updateSuggestions, 300); // Delay input handling by 300ms\r\n    });\r\n\r\n    document.getElementById('add-btn-tag').addEventListener('click', () => {\r\n        if (!store.isPendingResponse) {\r\n            addGenAITags();\r\n        }\r\n    });\r\n\r\n    document.getElementById('customized-table').addEventListener('click', () => {\r\n        if (!store.isPendingResponse) {\r\n            customizeTable('Custom');\r\n        }\r\n    })\r\n\r\n    document.getElementById('predefined-table').addEventListener('click', () => {\r\n        if (!store.isPendingResponse) {\r\n            customizeTable('Pre');\r\n        }\r\n    })\r\n\r\n    document.getElementById('apply-btn-tag').addEventListener('click', () => {\r\n        if (!store.isPendingResponse) {\r\n            applyTagFn();\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) {\r\n                throw new Error('Selection is invalid or not found.');\r\n            }\r\n\r\n            let newSelection = selection;\r\n\r\n            if (type === 'TABLE') {\r\n                const parser = new DOMParser();\r\n                const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n                const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                await context.sync();\r\n\r\n                for (const node of bodyNodes) {\r\n                    if (node.nodeType === Node.TEXT_NODE) {\r\n                        let textContent = node.textContent?.trim();\r\n                        if (textContent) {\r\n                            textContent = textContent.replace(/\\n- /g, \"\\n \");\r\n\r\n                            textContent.split('\\n').forEach(line => {\r\n                                if (line.trim()) {\r\n                                    insertLineWithHeadingStyle(selection, line);\r\n                                }\r\n                            });\r\n                        }\r\n                    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        const element = node as HTMLElement;\r\n\r\n                        if (element.tagName.toLowerCase() === 'table') {\r\n                            const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                            if (rows.length === 0) {\r\n                                selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                                continue;\r\n                            }\r\n\r\n                            const maxCols = Math.max(...rows.map(row => {\r\n                                return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                                }, 0);\r\n                            }));\r\n\r\n                            const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                            await context.sync();\r\n\r\n                            const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                            const store = StoreService.getInstance();\r\n                            const resolvedTableStyle = resolveWordTableStyle(store.tableStyle);\r\n                            if (resolvedTableStyle !== 'none') {\r\n                                table.style = resolvedTableStyle;\r\n                            }  // Apply built-in Word table style\r\n\r\n                            await context.sync();\r\n                            if (store.colorPallete.Customize) {\r\n                                await colorTable(table, rows, context);\r\n                            }\r\n                            else {\r\n                                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n                                let lastParamRowIndex = -1; // row index of last non-empty Parameter cell\r\n\r\n                                rows.forEach((row, rowIndex) => {\r\n                                    const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                    let cellIndex = 0;\r\n\r\n                                    // track first column text in HTML row\r\n                                    let firstColText = \"\";\r\n\r\n                                    cells.forEach((cell) => {\r\n                                        while (rowspanTracker[cellIndex] > 0) {\r\n                                            rowspanTracker[cellIndex]--;\r\n                                            cellIndex++;\r\n                                        }\r\n\r\n                                        const cellText = Array.from(cell.childNodes)\r\n                                            .map(node => {\r\n                                                if (node.nodeType === Node.TEXT_NODE) {\r\n                                                    return node.textContent?.trim() || '';\r\n                                                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                    return (node as HTMLElement).innerText.trim();\r\n                                                }\r\n                                                return '';\r\n                                            })\r\n                                            .filter(text => text.length > 0)\r\n                                            .join(' ');\r\n\r\n                                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                                        // save first column text if this is first column\r\n                                        if (cellIndex === 0) {\r\n                                            firstColText = cellText.trim();\r\n                                        }\r\n\r\n                                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                        // colspan blank filling\r\n                                        for (let i = 1; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                            }\r\n                                        }\r\n\r\n                                        // rowspan tracking\r\n                                        if (rowspan > 1) {\r\n                                            for (let i = 0; i < colspan; i++) {\r\n                                                if (cellIndex + i < maxCols) {\r\n                                                    rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        cellIndex += colspan;\r\n                                    });\r\n\r\n                                    //  AFTER filling the row  apply merge logic for 1st column\r\n                                    if (rowIndex === 0) {\r\n                                        // header row typically\r\n                                        return;\r\n                                    }\r\n\r\n                                    if (firstColText) {\r\n                                        // new parameter starts\r\n                                        lastParamRowIndex = rowIndex;\r\n                                    } else {\r\n                                        // empty parameter row  merge vertically with previous parameter row\r\n                                        if (lastParamRowIndex !== -1) {\r\n                                            const topCell = table.getCell(lastParamRowIndex, 0);\r\n                                            const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n                                            // merge bottom into top\r\n                                            topCell.merge(bottomCell);\r\n\r\n                                            //  center align merged cell\r\n                                            try {\r\n                                                topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n                                                topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n                                            } catch (e) {\r\n                                                // ignore (safe fallback)\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                });\r\n\r\n                            }\r\n\r\n                            newSelection = table.getCell(0, 0); // Set the cursor to the start of the table\r\n                        } else {\r\n                            let elementText = element.innerText.trim();\r\n                            if (elementText) {\r\n                                elementText = elementText.replace(/\\n- /g, \"\\n \");\r\n\r\n                                elementText.split('\\n').forEach(line => {\r\n                                    if (line.trim()) {\r\n                                        insertLineWithHeadingStyle(selection, line);\r\n                                    }\r\n                                });\r\n                            }\r\n                            newSelection = selection; // If it's not a table, just use the existing selection.\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (type === \"IMAGE\") {\r\n                let base64Image: string = word.EditorValue;\r\n\r\n                if (base64Image.startsWith(\"data:image/svg+xml\")) {\r\n                    // Convert SVG  PNG\r\n                    base64Image = await svgBase64ToPngBase64(base64Image);\r\n                } else if (base64Image.startsWith(\"data:image\")) {\r\n                    base64Image = base64Image.split(\",\")[1]; // strip prefix\r\n                }\r\n\r\n                selection.insertInlinePictureFromBase64(base64Image, Word.InsertLocation.replace);\r\n                newSelection = selection;\r\n            } else {\r\n                if (word.EditorValue === '' || word.IsApplied) {\r\n                    selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n                } else {\r\n                    let content = removeQuotes(word.EditorValue);\r\n                    let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n                    lines.forEach(line => {\r\n                        selection.insertParagraph(line, Word.InsertLocation.before);\r\n                    });\r\n                }\r\n                newSelection = selection; // After inserting the text, set selection to it.\r\n            }\r\n\r\n            // Move the cursor to the next line after content insertion\r\n            const nextLineParagraph = selection.insertParagraph(\"\", Word.InsertLocation.after);\r\n            await context.sync();\r\n\r\n            // Set the new cursor position after content\r\n            newSelection = nextLineParagraph;\r\n            selection.select(); // Select the new paragraph where the cursor will be\r\n            await context.sync();\r\n\r\n        } catch (error) {\r\n            console.error('Detailed error:', error);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport async function openAITag(tag) {\r\n    tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n    });\r\n\r\n\r\n}\r\n\r\nexport async function generateCheckboxHistory(tag, type: \"Summary\" | \"AITag\") {\r\n    var skipFetch = false;\r\n    if ((!tag.FilteredReportHeadAIHistoryList || tag.FilteredReportHeadAIHistoryList.length === 0) && !skipFetch) {\r\n        if (type !== 'Summary') {\r\n            await AIService.fetchAIHistory(tag);\r\n        } else {\r\n            await summaryService.fetchSummaryAIHistory(tag);\r\n        }\r\n    }\r\n\r\n    const history = tag.FilteredReportHeadAIHistoryList;\r\n\r\n    if (history.length === 0) {\r\n        return '<div>No AI history available.</div>';\r\n    }\r\n\r\n    // Check current theme\r\n    const store = StoreService.getInstance();\r\n    const isDark = store.theme === 'Dark';\r\n    const closeBtnClass = isDark\r\n        ? 'fa-solid fa-circle-xmark bg-dark text-light'\r\n        : 'fa-solid fa-circle-xmark bg-light text-dark';\r\n\r\n    const headerBgClass = isDark ? 'bg-dark text-light' : 'bg-white text-dark';\r\n    const DisplayName = type === 'Summary' ? tag.Name : tag.DisplayName;\r\n    const closeBar = `\r\n    <div class=\"chat-header sticky-top ${headerBgClass} z-3\">\r\n        <div class=\"d-flex justify-content-between align-items-center px-2 pt-3\">\r\n            <div class=\"d-flex align-items-center ms-3\">\r\n                <i class=\"fa fa-microchip-ai text-muted me-2\"></i>\r\n                <span class=\"fw-bold\">${DisplayName}</span>\r\n            </div>\r\n            <div class=\"d-flex justify-content-center align-items-center me-3 c-pointer\" id=\"close-btn-tag\">\r\n                <i class=\"${closeBtnClass}\" id=\"close-ai-window\"></i>\r\n            </div>\r\n        </div>\r\n        <hr class=\"mt-2 mb-1 mx-3\">\r\n        </div>\r\n    `;\r\n\r\n    const chatBody = `\r\n        <div class=\"chat-body flex-grow-1 overflow-auto\">\r\n            ${generateChatHistoryHtml(history)}\r\n        </div>\r\n    `;\r\n\r\n    const chatFooterHtml = `\r\n        <div class=\"d-flex align-items-end justify-content-end chatbox p-2\" id=\"chatFooter\">\r\n            ${chatfooter(tag)}\r\n        </div>\r\n    `;\r\n\r\n    initializeAIHistoryEvents(tag, store.jwt, store.availableKeys, type);\r\n\r\n    return `${closeBar}${chatBody}${chatFooterHtml}`;\r\n}\r\n\r\n\r\n\r\n\r\nexport async function setupPromptBuilderUI(container, promptBuilderList) {\r\n\r\n    // Static template and field definitions\r\n    let preview = '';\r\n    let templateText = '';\r\n\r\n    // Field configs (can be extended)\r\n    let fieldsList = [];\r\n\r\n    // Create the form container\r\n    // Create the form container\r\n    container.innerHTML = `\r\n  <div class=\"form-group mb-3 p-3 pt-0\">\r\n    <label class='form-label'><span class=\"text-danger\">*</span> Prompt Builder Template</label>\r\n    <select id=\"promptBuilderTemplate\" class=\"form-control\">\r\n      <option value=\"\" disabled selected>Select a template</option>\r\n    </select>\r\n    <div id=\"templateError\" class=\"invalid-feedback d-none\">Type is required.</div>\r\n  </div>\r\n\r\n  <div id=\"fieldsContainer\"></div>\r\n\r\n  <div class=\"form-group mb-3 p-3 pt-0\" id=\"previewContainer\" style=\"display: none;\">\r\n    <label class=\"mb-2\">Preview</label>\r\n    <div id=\"preview\" class=\"form-control\"></div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-between px-3 align-items-center mt-3\">\r\n    <span id=\"resetBtn\" class=\"text-primary fw-bold\" style=\"cursor: pointer;\">Reset</span>\r\n    <button id=\"applyBtn\" class=\"btn btn-primary text-white\" disabled>Apply Prompt</button>\r\n  </div>\r\n`;\r\n\r\n    // Element references\r\n    const templateSelect = container.querySelector('#promptBuilderTemplate') as HTMLSelectElement;\r\n    const applyBtn = container.querySelector('#applyBtn') as HTMLButtonElement;\r\n    const resetBtn = container.querySelector('#resetBtn') as HTMLSpanElement;\r\n    const previewDiv = container.querySelector('#preview') as HTMLDivElement;\r\n    const fieldsContainer = container.querySelector('#fieldsContainer') as HTMLDivElement;\r\n    const previewContainer = container.querySelector('#previewContainer') as HTMLDivElement;\r\n    const templateError = container.querySelector('#templateError') as HTMLDivElement;\r\n\r\n    // Populate template dropdown\r\n    promptBuilderList.forEach((item) => {\r\n        const option = document.createElement('option');\r\n        option.value = item.ID.toString();\r\n        option.textContent = item.Name;\r\n        templateSelect.appendChild(option);\r\n    });\r\n\r\n    templateSelect.addEventListener('change', async () => {\r\n        const templateId = templateSelect.value;\r\n        const jwt = sessionStorage.getItem('token') || '';\r\n\r\n        const data = await getPromptTemplateById(templateId, jwt);\r\n        if (data.Status && data.Data) {\r\n            fieldsList = data.Data;\r\n            preview = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n\r\n            templateText = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n        }\r\n        if (!templateId) {\r\n            templateError.classList.remove('d-none');\r\n            return;\r\n        }\r\n\r\n        templateError.classList.add('d-none');\r\n\r\n        renderFields();\r\n        updatePreview();\r\n    });\r\n\r\n    function renderFields() {\r\n        fieldsContainer.innerHTML = '';\r\n\r\n        fieldsList.forEach((field) => {\r\n            const div = document.createElement('div');\r\n            div.className = 'form-group mb-3 p-3 pt-0';\r\n\r\n            const label = document.createElement('label');\r\n            label.textContent = field.Label;\r\n            div.appendChild(label);\r\n\r\n            if (field.Type === 1) {\r\n                const input = document.createElement('input');\r\n                input.type = 'text';\r\n                input.className = 'form-control';\r\n                input.id = field.Label;\r\n                input.addEventListener('input', replaceKeywordsManually);\r\n                div.appendChild(input);\r\n            } else if (field.Type === 2) {\r\n                const select = document.createElement('select');\r\n                select.className = 'form-control';\r\n                select.id = field.Label;\r\n                field.PromptTemplateOptionList.forEach((opt: any) => {\r\n                    const option = document.createElement('option');\r\n                    option.value = opt.Text;\r\n                    option.textContent = opt.Option;\r\n                    select.appendChild(option);\r\n                });\r\n                select.addEventListener('change', replaceKeywordsManually);\r\n                div.appendChild(select);\r\n            }\r\n\r\n            fieldsContainer.appendChild(div);\r\n        });\r\n    }\r\n\r\n    function replaceKeywordsManually() {\r\n        const keywordMap: { [key: string]: string } = {};\r\n\r\n        fieldsList.forEach((field) => {\r\n            const id = field.Label;\r\n            const keyword = `#${id}#`;\r\n\r\n            let value = '';\r\n            const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement;\r\n\r\n            if (element) {\r\n                value = (element instanceof HTMLInputElement || element instanceof HTMLSelectElement)\r\n                    ? element.value\r\n                    : '';\r\n            }\r\n\r\n            keywordMap[keyword] = value ? value : keyword;\r\n        });\r\n\r\n        let insertValue = templateText;\r\n        for (const [keyword, value] of Object.entries(keywordMap)) {\r\n            insertValue = insertValue.replace(new RegExp(keyword, 'g'), value);\r\n        }\r\n\r\n        preview = insertValue;\r\n        previewDiv.textContent = preview;\r\n        previewContainer.style.display = preview ? 'block' : 'none';\r\n        applyBtn.disabled = preview === '';\r\n    }\r\n\r\n    function updatePreview() {\r\n        replaceKeywordsManually();\r\n    }\r\n\r\n    function resetForm() {\r\n        // Reset only the dynamic field values\r\n        fieldsList.forEach((field) => {\r\n            const element = document.getElementById(field.Label) as HTMLInputElement | HTMLSelectElement;\r\n            if (element) {\r\n                if (element instanceof HTMLInputElement) {\r\n                    element.value = '';\r\n                } else if (element instanceof HTMLSelectElement) {\r\n                    element.selectedIndex = 0; // optional: reset to first option\r\n                }\r\n            }\r\n        });\r\n\r\n        // Clear preview\r\n        previewDiv.textContent = templateText;\r\n        preview = templateText;\r\n    }\r\n\r\n\r\n    function applyPrompt() {\r\n        if (!preview) return;\r\n\r\n        const promptTextarea = document.getElementById('prompt') as HTMLTextAreaElement;\r\n        if (promptTextarea) {\r\n            promptTextarea.value = preview;\r\n            switchToAddTag()\r\n        }\r\n\r\n    }\r\n\r\n    resetBtn.addEventListener('click', resetForm);\r\n    applyBtn.addEventListener('click', applyPrompt);\r\n}\r\n\r\n\r\nexport async function insertTagPrompt(tag) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) throw new Error(\"Invalid selection\");\r\n\r\n            /* --------------------------------------------------\r\n               1 Create invisible anchor at cursor\r\n            -------------------------------------------------- */\r\n            const anchorChar = selection.insertText(\r\n                \"\\u200B\", // zero-width space\r\n                Word.InsertLocation.replace\r\n            );\r\n            await context.sync();\r\n\r\n            let cursor = anchorChar.getRange();\r\n\r\n            let bookmarkStart: Word.Range | null = null;\r\n            let bookmarkEnd: Word.Range | null = null;\r\n\r\n            const include = (r: Word.Range) => {\r\n                if (!bookmarkStart) {\r\n                    bookmarkStart = r.getRange(\"Start\");\r\n                }\r\n                bookmarkEnd = r.getRange(\"End\");\r\n            };\r\n\r\n            /* --------------------------------------------------\r\n               2 Insert content\r\n            -------------------------------------------------- */\r\n            if (tag.ComponentKeyDataType === \"TABLE\") {\r\n                const parser = new DOMParser();\r\n                const doc = parser.parseFromString(tag.EditorValue, \"text/html\");\r\n                const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                for (const node of bodyNodes) {\r\n\r\n                    // TEXT NODE\r\n                    if (node.nodeType === Node.TEXT_NODE) {\r\n                        let txt = node.textContent?.trim();\r\n                        if (!txt) continue;\r\n\r\n                        txt = txt.replace(/\\n- /g, \"\\n \");\r\n                        for (const line of txt.split(\"\\n\")) {\r\n                            if (!line.trim()) continue;\r\n\r\n                            const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                            insertLineWithHeadingStyle(p, line);\r\n                            include(p.getRange());\r\n                            cursor = p.getRange();\r\n                        }\r\n                    }\r\n\r\n                    // ELEMENT NODE\r\n                    else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        const el = node as HTMLElement;\r\n\r\n                        // TABLE\r\n                        if (el.tagName.toLowerCase() === \"table\") {\r\n                            const rows = Array.from(el.querySelectorAll(\"tr\"));\r\n                            if (!rows.length) continue;\r\n\r\n                            const maxCols = Math.max(\r\n                                ...rows.map(r =>\r\n                                    Array.from(r.querySelectorAll(\"td, th\"))\r\n                                        .reduce(\r\n                                            (s, c) => s + parseInt(c.getAttribute(\"colspan\") || \"1\"),\r\n                                            0\r\n                                        )\r\n                                )\r\n                            );\r\n\r\n                            const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                            const table = p.insertTable(\r\n                                rows.length,\r\n                                maxCols,\r\n                                Word.InsertLocation.after\r\n                            );\r\n\r\n                            const store = StoreService.getInstance();\r\n                            const resolvedTableStyle = resolveWordTableStyle(store.tableStyle);\r\n                            if (resolvedTableStyle !== 'none') {\r\n                                table.style = resolvedTableStyle;\r\n                            }\r\n\r\n                            if (store.colorPallete.Customize) {\r\n                                await colorTable(table, rows, context);\r\n                            } else {\r\n                                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n                                let lastParamRowIndex = -1; // row index of last non-empty Parameter cell\r\n\r\n                                rows.forEach((row, rowIndex) => {\r\n                                    const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                    let cellIndex = 0;\r\n\r\n                                    // track first column text in HTML row\r\n                                    let firstColText = \"\";\r\n\r\n                                    cells.forEach((cell) => {\r\n                                        while (rowspanTracker[cellIndex] > 0) {\r\n                                            rowspanTracker[cellIndex]--;\r\n                                            cellIndex++;\r\n                                        }\r\n\r\n                                        const cellText = Array.from(cell.childNodes)\r\n                                            .map(node => {\r\n                                                if (node.nodeType === Node.TEXT_NODE) {\r\n                                                    return node.textContent?.trim() || '';\r\n                                                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                    return (node as HTMLElement).innerText.trim();\r\n                                                }\r\n                                                return '';\r\n                                            })\r\n                                            .filter(text => text.length > 0)\r\n                                            .join(' ');\r\n\r\n                                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                                        // save first column text if this is first column\r\n                                        if (cellIndex === 0) {\r\n                                            firstColText = cellText.trim();\r\n                                        }\r\n\r\n                                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                        // colspan blank filling\r\n                                        for (let i = 1; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                            }\r\n                                        }\r\n\r\n                                        // rowspan tracking\r\n                                        if (rowspan > 1) {\r\n                                            for (let i = 0; i < colspan; i++) {\r\n                                                if (cellIndex + i < maxCols) {\r\n                                                    rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        cellIndex += colspan;\r\n                                    });\r\n\r\n                                    //  AFTER filling the row  apply merge logic for 1st column\r\n                                    if (rowIndex === 0) {\r\n                                        // header row typically\r\n                                        return;\r\n                                    }\r\n\r\n                                    if (firstColText) {\r\n                                        // new parameter starts\r\n                                        lastParamRowIndex = rowIndex;\r\n                                    } else {\r\n                                        // empty parameter row  merge vertically with previous parameter row\r\n                                        // empty parameter row  merge vertically with previous parameter row\r\n                                        if (lastParamRowIndex !== -1) {\r\n                                            const topCell = table.getCell(lastParamRowIndex, 0);\r\n                                            const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n                                            // merge bottom into top\r\n                                            topCell.merge(bottomCell);\r\n\r\n                                            //  center align merged cell\r\n                                            try {\r\n                                                topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n                                                topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n                                            } catch (e) {\r\n                                                // ignore (safe fallback)\r\n                                            }\r\n                                        }\r\n\r\n                                    }\r\n                                });\r\n\r\n                            }\r\n\r\n                            include(table.getRange());\r\n                            cursor = table.getRange();\r\n                        }\r\n\r\n                        // OTHER HTML ELEMENTS\r\n                        else {\r\n                            let txt = el.innerText?.trim();\r\n                            if (!txt) continue;\r\n\r\n                            txt = txt.replace(/\\n- /g, \"\\n \");\r\n                            for (const line of txt.split(\"\\n\")) {\r\n                                if (!line.trim()) continue;\r\n\r\n                                const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                                insertLineWithHeadingStyle(p, line);\r\n                                include(p.getRange());\r\n                                cursor = p.getRange();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // NON-TABLE CONTENT\r\n            else {\r\n                const txt = tag.EditorValue.replace(/\\n- /g, \"\\n \").trim();\r\n\r\n                for (const line of txt.split(\"\\n\")) {\r\n                    if (!line.trim()) continue;\r\n\r\n                    const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\r\n                    insertLineWithHeadingStyle(p, line);\r\n                    include(p.getRange());\r\n                    cursor = p.getRange();\r\n                }\r\n            }\r\n\r\n            await context.sync();\r\n\r\n            /* --------------------------------------------------\r\n               3 Create ONE bookmark covering everything\r\n            -------------------------------------------------- */\r\n            if (bookmarkStart && bookmarkEnd) {\r\n                const bookmarkName =\r\n                    `ID${tag.ID}_Split_${getDateTimeStamp()}`;\r\n\r\n                bookmarkStart\r\n                    .expandTo(bookmarkEnd)\r\n                    .insertBookmark(bookmarkName);\r\n            }\r\n\r\n            /* --------------------------------------------------\r\n               4 Remove invisible anchor\r\n            -------------------------------------------------- */\r\n            anchorChar.delete();\r\n\r\n            await context.sync();\r\n            toaster(\"Inserted successfully\", \"success\");\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            toaster(\"Something went wrong\", \"error\");\r\n        }\r\n    });\r\n}\r\n\r\nexport function getDateTimeStamp() {\r\n    const d = new Date();\r\n\r\n    const pad = (n) => n.toString().padStart(2, \"0\");\r\n\r\n    return `${d.getFullYear()}${pad(d.getMonth() + 1)}${pad(d.getDate())}_` +\r\n        `${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;\r\n}\r\n\r\n\r\n\r\n\r\nexport function initializeAIHistoryEvents(tag: any, jwt: string, availableKeys: any, type: \"Summary\" | \"AITag\") {\r\n    setTimeout(() => {\r\n        tag.FilteredReportHeadAIHistoryList.forEach((chat: any, index: number) => {\r\n            // Copy buttons\r\n            if (tag.textareavalue) {\r\n                (document.getElementById(`chatInput`) as HTMLTextAreaElement).value = tag.textareavalue;\r\n                delete (tag.textareavalue)\r\n            }\r\n\r\n            // After initializing buttons inside setTimeout\r\n            const chatInput = document.getElementById(\"chatInput\") as HTMLTextAreaElement;\r\n            const changeSourceButton = document.getElementById(\"changeSourceButton\") as HTMLButtonElement;\r\n\r\n            if (chatInput && changeSourceButton) {\r\n                // Run once on load\r\n                changeSourceButton.disabled = chatInput.value.trim().length === 0;\r\n\r\n                // Listen for changes in textarea\r\n                chatInput.addEventListener(\"input\", () => {\r\n                    if (chatInput.value.trim().length > 0) {\r\n                        changeSourceButton.disabled = false;\r\n                    } else {\r\n                        changeSourceButton.disabled = true;\r\n                    }\r\n                });\r\n            };\r\n            document.getElementById(`copyPrompt-${index}`)?.addEventListener('click', () => copyText(chat.Prompt));\r\n            const savePromptele = document.getElementById(`savePrompt-${index}`);\r\n            if (savePromptele) {\r\n                document.getElementById(`savePrompt-${index}`)?.addEventListener('click', () => {\r\n                    const container = document.getElementById('confirmation-popup');\r\n                    if (container) {\r\n                        container.innerHTML = Confirmationpopup('Do you want to save the current prompt as a global default?');\r\n\r\n                        // Wait for DOM to update and then attach cancel button listener\r\n                        setTimeout(() => {\r\n                            document.getElementById('confirmation-popup-cancel')?.addEventListener('click', () => {\r\n                                container.innerHTML = '';\r\n                            });\r\n\r\n                            document.getElementById('confirmation-popup-confirm')?.addEventListener('click', async () => {\r\n                                try {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'true');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'true');\r\n                                    let data: any;\r\n                                    if (type === 'Summary') {\r\n                                        const payload = {\r\n                                            Name: tag.Name,\r\n                                            Prompt: chat.Prompt\r\n                                        };\r\n                                        data = await updateSummaryTagPrompt(payload, jwt);\r\n                                    } else {\r\n                                        let updatedTag = JSON.parse(JSON.stringify(tag));\r\n                                        updatedTag.Prompt = chat.Prompt;\r\n                                        data = await updatePromptTemplate(updatedTag, jwt);\r\n                                    }\r\n                                    if (data['Status']) {\r\n                                        toaster('Updated Succesfully', 'success');\r\n                                        container.innerHTML = '';\r\n                                    } else {\r\n                                        document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                        document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                        toaster('Something went wrong', 'error');\r\n\r\n\r\n                                    }\r\n                                } catch (error) {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                    toaster('Something went wrong', 'error');\r\n                                }\r\n                            });\r\n                        }, 0);\r\n                    }\r\n                });\r\n            }\r\n\r\n            const openRefferance = document.getElementById(`openRefferance-${index}`);\r\n            if (openRefferance) {\r\n                document.getElementById(`openRefferance-${index}`)?.addEventListener('click', () => {\r\n                    const container = document.getElementById('confirmation-popup');\r\n                    if (container) {\r\n                        const store = StoreService.getInstance();\r\n                        const sourceList = type === 'Summary' ? store.sourceSummaryList : store.sourceList;\r\n                        const rawSources = type === 'Summary' ? chat.SourceVector : chat.SourceValue;\r\n                        const sourceIds = Array.isArray(rawSources) ? rawSources : (rawSources ? String(rawSources).split(',') : []);\r\n\r\n                        const chatSources = sourceIds.map((item: any) => {\r\n                            if (type === 'Summary') {\r\n                                return sourceList.find(\r\n                                    (source: any) => String(item) === String(source.VectorID)\r\n                                );\r\n                            } else {\r\n                                return sourceList.find(\r\n                                    (source: any) => Number(item) === source.VectorID\r\n                                );\r\n                            }\r\n                        });\r\n\r\n                        const sources = chatSources.filter((src: any) => !!src);\r\n                        const popupData = {\r\n                            Data: chat.Evidences,\r\n                            Name: type === 'Summary' ? tag.Name : tag.DisplayName,\r\n                            UserValue: chat.Response,\r\n                            Sources: sources\r\n                        }\r\n\r\n                        container.innerHTML = DataModalPopup(popupData);\r\n\r\n                        // Wait for DOM to update and then attach cancel button listener\r\n                        setTimeout(() => {\r\n                            document.getElementById('confirmation-popup-cancel')?.addEventListener('click', () => {\r\n                                container.innerHTML = '';\r\n                            });\r\n\r\n                            document.getElementById('confirmation-popup-confirm')?.addEventListener('click', async () => {\r\n                                try {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'true');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'true');\r\n                                    let updatedTag = JSON.parse(JSON.stringify(tag));\r\n                                    updatedTag.Prompt = chat.Prompt;\r\n                                    const data = await updatePromptTemplate(updatedTag, jwt);\r\n                                    if (data['Status']) {\r\n                                        toaster('Updated Succesfully', 'success');\r\n                                        container.innerHTML = '';\r\n                                    } else {\r\n                                        document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                        document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                        toaster('Something went wrong', 'error');\r\n\r\n\r\n                                    }\r\n                                } catch (error) {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                    toaster('Something went wrong', 'error');\r\n                                }\r\n                            });\r\n\r\n                            document.getElementById('datamodel-popup-ok')?.addEventListener('click', async () => {\r\n                                container.innerHTML = ''\r\n                            })\r\n                        }, 0);\r\n                    }\r\n                });\r\n            }\r\n\r\n\r\n            document.getElementById(`copyResponse-${index}`)?.addEventListener('click', () => copyText(chat.Response));\r\n\r\n            // Checkbox logic\r\n            const checkbox = document.getElementById(`checkbox-${index}`) as HTMLInputElement;\r\n            if (checkbox) {\r\n                checkbox.addEventListener('change', async (event: Event) => {\r\n                    const isChecked = (event.target as HTMLInputElement).checked;\r\n\r\n                    // Reset all\r\n                    tag.FilteredReportHeadAIHistoryList.forEach((_: any, otherIndex: number) => {\r\n                        const otherCheckbox = document.getElementById(`checkbox-${otherIndex}`) as HTMLInputElement;\r\n                        const responseContainer = document.getElementById(`responseContainer-${otherIndex}`);\r\n                        if (otherCheckbox) otherCheckbox.checked = false;\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.remove('ai-selected-response');\r\n                            responseContainer.classList.add('bg-light');\r\n                        }\r\n                        tag.FilteredReportHeadAIHistoryList[otherIndex].Selected = 0;\r\n                    });\r\n\r\n                    // Set selected\r\n                    if (isChecked) {\r\n                        checkbox.checked = true;\r\n                        const responseContainer = document.getElementById(`responseContainer-${index}`);\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.add('ai-selected-response');\r\n                            responseContainer.classList.remove('bg-light');\r\n                        }\r\n                        chat.Selected = 1;\r\n                    } else {\r\n                        chat.Selected = 0;\r\n                    }\r\n\r\n                    try {\r\n                        const data = type === 'Summary' ? await updateSummaryHistory(chat, jwt) : await updateAiHistory(chat, jwt);\r\n                        if (data['Data']) {\r\n                            tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n                            tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n                            tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                                historyList.Response = removeQuotes(historyList.Response);\r\n                                tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                            });\r\n\r\n                            const finalResponse = chat.FormattedResponse\r\n                                ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                : chat.Response;\r\n\r\n                            tag.ComponentKeyDataType = chat.FormattedResponse ? 'TABLE' : 'TEXT';\r\n                            tag.UserValue = finalResponse;\r\n                            tag.EditorValue = finalResponse;\r\n                            tag.text = finalResponse;\r\n\r\n                            const currentlySelected = tag.FilteredReportHeadAIHistoryList.some((item: any) => item.Selected === 1);\r\n                            tag.IsApplied = !currentlySelected;\r\n                            availableKeys.forEach(currentTag => {\r\n                                if (currentTag.ID === tag.ID) {\r\n                                    const isTable = chat.FormattedResponse !== '';\r\n                                    const finalResponse = chat.FormattedResponse\r\n                                        ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                        : chat.Response;\r\n                                    currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n                                    currentTag.UserValue = finalResponse;\r\n                                    currentTag.EditorValue = finalResponse;\r\n                                    currentTag.text = finalResponse;\r\n                                    currentTag.IsApplied = tag.IsApplied;\r\n                                }\r\n                            })\r\n\r\n                            const store = StoreService.getInstance();\r\n                            store.aiTagList.forEach(currentTag => {\r\n                                if (currentTag.ID === tag.ID) {\r\n                                    const isTable = chat.FormattedResponse !== '';\r\n                                    const finalResponse = chat.FormattedResponse\r\n                                        ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                        : chat.Response;\r\n\r\n\r\n                                    currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n                                    currentTag.UserValue = finalResponse;\r\n                                    currentTag.EditorValue = finalResponse;\r\n                                    currentTag.text = finalResponse;\r\n                                    currentTag.IsApplied = tag.IsApplied;\r\n                                }\r\n                            });\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('Failed to update AI history:', err);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        // Close button\r\n        document.getElementById(`close-btn-tag`)?.addEventListener('click', () => {\r\n            const store = StoreService.getInstance();\r\n            if (store.mode === \"Home\") {\r\n                loadHomepage(availableKeys)\r\n            } else if (store.mode === \"Summary\") {\r\n                loadSummarypage(availableKeys);\r\n            }\r\n        });\r\n\r\n        // Button: Insert Tag\r\n        document.getElementById(`insertTagButton`)?.addEventListener('click', () => {\r\n            if (!tag.IsApplied) {\r\n                insertTagPrompt(tag);\r\n            }\r\n        });\r\n\r\n        // Button: Send Prompt\r\n        document.getElementById(`sendPromptButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            AIService.sendPrompt(tag, textareaValue, type);\r\n        });\r\n\r\n        // Button: Change Source\r\n        document.getElementById(`changeSourceButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            tag.textareavalue = textareaValue;\r\n            createMultiSelectDropdown(tag, type);\r\n        });\r\n\r\n        // Mention dropdown\r\n        mentionDropdownFn(`chatInput`, `mention-dropdown`, 'edit');\r\n    }, 0);\r\n}\r\n\r\n","import { toaster } from \"../components/bodyelements\";\r\nimport { generateCheckboxHistory } from \"./home\";\r\nimport { wordTableStyleLocales } from \"../components/tablestyles\";\r\nimport { StoreService } from \"../services/store.service\";\r\n\r\nexport function insertLineWithHeadingStyle(\r\n  paragraph: Word.Paragraph,\r\n  line: string\r\n) {\r\n  let builtInStyle: Word.BuiltInStyleName = Word.BuiltInStyleName.normal;\r\n  let text = line;\r\n\r\n  if (line.startsWith(\"###### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading6;\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith(\"##### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading5;\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith(\"#### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading4;\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith(\"### \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading3;\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith(\"## \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading2;\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith(\"# \")) {\r\n    builtInStyle = Word.BuiltInStyleName.heading1;\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  //  THIS is the important line\r\n  paragraph.styleBuiltIn = builtInStyle;\r\n\r\n  const regex = /(\\*\\*(.+?)\\*\\*)|(\\*(.+?)\\*)|(_(.+?)_)/g;\r\n  let lastIndex = 0;\r\n  let match;\r\n\r\n  while ((match = regex.exec(text)) !== null) {\r\n    if (match.index > lastIndex) {\r\n      paragraph.insertText(\r\n        text.substring(lastIndex, match.index),\r\n        Word.InsertLocation.end\r\n      );\r\n    }\r\n\r\n    let content = \"\";\r\n    let bold = false;\r\n    let italic = false;\r\n    let underline = false;\r\n\r\n    if (match[1]) {\r\n      content = match[2];\r\n      bold = true;\r\n    } else if (match[3]) {\r\n      content = match[4];\r\n      italic = true;\r\n    } else if (match[5]) {\r\n      content = match[6];\r\n      underline = true;\r\n    }\r\n\r\n    const r = paragraph.insertText(content, Word.InsertLocation.end);\r\n    r.font.bold = bold;\r\n    r.font.italic = italic;\r\n    r.font.underline = underline\r\n      ? Word.UnderlineType.single\r\n      : Word.UnderlineType.none;\r\n\r\n    lastIndex = regex.lastIndex;\r\n  }\r\n\r\n  if (lastIndex < text.length) {\r\n    paragraph.insertText(\r\n      text.substring(lastIndex),\r\n      Word.InsertLocation.end\r\n    );\r\n  }\r\n}\r\n\r\nexport function removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\n\r\n\r\nexport function copyText(text: string) {\r\n  // Copy text to clipboard logic\r\n  const tempTextArea = document.createElement('textarea');\r\n  tempTextArea.value = text;\r\n  document.body.appendChild(tempTextArea);\r\n  tempTextArea.select();\r\n  document.execCommand('copy');\r\n  document.body.removeChild(tempTextArea);\r\n  toaster('Copied to clipboard successfully!', 'success')\r\n\r\n}\r\n\r\n\r\nexport function switchToPromptBuilder() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('prompt-tab').classList.add('active');\r\n  document.getElementById('add-prompt-template').classList.add('show', 'active');\r\n}\r\n\r\n\r\nexport function switchToAddTag() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('tag-tab').classList.add('active');\r\n  document.getElementById('add-tag-body').classList.add('show', 'active');\r\n}\r\n\r\nexport function updateEditorFinalTable(data) {\r\n  const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n  let match;\r\n  let tables = [];\r\n\r\n  while ((match = regex.exec(data)) !== null) {\r\n    try {\r\n      const parsedContent = JSON.parse(match[1]);\r\n      tables.push(jsonToHtmlTable(parsedContent));\r\n    } catch (error) {\r\n      console.error(\"Failed to parse JSON:\", error, match[1]);\r\n    }\r\n  }\r\n\r\n  let tableIndex = 0;\r\n  return data.replace(regex, () => tables[tableIndex++] || \"\");\r\n}\r\n\r\nfunction jsonToHtmlTable(jsonData) {\r\n  if (!jsonData || (Array.isArray(jsonData) && jsonData.length === 0)) {\r\n    return '<p>No data available</p>';\r\n  }\r\n\r\n  let headers = new Set();\r\n  let rows = [];\r\n\r\n  function flattenObject(obj, prefix = \"\", result = {}) {\r\n    Object.keys(obj).forEach(key => {\r\n      const value = obj[key];\r\n      const newKey = prefix ? `${prefix} > ${key}` : key;\r\n\r\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n        flattenObject(value, newKey, result);\r\n      } else if (Array.isArray(value)) {\r\n        result[newKey] = value.map(item => {\r\n          return typeof item === 'object'\r\n            ? Object.entries(item).map(([k, v]) => `<strong>${k}:</strong> ${v}`).join('<br>')\r\n            : item;\r\n        }).join('<br>');\r\n      } else {\r\n        result[newKey] = value;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  if (!Array.isArray(jsonData)) {\r\n    jsonData = Object.entries(jsonData).map(([key, value]) => ({ [key]: value }));\r\n  }\r\n\r\n  jsonData.forEach(item => {\r\n    let flattenedItem = flattenObject(item);\r\n    Object.keys(flattenedItem).forEach(key => headers.add(key));\r\n    rows.push(flattenedItem);\r\n  });\r\n\r\n  let table = '<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">';\r\n  table += '<tr>' + [...headers].map(header => `<th>${header}</th>`).join('') + '</tr>';\r\n  rows.forEach(row => {\r\n    table += '<tr>' + [...headers].map(header => `<td>${row[header]}</td>`).join('') + '</tr>';\r\n  });\r\n\r\n  table += '</table>';\r\n  return table;\r\n}\r\n\r\n\r\n\r\nexport function generateChatHistoryHtml(chatList: any[]): string {\r\n  const store = StoreService.getInstance();\r\n  const promptclass = store.theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n  const globalPromptUpdate = store.UserRole.UserRoleEntityAccessList.find(\r\n    (item: any) => item.UserRoleEntity === 'Global Prompt Update'\r\n  );\r\n\r\n  return chatList.map((chat, index) => {\r\n    const includeSaveIcon = globalPromptUpdate?.UserRoleAccessID === 3;\r\n    const includeReferenceIcon = chat.Evidences && chat.Evidences.length > 0;\r\n\r\n    return `\r\n      <div class=\"row chat-entry m-0 p-0\">\r\n        <div class=\"col-md-12 mt-2 p-2\">\r\n          <div class=\"d-flex justify-content-between align-items-start\">\r\n            <!-- Prompt Box -->\r\n            <div class=\"form-control h-34 d-flex align-items-center dynamic-height prompt-text ${promptclass}\" style=\"width: 95%;\">\r\n              ${chat.Prompt}\r\n            </div>\r\n\r\n            <!-- Icons Stack -->\r\n            <div class=\"d-flex flex-column align-items-center ms-2\">\r\n              <i class=\"fa fa-copy text-secondary c-pointer mb-2\" title=\"Copy Prompt\" id=\"copyPrompt-${index}\"></i>\r\n              ${includeSaveIcon ? `<i class=\"fa fa-save text-secondary c-pointer\" title=\"Save Prompt\" id=\"savePrompt-${index}\"></i>` : ''}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-12 mb-2 p-2 d-flex\">\r\n          <span class=\"d-flex align-items-baseline w-100\">\r\n            <div class=\"flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response\" id=\"responseContainer-${index}\">\r\n              <input\r\n                class=\"form-check-input c-pointer me-2 response-checkbox\"\r\n                type=\"checkbox\"\r\n                id=\"checkbox-${index}\"\r\n                ${chat.Selected === 1 ? 'checked' : ''}>\r\n              <span id=\"responseText-${index}\">${chat.Response}</span>\r\n              <i class=\"fa fa-copy text-secondary c-pointer ms-2\"\r\n                title=\"Copy Response\"\r\n                id=\"copyResponse-${index}\"></i>\r\n              ${includeReferenceIcon\r\n        ? `<i class=\"fa fa-folder-gear text-secondary c-pointer ms-2\"\r\n                    title=\"Open Reference\"\r\n                    id=\"openRefferance-${index}\"></i>`\r\n        : ''}\r\n            </div>\r\n          </span>\r\n        </div>\r\n      </div>`;\r\n  }).join('');\r\n}\r\n\r\n\r\n\r\nexport function chatfooter(tag: any) {\r\n  const store = StoreService.getInstance();\r\n  const promptclass = store.theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n  const tooltipButton = tag.Sources && tag.Sources.length > 0\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n  return ` <textarea class=\"form-control ${promptclass}\"\r\n                      rows=\"5\"\r\n                      id=\"chatInput\"\r\n                      ></textarea>\r\n            <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n            <div class=\"d-flex flex-column align-self-end me-3\">\r\n              <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insertTagButton\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\"></i>\r\n              </button>\r\n             <div class=\"ngb-tooltip d-inline-block\">\r\n                 ${tooltipButton}\r\n                <button class=\"btn btn-secondary ms-2 mb-2 text-white\" id=\"changeSourceButton\">\r\n                  <i class=\"fa fa-file-lines text-white\"></i>\r\n                </button>\r\n              </div>\r\n\r\n              <button type=\"submit\" class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\" id=\"sendPromptButton\">\r\n                <span class=\"tooltiptext\">Send</span>\r\n                <i class=\"fa fa-paper-plane text-white\"></i>\r\n              </button>\r\n            </div>`\r\n}\r\n\r\nexport function renderSelectedTags(selectedNames, availableKeys) {\r\n  const badgeWrapper = document.getElementById('tag-badge-wrapper');\r\n  if (badgeWrapper) {\r\n    badgeWrapper.innerHTML = '';\r\n    // Filter out duplicates (case-insensitive)\r\n    const uniqueNames = [...new Set(\r\n      selectedNames.map(name => name.toLowerCase())\r\n    )].map(lowerName =>\r\n      selectedNames.find(name => name.toLowerCase() === lowerName)\r\n    );\r\n\r\n\r\n    uniqueNames.forEach(name => {\r\n      let aiTag;\r\n\r\n      if (/^ID\\d+$/i.test(name)) {\r\n        aiTag = availableKeys.find(\r\n          mention => mention.AIFlag === 1 && `id${mention.ID}`.toLowerCase() === name.toLowerCase()\r\n        );\r\n      } else {\r\n        aiTag = availableKeys.find(\r\n          mention => mention.AIFlag === 1 && mention.DisplayName.toLowerCase() === name.toLowerCase()\r\n        );\r\n      }\r\n      if (aiTag?.DisplayName) {\r\n\r\n        const badge = document.createElement('span');\r\n        badge.className = 'badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable';\r\n        badge.style.cursor = 'pointer';\r\n        badge.innerHTML = `${aiTag.DisplayName} <i class=\"fa-solid fa-microchip-ai ms-2 text-muted\" aria-label=\"AI Suggested\"></i>`;\r\n        badge.addEventListener('click', async () => {\r\n          await selectMatchingBookmarkFromSelection(name);\r\n\r\n          if (aiTag) {\r\n            const appBody = document.getElementById('app-body');\r\n            appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n\r\n            generateCheckboxHistory(aiTag, \"AITag\").then(html => {\r\n              appBody.innerHTML = html;\r\n            });\r\n          }\r\n        });\r\n        badgeWrapper.appendChild(badge);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n// applyThemeClasses and swicthThemeIcon moved to UIService\r\n\r\nconst modeIconMap = {\r\n  Home: \"fa-home\",\r\n  Summary: \"fa-wand-magic-sparkles\",\r\n  Review: \"fa-magnifying-glass\",\r\n} as const;\r\n\r\nexport function switchModeIcon() {\r\n  const icon = document.getElementById(\"modeDropdown\");\r\n  if (!icon) return;\r\n\r\n  const store = StoreService.getInstance();\r\n  icon.classList.remove(...Object.values(modeIconMap));\r\n  icon.classList.add(modeIconMap[store.mode]);\r\n\r\n  sessionStorage.setItem(\"mode\", store.mode);\r\n}\r\n\r\n\r\nexport async function selectMatchingBookmarkFromSelection(displayName) {\r\n  return Word.run(async (context) => {\r\n    const selection = context.document.getSelection();\r\n    const bookmarks = selection.getBookmarks(); // ClientResult<string[]>\r\n    await context.sync();\r\n\r\n    const targetBookmarkName = bookmarks.value.find(bookmark => {\r\n      const cleanName = bookmark.split('_Split_')[0].replace(/_/g, ' ');\r\n      return cleanName.toLowerCase() === displayName.toLowerCase();\r\n    });\r\n\r\n    if (targetBookmarkName) {\r\n      const range = context.document.getBookmarkRangeOrNullObject(targetBookmarkName);\r\n      range.load('isNullObject');\r\n      await context.sync();\r\n\r\n      if (!range.isNullObject) {\r\n        range.select(); // Select the entire bookmark\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport async function colorTable(table: any, rows: any, context: any) {\r\n\r\n  // ------------------------------------------------------------\r\n  // 1) Copy cell values DOM -> Word + MERGE FIRST COLUMN GROUPS\r\n  // ------------------------------------------------------------\r\n  let lastParamRowIndex = -1; // last row index where 1st col had value\r\n\r\n  rows.forEach((row, rowIndex) => {\r\n    const cells = Array.from(row.querySelectorAll(\"td, th\"));\r\n    let cellIndex = 0;\r\n\r\n    let firstColText = \"\";\r\n\r\n    cells.forEach((cell) => {\r\n      const text = cell.innerText.trim();\r\n\r\n      // capture first column text\r\n      if (cellIndex === 0) {\r\n        firstColText = text;\r\n      }\r\n\r\n      table.getCell(rowIndex, cellIndex).value = text;\r\n      cellIndex++;\r\n    });\r\n\r\n    //  Merge first column when empty (skip header row)\r\n    if (rowIndex > 0) {\r\n      if (firstColText) {\r\n        // new group starts\r\n        lastParamRowIndex = rowIndex;\r\n      } else {\r\n        // empty first col = merge with last non-empty parameter row\r\n        if (lastParamRowIndex !== -1) {\r\n          const topCell = table.getCell(lastParamRowIndex, 0);\r\n          const bottomCell = table.getCell(rowIndex, 0);\r\n\r\n          topCell.merge(bottomCell);\r\n\r\n          //  center align merged parameter cell\r\n          try {\r\n            topCell.verticalAlignment = Word.VerticalAlignment.center;\r\n            topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\r\n          } catch (e) {\r\n            // ignore\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  await context.sync();\r\n\r\n  // ------------------------------------------------------------\r\n  // 2) Load rows for formatting\r\n  // ------------------------------------------------------------\r\n  table.rows.load(\"items\");\r\n  await context.sync();\r\n\r\n  // Helper to check if color is dark\r\n  const isColorDark = (hexColor: string): boolean => {\r\n    const hex = hexColor.replace(\"#\", \"\");\r\n    const r = parseInt(hex.substring(0, 2), 16);\r\n    const g = parseInt(hex.substring(2, 4), 16);\r\n    const b = parseInt(hex.substring(4, 6), 16);\r\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\r\n    return luminance < 0.5;\r\n  };\r\n\r\n  const store = StoreService.getInstance();\r\n\r\n  const applyBoldIfNeeded = (cell: any, rowIndex: number, cellIndex: number) => {\r\n    let weight = \"Normal\";\r\n\r\n    if (store.colorPallete.IsHeaderBold && rowIndex === 0) weight = \"Bold\";\r\n    if (store.colorPallete.IsSideHeaderBold && cellIndex === 0) weight = \"Bold\";\r\n\r\n    cell.body.font.bold = weight === \"Bold\";\r\n  };\r\n\r\n  // Helper to apply shading, font color, and border to a row or cell\r\n  const applyColor = (cellOrRow: any, bgColor: string) => {\r\n    cellOrRow.shadingColor = bgColor;\r\n    try {\r\n      cellOrRow.font.color = isColorDark(bgColor) ? \"#FFFFFF\" : \"#000000\";\r\n\r\n      // Apply thin light grey border for all sides\r\n      const borderColor = \"#D3D3D3\"; // light grey\r\n      if (cellOrRow.getBorder) {\r\n        [\"Top\", \"Bottom\", \"Left\", \"Right\"].forEach((side) => {\r\n          cellOrRow.getBorder(side).type = \"Single\";\r\n          cellOrRow.getBorder(side).color = borderColor;\r\n          cellOrRow.getBorder(side).width = 1; // 1pt thin\r\n        });\r\n      }\r\n    } catch (e) {\r\n      // row objects might not have font directly\r\n    }\r\n  };\r\n\r\n  // Determine base table type\r\n  const base = store.tableStyle.split(\" - \")[0].trim();\r\n\r\n  // ------------------------------------------------------------\r\n  // Plain Table 3\r\n  // ------------------------------------------------------------\r\n  if (base === \"Plain Table 3\") {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = store.colorPallete.Primary;\r\n\r\n        if (rowIndex === 0 || cellIndex === 0) {\r\n          bgColor = store.colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? store.colorPallete.Primary\r\n            : store.colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Plain Table 2\r\n  // ------------------------------------------------------------\r\n  else if (base === \"Plain Table 2\") {\r\n\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    const rowCount = table.rows.items.length;\r\n    const firstGapIndex = 0;             // gap between row 0 and row 1\r\n    const lastGapIndex = rowCount - 1;   // gap between last-2 and last row\r\n\r\n    // STEP 2  Turn OFF all gaps EXCEPT first + last\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      // rowIndex = gap BELOW this row\r\n      if (rowIndex !== firstGapIndex && rowIndex !== lastGapIndex) {\r\n        const bottom = row.getBorder(Word.BorderLocation.bottom);\r\n        bottom.type = Word.BorderType.none;\r\n      }\r\n    });\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = store.colorPallete.Primary;\r\n\r\n        if (rowIndex === 0) {\r\n          bgColor = store.colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? store.colorPallete.Primary\r\n            : store.colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n\r\n    await context.sync();\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Plain Table 5\r\n  // ------------------------------------------------------------\r\n  else if (base === \"Plain Table 5\") {\r\n    table.getBorder(Word.BorderLocation.insideVertical).type = Word.BorderType.none;\r\n\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = store.colorPallete.Primary;\r\n\r\n        if (rowIndex === 0) {\r\n          bgColor = store.colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? store.colorPallete.Primary\r\n            : store.colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Table Grid\r\n  // ------------------------------------------------------------\r\n  else if (base === \"Table Grid\") {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n    table.rows.items.forEach((row, i) => {\r\n      const bg = i % 2 === 0 ? store.colorPallete.Header : store.colorPallete.Primary;\r\n      applyColor(row, bg);\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n\r\n    });\r\n  }\r\n  else if (base === \"Table Grid 1\") {\r\n    table.rows.items.forEach(r => r.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, i) => {\r\n      const bg = i % 2 === 0 ? store.colorPallete.Header : store.colorPallete.Primary;\r\n      applyColor(row, bg);\r\n\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n    });\r\n\r\n    //  ONE full width double border under header row\r\n    const headerRow = table.rows.items[0];\r\n    const bottom = headerRow.getBorder(Word.BorderLocation.bottom);\r\n    bottom.type = Word.BorderType.double;\r\n    bottom.width = 0.5;\r\n    bottom.color = \"000000\";\r\n\r\n    await context.sync();\r\n  }\r\n\r\n\r\n  // ------------------------------------------------------------\r\n  // Grid Table 4\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"Grid Table 4\")) {\r\n    const headerRow = table.rows.items[0];\r\n    applyColor(headerRow, store.colorPallete.Header);\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n    table.rows.items.forEach((row, i) => {\r\n      if (i > 0) {\r\n        const bg = i % 2 === 0 ? store.colorPallete.Secondary : store.colorPallete.Primary;\r\n        applyColor(row, bg);\r\n      }\r\n\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Grid Table 5 Dark\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"Grid Table 5 Dark\")) {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = store.colorPallete.Primary;\r\n\r\n        if (rowIndex === 0 || cellIndex === 0) {\r\n          bgColor = store.colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? store.colorPallete.Primary\r\n            : store.colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // List Table 3\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"List Table 3\")) {\r\n    const headerRow = table.rows.items[0];\r\n    applyColor(headerRow, store.colorPallete.Header);\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n    table.rows.items.forEach((row, i) => {\r\n      if (i > 0) applyColor(row, store.colorPallete.Primary);\r\n\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        applyBoldIfNeeded(cell, i, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // List Table 2\r\n  // ------------------------------------------------------------\r\n  else if (base.startsWith(\"List Table 2\")) {\r\n    table.rows.items.forEach(row => row.cells.load(\"items\"));\r\n    await context.sync();\r\n\r\n    table.rows.items.forEach((row, rowIndex) => {\r\n      row.cells.items.forEach((cell, cellIndex) => {\r\n        let bgColor = store.colorPallete.Primary;\r\n\r\n        if (rowIndex === 0) {\r\n          bgColor = store.colorPallete.Header;\r\n        } else {\r\n          bgColor = rowIndex % 2 === 1\r\n            ? store.colorPallete.Primary\r\n            : store.colorPallete.Secondary;\r\n        }\r\n\r\n        applyColor(cell, bgColor);\r\n        applyBoldIfNeeded(cell, rowIndex, cellIndex);\r\n      });\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // default\r\n  // ------------------------------------------------------------\r\n  else {\r\n    table.rows.items.forEach((row) => applyColor(row, store.colorPallete.Primary));\r\n  }\r\n\r\n  await context.sync();\r\n}\r\n\r\n\r\nexport function mapImagesToComponentObjects(input: any): any[] {\r\n  if (!input) return [];\r\n\r\n  // 1 Flatten ALL three arrays into a single list\r\n  const flatImages = [\r\n    ...(input.Flowchart || []),\r\n    ...(input.Graph || []),\r\n    ...(input.Image || [])\r\n  ];\r\n\r\n  // 2 Map to required structure\r\n  return flatImages.map(img => ({\r\n    Name: img.ImageName,\r\n    DisplayName: img.ImageName,\r\n    EditorValue: img.ImageData,\r\n    UserValue: img.ImageData,\r\n    ComponentKeyDataType: \"IMAGE\",\r\n    AIFlag: 0,\r\n    IsImage: true\r\n  }));\r\n}\r\n\r\nexport async function svgBase64ToPngBase64(svgBase64: string): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      const svgBlob = new Blob(\r\n        [atob(svgBase64.split(',')[1])],\r\n        { type: \"image/svg+xml\" }\r\n      );\r\n      const url = URL.createObjectURL(svgBlob);\r\n\r\n      const img = new Image();\r\n      img.crossOrigin = \"anonymous\";\r\n\r\n      img.onload = function () {\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = img.width || 1200;\r\n        canvas.height = img.height || 800;\r\n\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) return reject(\"Canvas unsupported.\");\r\n\r\n        ctx.drawImage(img, 0, 0);\r\n\r\n        const pngBase64 = canvas.toDataURL(\"image/png\").split(\",\")[1];\r\n        resolve(pngBase64);\r\n\r\n        URL.revokeObjectURL(url);\r\n      };\r\n\r\n      img.onerror = () => reject(\"SVG load failed.\");\r\n      img.src = url;\r\n\r\n    } catch (err) {\r\n      reject(err);\r\n    }\r\n  });\r\n}\r\n\r\nexport function resolveWordTableStyle(englishStyle: string): string {\r\n  const lang =\r\n    Office.context.displayLanguage?.toLowerCase().slice(0, 2) || \"en\";\r\n\r\n  return (\r\n    wordTableStyleLocales[lang]?.[englishStyle] ??\r\n    wordTableStyleLocales.en[englishStyle] ??\r\n    'none'\r\n  );\r\n}\r\n","/* global Word */\r\nimport { DocumentProperty } from \"../models/app.model\";\r\nimport { getReportById, getAllClients, getAllPromptTemplates, getGeneralImages, getReportHeadImageById } from \"../draft/draft.api\";\r\nimport { updateEditorFinalTable, mapImagesToComponentObjects } from \"../draft/draft-functions\";\r\n\r\nexport class DocumentService {\r\n\r\n    private static transformDocumentName(value: string): string {\r\n        if (!value || value.trim() === '') return value;\r\n        const parts = value.split('_');\r\n        if (parts.length <= 1) return value;\r\n        return parts.slice(1).join('_').replace(/%20/g, ' ').replace(/%25/g, '%');\r\n    }\r\n\r\n    static async loadReportData(documentId: string, jwt: string, userId: string): Promise<any> {\r\n        try {\r\n            console.log(`Fetching report data for ID: ${documentId}`);\r\n            const data = await getReportById(documentId, jwt);\r\n\r\n            if (!data.Status || !data.Data) {\r\n                throw new Error(\"Failed to fetch report data\");\r\n            }\r\n\r\n            const dataList = data.Data;\r\n\r\n            // Basic processing\r\n            if (!dataList.SourceTypeList) dataList.SourceTypeList = [];\r\n\r\n            const sourceList = dataList.SourceTypeList\r\n                .filter((item: any) => item.SourceValue !== '' && item.AIFlag === 1)\r\n                .map((item: any) => ({\r\n                    ...item,\r\n                    SourceName: decodeURIComponent(DocumentService.transformDocumentName(item.SourceValue))\r\n                }));\r\n\r\n            const clientId = dataList.ClientID;\r\n            const aiGroup = dataList.Group.find((element: any) => element.DisplayName === 'AIGroup');\r\n            const groupName = aiGroup ? aiGroup.Name : '';\r\n            const aiTagList = aiGroup ? aiGroup.GroupKey : [];\r\n\r\n            // Image processing - Deferred to background (getImages)\r\n\r\n            // Available Keys filtering\r\n            let availableKeys = dataList.GroupKeyAll.filter((element: any) =>\r\n                element.ComponentKeyDataType === 'TABLE' ||\r\n                element.ComponentKeyDataType === 'TEXT'\r\n            );\r\n\r\n            const imageList: any[] = [];\r\n\r\n            // Apply transformations to keys (updateEditorFinalTable)\r\n            const processKey = (key: any) => {\r\n                if (key.AIFlag === 1) {\r\n                    const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n                    if (regex.exec(key.EditorValue) !== null) {\r\n                        key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n                        key.UserValue = key.EditorValue;\r\n                        key.InitialTable = true;\r\n                        key.ComponentKeyDataType = 'TABLE';\r\n                    }\r\n                }\r\n            };\r\n\r\n            availableKeys.forEach(processKey);\r\n            aiTagList.forEach(processKey);\r\n\r\n            return {\r\n                dataList,\r\n                availableKeys,\r\n                sourceList,\r\n                clientId,\r\n                groupName,\r\n                aiTagList,\r\n                imageList,\r\n                clientList: [], // Will be filled if needed or fetched separately\r\n                promptBuilderList: [] // Fetched via loadPromptTemplates\r\n            };\r\n\r\n        } catch (error) {\r\n            console.error(\"Error in loadReportData:\", error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    static async retrieveDocumentProperties(): Promise<{ documentID: string, organizationName: string } | null> {\r\n        try {\r\n            return await Word.run(async (context) => {\r\n                const properties = context.document.properties.customProperties;\r\n                properties.load(\"items\");\r\n\r\n                await context.sync();\r\n\r\n                const property = properties.items.find(prop => prop.key === 'DocumentID');\r\n                const orgName = properties.items.find(prop => prop.key === 'Organization');\r\n\r\n                if (property && orgName) {\r\n                    return {\r\n                        documentID: property.value,\r\n                        organizationName: orgName.value\r\n                    };\r\n                } else {\r\n                    return null;\r\n                }\r\n            });\r\n        } catch (error) {\r\n            console.error(\"Error retrieving document properties\", error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    static async insertText(text: string): Promise<void> {\r\n        await Word.run(async (context) => {\r\n            const body = context.document.body;\r\n            body.insertParagraph(text, Word.InsertLocation.end);\r\n            await context.sync();\r\n        });\r\n    }\r\n}\r\n","import { CONFIG } from \"../utils/config\";\r\n\r\nexport class UIService {\r\n\r\n    static showNotification(message: string, type: 'success' | 'error' | 'info' = 'info'): void {\r\n        console.log(`[${type.toUpperCase()}] ${message}`);\r\n        // Simple toastr wrapper, assuming toastr function is available globally or via import if we were stricter\r\n        // For this refactor, we keep it compatible with existing 'toaster' global if possible, or implement simple DOM manipulation\r\n        const toastContainer = document.getElementById('toastr'); // Hypothetical, in reality the old app used 'toaster()'\r\n        if (typeof (window as any).toaster === 'function') {\r\n            (window as any).toaster(message, type);\r\n        } else {\r\n            // Fallback\r\n            alert(message);\r\n        }\r\n    }\r\n\r\n    static toggleLoader(loading: boolean): void {\r\n        const loader = document.getElementById('page-loader');\r\n        if (loader) loader.style.display = loading ? 'flex' : 'none';\r\n    }\r\n\r\n    static renderLoginPage(storedUrl: string, handleLoginCallback: (e: Event) => void, themeToggleCallback: () => void): void {\r\n        const logoHeader = document.getElementById('logo-header');\r\n        if (logoHeader) {\r\n            logoHeader.innerHTML = `\r\n            <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n            <div class=\"icon-nav me-3\">\r\n                <span id=\"theme-toggle\"><i class=\"fa fa-moon c-pointer me-3\"  title=\"Toggle Theme\"></i><span>\r\n            </div>`;\r\n        }\r\n\r\n        const appBody = document.getElementById('app-body');\r\n        if (appBody) {\r\n            appBody.innerHTML = `\r\n            <div class=\"container pt-2\">\r\n            <form id=\"login-form\" class=\"p-4 border rounded\">\r\n                <div class=\"mb-3\">\r\n                <label for=\"organization\" class=\"form-label fw-bold\">Organization</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"organization\" required>\r\n                </div>\r\n                <div class=\"mb-3\">\r\n                <label for=\"username\" class=\"form-label fw-bold\">Username</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"username\" required>\r\n                </div>\r\n                <div class=\"mb-3\">\r\n                <label for=\"password\" class=\"form-label fw-bold\">Password</label>\r\n                <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n                </div>\r\n                <div class=\"d-grid\">\r\n                <button type=\"submit\" class=\"btn btn-primary bg-primary-clr\">Login</button>\r\n                </div>\r\n            <div id=\"login-error\" class=\"mt-3 text-danger\" style=\"display: none;\"></div>\r\n            </form>\r\n            </div>`;\r\n        }\r\n\r\n        // Attach Event Listeners\r\n        document.getElementById('theme-toggle')?.addEventListener('click', themeToggleCallback);\r\n        document.getElementById('login-form')?.addEventListener('submit', handleLoginCallback);\r\n    }\r\n\r\n    static applyTheme(theme: 'Light' | 'Dark'): void {\r\n        const isDark = theme === 'Dark';\r\n        const isLight = theme === 'Light';\r\n\r\n        const safeApplyClass = (selector: string, darkClasses: string, lightClasses: string) => {\r\n            const elements = document.querySelectorAll(selector);\r\n            const darkClassList = darkClasses.split(' ');\r\n            const lightClassList = lightClasses.split(' ');\r\n\r\n            elements.forEach(elem => {\r\n                if (!elem) return;\r\n                elem.classList.remove(...darkClassList);\r\n                elem.classList.remove(...lightClassList);\r\n                if (isDark) elem.classList.add(...darkClassList);\r\n                if (isLight) elem.classList.add(...lightClassList);\r\n            });\r\n        };\r\n\r\n        // Apply Global Toggles\r\n        document.body.classList.toggle('dark-theme', isDark);\r\n        document.body.classList.toggle('light-theme', isLight);\r\n\r\n        // Apply Specific Element Classes\r\n        safeApplyClass('#app-body', 'bg-dark text-light', 'bg-white text-dark');\r\n        safeApplyClass('#search-box', 'bg-secondary text-light border-0', 'bg-white text-dark border');\r\n        safeApplyClass('.dropdown-menu', 'bg-dark text-light border-light', 'bg-white text-dark border');\r\n        safeApplyClass('.list-group-item', 'bg-dark text-light', 'bg-white text-dark');\r\n        safeApplyClass('.dropdown-toggle', 'bg-dark text-light border-0', 'bg-white text-dark border');\r\n        safeApplyClass('.dropdown-item', 'bg-dark text-light', 'bg-white text-dark');\r\n        safeApplyClass('.card', 'bg-dark text-light border-secondary', 'bg-white text-dark border');\r\n        safeApplyClass('.card-header', 'bg-secondary text-light border-secondary', 'bg-light text-dark border-bottom');\r\n        safeApplyClass('.box', 'bg-dark text-light border-secondary', 'bg-light text-dark border');\r\n        safeApplyClass('.modal-content', 'bg-dark text-light border-secondary', 'bg-white text-dark border');\r\n\r\n        safeApplyClass(\r\n            '.list-group-item-action',\r\n            'bg-dark text-light list-hover-dark',\r\n            'bg-light text-dark list-hover-light'\r\n        );\r\n\r\n        safeApplyClass('#close-ai-window', 'fa-solid fa-circle-xmark bg-dark text-light', 'fa-solid fa-circle-xmark bg-light text-dark');\r\n        safeApplyClass('#chatInput', 'bg-secondary text-light', 'bg-white text-dark');\r\n        safeApplyClass('.prompt-text', 'bg-secondary text-light', 'bg-white text-dark');\r\n\r\n        // Toggle Icon\r\n        const themeToggle = document.getElementById('theme-toggle');\r\n        const icon = themeToggle?.querySelector('i');\r\n        if (icon) {\r\n            if (isDark) {\r\n                icon.classList.remove('fa-moon');\r\n                icon.classList.add('fa-sun');\r\n            } else {\r\n                icon.classList.remove('fa-sun');\r\n                icon.classList.add('fa-moon');\r\n            }\r\n        }\r\n    }\r\n\r\n    static attachDashboardEvents(\r\n        handlers: {\r\n            onHome: () => void,\r\n            onSummary: () => void,\r\n            onGlossary: () => void,\r\n            onFormat: () => void,\r\n            onRemoveFormat: () => void,\r\n            onThemeToggle: () => void,\r\n            onLogout: () => void\r\n        }\r\n    ): void {\r\n        document.getElementById('home')?.addEventListener('click', handlers.onHome);\r\n        document.getElementById('summary-mode')?.addEventListener('click', handlers.onSummary);\r\n        document.getElementById('glossary')?.addEventListener('click', handlers.onGlossary);\r\n        document.getElementById('define-formatting')?.addEventListener('click', handlers.onFormat);\r\n        document.getElementById('removeFormatting')?.addEventListener('click', handlers.onRemoveFormat);\r\n        document.getElementById('theme-toggle')?.addEventListener('click', handlers.onThemeToggle);\r\n        document.getElementById('logout')?.addEventListener('click', handlers.onLogout);\r\n    }\r\n}\r\n","// Imports\nimport { CONFIG } from \"./utils/config\";\nimport { AuthService } from \"./services/auth.service\";\nimport { DocumentService } from \"./services/document.service\";\nimport { UIService } from \"./services/ui.service\";\nimport { StoreService } from \"./services/store.service\";\nimport { AIService } from \"./services/ai.service\";\n// Note: GlossaryService import removed if unused or moved\n\n// Restoration of variables needed by the rest of the file (Legacy Support - check if needed)\nimport { generateCheckboxHistory, getDateTimeStamp, initializeAIHistoryEvents, loadHomepage, replaceMention, setupPromptBuilderUI } from \"./draft/home\";\nimport { chatfooter, colorTable, insertLineWithHeadingStyle, mapImagesToComponentObjects, resolveWordTableStyle, selectMatchingBookmarkFromSelection, svgBase64ToPngBase64, switchModeIcon, switchToAddTag, switchToPromptBuilder, updateEditorFinalTable } from \"./draft/draft-functions\";\nimport { addtagbody, customizeTablePopup, logoheader, navTabs, toaster } from \"./components/bodyelements\";\nimport { addAiHistory, addGroupKey, fetchGlossaryTemplate, getAiHistory, getAllClients, getAllCustomTables, getAllPromptTemplates, getGeneralImages, getReportById, getReportHeadImageById, loginUser, updateGroupKey } from \"./draft/draft.api\";\nimport { wordTableStyles } from \"./components/tablestyles\";\nimport { renderSelectedTags } from \"./draft/draft-functions\";\nimport { loadSummarypage } from \"./summary/summary\";\n\nOffice.onReady((info) => {\n  if (info.host === Office.HostType.Word) {\n    document.getElementById(\"app-body\").style.display = \"flex\";\n    document.getElementById(\"footer\").innerText = ` ${new Date().getFullYear()} - TrialAssure LINK AI Assistant ${CONFIG.version}`;\n\n    // Initialize Services\n    // AuthService.init(); // if needed\n\n    // Retrieve Properties via Service\n    DocumentService.retrieveDocumentProperties().then((props) => {\n      if (props) {\n        // Update local state for legacy compatibility\n        // documentID = props.documentID; // Moved to Store\n        // organizationName = props.organizationName; // Moved to Store\n        const store = StoreService.getInstance();\n        store.documentID = props.documentID;\n        store.organizationName = props.organizationName;\n\n        // Check Session\n        const session = AuthService.restoreSession();\n        if (session) {\n          // Restore session state\n          store.jwt = session.jwt;\n          store.UserRole = session.userRole;\n          if (session.tableStyle) store.tableStyle = session.tableStyle;\n          if (session.colorPallete) store.colorPallete = session.colorPallete;\n\n          window.location.hash = '#/dashboard';\n          toaster('You are successfully logged in', 'success');\n          displayMenu(); // Trigger legacy menu display\n        } else {\n          loadLoginPage();\n        }\n\n      } else {\n        document.getElementById('app-body').innerHTML = `\n        <p class=\"px-3 text-center\">Export a document from the LINK AI application to use this functionality.</p>`\n        console.log(`Custom property \"documentID\" not found.`);\n      }\n    }).catch(err => {\n      console.error(\"Failed to initialize\", err);\n    });\n\n    // Restore theme preference from sessionStorage\n    const store = StoreService.getInstance();\n    const savedTheme = sessionStorage.getItem('theme');\n    if (savedTheme) {\n      store.theme = savedTheme;\n      UIService.applyTheme(savedTheme as 'Light' | 'Dark');\n    }\n\n    // Setup UI\n    setupEventHandlers();\n  }\n});\n\nfunction setupEventHandlers() {\n  // Porting event listeners\n  document.getElementById(\"login-btn\")?.addEventListener(\"click\", handleLogin);\n}\n\nasync function login() {\n  // document.getElementById('header').innerHTML = ``\n  const sessionToken = sessionStorage.getItem('token');\n  const store = StoreService.getInstance();\n  if (sessionToken) {\n    store.UserRole = JSON.parse(sessionStorage.getItem('userRole')) || ''\n    store.jwt = sessionToken;\n    window.location.hash = '#/dashboard';\n    const style = sessionStorage.getItem('tableStyle');\n    if (style) {\n      store.tableStyle = style;\n    }\n    const localPallete = sessionStorage.getItem('colorPallete');\n    if (localPallete) {\n      store.colorPallete = JSON.parse(localPallete);\n    }\n\n  } else {\n    loadLoginPage();\n  }\n}\n\nfunction loadLoginPage() {\n  const store = StoreService.getInstance();\n  UIService.renderLoginPage(CONFIG.storeUrl, handleLogin, () => {\n    store.theme = store.theme === 'Light' ? 'Dark' : 'Light';\n    UIService.applyTheme(store.theme as 'Light' | 'Dark');\n    sessionStorage.setItem('theme', store.theme);\n  });\n}\n\nasync function handleLogin(event) {\n  event.preventDefault();\n\n  const organization = (document.getElementById('organization') as HTMLInputElement).value;\n  const username = (document.getElementById('username') as HTMLInputElement).value;\n  const password = (document.getElementById('password') as HTMLInputElement).value;\n\n  const store = StoreService.getInstance();\n\n  if (organization.toLowerCase().trim() === store.organizationName.toLocaleLowerCase().trim()) {\n    UIService.toggleLoader(true);\n\n    // Use AuthService\n    const result = await AuthService.login(organization, username, password);\n\n    // Hide loader is handled by UI replacement or overwrite below? \n    // Legacy code overwrote app-body with loader, so we need to be careful.\n    // Actually, legacy code replaced innerHTML with loader. calling displayMenu() replaces it again.\n\n    if (result.success) {\n      const data = result.data;\n      const store = StoreService.getInstance();\n      store.jwt = data.token;\n      store.UserRole = data.userRole;\n\n      // Preserve legacy logic for style restoring if it was there\n      const style = sessionStorage.getItem('tableStyle');\n      if (style) store.tableStyle = style;\n\n      const localPallete = sessionStorage.getItem('colorPallete');\n      if (localPallete) store.colorPallete = JSON.parse(localPallete);\n\n      toaster('You are successfully logged in', 'success');\n      displayMenu();\n      window.location.hash = '#/dashboard';\n    } else {\n      showLoginError(result.message || \"Login failed\");\n    }\n  } else {\n    showLoginError(\"The organization specified is not associated with this document\")\n  }\n}\n\nfunction showLoginError(message) {\n  loadLoginPage();  // Reload the form UI\n  const errorDiv = document.getElementById('login-error');\n  errorDiv.style.display = 'block';\n  errorDiv.textContent = message;\n}\n\nfunction displayMenu() {\n  const store = StoreService.getInstance();\n  store.userId = Number(sessionStorage.getItem('userId'))\n  // document.getElementById('aitag').addEventListener('click', redirectAI);\n  fetchDocument('Init');\n\n}\n\nasync function getTableStyle() {\n  const store = StoreService.getInstance();\n  const tableStyleObj = await getAllCustomTables(store.jwt);\n  store.customTableStyle = tableStyleObj['Data'];\n  const selectedTable = store.customTableStyle.find(style => style.ID === store.dataList.TableCustomizationID);\n  if (selectedTable) {\n    sessionStorage.setItem(\"CustomStyle\", selectedTable ? selectedTable.Name : '');\n    store.colorPallete = {\n      \"Header\": selectedTable.Setting.HeaderColor,\n      \"Primary\": selectedTable.Setting.PrimaryColor,\n      \"Secondary\": selectedTable.Setting.SecondaryColor,\n      \"Customize\": true,\n      \"IsHeaderBold\": selectedTable.Setting.IsHeaderBold,\n      \"IsSideHeaderBold\": selectedTable.Setting.IsSideHeaderBold\n    };\n    store.tableStyle = selectedTable.Setting.BaseStyle;\n  }\n\n}\n\nasync function fetchDocument(action) {\n  UIService.toggleLoader(true);\n  try {\n    const store = StoreService.getInstance();\n    const userId = sessionStorage.getItem('userId') || '0';\n    const reportData = await DocumentService.loadReportData(store.documentID, store.jwt, userId);\n\n    // Assign to store\n    store.dataList = reportData.dataList;\n    await getTableStyle();\n    await loadPromptTemplates();\n    store.availableKeys = reportData.availableKeys;\n    store.sourceList = reportData.sourceList;\n    store.clientId = reportData.clientId;\n    // Global Assignment\n    store.aiTagList = reportData.aiTagList;\n    store.imageList = reportData.imageList;\n    store.clientList = reportData.clientList;\n    // promptBuilderList = reportData.promptBuilderList;\n\n    // Handle Side Effects\n    if (action === 'AIpanel' || action === 'Refresh' || action === 'Init') {\n      if (store.mode === \"Home\") loadHomepage(store.availableKeys);\n      if (store.mode === \"Summary\") loadSummarypage(store.availableKeys);\n    }\n\n    // Render navigation header\n    const logoHeaderEl = document.getElementById('logo-header');\n    if (logoHeaderEl) {\n      logoHeaderEl.innerHTML = logoheader(CONFIG.storeUrl);\n    }\n\n    switchModeIcon();\n    UIService.toggleLoader(false);\n\n    // Fetch images in background\n    getImages();\n\n    // Event Wiring\n    UIService.attachDashboardEvents({\n      onHome: async () => {\n        if (!store.isPendingResponse) {\n          if (store.isGlossaryActive) await removeMatchingContentControls();\n          loadHomepage(store.availableKeys);\n        }\n        store.mode = 'Home';\n        switchModeIcon();\n      },\n      onSummary: async () => {\n        if (!store.isPendingResponse) {\n          if (store.isGlossaryActive) await removeMatchingContentControls();\n          loadSummarypage(store.availableKeys);\n        }\n        store.mode = 'Summary';\n        switchModeIcon();\n      },\n      onGlossary: () => {\n        if (store.emptyFormat) fetchGlossary();\n      },\n      onFormat: () => {\n        if (!store.isPendingResponse) formatOptionsDisplay();\n      },\n      onRemoveFormat: () => {\n        if (Object.keys(store.capturedFormatting).length > 0) removeOptionsConfirmation();\n      },\n      onThemeToggle: () => {\n        store.theme = store.theme === 'Light' ? 'Dark' : 'Light';\n        UIService.applyTheme(store.theme as 'Light' | 'Dark');\n        sessionStorage.setItem('theme', store.theme);\n      },\n      onLogout: async () => {\n        if (!store.isPendingResponse) {\n          if (store.isGlossaryActive) await removeMatchingContentControls();\n          logout();\n        }\n      }\n    });\n\n    // Register selection change handler for tag detection\n    if (action === 'Init') {\n      Office.context.document.addHandlerAsync(\n        Office.EventType.DocumentSelectionChanged,\n        handleSelectionChange\n      );\n    }\n\n    UIService.toggleLoader(false);\n  } catch (error) {\n    console.error(\"Error loading document data\", error);\n    UIService.showNotification(\"Error loading data\", \"error\");\n    UIService.toggleLoader(false);\n  }\n}\n\nexport async function formatOptionsDisplay() {\n  const store = StoreService.getInstance();\n  if (!store.isTagUpdating) { // Check if isTagUpdating is false\n    if (store.isGlossaryActive) {\n      await removeMatchingContentControls();\n    }\n    const htmlBody = `\n      <div class=\"container pt-3\">\n        <div class=\"card\">\n          <div class=\"card-header\">\n               <!-- Buttons for Capture and Empty Format -->\n            <div class=\"d-flex justify-content-end\">\n              <button id=\"capture-format-btn\" class=\"btn btn-primary bg-primary-clr\"><i class=\"fa fa-border-style me-1\"></i>  Capture Format</button>\n            </div>\n            <!-- <h5 class=\"card-title\">Formatting Options</h5> -->\n          </div>\n          <div class=\"card-body\">\n          <div class=\"formating-checkbox\">\n               <input type=\"checkbox\" id=\"empty-format-checkbox\" class=\"form-check-input\">\n              <label for=\"empty-format-checkbox\" class=\"form-check-label empty-format-checkbox-label\" style=\"flex: 1;\">\n                   Skip ignoring and removing format-based text\n              </label>\n            </div>\n\n            <!-- Section to display captured formatting -->\n            <div id=\"format-details\">\n              <h5 class=\"my-3\">Selected Formatting:</h5>\n              <ul id=\"format-list\" class=\"list-unstyled\"></ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n\n    document.getElementById('app-body').innerHTML = htmlBody;\n    if (Object.keys(store.capturedFormatting).length === 0) {\n      const formatDetails = document.getElementById(\"format-details\");\n      formatDetails.style.display = 'none';\n      // The object is not empty\n    }\n\n    const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\n    if (!glossaryBtn.classList.contains('disabled-link')) {\n      glossaryBtn.classList.add('disabled-link');\n    }\n\n    if (store.emptyFormat) {\n      clearCapturedFormatting();\n    }\n    else {\n      if (store.capturedFormatting.Bold === null || store.capturedFormatting.Bold === undefined ||\n        store.capturedFormatting.Underline === 'Mixed' || store.capturedFormatting.Underline === undefined ||\n        store.capturedFormatting.Size === null || store.capturedFormatting.Size === undefined ||\n        store.capturedFormatting[\"Font Name\"] === null || store.capturedFormatting[\"Font Name\"] === undefined ||\n        store.capturedFormatting[\"Background Color\"] === '' || store.capturedFormatting[\"Background Color\"] === undefined ||\n        store.capturedFormatting[\"Text Color\"] === '' || store.capturedFormatting[\"Text Color\"] === undefined) {\n        const formatList = document.getElementById(\"format-list\");\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\n\n\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\n          removeFormatBtn.classList.add('disabled-link');\n        }\n      } else {\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\n        removeFormatBtn.classList.remove('disabled-link');\n        displayCapturedFormatting();\n      }\n    }\n    // Event listeners for the buttons\n\n    document.getElementById(\"capture-format-btn\").addEventListener(\"click\", captureFormatting);\n\n    const emptyFormatCheckbox = document.getElementById(\"empty-format-checkbox\") as HTMLInputElement;\n    if (store.isNoFormatTextAvailable) {\n      emptyFormatCheckbox.checked = true;\n      clearCapturedFormatting();\n    }\n\n    emptyFormatCheckbox.addEventListener(\"change\", () => {\n      if (emptyFormatCheckbox.checked) {\n        store.isNoFormatTextAvailable = true;\n        clearCapturedFormatting();\n      } else {\n        const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\n        CaptureBtn.disabled = false;\n        store.isNoFormatTextAvailable = false;\n        store.emptyFormat = false;\n        const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\n        if (!glossaryBtn.classList.contains('disabled-link')) {\n          glossaryBtn.classList.add('disabled-link');\n        }\n      }\n    });\n\n  }\n}\n\n\n\nfunction displayCapturedFormatting() {\n  const store = StoreService.getInstance();\n  store.emptyFormat = false;\n  const formatList = document.getElementById(\"format-list\");\n  formatList.innerHTML = \"\"; // Clear the list before adding new items\n\n  for (const [key, value] of Object.entries(store.capturedFormatting)) {\n    if ((key === \"Text Color\" || key === \"Background Color\") && value) {\n      formatList.innerHTML += `\n        <li><strong>${key}:</strong>${value}\n          <span style=\"display:inline-block;width:15px;height:15px;background-color:${value};border:1px solid black;\"></span>\n        </li>\n      `;\n    } else {\n      formatList.innerHTML += `<li><strong>${key}:</strong> ${value}</li>`;\n    }\n  }\n}\n\nfunction clearCapturedFormatting() {\n  const store = StoreService.getInstance();\n  store.capturedFormatting = {}; // Clear the captured formatting object\n  const formatDetails = document.getElementById(\"format-details\");\n  formatDetails.style.display = 'none';\n  // formatList.innerHTML = `<li>No formatting selected.</li>`;\n  store.emptyFormat = true;\n  const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\n  glossaryBtn.classList.remove('disabled-link');\n  const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\n  CaptureBtn.disabled = true;\n\n\n  const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\n  if (!removeFormatBtn.classList.contains('disabled-link')) {\n    removeFormatBtn.classList.add('disabled-link');\n  }\n  console.log(\"Captured formatting cleared.\");\n}\n\nasync function captureFormatting() {\n  try {\n    await Word.run(async (context) => {\n      const selection = context.document.getSelection();\n      const font = selection.font;\n      font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\n\n      await context.sync();\n\n      const store = StoreService.getInstance();\n\n      store.capturedFormatting = {\n        Bold: font.bold,\n        Italic: font.italic,\n        Underline: font.underline,\n        Size: font.size,\n        \"Background Color\": font.highlightColor,\n        \"Font Name\": font.name,\n        'Text Color': font.color\n      };\n\n\n\n      const formatDetails = document.getElementById(\"format-details\");\n      formatDetails.style.display = 'block';\n\n      if (store.capturedFormatting.Bold === null ||\n        store.capturedFormatting.Underline === 'Mixed' ||\n        store.capturedFormatting.Size === null ||\n        store.capturedFormatting[\"Font Name\"] === null ||\n        store.capturedFormatting[\"Background Color\"] === '' ||\n        store.capturedFormatting[\"Text Color\"] === ''\n\n      ) {\n        const formatList = document.getElementById(\"format-list\");\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\n          removeFormatBtn.classList.add('disabled-link');\n        }\n\n      } else {\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\n        removeFormatBtn.classList.remove('disabled-link');\n        displayCapturedFormatting();\n      }\n    });\n  } catch (error) {\n    console.error(\"Error capturing formatting:\", error);\n  }\n}\n\n\n\nasync function removeOptionsConfirmation() {\n  const store = StoreService.getInstance();\n  if (!store.isTagUpdating) {\n    if (store.isGlossaryActive) {\n      await removeMatchingContentControls();\n    } // Check if isTagUpdating is false\n    const htmlBody = `\n      <div class=\"container pt-3\">\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h5 class=\"card-title\">Are you sure you want to remove formatted text ?</h5>\n          </div>\n          <div class=\"card-body\">\n          <div id=\"format-details\">\n              <h5>Selected Formatting:</h5>\n              <ul id=\"format-list\" class=\"list-unstyled mb-3\"></ul>\n              <small class=\"text-secondary font-italic\" id=\"warning-rem-fmt\"></small>\n             \n            </div>\n               <!-- Buttons for Capture and Empty Format -->\n\n            <div class=\"mt-3 d-flex justify-content-between\">\n              <span id=\"change-ft-btn\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\n              <button id=\"clear-ft-btn\" class=\"btn btn-primary px-3\"><i class=\"fa fa-check-circle me-2\"></i>Yes</button>\n\n            </div>\n\n            \n          </div>\n        </div>\n      </div>\n    `;\n\n\n\n    document.getElementById('app-body').innerHTML = htmlBody;\n    displayCapturedFormatting();\n\n    if (store.capturedFormatting['Background Color'] === null &&\n      store.capturedFormatting['Text Color'] === '#000000') {\n      const warningEle = document.getElementById('warning-rem-fmt').innerHTML = 'Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?'\n    }\n\n    // Event listeners for the buttons\n    document.getElementById(\"clear-ft-btn\").addEventListener(\"click\", removeFormattedText);\n    document.getElementById(\"change-ft-btn\").addEventListener(\"click\", formatOptionsDisplay);\n\n  }\n}\n\nasync function removeFormattedText() {\n  try {\n    await Word.run(async (context) => {\n\n      const iconelement = document.getElementById(`clear-ft-btn`);\n      iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Yes`;\n      const clrBtn = document.getElementById('clear-ft-btn') as HTMLButtonElement;\n      clrBtn.disabled = true;\n\n      const changeBtn = document.getElementById('change-ft-btn') as HTMLButtonElement;\n      changeBtn.disabled = true;\n      const paragraphs = context.document.body.paragraphs;\n      paragraphs.load(\"items\"); // Load paragraphs from the body\n\n      await context.sync();\n\n      const store = StoreService.getInstance();\n\n      // Iterate through each paragraph in the document body\n      for (const paragraph of paragraphs.items) {\n\n        // Check if the paragraph contains text\n        if (paragraph.text.trim() !== \"\") {\n          const textRanges = paragraph.split([\" \"], true, true); // Split paragraph into individual words/segments\n          textRanges.load(\"items, font\");\n\n          await context.sync();\n\n          for (const range of textRanges.items) {\n            const font = range.font;\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\n\n            await context.sync();\n\n            // Check if the text range matches the captured formatting\n            if (\n              font.highlightColor === store.capturedFormatting['Background Color'] &&\n              font.color === store.capturedFormatting['Text Color'] &&\n              font.bold === store.capturedFormatting['Bold'] &&\n              font.italic === store.capturedFormatting['Italic'] &&\n              font.size === store.capturedFormatting['Size'] &&\n              font.underline === store.capturedFormatting['Underline'] &&\n              font.name === store.capturedFormatting['Font Name']\n            ) {\n              // Clear the range whether it's a full word or part of a word\n              font.highlightColor = \"#FFFFFF\"; // Set new background color\n              font.color = \"#000000\"; // Set new text color\n              font.bold = false; // Reset bold if needed\n              font.italic = false; // Reset italic if needed\n              font.underline = \"None\";\n              paragraph.insertText(\" \", Word.InsertLocation.replace);\n            }\n          }\n        }\n      }\n\n      await context.sync();\n      store.capturedFormatting = {}; // Clear the captured formatting object\n      const formatDetails = document.getElementById(\"format-details\");\n      formatDetails.style.display = 'none';\n      // formatList.innerHTML = `<li>No formatting selected.</li>`;\n      store.emptyFormat = true;\n      store.isNoFormatTextAvailable = true;\n      const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\n      glossaryBtn.classList.remove('disabled-link');\n      formatOptionsDisplay()\n    });\n  } catch (error) {\n    console.error(\"Error removing formatted text:\", error);\n  }\n}\n\n\n// fetchAIHistory and sendPrompt moved to AIService\n// Left empty or removed to prevent errors if these were exported.\n// Since we removed exports at the top, we can now remove the functions.\n\n\n\n\n\n// Your existing copyText function\n\n\n\nasync function logout() {\n  const store = StoreService.getInstance();\n  if (store.isGlossaryActive) {\n    await removeMatchingContentControls();\n  }\n  sessionStorage.clear();\n  window.location.hash = '#/new';\n  store.initialised = true;\n  document.getElementById('logo-header').innerHTML = ``;\n  login();\n}\n\nexport async function applyTagFn() {\n\n  return Word.run(async (context) => {\n    try {\n      const body = context.document.body;\n\n      context.load(body, 'text');\n      await context.sync();\n      await applyAITagFn(body, context);\n      await applyImageTagFn(body, context);\n    } catch (err) {\n      toaster(\"Something went wrong\", \"error\")\n      console.error(\"Error during tag application:\", err);\n      const store = StoreService.getInstance();\n      loadHomepage(store.availableKeys);\n    }\n  });\n}\n\nasync function applyImageTagFn(body: Word.Body, context: Word.RequestContext) {\n  const store = StoreService.getInstance();\n  for (let i = 0; i < store.imageList.length; i++) {\n    const tag = store.imageList[i];\n    const searchResults = body.search(`$${tag.DisplayName}$`, {\n      matchCase: false,\n      matchWholeWord: false,\n    });\n    context.load(searchResults, 'items');\n    await context.sync();\n\n    for (const item of searchResults.items) {\n      if (tag.EditorValue !== \"\") {\n        let base64Image: string = tag.EditorValue;\n\n        // Clean base64\n        if (!base64Image) continue;\n\n        // Convert SVG  PNG\n        if (base64Image.startsWith(\"data:image/svg+xml\")) {\n          base64Image = await svgBase64ToPngBase64(base64Image);\n        }\n        // Already PNG/JPEG  strip data prefix\n        else if (base64Image.startsWith(\"data:image\")) {\n          base64Image = base64Image.split(\",\")[1];\n        }\n\n        const imageRange = item.getRange();\n        imageRange.insertInlinePictureFromBase64(base64Image, Word.InsertLocation.replace);\n        await context.sync();\n      }\n    }\n  }\n  await context.sync();\n  toaster(\"AI tag application completed!\", \"success\");\n  loadHomepage(store.availableKeys);\n}\n\nexport async function applyAITagFn(\n  body: Word.Body,\n  context: Word.RequestContext\n) {\n  document.getElementById('app-body').innerHTML = `\n  <div id=\"button-container\">\n    <div class=\"loader\" id=\"loader\"></div>\n    <div id=\"highlighted-text\"></div>\n  </div>`\n  toaster(\"Please wait... applying AI tags\", \"info\");\n\n  const store = StoreService.getInstance();\n  for (const tag of store.aiTagList) {\n    tag.EditorValue = removeQuotes(tag.EditorValue);\n    if (!tag.EditorValue || tag.IsApplied) continue;\n\n    const results = body.search(`#${tag.DisplayName}#`, {\n      matchCase: false,\n      matchWholeWord: false\n    });\n\n    context.load(results, \"items\");\n    await context.sync();\n\n    for (const item of results.items) {\n\n      /* --------------------------------------------------\n         1 Anchor correctly (NO invisible chars)\n      -------------------------------------------------- */\n      const anchor = item.getRange(\"Start\");\n\n      // Remove placeholder text completely\n      item.delete();\n      await context.sync();\n\n      let cursor = anchor;\n\n      let bookmarkStart: Word.Range | null = null;\n      let bookmarkEnd: Word.Range | null = null;\n\n      const include = (r: Word.Range) => {\n        if (!bookmarkStart) {\n          bookmarkStart = r.getRange(\"Start\");\n        }\n        bookmarkEnd = r.getRange(\"End\");\n      };\n\n      /* --------------------------------------------------\n         2 Insert content forward from anchor\n      -------------------------------------------------- */\n\n      // TABLE CONTENT\n      if (tag.ComponentKeyDataType === \"TABLE\") {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(tag.EditorValue, \"text/html\");\n        const nodes = Array.from(doc.body.childNodes);\n\n        for (const node of nodes) {\n\n          // TEXT NODE\n          if (node.nodeType === Node.TEXT_NODE) {\n            let txt = node.textContent?.trim();\n            if (!txt) continue;\n\n            txt = txt.replace(/\\n- /g, \"\\n \");\n            for (const line of txt.split(\"\\n\")) {\n              if (!line.trim()) continue;\n\n              const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\n              insertLineWithHeadingStyle(p, line);\n\n              include(p.getRange());\n              cursor = p.getRange();\n            }\n          }\n\n          // ELEMENT NODE\n          else if (node.nodeType === Node.ELEMENT_NODE) {\n            const el = node as HTMLElement;\n\n            // TABLE\n            if (el.tagName.toLowerCase() === \"table\") {\n              const rows = Array.from(el.querySelectorAll(\"tr\"));\n              if (!rows.length) continue;\n\n              const maxCols = Math.max(\n                ...rows.map(r =>\n                  Array.from(r.querySelectorAll(\"td, th\")).reduce(\n                    (s, c) =>\n                      s + parseInt(c.getAttribute(\"colspan\") || \"1\", 10),\n                    0\n                  )\n                )\n              );\n\n              const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\n              const table = p.insertTable(\n                rows.length,\n                maxCols,\n                Word.InsertLocation.after\n              );\n\n              const store = StoreService.getInstance();\n              const resolvedTableStyle = resolveWordTableStyle(store.tableStyle);\n              if (resolvedTableStyle !== 'none') {\n                table.style = resolvedTableStyle;\n              }\n\n              if (store.colorPallete.Customize) {\n                await colorTable(table, rows, context);\n              } else {\n                const rowspanTracker: number[] = new Array(maxCols).fill(0);\n                let lastParamRowIndex = -1; // row index of last non-empty Parameter cell\n\n                rows.forEach((row, rowIndex) => {\n                  const cells = Array.from(row.querySelectorAll('td, th'));\n                  let cellIndex = 0;\n\n                  // track first column text in HTML row\n                  let firstColText = \"\";\n\n                  cells.forEach((cell) => {\n                    while (rowspanTracker[cellIndex] > 0) {\n                      rowspanTracker[cellIndex]--;\n                      cellIndex++;\n                    }\n\n                    const cellText = Array.from(cell.childNodes)\n                      .map(node => {\n                        if (node.nodeType === Node.TEXT_NODE) {\n                          return node.textContent?.trim() || '';\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\n                          return (node as HTMLElement).innerText.trim();\n                        }\n                        return '';\n                      })\n                      .filter(text => text.length > 0)\n                      .join(' ');\n\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\n\n                    // save first column text if this is first column\n                    if (cellIndex === 0) {\n                      firstColText = cellText.trim();\n                    }\n\n                    table.getCell(rowIndex, cellIndex).value = cellText;\n\n                    // colspan blank filling\n                    for (let i = 1; i < colspan; i++) {\n                      if (cellIndex + i < maxCols) {\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\n                      }\n                    }\n\n                    // rowspan tracking\n                    if (rowspan > 1) {\n                      for (let i = 0; i < colspan; i++) {\n                        if (cellIndex + i < maxCols) {\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\n                        }\n                      }\n                    }\n\n                    cellIndex += colspan;\n                  });\n\n                  //  AFTER filling the row  apply merge logic for 1st column\n                  if (rowIndex === 0) {\n                    // header row typically\n                    return;\n                  }\n\n                  if (firstColText) {\n                    // new parameter starts\n                    lastParamRowIndex = rowIndex;\n                  } else {\n                    // empty parameter row  merge vertically with previous parameter row\n                    if (lastParamRowIndex !== -1) {\n                      const topCell = table.getCell(lastParamRowIndex, 0);\n                      const bottomCell = table.getCell(rowIndex, 0);\n\n                      // merge bottom into top\n                      topCell.merge(bottomCell);\n\n                      //  center align merged cell\n                      try {\n                        topCell.verticalAlignment = Word.VerticalAlignment.center;\n                        topCell.body.paragraphs.getFirst().alignment = Word.Alignment.center;\n                      } catch (e) {\n                        // ignore (safe fallback)\n                      }\n                    }\n                  }\n                });\n\n              }\n\n              include(table.getRange());\n              cursor = table.getRange();\n            }\n\n            // OTHER ELEMENTS\n            else {\n              let txt = el.innerText?.trim();\n              if (!txt) continue;\n\n              txt = txt.replace(/\\n- /g, \"\\n \");\n              for (const line of txt.split(\"\\n\")) {\n                if (!line.trim()) continue;\n\n                const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\n                insertLineWithHeadingStyle(p, line);\n\n                include(p.getRange());\n                cursor = p.getRange();\n              }\n            }\n          }\n        }\n      }\n\n      // IMAGE CONTENT\n      else if (tag.ComponentKeyDataType === \"IMAGE\") {\n        let base64 = tag.EditorValue;\n\n        if (base64.startsWith(\"data:image/svg+xml\")) {\n          base64 = await svgBase64ToPngBase64(base64);\n        } else if (base64.startsWith(\"data:image\")) {\n          base64 = base64.split(\",\")[1];\n        }\n\n        const pic = cursor.insertInlinePictureFromBase64(\n          base64,\n          Word.InsertLocation.after\n        );\n\n        include(pic.getRange());\n        cursor = pic.getRange();\n      }\n\n      // TEXT CONTENT\n      else {\n        const txt = tag.EditorValue\n          .replace(/\\n- /g, \"\\n \")\n          .trim();\n\n        for (const line of txt.split(\"\\n\")) {\n          if (!line.trim()) continue;\n\n          const p = cursor.insertParagraph(\"\", Word.InsertLocation.after);\n          insertLineWithHeadingStyle(p, line);\n\n          include(p.getRange());\n          cursor = p.getRange();\n        }\n      }\n\n      await context.sync();\n\n      /* --------------------------------------------------\n         3 Create SINGLE bookmark\n      -------------------------------------------------- */\n      if (bookmarkStart && bookmarkEnd) {\n        const bookmarkName = `ID${tag.ID}_Split_${getDateTimeStamp()}`;\n        bookmarkStart.expandTo(bookmarkEnd).insertBookmark(bookmarkName);\n      }\n    }\n  }\n}\n\nexport async function normalizeBlankLines(\n  context: Word.RequestContext\n) {\n  const paragraphs = context.document.body.paragraphs;\n  context.load(paragraphs, \"items, text\");\n  await context.sync();\n\n  let previousWasEmpty = false;\n\n  for (const p of paragraphs.items) {\n    const isEmpty = !p.text || p.text.trim() === \"\";\n\n    if (isEmpty && previousWasEmpty) {\n      p.delete();\n    }\n\n    previousWasEmpty = isEmpty;\n  }\n\n  await context.sync();\n}\n\nexport async function removeTrailingEmptyParagraphs(\n  context: Word.RequestContext\n) {\n  const paragraphs = context.document.body.paragraphs;\n  context.load(paragraphs, \"items, text\");\n  await context.sync();\n\n  for (let i = paragraphs.items.length - 1; i >= 0; i--) {\n    const p = paragraphs.items[i];\n\n    if (!p.text || p.text.trim() === \"\") {\n      p.delete();\n    } else {\n      break; // stop once real content is found\n    }\n  }\n\n  await context.sync();\n}\n\nasync function fetchGlossary() {\n  const store = StoreService.getInstance();\n  if (!store.isTagUpdating) {\n\n    document.getElementById('app-body').innerHTML = `\n  <div id=\"button-container\">\n\n          <div class=\"loader\" id=\"loader\"></div>\n\n        <div id=\"highlighted-text\"></div>`\n\n    loadGlossary()\n\n  }\n\n}\n\n\nfunction loadGlossary() {\n  document.getElementById('app-body').innerHTML = `\n        <div id=\"button-container\">\n          <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\n        </div>\n  `\n  document.getElementById('applyglossary').addEventListener('click', applyglossary);\n\n\n}\n\n\n\nexport async function applyglossary() {\n  document.getElementById('app-body').innerHTML = `\n  <div id=\"button-container\">\n\n          <div class=\"loader\" id=\"loader\"></div>\n\n        <div id=\"highlighted-text\"></div>`\n\n  try {\n\n    await Word.run(async (context) => {\n\n\n      const body = context.document.body;\n      body.load(\"text\");\n      await context.sync(); // Sync to get the text content\n\n      const bodyText = {\n        \"Content\": body.text.replace(/[\\n\\r]/g, ' ')\n      };\n      try {\n        const store = StoreService.getInstance();\n        const data = await fetchGlossaryTemplate(store.dataList?.ClientID, bodyText, store.jwt);\n\n        store.layTerms = data.Data;\n\n        if (data.Data.length > 0) {\n          store.glossaryName = data.Data[0].GlossaryTemplate;\n          loadGlossary();\n        } else {\n          document.getElementById('app-body').innerHTML = `\n            <p class=\"text-center\">Data not available</p>\n          `;\n        }\n      } catch (error) {\n        console.error('Error fetching glossary data:', error);\n      }\n      // Sort terms by length (longest first)\n      const store = StoreService.getInstance();\n      store.layTerms.sort((a, b) => b.ClinicalTerm.length - a.ClinicalTerm.length);\n\n      const processedTerms = new Set(); // Track added larger terms\n\n      // Filter out smaller terms if they are included in a larger term\n      const filteredTerms = store.layTerms.filter(term => {\n        for (const biggerTerm of processedTerms) {\n          if (typeof biggerTerm === 'string' && biggerTerm.includes(term.ClinicalTerm.toLowerCase())) {\n            console.log(`Skipping \"${term.ClinicalTerm}\" because it's part of \"${biggerTerm}\"`);\n            return false; // Exclude this smaller term\n          }\n        }\n        processedTerms.add(term.ClinicalTerm.toLowerCase());\n        return true;\n      });\n\n      store.filteredGlossaryTerm = filteredTerms;\n      await removeMatchingContentControls();\n\n      const foundRanges = new Map(); // Track words already processed\n\n      const searchPromises = store.filteredGlossaryTerm.map(term => {\n        const searchResults = body.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\n        searchResults.load(\"items\");\n        return searchResults;\n      });\n\n      await context.sync();\n\n      for (const searchResults of searchPromises) {\n\n        for (const range of searchResults.items) {\n\n          if (!range || !range.text) {\n            console.log(\"Invalid range. Skipping...\");\n            continue;\n          }\n\n          // Load existing content controls inside this range\n          const font = range.font;\n          font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\n          range.load(\"contentControls\");\n          await context.sync();\n\n          const existingControl = range.contentControls.items.length > 0;\n\n          if (existingControl) {\n            console.log(`Skipping \"${range.text}\" because it already has a content control.`);\n            continue; // Skip if content control is already present\n          }\n          // Check if we've already processed this term at this range\n          if (foundRanges.has(range.text)) {\n            console.log(`Skipping duplicate occurrence of \"${range.text}\"`);\n            continue;\n          }\n          // Mark this word as processed\n          foundRanges.set(range.text, true);\n          // Remove existing content controls if any\n          if (range.contentControls && range.contentControls.items.length > 0) {\n            console.log(`Removing existing content control from: \"${range.text}\"`);\n            for (const control of range.contentControls.items) {\n              control.delete(false); // 'false' keeps the text, only removes the control\n            }\n            await context.sync(); // Ensure deletion is applied before adding a new one\n          }\n\n          try {\n            // Insert a new content control\n            const contentControl = range.insertContentControl();\n            contentControl.title = `${range.text}`;\n            if (font.highlightColor !== null) {\n              contentControl.tag = `${font.highlightColor}`;\n            }\n            contentControl.font.highlightColor = \"yellow\"; // Highlight the control\n            contentControl.appearance = Word.ContentControlAppearance.boundingBox;\n            await context.sync();\n          } catch (error) {\n            console.error(`Error inserting content control for term \"${range.text}\":`, error);\n          }\n        }\n      }\n      // document.getElementById('glossarycheck').style.display='block';\n      store.isGlossaryActive = true;\n      document.getElementById('app-body').innerHTML = `\n      <div id=\"button-container\">\n        <button class=\"btn btn-secondary me-2 clear-glossary btn-sm\" id=\"clearGlossary\">Clear Glossary</button>\n      </div>\n\n      <div id=\"highlighted-text\"></div>\n      <div class=\"d-flex justify-content-center box-loader\">\n       <div class=\"loader\" id=\"loader\"></div></div>\n      \n`\n      const displayElement = document.getElementById('loader');\n      displayElement.style.display = 'none';\n      await context.sync();\n      document.getElementById('clearGlossary').addEventListener('click', removeMatchingContentControls);\n      Office.context.document.addHandlerAsync(\n        Office.EventType.DocumentSelectionChanged,\n        handleSelectionChange\n      );\n\n\n    });\n\n    // Optional: Notify user of completion\n    console.log('Glossary applied successfully');\n  } catch (error) {\n    console.error('Error applying glossary:', error);\n    // Optional: Notify user of error\n    console.log('Error applying glossary. Please try again.');\n  }\n}\n\n\nasync function handleSelectionChange() {\n  const store = StoreService.getInstance();\n\n  // Handle glossary mode\n  if (store.isGlossaryActive) {\n    await checkGlossary();\n  }\n\n  // Handle Home mode - detect bookmarks/tags in selection\n  if (store.mode === 'Home') {\n    await logBookmarksInSelection();\n  }\n}\n\nexport async function checkGlossary() {\n  try {\n    await Word.run(async (context) => {\n      const selection = context.document.getSelection();\n\n      selection.load(\"text, font.highlightColor\");\n\n      await context.sync();\n\n\n\n      if (selection.text) {\n        const loader = document.getElementById('loader');\n        if (loader) {\n          loader.style.display = 'block';\n        }\n        const store = StoreService.getInstance();\n        const searchPromises = store.layTerms.map(term => {\n          const searchResults = selection.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\n          searchResults.load(\"items\");\n          return searchResults;\n        });\n\n        await context.sync();\n        const selectedWords = []\n        for (const searchResults of searchPromises) {\n\n          for (const range of searchResults.items) {\n            const font = range.font;\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\n\n            await context.sync();\n            if (\n              font.highlightColor !== store.capturedFormatting['Background Color'] ||\n              font.color !== store.capturedFormatting['Text Color'] ||\n              font.bold !== store.capturedFormatting['Bold'] ||\n              font.italic !== store.capturedFormatting['Italic'] ||\n              font.size !== store.capturedFormatting['Size'] ||\n              font.underline !== store.capturedFormatting['Underline'] ||\n              font.name !== store.capturedFormatting['Font Name']\n            ) {\n              selectedWords.push(range.text);\n            }\n\n          }\n        }\n        // searchPromises.forEach(searchResults => {\n        //   searchResults.items.forEach(item => {\n        //   });\n        // });\n        displayHighlightedText(selectedWords)\n\n        await context.sync();\n\n\n\n\n        // const highlightColor = selection.font.highlightColor;\n\n        // if (highlightColor === \"red\") {\n        //   displayHighlightedText(selection.text);\n        // } else {\n        //   console.log('Selected text is not highlighted.');\n        // }\n      } else {\n        console.log('No text is selected.');\n      }\n    });\n  } catch (error) {\n    console.error('Error displaying glossary:', error);\n  }\n}\n\n\n\nfunction displayHighlightedText(words: string[]) {\n\n  const displayElement = document.getElementById('highlighted-text');\n\n  if (displayElement) {\n    displayElement.innerHTML = ''; // Clear previous content\n    const loader = document.getElementById('loader');\n    loader.style.display = 'block';\n    // Group lay terms by their clinical term\n    const groupedTerms: { [clinicalTerm: string]: string[] } = {};\n\n    const store = StoreService.getInstance();\n    words.forEach(word => {\n      store.layTerms.forEach(term => {\n        if (term.ClinicalTerm.toLowerCase() === word.toLowerCase()) {\n          if (!groupedTerms[term.ClinicalTerm]) {\n            groupedTerms[term.ClinicalTerm] = [];\n          }\n          if (!groupedTerms[term.ClinicalTerm].includes(term.LayTerm)) {\n            groupedTerms[term.ClinicalTerm].push(term.LayTerm);\n          }\n        }\n      });\n    });\n\n    // Create a box for each clinical term\n    Object.keys(groupedTerms).forEach(clinicalTerm => {\n      // Create the main box for the clinical term\n      const mainBox = document.createElement('div');\n      mainBox.className = 'box'; // Add box class for styling\n\n      // Create a heading for the clinical term\n      const heading = document.createElement('h3');\n      heading.textContent = `${clinicalTerm} (${store.glossaryName})`;\n      mainBox.appendChild(heading);\n\n      // Create sub-boxes for each lay term\n      groupedTerms[clinicalTerm].forEach(layTerm => {\n        const subBox = document.createElement('div');\n        subBox.className = 'sub-box'; // Add class for sub-box styling\n        subBox.textContent = layTerm;\n\n        // Add click event listener to replace ClinicalTerm with LayTerm\n        subBox.addEventListener('click', async () => {\n          await replaceClinicalTerm(clinicalTerm, layTerm);\n\n          // Remove the main box containing the clicked sub-box\n          mainBox.remove();\n        });\n\n        mainBox.appendChild(subBox);\n      });\n\n      displayElement.appendChild(mainBox);\n    });\n    loader.style.display = 'none';\n\n  }\n}\nasync function replaceClinicalTerm(clinicalTerm: string, layTerm: string) {\n  const displayElement = document.getElementById('loader');\n  displayElement.style.display = 'block';\n\n  try {\n    await Word.run(async (context) => {\n      // Get the current selection\n      const selection = context.document.getSelection();\n      selection.load('text');\n      await context.sync();\n\n      if (selection.text.toLowerCase().includes(clinicalTerm.toLowerCase())) {\n        // Search for the clinicalTerm in the document\n        const searchResults = selection.search(clinicalTerm, { matchCase: false, matchWholeWord: false });\n        searchResults.load('items');\n\n        await context.sync();\n\n        // Replace each occurrence of the clinicalTerm with the layTerm\n        for (const item of searchResults.items) {\n          // Load the font properties\n          item.font.load(['bold', 'italic', 'underline', 'color', 'highlightColor', 'size', 'name']);\n          await context.sync();  // Ensure the properties are loaded before accessing them\n\n          // Insert the layTerm while keeping the formatting\n          item.insertText(layTerm, Word.InsertLocation.replace);\n\n          // Apply the original formatting to the new text\n          item.font.bold = item.font.bold;\n          item.font.italic = item.font.italic;\n          item.font.underline = item.font.underline;\n          item.font.color = item.font.color;\n          item.font.highlightColor = '#c7c7c7';\n          item.font.size = item.font.size;\n          item.font.name = item.font.name;\n        }\n\n        await context.sync();\n        displayElement.style.display = 'none';\n        console.log(`Replaced '${clinicalTerm}' with '${layTerm}' and preserved the original formatting.`);\n      } else {\n        displayElement.style.display = 'none';\n        console.log(`Selected text does not contain '${clinicalTerm}'.`);\n      }\n    });\n  } catch (error) {\n    displayElement.style.display = 'none';\n    console.error('Error replacing term:', error);\n  }\n}\n\n\nexport async function removeMatchingContentControls() {\n  try {\n    await Word.run(async (context) => {\n      document.getElementById('app-body').innerHTML = `\n      <div id=\"button-container\">\n        <div class=\"loader\" id=\"loader\"></div>\n        <div id=\"highlighted-text\"></div>`;\n      const body = context.document.body;\n\n      // Load all content controls\n      const contentControls = body.contentControls;\n      contentControls.load(\"items\");\n      await context.sync();\n\n      if (contentControls.items.length === 0) {\n        console.log(\"No content controls found.\");\n        return;\n      }\n\n      for (const control of contentControls.items) {\n        const store = StoreService.getInstance();\n        if (control.title && store.filteredGlossaryTerm.some(term => term.ClinicalTerm.toLowerCase() === control.title.toLowerCase())) {\n          const range = control.getRange();\n          range.load(\"text\");\n          await context.sync();\n          if (control.tag && /^#[0-9A-Fa-f]{6}$/.test(control.tag)) {\n            range.font.highlightColor = control.tag;\n          } else {\n            range.font.highlightColor = null\n          }\n          await context.sync();\n          control.delete(true);\n        }\n      }\n\n      document.getElementById('app-body').innerHTML = `\n      <div id=\"button-container\">\n        <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\n      </div>\n      `;\n\n      await context.sync();\n      const store = StoreService.getInstance();\n      store.isGlossaryActive = false;\n      document.getElementById('applyglossary').addEventListener('click', applyglossary);\n    });\n  } catch (error) {\n    console.error(\"Error removing content controls:\", error);\n  }\n}\n\nexport async function addGenAITags() {\n  const store = StoreService.getInstance();\n  if (!store.isTagUpdating) {\n\n    if (store.isGlossaryActive) {\n      await removeMatchingContentControls();\n    }\n\n    let selectedClient = store.clientList.filter(item => item.ID === store.clientId);\n\n    // Build Primary Source List\n    let sourceTypeList = [\n      ...Array.from(new Map(\n        store.dataList.SourceTypeList\n          .filter(item => item.VectorID > 0)\n          .map(item => [item.SourceTypeID, { Name: item.SourceType, ID: item.SourceTypeID }])\n      ).values())\n    ];\n\n\n    let sourceOptions = sourceTypeList.map((src: any) => {\n      return `\n        <li class=\"source-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\n          <div class=\"form-check\">\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${src.ID}\" id=\"source${src.ID}\">\n            <label class=\"form-check-label text-prewrap\" for=\"source${src.ID}\">${src.Name}</label>\n          </div>\n        </li>`;\n    }).join(\"\");\n\n    let sponsorOptions = store.clientList.map(client => {\n      const isSelectedClient = selectedClient.some(selected => selected.ID === client.ID);\n      return `\n        <li class=\"sponsor-dropdown-item dropdown-item p-2\" style=\"cursor: pointer;\">\n          <div class=\"form-check\">\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${client.ID}\" id=\"sponsor${client.ID}\" ${isSelectedClient ? 'checked disabled' : ''}>\n            <label class=\"form-check-label text-prewrap\" for=\"sponsor${client.ID}\">${client.Name}</label>\n          </div>\n        </li>`;\n    }).join(\"\");\n\n    document.getElementById('app-body').innerHTML = navTabs;\n\n    // Inject modal\n    document.getElementById('add-tag-body').innerHTML = addtagbody(sponsorOptions, sourceOptions, store.mode === \"Summary\");\n\n    const promptTemplateElement = document.getElementById('add-prompt-template');\n    setupPromptBuilderUI(promptTemplateElement, store.promptBuilderList);\n\n    document.getElementById('tag-tab').addEventListener('click', () => switchToAddTag());\n    document.getElementById('prompt-tab').addEventListener('click', () => switchToPromptBuilder());\n\n    mentionDropdownFn('prompt', 'mention-dropdown', 'add');\n\n    const form = document.getElementById('genai-form');\n    const nameField = document.getElementById('name');\n    const descriptionField = document.getElementById('description') as HTMLInputElement;\n    const promptField = document.getElementById('prompt') as HTMLTextAreaElement;\n    // const primarySourceField = document.getElementById('primarySource');\n\n    const saveGloballyCheckbox = document.getElementById('saveGlobally') as HTMLInputElement;\n    const availableForAllCheckbox = document.getElementById('isAvailableForAll') as HTMLInputElement;\n    const sponsorDropdownButton = document.getElementById('sponsorDropdown');\n    const sponsorDropdownItems = document.querySelectorAll('.sponsor-dropdown-item .form-check-input');\n\n\n    const sourceDropdownButton = document.getElementById('sourceDropdown');\n    const sourceDropdownItems = document.querySelectorAll('.source-dropdown-item .form-check-input');\n\n    const isSummaryMode = store.mode === \"Summary\";\n\n    document.getElementById('cancel-btn-gen-ai').addEventListener('click', () => {\n      const store = StoreService.getInstance();\n      if (!store.isPendingResponse) loadHomepage(store.availableKeys);\n    });\n\n\n    if (form && nameField && promptField && sponsorDropdownItems.length > 0 && (isSummaryMode || sourceDropdownItems.length > 0)) {\n\n      const updateSponsorDropdownLabel = () => {\n        if ((availableForAllCheckbox as HTMLInputElement).checked) {\n          sponsorDropdownButton.textContent = store.clientList.map(x => x.Name).join(\", \");\n        } else {\n          const selectedNames = Array.from(sponsorDropdownItems)\n            .filter(cb => (cb as HTMLInputElement).checked && cb.id !== 'sponsorSelectAll')\n            .map(cb => cb.parentElement.textContent.trim());\n\n          sponsorDropdownButton.textContent = selectedNames.length\n            ? selectedNames.join(\", \")\n            : \"Select Sponsors\";\n        }\n      };\n\n      const updateSourceDropdownLabel = () => {\n        const selectedNames = Array.from(sourceDropdownItems)\n          .filter(cb => (cb as HTMLInputElement).checked && cb.id !== 'sourceSelectAll')\n          .map(cb => cb.parentElement.textContent.trim());\n\n        sourceDropdownButton.textContent = selectedNames.length\n          ? selectedNames.join(\", \")\n          : \"Select Source Types\";\n      }\n\n      // Submit Handler\n      form.addEventListener('submit', async (e) => {\n        e.preventDefault();\n\n        form.querySelectorAll('.is-invalid').forEach(i => i.classList.remove('is-invalid'));\n\n        let valid = true;\n\n        if (!nameField.value.trim()) { nameField.classList.add('is-invalid'); valid = false; }\n        if (!promptField.value.trim()) { promptField.classList.add('is-invalid'); valid = false; }\n\n        // PRIMARY SOURCE VALIDATION\n        let selectedPrimarySources = [];\n        if (!isSummaryMode) {\n          selectedPrimarySources = Array.from(sourceDropdownItems)\n            .filter(cb => (cb as HTMLInputElement).checked && cb.id !== 'sourceSelectAll')\n            .map(cb => (cb as HTMLInputElement).value);\n\n          if (!selectedPrimarySources.length) {\n            document.getElementById(\"primarySourceError\").style.display = \"block\";\n            valid = false;\n          } else {\n            document.getElementById(\"primarySourceError\").style.display = \"none\";\n          }\n        }\n\n        if (!valid) return;\n\n        const selectedSponsors = Array.from(sponsorDropdownItems)\n          .filter(cb => (cb as HTMLInputElement).checked && cb.id !== 'sponsorSelectAll')\n          .map(cb => store.clientList.find(c => c.ID == (cb as HTMLInputElement).value));\n\n        const isAvailableForAll = availableForAllCheckbox.checked;\n        const isSaveGlobally = saveGloballyCheckbox.checked;\n        const aigroup = store.dataList.Group.find(el => el.DisplayName === 'AIGroup');\n\n        const formData = {\n          DisplayName: nameField.value.trim(),\n          Prompt: promptField.value.trim(),\n          Description: descriptionField.value.trim(),\n          GroupKeyClient: selectedSponsors,\n          AllClient: isAvailableForAll ? 1 : 0,\n          SaveGlobally: isSaveGlobally,\n          UserDefined: '1',\n          ComponentKeyDataTypeID: '1',\n          ComponentKeyDataAccessID: '3',\n          AIFlag: 1,\n          DocumentTypeID: store.dataList.DocumentTypeID,\n          ReportHeadID: store.dataList.ID,\n\n          // MULTI SELECT SOURCE TYPE\n          SourceTypeID: isSummaryMode ? \"0\" : selectedPrimarySources.join(\",\"),\n\n          ReportHeadGroupID: aigroup.ID,\n          ReportHeadSourceID: 0\n        };\n\n        await createTextGenTag(formData);\n      });\n\n      const checkAndDisableSponsors = () => {\n        sponsorDropdownItems.forEach(cb => {\n          if (!cb.disabled) {\n            cb.checked = true;\n            cb.disabled = true;\n          }\n        });\n        updateSponsorDropdownLabel();\n      };\n\n      const enableSponsors = () => {\n        sponsorDropdownItems.forEach(cb => {\n          const isSelectedClient = selectedClient.some(sel => sel.ID === parseInt(cb.value));\n          if (!isSelectedClient) cb.disabled = false;\n        });\n        updateSponsorDropdownLabel();\n      };\n\n      saveGloballyCheckbox.addEventListener('change', function () {\n        if (!store.isPendingResponse) {\n          if (this.checked) {\n            availableForAllCheckbox.disabled = false;\n            sponsorDropdownButton.disabled = false;\n          } else {\n            enableSponsors();\n            availableForAllCheckbox.checked = false;\n            availableForAllCheckbox.disabled = true;\n            (sponsorDropdownButton as HTMLButtonElement).disabled = true;\n\n            sponsorDropdownItems.forEach(cb => {\n              if (!(cb as HTMLInputElement).disabled) {\n                (cb as HTMLInputElement).checked = false;\n                (cb as HTMLInputElement).disabled = false;\n              }\n            });\n\n            updateSponsorDropdownLabel();\n          }\n        }\n      });\n\n\n\n      availableForAllCheckbox.addEventListener('change', function () {\n        if (!store.isPendingResponse) {\n          this.checked ? checkAndDisableSponsors() : enableSponsors();\n        }\n      });\n\n\n      saveGloballyCheckbox.checked = true;\n      availableForAllCheckbox.checked = true;\n      //  Trigger its logic so sponsor dropdown activates properly\n      saveGloballyCheckbox.dispatchEvent(new Event(\"change\"));\n      availableForAllCheckbox.dispatchEvent(new Event(\"change\"));\n      document.querySelectorAll('.sponsor-dropdown-item').forEach(item => {\n        item.addEventListener('click', function (e) {\n          e.stopPropagation();\n          const checkbox = this.querySelector('.sponsor-dropdown-item .form-check-input');\n          if (!checkbox) return;\n\n          if (checkbox.id === 'sponsorSelectAll') {\n            const isChecked = (checkbox as HTMLInputElement).checked;\n            sponsorDropdownItems.forEach(cb => {\n              if (!(cb as HTMLInputElement).disabled) (cb as HTMLInputElement).checked = isChecked;\n            });\n          }\n\n          updateSponsorDropdownLabel();\n        });\n      });\n\n      if (!isSummaryMode) {\n        document.querySelectorAll('.source-dropdown-item').forEach(item => {\n          item.addEventListener('click', function (e) {\n            e.stopPropagation();\n            const checkbox = this.querySelector('.source-dropdown-item .form-check-input');\n            if (!checkbox) return;\n\n            if (checkbox.id === 'sourceSelectAll') {\n              const isChecked = (checkbox as HTMLInputElement).checked;\n              sourceDropdownItems.forEach(cb => {\n                (cb as HTMLInputElement).checked = isChecked;\n              });\n            }\n\n            updateSourceDropdownLabel();\n            const selectedCount = Array.from(sourceDropdownItems)\n              .filter(cb => (cb as HTMLInputElement).checked).length;\n\n            if (selectedCount === 0) {\n              document.getElementById(\"primarySourceError\").style.display = \"block\";\n            } else {\n              document.getElementById(\"primarySourceError\").style.display = \"none\";\n            }\n\n          });\n        });\n      }\n\n      updateSponsorDropdownLabel();\n      if (!isSummaryMode) updateSourceDropdownLabel();\n\n      [nameField, promptField].forEach(field => {\n        field.addEventListener('input', function () {\n          const input = this as HTMLInputElement;\n          if (input.classList.contains('is-invalid') && input.value.trim()) {\n            input.classList.remove('is-invalid');\n          }\n        });\n      });\n\n    } else {\n      console.error(\"Required elements missing.\");\n    }\n  }\n}\n\n\nexport async function customizeTable(type: string) {\n  const store = StoreService.getInstance();\n  const container = document.getElementById(\"confirmation-popup\");\n  if (!container) return;\n\n  const customStyleName = sessionStorage.getItem(\"CustomStyle\") || \"\";\n  const defaultStyle = sessionStorage.getItem(\"DefaultStyle\") || store.tableStyle;\n  let styleObj: any = type === \"Custom\" ? customStyleName : defaultStyle;\n  container.innerHTML = customizeTablePopup(styleObj, type);\n\n  const cancelBtn = document.getElementById(\"confirmation-popup-cancel\");\n  const okBtn = document.getElementById(\"confirmation-popup-confirm\");\n  const dropdown = document.getElementById(\"confirmation-popup-dropdown\") as HTMLSelectElement;\n  const tablePreview = document.getElementById(\"confirmation-popup-table-preview\") as HTMLTableElement;\n\n  const applyStyle = () => {\n    if (!dropdown || !tablePreview) return;\n    let styleObj: any;\n    if (type === \"Custom\") {\n      styleObj = store.customTableStyle.find(s => s.Name === dropdown.value);\n    } else {\n      styleObj = wordTableStyles.find(s => s.style === dropdown.value);\n    }\n\n    if (styleObj && type === 'Pre') {\n      // Clear existing styles\n      Array.from(tablePreview.rows).forEach(row => {\n        Array.from(row.cells).forEach(cell => (cell as HTMLTableCellElement).removeAttribute(\"style\"));\n      });\n\n      if (styleObj.tableClass) tablePreview.style.cssText = styleObj.tableClass;\n\n      if (styleObj.headerClass) {\n        const thead = tablePreview.querySelector(\"thead\");\n        if (thead) {\n          Array.from(thead.rows).forEach(row => {\n            Array.from(row.cells).forEach(cell => {\n              (cell as HTMLTableCellElement).style.cssText = styleObj.headerClass!;\n            });\n          });\n        }\n      }\n\n      if (styleObj.sideHeader && styleObj.rowClass) {\n        Array.from(tablePreview.rows).forEach((row, index) => {\n          Array.from(row.cells).forEach((cell, cellIndex) => {\n            if (cellIndex === 0 && index !== 0) {\n              (cell as HTMLTableCellElement).style.cssText = \"font-weight:bold;\";\n            }\n          });\n        });\n      }\n\n      if (styleObj.format === \"empty\" && styleObj.rowClass) {\n        Array.from(tablePreview.rows).forEach((row, index) => {\n          if (index % 2 === 1) (row as HTMLTableRowElement).style.cssText = styleObj.rowClass!;\n        });\n      } else if (styleObj.format === \"partial\" && styleObj.rowClass) {\n        Array.from(tablePreview.rows).forEach((row, index) => {\n          Array.from(row.cells).forEach((cell, cellIndex) => {\n            if (cellIndex === 0) {\n              (cell as HTMLTableCellElement).style.cssText =\n                styleObj.tableClass! + \"font-weight:bold;\";\n            } else if (index % 2 === 1) {\n              (cell as HTMLTableCellElement).style.cssText = styleObj.rowClass!;\n            }\n          });\n        });\n      } else if (styleObj.format === \"full\") {\n        Array.from(tablePreview.rows).forEach((row, index) => {\n          Array.from(row.cells).forEach((cell, cellIndex) => {\n            const headerClass = index === 0 ? styleObj.headerClass! : \"\";\n            if (cellIndex === 0 && styleObj.sideHeader) {\n              (cell as HTMLTableCellElement).style.cssText =\n                styleObj.tableClass! + \"font-weight:bold;\" + headerClass;\n            } else {\n              (cell as HTMLTableCellElement).style.cssText = styleObj.tableClass! + headerClass;\n            }\n          });\n        });\n      }\n    } else if (styleObj) {\n\n      tablePreview.innerHTML = styleObj.Preview;\n    } else {\n      tablePreview.innerHTML = '';\n    }\n  };\n\n  // Initial preview\n  applyStyle();\n  dropdown?.addEventListener(\"change\", applyStyle);\n\n  if (cancelBtn) cancelBtn.addEventListener(\"click\", () => (container.innerHTML = \"\"));\n  if (okBtn && dropdown) {\n    okBtn.addEventListener(\"click\", () => {\n      if (type === \"Custom\") {\n        const styleObj = store.customTableStyle.find(s => s.Name === dropdown.value);\n        store.colorPallete.Header = styleObj.Setting.HeaderColor;\n        store.colorPallete.Primary = styleObj.Setting.PrimaryColor;\n        store.colorPallete.Secondary = styleObj.Setting.SecondaryColor;\n        store.colorPallete.Customize = true;\n        store.colorPallete.IsSideHeaderBold = styleObj.Setting.IsSideHeaderBold;\n        store.colorPallete.IsHeaderBold = styleObj.Setting.IsHeaderBold;\n        sessionStorage.setItem(\"CustomStyle\", styleObj.Name);\n        store.tableStyle = styleObj.Setting.BaseStyle; // stores full object as \n      } else {\n        store.colorPallete.Customize = false;\n        store.tableStyle = dropdown.value; // normal style string\n        sessionStorage.setItem(\"DefaultStyle\", store.tableStyle);\n\n      }\n\n      sessionStorage.setItem(\"colorPallete\", JSON.stringify(store.colorPallete));\n      sessionStorage.setItem(\"tableStyle\", store.tableStyle);\n\n      container.innerHTML = \"\";\n    });\n  }\n}\n\nimport { addSummaryTag } from \"./summary/summary.api\";\n\nasync function createTextGenTag(payload) {\n  const store = StoreService.getInstance();\n  try {\n    const iconelement = document.getElementById(`text-gen-save`);\n    const cancelBtnGenAi = document.getElementById('cancel-btn-gen-ai');\n\n\n    (cancelBtnGenAi as HTMLButtonElement).disabled = true;\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Save`;\n    (iconelement as HTMLButtonElement).disabled = true;\n    store.isPendingResponse = true;\n\n    let data: any;\n    if (store.mode === \"Summary\") {\n      const summaryPayload = {\n        ReportHeadID: payload.ReportHeadID,\n        Name: payload.DisplayName,\n        Description: payload.Description,\n        Prompt: payload.Prompt,\n        Selected: 1,\n        SourceTypeID: payload.SourceTypeID,\n        AllClient: payload.AllClient,\n        SaveGlobally: payload.SaveGlobally ? 1 : 0,\n        SummaryTagClient: payload.GroupKeyClient\n      };\n      data = await addSummaryTag(summaryPayload, store.jwt);\n    } else {\n      data = await addGroupKey(payload, store.jwt);\n    }\n\n    store.isPendingResponse = false;\n\n    if (data['Status']) {\n      if (store.mode === \"Summary\") {\n        loadSummarypage(store.availableKeys);\n      } else {\n        fetchDocument('AIpanel');\n      }\n      toaster('Saved successfully', 'success');\n    } else {\n      (cancelBtnGenAi as HTMLButtonElement).disabled = false;\n      (iconelement as HTMLButtonElement).disabled = false;\n      iconelement.innerHTML = `<i class=\"fa fa-check-circle me-2\"></i>Save`;\n      toaster('Something went wrong', 'error');\n      // showAddTagError(data['Data']);\n    }\n\n  } catch (error) {\n    toaster('Something went wrong', 'error');\n    console.error('Error creating text generation tag:', error);\n  }\n}\n\n\n\nexport function mentionDropdownFn(textareaId, DropdownId, action) {\n  const store = StoreService.getInstance();\n  const filterMentions = (query) => {\n    // Assuming availableKeys is an array of objects with DisplayName and EditorValue properties\n    const filtered = store.availableKeys.filter(item => item.AIFlag === 0).filter(item =>\n      item.DisplayName.toLowerCase().includes(query.toLowerCase())\n    );\n    return filtered;\n  };\n  let highlightedIndex = -1;\n\n  const promptField = document.getElementById(`${textareaId}`);\n  const mentionDropdown = document.getElementById(`${DropdownId}`);\n  if (promptField) {\n\n    // Handle input events on prompt field for mentions\n    promptField.addEventListener('input', (e) => {\n      const cursorPosition = (promptField as HTMLTextAreaElement).selectionStart;\n      const textBeforeCursor = (promptField as HTMLTextAreaElement).value.slice(0, cursorPosition);\n      const lastHashtag = textBeforeCursor.lastIndexOf('#');\n      if (lastHashtag !== -1) {\n        const query = textBeforeCursor.slice(lastHashtag + 1).trim();\n        if (query.length > 0) {\n          const mentions = filterMentions(query);\n\n          if (mentions.length > 0) {\n            mentionDropdown.innerHTML = mentions.map(item => {\n              let editorValue = '';\n              if (action === 'add') {\n                editorValue = `#${item.DisplayName}#`;\n              } else {\n                editorValue = item.EditorValue || `#${item.DisplayName}#`;\n              }\n\n              return `<li class=\"dropdown-item\" data-editor-value=\"${editorValue}\">${item.DisplayName}</li>`;\n            }).join('');\n\n            // Get the position of the textarea and place the dropdown above it\n            const textareaRect = promptField.getBoundingClientRect();\n            mentionDropdown.style.left = `${textareaRect.left}px`;\n            mentionDropdown.style.bottom = `75px`; // Position above the textarea\n            mentionDropdown.style.display = 'block';\n          } else {\n            mentionDropdown.style.display = 'none';\n          }\n        } else {\n          mentionDropdown.style.display = 'none';\n        }\n      } else {\n        mentionDropdown.style.display = 'none';\n      }\n\n    });\n\n    // Handle keyboard navigation in the dropdown\n    promptField.addEventListener('keydown', (e) => {\n      const items = document.querySelectorAll(`#${DropdownId} .dropdown-item`);\n      const totalItems = items.length;\n\n      if (e.key === 'ArrowDown') {\n        // Prevent default behavior to stop cursor from moving\n        e.preventDefault();\n\n        // Move the highlight down and wrap around to the top if at the end\n        if (highlightedIndex < totalItems - 1) {\n          highlightedIndex++;\n        } else {\n          highlightedIndex = 0; // Wrap to the first item\n        }\n        updateHighlightedItem(`${DropdownId}`);\n      } else if (e.key === 'ArrowUp') {\n        // Prevent default behavior to stop cursor from moving\n        e.preventDefault();\n\n        // Move the highlight up and wrap around to the bottom if at the top\n        if (highlightedIndex > 0) {\n          highlightedIndex--;\n        } else {\n          highlightedIndex = totalItems - 1; // Wrap to the last item\n        }\n        updateHighlightedItem(`${DropdownId}`);\n      } else if (e.key === 'Enter' && highlightedIndex !== -1) {\n        // Select the highlighted item\n        const selectedItem = items[highlightedIndex];\n        if (selectedItem) {\n          selectMention(selectedItem.getAttribute('data-editor-value'));\n          mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\n          e.preventDefault();  // Prevent form submission on Enter key\n        }\n      }\n    });\n\n    // Function to highlight the selected item\n    function updateHighlightedItem(id) {\n      const items = document.querySelectorAll(`#${id} .dropdown-item`);\n      const dropdown = document.getElementById(`${id}`);\n      const totalItems = items.length;\n\n      // Remove the 'active' class from all items\n      items.forEach(item => item.classList.remove('active'));\n\n      // Add the 'active' class to the currently highlighted item\n      if (highlightedIndex >= 0 && highlightedIndex < totalItems) {\n        const highlightedItem = items[highlightedIndex];\n        highlightedItem.classList.add('active');\n\n        // Ensure the highlighted item is visible within the dropdown\n        highlightedItem.scrollIntoView({\n          behavior: 'smooth',    // Smooth scroll\n          block: 'nearest'      // Scroll only if necessary\n        });\n      }\n    }\n\n\n\n    // Handle selecting an item from the dropdown via mouse click\n    mentionDropdown.addEventListener('click', (e) => {\n      if (e.target && e.target.matches('li')) {\n        const editorValue = (e.target as HTMLLIElement).getAttribute('data-editor-value');\n        selectMention(editorValue);\n        mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\n      }\n    });\n\n    // Function to insert the selected mention into the prompt field\n    const selectMention = (editorValue) => {\n      const textarea = document.getElementById(`${textareaId}`) as HTMLTextAreaElement;\n      const currentValue = textarea.value;\n      const cursorPosition = textarea.selectionStart;\n\n      const textBefore = currentValue.slice(0, cursorPosition);\n      const textAfter = currentValue.slice(cursorPosition);\n\n      const lastHashPosition = textBefore.lastIndexOf('#');\n      const updatedTextBefore = textBefore.slice(0, lastHashPosition); // Removing '#' symbol\n\n      textarea.value = `${updatedTextBefore}${editorValue}${textAfter}`;\n      const newCursorPosition = updatedTextBefore.length + editorValue.length;\n      textarea.setSelectionRange(newCursorPosition, newCursorPosition);\n    };\n\n    // Hide the dropdown if clicked outside\n    document.addEventListener('click', (e) => {\n      if (!mentionDropdown.contains(e.target as Node) && e.target !== promptField) {\n        mentionDropdown.style.display = 'none';\n      }\n    });\n  }\n}\n\nfunction removeQuotes(value: string): string {\n  return value\n    ? value\n      .replace(/^\"|\"$/g, '')\n      .replace(/\\\\n/g, '')\n      .replace(/\\*\\*/g, '')\n      .replace(/\\\\r/g, '')\n    : '';\n}\n\nexport function createMultiSelectDropdown(tag, type: \"Summary\" | \"AITag\") {\n  const store = StoreService.getInstance();\n  const isDark = store.theme === 'Dark';\n  const btnClass = isDark ? 'btn-dark text-light border-0' : 'btn-light text-dark border';\n  const dropdownMenuClass = isDark ? 'bg-dark text-light border-light' : 'bg-white text-dark border';\n  const itemClass = isDark ? 'bg-dark text-light' : 'bg-white text-dark';\n\n  // Group sources by SourceType\n  const sourceList = type === 'Summary' ? store.sourceSummaryList : store.sourceList;\n  const groupedSources = sourceList.reduce((groups, source) => {\n    if (!groups[source.SourceType]) groups[source.SourceType] = [];\n    groups[source.SourceType].push(source);\n    return groups;\n  }, {});\n  debugger\n\n  const multiSelectHTML = `\n  <div class='p-3 w-100'>\n    <div class=\"mb-3\">\n      <label for=\"source-select\" class=\"form-label\"><span class=\"text-danger\">*</span> Select Sources</label>\n      <div class=\"dropdown w-100\">\n        <button \n          class=\"btn ${btnClass} w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources\" \n          type=\"button\" \n          id=\"sourceDropdown\" \n          data-bs-toggle=\"dropdown\" \n          aria-expanded=\"false\">\n          <span id=\"sourceDropdownLabel\" class='sourceDropdownLabel'></span>\n          <span class=\"dropdown-toggle-icon dropdown-toggle-icon-s\"></span>\n        </button>\n        <ul class=\"dropdown-menu ${dropdownMenuClass} w-100 p-2\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000; max-height: 300px; overflow-y: auto;\">\n          \n          <!-- Select All -->\n          <li class=\"dropdown-item p-2 ${itemClass}\" data-checkbox-id=\"selectAll\">\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\n              <label class=\"form-check-label w-100\" for=\"selectAll\">Select All</label>\n            </div>\n          </li>\n\n          <!-- Grouped Sources -->\n          ${Object.keys(groupedSources)\n      .map((group, groupIndex) => {\n        const groupItems = groupedSources[group]\n          .map(\n            (source, index) => `\n                  <li class=\"dropdown-item ps-4 ${itemClass}\" style=\"cursor: pointer;\" data-checkbox-id=\"source-${groupIndex}-${index}\">\n                    <div class=\"form-check\">\n                      <input class=\"form-check-input source-checkbox\" type=\"checkbox\" value=\"${type === 'Summary' ? source.FileName : source.SourceName}\" id=\"source-${groupIndex}-${index}\">\n                      <label class=\"form-check-label w-100 text-prewrap\" for=\"source-${groupIndex}-${index}\">${type === 'Summary' ? source.FileName : source.SourceName}</label>\n                    </div>\n                  </li>\n                `\n          )\n          .join('');\n\n        return `\n                <!-- Group Header -->\n                <li class=\"dropdown-item p-2 ${itemClass}\" data-group-id=\"group-${groupIndex}\">\n                  <div class=\"form-check\">\n                    <input class=\"form-check-input group-checkbox\" type=\"checkbox\" value=\"${group}\" id=\"group-${groupIndex}\">\n                    <label class=\"form-check-label fw-bold\" for=\"group-${groupIndex}\">${group}</label>\n                  </div>\n                </li>\n                ${groupItems}\n              `;\n      })\n      .join('')}\n        </ul>\n      </div>\n    </div>\n    <div class=\"mt-3 d-flex justify-content-between\">\n      <span id=\"cancel-src-btn\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\n      <button id=\"ok-src-btn\" class=\"btn btn-primary\">Save</button>\n    </div>\n  </div>\n  `;\n\n  const accordionBody = document.getElementById(`chatFooter`);\n  accordionBody.innerHTML = multiSelectHTML;\n\n  let selectedSources = [];\n\n  const selectAllCheckbox = document.getElementById(`selectAll`) as HTMLInputElement;\n  const groupCheckboxes = document.querySelectorAll(`.group-checkbox`);\n  const individualCheckboxes = document.querySelectorAll(`.source-checkbox`);\n  const sourceDropdownLabel = document.getElementById(`sourceDropdownLabel`);\n\n  function updateLabel() {\n    sourceDropdownLabel.innerText = selectedSources.length > 0 ? selectedSources.join(', ') : ' ';\n  }\n\n  // Select All logic\n  selectAllCheckbox.addEventListener(\"change\", function () {\n    const checked = this.checked;\n    groupCheckboxes.forEach(cb => (cb as HTMLInputElement).checked = checked);\n    individualCheckboxes.forEach(cb => {\n      (cb as HTMLInputElement).checked = checked;\n      if (checked && !selectedSources.includes((cb as HTMLInputElement).value)) {\n        selectedSources.push((cb as HTMLInputElement).value);\n      }\n      if (!checked) {\n        selectedSources = [];\n      }\n    });\n    updateLabel();\n  });\n\n  // Group checkbox logic\n  groupCheckboxes.forEach(groupCb => {\n    groupCb.addEventListener(\"change\", function () {\n      const groupIndex = this.id.split('-')[1];\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\n\n      groupItems.forEach(cb => {\n        (cb as HTMLInputElement).checked = (this as HTMLInputElement).checked;\n        if ((this as HTMLInputElement).checked && !selectedSources.includes((cb as HTMLInputElement).value)) {\n          selectedSources.push((cb as HTMLInputElement).value);\n        }\n        if (!(this as HTMLInputElement).checked) {\n          selectedSources = selectedSources.filter(s => s !== (cb as HTMLInputElement).value);\n        }\n      });\n\n      // Update Select All state\n      selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => (child as HTMLInputElement).checked);\n      updateLabel();\n    });\n  });\n\n  // Individual checkbox logic\n  individualCheckboxes.forEach(cb => {\n    cb.addEventListener(\"change\", function () {\n      if ((cb as HTMLInputElement).checked) {\n        if (!selectedSources.includes((cb as HTMLInputElement).value)) selectedSources.push((cb as HTMLInputElement).value);\n      } else {\n        selectedSources = selectedSources.filter(s => s !== (cb as HTMLInputElement).value);\n      }\n\n      // Update parent group checkbox\n      const groupIndex = cb.id.split(\"-\")[1];\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\n      const groupCheckbox = document.getElementById(`group-${groupIndex}`) as HTMLInputElement;\n      groupCheckbox.checked = Array.from(groupItems).every(child => (child as HTMLInputElement).checked);\n\n      // Update Select All checkbox\n      selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => (child as HTMLInputElement).checked);\n\n      updateLabel();\n    });\n  });\n\n  // Initialize with pre-selected sources\n  if (tag.Sources && tag.Sources.length > 0) {\n    individualCheckboxes.forEach(cb => {\n      if (tag.Sources.includes((cb as HTMLInputElement).value)) {\n        (cb as HTMLInputElement).checked = true;\n        selectedSources.push((cb as HTMLInputElement).value);\n      }\n    });\n\n    // Update group checkboxes\n    groupCheckboxes.forEach(groupCb => {\n      const groupIndex = groupCb.id.split(\"-\")[1];\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\n      (groupCb as HTMLInputElement).checked = Array.from(groupItems).every(child => (child as HTMLInputElement).checked);\n    });\n\n    // Update Select All\n    selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => (child as HTMLInputElement).checked);\n    updateLabel();\n  }\n\n  // Save\n  document.getElementById(`ok-src-btn`).addEventListener(\"click\", function () {\n    tag.Sources = [...selectedSources];\n    const store = StoreService.getInstance();\n    const receivedEntry = sourceList.filter(source => selectedSources.includes(type === 'Summary' ? source.FileName : source.SourceName));\n    tag.TempSourceValue = receivedEntry.map((item) => {\n      return item.VectorID ? String(item.VectorID) : item.SourceValue;\n    });\n    if (type === 'Summary') {\n      tag.FileName = receivedEntry.map((item) => {\n        return item.FileName;\n      });\n    } else {\n      tag.SourceName = receivedEntry.map((item) => {\n        return item.SourceName;\n      });\n    }\n\n\n\n    tag.SourceValueID = receivedEntry.map((item) => {\n      return String(item.VectorID);\n    });\n\n    tag.SourceValue = receivedEntry\n      .map(source => source.SourceValue);\n    accordionBody.innerHTML = chatfooter(tag);\n    initializeAIHistoryEvents(tag, store.jwt, store.availableKeys, type);\n  });\n\n  // Cancel\n  document.getElementById(`cancel-src-btn`).addEventListener(\"click\", function () {\n    accordionBody.innerHTML = chatfooter(tag);\n    initializeAIHistoryEvents(tag, store.jwt, store.availableKeys, type);\n  });\n}\n\n\n\nasync function loadPromptTemplates() {\n  const store = StoreService.getInstance();\n  try {\n    const data = await getAllPromptTemplates(store.jwt);\n    if (data.Status && data.Data) {\n      store.promptBuilderList = data.Data;\n    }\n    // Do something with the data\n  } catch (error) {\n    console.error('Error fetching prompt templates:', error);\n  }\n}\n\nasync function logBookmarksInSelection() {\n  return Word.run(async (context) => {\n\n    const rawBookmarks = await getBookmarksFromSelection(context);\n    const bookmarks = pickRelevantBookmarks(rawBookmarks);\n\n    if (bookmarks.length === 0) {\n      document.getElementById('tags-in-selected-text')\n        ?.classList.replace('d-block', 'd-none');\n      return;\n    }\n\n    document.getElementById('tags-in-selected-text')\n      ?.classList.replace('d-none', 'd-block');\n\n    if (bookmarks.length > 1) {\n      const store = StoreService.getInstance();\n      store.selectedNames = bookmarks;\n      renderSelectedTags(store.selectedNames, store.availableKeys);\n      return;\n    }\n\n    // Single bookmark\n    const seachBox = document.getElementById('search-box') as HTMLInputElement;\n    if (seachBox) {\n      const processedName = bookmarks[0];\n      const store = StoreService.getInstance();\n      store.selectedNames = [processedName];\n      selectMatchingBookmarkFromSelection(processedName);\n\n      const aiTag = store.availableKeys.find(k =>\n        k.AIFlag === 1 &&\n        (k.DisplayName.toLowerCase() === processedName.toLowerCase() ||\n          `id${k.ID}`.toLowerCase() === processedName.toLowerCase())\n      );\n\n      if (!aiTag) return;\n\n      const appBody = document.getElementById('app-body');\n      appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\n\n      appBody.innerHTML = await generateCheckboxHistory(aiTag, \"AITag\");\n    }\n\n\n  });\n}\n\nasync function getBookmarksFromSelection(context: Word.RequestContext): Promise<string[]> {\n  const selection = context.document.getSelection();\n  const bookmarks = selection.getBookmarks();\n  await context.sync();\n  return bookmarks.value || [];\n}\n\n\nfunction normalizeBookmark(name: string) {\n  return name.split('_Split_')[0].replace(/_/g, ' ');\n}\n\nfunction pickRelevantBookmarks(bookmarks: string[]) {\n  // Remove duplicates & internal splits\n  const normalized = Array.from(new Set(bookmarks.map(normalizeBookmark)));\n\n  // Prefer AI tags only\n  const store = StoreService.getInstance();\n  return normalized.filter(name =>\n    store.availableKeys.some(\n      k => k.AIFlag === 1 &&\n        (k.DisplayName.toLowerCase() === name.toLowerCase() ||\n          `id${k.ID}`.toLowerCase() === name.toLowerCase())\n    )\n  );\n}\n\nasync function getImages() {\n  try {\n    const store = StoreService.getInstance();\n    const userId = sessionStorage.getItem('userId') || '0';\n\n    // Fetch Images and Clients in parallel\n    const generalImagesPromise = getGeneralImages(store.jwt);\n    const documentImagesPromise = getReportHeadImageById(store.dataList.ID, store.jwt);\n    const clientsPromise = getAllClients(userId, store.jwt);\n\n    const [generalImages, documentImages, clientsData] = await Promise.all([\n      generalImagesPromise,\n      documentImagesPromise,\n      clientsPromise\n    ]);\n\n    const mappedGeneral = mapImagesToComponentObjects(generalImages['Data']);\n    const mappedDocument = mapImagesToComponentObjects(documentImages['Data']);\n\n    // Update Store with Images\n    store.dataList.GroupKeyAll.push(...mappedGeneral);\n    store.dataList.GroupKeyAll.push(...mappedDocument);\n    store.availableKeys.push(...mappedGeneral);\n    store.availableKeys.push(...mappedDocument);\n    store.imageList = store.dataList.GroupKeyAll.filter(element => element.ComponentKeyDataType === 'IMAGE');\n\n    // Update Store with Clients\n    if (clientsData.Status && clientsData.Data) {\n      store.clientList = clientsData.Data;\n    }\n\n    if (store.imageList && store.imageList.length > 0) {\n      toaster('Images and data are loaded and ready for use', 'success');\n    }\n  } catch (error) {\n    console.error(\"Error loading background data:\", error);\n  }\n}\n"],"names":["___HTML_LOADER_IMPORT_0___","___HTML_LOADER_IMPORT_1___","module","exports","url","options","String","__esModule","default","hash","maybeNeedQuotes","test","concat","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","m","n","getter","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","b","baseURI","self","href","CONFIG","dataUrl","storeUrl","version","baseUrl","async","updatePromptTemplate","payload","jwt","response","fetch","method","headers","body","JSON","stringify","ok","json","AuthService","getStoredToken","sessionStorage","getItem","restoreSession","sessionToken","userRole","parse","USER_ROLE_KEY","tableStyle","STYLE_KEY","colorPallete","PALETTE_KEY","userId","login","organization","username","password","console","log","data","ClientName","Username","Password","loginUser","Status","ResponseStatus","Data","Token","UserRole","ID","setItem","success","token","raw","message","error","logout","removeItem","StoreService","documentID","organizationName","aiTagList","imageList","initialised","availableKeys","promptBuilderList","glossaryName","isGlossaryActive","GroupName","layTerms","dataList","isTagUpdating","capturedFormatting","emptyFormat","isNoFormatTextAvailable","clientId","clientList","currentYear","Date","getFullYear","selectedNames","isPendingResponse","theme","mode","customTableStyle","constructor","getInstance","instance","wordTableStyles","name","style","headerClass","tableClass","rowClass","format","sideHeader","wordTableStyleLocales","en","de","fr","es","Confirmationpopup","content","isDark","toaster","type","getElementById","innerHTML","setTimeout","navTabs","getSummaryTagsByReportHeadId","reportHeadId","getSummaryTagHistory","reportHeadSummaryTagID","getSummaryTagStatus","addSummaryHistory","AIService","fetchAIHistory","tag","store","tagId","getAiHistory","ReportHeadAIHistoryList","FilteredReportHeadAIHistoryList","SourceValueID","SourceValue","selectedSources","sourceList","filter","list","includes","VectorID","SourceName","map","item","Sources","join","TempSourceValue","forEach","historyList","Response","removeQuotes","unshift","warn","sendPrompt","prompt","iconelement","ReportHeadID","ReportHeadSummaryTagID","Prompt","Selected","SourceVector","Name","DocumentID","NCTID","DocumentType","TextSetting","DocumentTemplate","ReportTemplate","ReportHeadGroupKeyID","ThreadID","AssistantID","Container","PromptType","addAiHistory","chat","currentTag","updateTagWithChat","IsApplied","appbody","generateCheckboxHistory","chatInput","value","isApplied","isTable","FormattedResponse","finalResponse","updateEditorFinalTable","ComponentKeyDataType","UserValue","EditorValue","text","isSummaryLoading","allSummaryTags","currentSummaryStatus","currentSummaryInstance","loadSummarypage","instanceId","searchBoxClass","searchBox","pageButtons","pageCountLabel","btnFirst","btnPrev","btnNext","btnLast","addBtn","reanalyzeBtn","disableActionButtons","disabled","classList","toggle","setReanalyzeButtonState","enabled","normalizeNames","res","names","SelectedNames","split","x","trim","Boolean","Array","isArray","DisplayName","TagName","pageSize","debounceTimeout","currentPage","filtered","getTotalPages","Math","max","ceil","renderRows","replaceChildren","pageItems","start","slice","slicePage","row","createElement","isActive","themeClasses","className","cursor","tagStatus","statusIcon","onclick","appBody","html","appendChild","infoBtn","querySelector","addEventListener","stopPropagation","renderAll","historyRes","history","lastHistory","Number","pollSummaryUntilDone","err","reprocessTag","totalPages","min","startItem","endItem","textContent","toggleAttribute","floor","maxButtons","end","renderPager","applySearch","term","toLowerCase","t","clearTimeout","addGenAITags","hasActivated","deduplicateSummarySources","sources","Map","source","FileName","has","existing","set","from","values","statusRes","status","SummaryTagGenerated","tagStatuses","SummaryTagStatus","ts","matchingTag","find","allTagsProcessed","every","getRes2","SummaryTags","Promise","r","contains","popupContainer","cancelBtn","confirmBtn","innerText","handleAction","base64Data","getWordAsBase64","RefreshSummaryTag","refresh","ActiveDocument","refreshSummaryMode","sourceSummaryList","SummarySources","getRes","summaryStatus","activateSummaryMode","firstLoadAndRender","resolve","reject","Office","context","getFileAsync","FileType","Compressed","sliceSize","result","AsyncResultStatus","Succeeded","file","slices","index","getSlice","getSliceAsync","closeAsync","push","bytes","Uint8Array","binary","len","byteLength","fromCharCode","btoa","uint8ToBase64","sliceCount","summaryService","fetchSummaryAIHistory","loadHomepage","suggestionList","updateSuggestions","searchTerm","filteredMentions","nonAITags","AIFlag","aiTags","propertiesTags","imageTags","IsImage","createSection","labelText","mentions","isAISection","isImageSection","itemClass","labelClass","label","mention","listItem","icon","catch","then","word","Word","run","selection","getSelection","sync","newSelection","doc","DOMParser","parseFromString","bodyNodes","childNodes","node","nodeType","Node","TEXT_NODE","line","insertLineWithHeadingStyle","ELEMENT_NODE","element","tagName","rows","querySelectorAll","insertParagraph","InsertLocation","before","maxCols","reduce","sum","cell","parseInt","getAttribute","paragraph","table","insertTable","after","resolvedTableStyle","resolveWordTableStyle","Customize","colorTable","rowspanTracker","fill","lastParamRowIndex","rowIndex","cells","cellIndex","firstColText","cellText","colspan","rowspan","getCell","topCell","bottomCell","merge","verticalAlignment","VerticalAlignment","center","paragraphs","getFirst","alignment","Alignment","elementText","base64Image","startsWith","svgBase64ToPngBase64","insertInlinePictureFromBase64","nextLineParagraph","select","replaceMention","badgeWrapper","remove","add","renderSelectedTags","customizeTable","applyTagFn","closeBtnClass","closeBar","chatBody","chatList","promptclass","globalPromptUpdate","UserRoleEntityAccessList","UserRoleEntity","includeSaveIcon","UserRoleAccessID","includeReferenceIcon","Evidences","generateChatHistoryHtml","chatFooterHtml","chatfooter","initializeAIHistoryEvents","getDateTimeStamp","pad","toString","padStart","getMonth","getDate","getHours","getMinutes","getSeconds","textareavalue","changeSourceButton","copyText","container","setAttribute","updateSummaryTagPrompt","updatedTag","rawSources","popupData","selectedData","PageNumber","Sentence","DataModalPopup","checkbox","isChecked","event","target","checked","_","otherIndex","otherCheckbox","responseContainer","updateSummaryHistory","updateAiHistory","currentlySelected","some","anchorChar","insertText","getRange","bookmarkStart","bookmarkEnd","include","txt","el","s","c","bookmarkName","expandTo","insertBookmark","delete","insertTagPrompt","textareaValue","createMultiSelectDropdown","mentionDropdownFn","builtInStyle","BuiltInStyleName","normal","heading6","substring","heading5","heading4","heading3","heading2","heading1","styleBuiltIn","regex","match","lastIndex","exec","bold","italic","underline","font","UnderlineType","single","none","tempTextArea","execCommand","removeChild","switchToAddTag","tables","parsedContent","jsonToHtmlTable","tableIndex","jsonData","Set","flattenObject","prefix","keys","newKey","entries","k","v","flattenedItem","header","lowerName","aiTag","badge","selectMatchingBookmarkFromSelection","modeIconMap","Home","Summary","Review","switchModeIcon","displayName","bookmarks","getBookmarks","targetBookmarkName","bookmark","range","getBookmarkRangeOrNullObject","load","isNullObject","applyBoldIfNeeded","weight","IsHeaderBold","IsSideHeaderBold","applyColor","cellOrRow","bgColor","shadingColor","color","hexColor","hex","isColorDark","borderColor","getBorder","side","width","base","items","Primary","Header","Secondary","rowCount","firstGapIndex","lastGapIndex","BorderLocation","bottom","BorderType","insideVertical","bg","double","headerRow","mapImagesToComponentObjects","input","Flowchart","Graph","Image","img","ImageName","ImageData","svgBase64","svgBlob","Blob","atob","URL","createObjectURL","crossOrigin","onload","canvas","height","ctx","getContext","drawImage","pngBase64","toDataURL","revokeObjectURL","onerror","englishStyle","lang","displayLanguage","DocumentService","transformDocumentName","parts","loadReportData","documentId","getReportById","SourceTypeList","decodeURIComponent","ClientID","aiGroup","Group","groupName","GroupKey","GroupKeyAll","processKey","InitialTable","retrieveDocumentProperties","properties","customProperties","property","orgName","UIService","showNotification","toUpperCase","alert","toggleLoader","loading","loader","display","renderLoginPage","storedUrl","handleLoginCallback","themeToggleCallback","logoHeader","applyTheme","isLight","safeApplyClass","selector","darkClasses","lightClasses","elements","darkClassList","lightClassList","elem","themeToggle","attachDashboardEvents","handlers","onHome","onSummary","onGlossary","onFormat","onRemoveFormat","onThemeToggle","onLogout","loadLoginPage","handleLogin","preventDefault","toLocaleLowerCase","localPallete","displayMenu","showLoginError","errorDiv","fetchDocument","action","reportData","tableStyleObj","getAllCustomTables","selectedTable","TableCustomizationID","Setting","HeaderColor","PrimaryColor","SecondaryColor","BaseStyle","getTableStyle","getAllPromptTemplates","loadPromptTemplates","logoHeaderEl","themeicon","logoheader","generalImagesPromise","getGeneralImages","documentImagesPromise","id","getReportHeadImageById","clientsPromise","getAllClients","generalImages","documentImages","clientsData","all","mappedGeneral","mappedDocument","getImages","removeMatchingContentControls","loadGlossary","fetchGlossary","formatOptionsDisplay","htmlBody","displayCapturedFormatting","removeFormattedText","removeOptionsConfirmation","clear","addHandlerAsync","EventType","DocumentSelectionChanged","handleSelectionChange","glossaryBtn","clearCapturedFormatting","Bold","Underline","Size","removeFormatBtn","captureFormatting","emptyFormatCheckbox","formatList","Italic","size","highlightColor","textRanges","results","search","matchCase","matchWholeWord","anchor","nodes","base64","pic","applyAITagFn","searchResults","applyImageTagFn","applyglossary","bodyText","fetchGlossaryTemplate","GlossaryTemplate","sort","ClinicalTerm","processedTerms","filteredTerms","biggerTerm","filteredGlossaryTerm","foundRanges","searchPromises","contentControls","control","contentControl","insertContentControl","title","appearance","ContentControlAppearance","boundingBox","selectedWords","words","displayElement","groupedTerms","LayTerm","clinicalTerm","mainBox","heading","layTerm","subBox","replaceClinicalTerm","displayHighlightedText","checkGlossary","rawBookmarks","getBookmarksFromSelection","normalized","normalizeBookmark","pickRelevantBookmarks","processedName","logBookmarksInSelection","selectedClient","sourceOptions","SourceTypeID","SourceType","sponsorOptions","client","isSelectedClient","selected","isSummaryMode","addtagbody","preview","templateText","fieldsList","templateSelect","applyBtn","resetBtn","previewDiv","fieldsContainer","previewContainer","templateError","replaceKeywordsManually","keywordMap","field","Label","keyword","HTMLInputElement","HTMLSelectElement","insertValue","RegExp","option","templateId","getPromptTemplateById","Template","div","Type","PromptTemplateOptionList","opt","Text","Option","selectedIndex","promptTextarea","setupPromptBuilderUI","form","nameField","descriptionField","promptField","saveGloballyCheckbox","availableForAllCheckbox","sponsorDropdownButton","sponsorDropdownItems","sourceDropdownButton","sourceDropdownItems","updateSponsorDropdownLabel","cb","parentElement","updateSourceDropdownLabel","valid","selectedPrimarySources","selectedSponsors","isAvailableForAll","isSaveGlobally","aigroup","formData","Description","GroupKeyClient","AllClient","SaveGlobally","UserDefined","ComponentKeyDataTypeID","ComponentKeyDataAccessID","DocumentTypeID","ReportHeadGroupID","ReportHeadSourceID","cancelBtnGenAi","summaryPayload","SummaryTagClient","addSummaryTag","addGroupKey","createTextGenTag","checkAndDisableSponsors","enableSponsors","sel","dispatchEvent","Event","selectedCount","customStyleName","defaultStyle","styleObj","selectedValue","popupClass","warningContent","customizeTablePopup","okBtn","dropdown","tablePreview","applyStyle","removeAttribute","cssText","thead","Preview","textareaId","DropdownId","highlightedIndex","mentionDropdown","updateHighlightedItem","totalItems","highlightedItem","scrollIntoView","behavior","block","cursorPosition","selectionStart","textBeforeCursor","lastHashtag","lastIndexOf","query","filterMentions","editorValue","textareaRect","getBoundingClientRect","left","selectedItem","selectMention","matches","textarea","currentValue","textBefore","textAfter","lastHashPosition","updatedTextBefore","newCursorPosition","setSelectionRange","btnClass","dropdownMenuClass","groupedSources","groups","multiSelectHTML","group","groupIndex","groupItems","accordionBody","selectAllCheckbox","groupCheckboxes","individualCheckboxes","sourceDropdownLabel","updateLabel","groupCb","child","receivedEntry","onReady","info","host","HostType","props","session","savedTheme"],"sourceRoot":""}