{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane/./src/taskpane/index.html","webpack://office-addin-taskpane/./node_modules/html-loader/dist/runtime/getUrl.js","webpack://office-addin-taskpane/webpack/bootstrap","webpack://office-addin-taskpane/webpack/runtime/compat get default export","webpack://office-addin-taskpane/webpack/runtime/define property getters","webpack://office-addin-taskpane/webpack/runtime/global","webpack://office-addin-taskpane/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane/webpack/runtime/publicPath","webpack://office-addin-taskpane/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane/./src/taskpane/data.ts","webpack://office-addin-taskpane/./src/taskpane/api.ts","webpack://office-addin-taskpane/./src/taskpane/components/tablestyles.ts","webpack://office-addin-taskpane/./src/taskpane/components/bodyelements.ts","webpack://office-addin-taskpane/./src/taskpane/functions.ts","webpack://office-addin-taskpane/./src/taskpane/components/home.ts","webpack://office-addin-taskpane/./src/taskpane/taskpane.ts"],"sourcesContent":["// Imports\nimport ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___ from \"../../node_modules/html-loader/dist/runtime/getUrl.js\";\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\nvar ___HTML_LOADER_IMPORT_1___ = new URL(\"./css/bootstrap3.css\", import.meta.url);\n// Module\nvar ___HTML_LOADER_REPLACEMENT_0___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_0___);\nvar ___HTML_LOADER_REPLACEMENT_1___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_1___);\nvar code = \" <!DOCTYPE html> <html> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>Link addin</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css\\\"/> <link href=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" integrity=\\\"sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65\\\" crossorigin=\\\"anonymous\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\\\"> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_0___ + \"\\\" rel=\\\"stylesheet\\\"/> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_1___ + \"\\\" rel=\\\"stylesheet\\\"/> <\" + \"script src=\\\"https://kit.fontawesome.com/5aabee8816.js\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> </head> <body class=\\\"ms-font-m ms-welcome ms-Fabric\\\"> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\\\" integrity=\\\"sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <div id=\\\"header-nav\\\"> <div class=\\\"logo-header d-flex w-100 justify-content-between align-items-center bg-light\\\" id=\\\"logo-header\\\"> </div> </div> <main id=\\\"app-body\\\" class=\\\"d-block mh-34\\\"> <div id=\\\"ai-tag-list-container\\\" class=\\\"accordion\\\"></div> </main> <section id=\\\"confirmation-popup\\\"></section> <section id=\\\"toastr\\\"></section> <div id=\\\"footer\\\" class=\\\"py-2 text-center footer\\\"> </div> </body> </html>\";\n// Exports\nexport default code;","\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    // eslint-disable-next-line no-param-reassign\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n  url = String(url.__esModule ? url.default : url);\n  if (options.hash) {\n    // eslint-disable-next-line no-param-reassign\n    url += options.hash;\n  }\n  if (options.maybeNeedQuotes && /[\\t\\n\\f\\r \"'=<>`]/.test(url)) {\n    return \"\\\"\".concat(url, \"\\\"\");\n  }\n  return url;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","const dataUrl='https://plsdevapp.azurewebsites.net'\r\nconst storeUrl='https://akhil-pws.github.io/ApplyGlossaryWordPane'\r\nconst versionLink='2.4.0'\r\nexport {dataUrl,storeUrl,versionLink};","import { dataUrl } from \"./data\";\r\n\r\n// api.ts\r\nconst baseUrl = dataUrl // Set your actual base URL\r\n\r\nexport async function loginUser(organization: string, username: string, password: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/user/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      ClientName: organization,\r\n      Username: username,\r\n      Password: password\r\n    })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\n// api.ts\r\n\r\nexport async function getReportById(documentID: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/id/${documentID}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAllClients(userId: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/client/all/${userId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAiHistory(tagId: string, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/${tagId}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${jwt}`\r\n    }\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function updateGroupKey(tag: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/head/groupkey`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(tag)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function addAiHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function updateAiHistory(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/ai-history/update`, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function fetchGlossaryTemplate(clientId: string, bodyText: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/glossary-template/client-id/${clientId}`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(bodyText)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function addGroupKey(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/report/group-key/add`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getAllPromptTemplates(jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/prompt-template/all`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\n\r\nexport async function getPromptTemplateById(id: string, jwt): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/prompt-template/${id}/data`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n\r\nexport async function updatePromptTemplate(payload: any, jwt: string): Promise<any> {\r\n  const response = await fetch(`${baseUrl}/api/groupkey/update-prompt`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${jwt}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Network response was not ok.');\r\n  }\r\n\r\n  const data: any = await response.json();\r\n  return data;\r\n}\r\n","export const wordTableStyles = [\r\n    { name: \"Table Grid\", style: \"Table Grid\", tableClass: \"background-color:#ffffff;border:1px solid #000;\" ,rowClass: \"background-color:#ffffff;color:#000000;\"},\r\n\r\n    // // Light Shading\r\n    // { name: \"Light Shading - Blue\", style: \"Light Shading - Accent 1\", class: \"background-color:#c6d9f0;border:1px solid #4f81bd;\" },\r\n    // { name: \"Light Shading - Orange\", style: \"Light Shading - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Light Shading - Gray\", style: \"Light Shading - Accent 3\", class: \"background-color:#e7e6e6;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Light Shading - Yellow\", style: \"Light Shading - Accent 4\", class: \"background-color:#fff2ca;border:1px solid #ffbf00;\" },\r\n    // { name: \"Light Shading - Teal\", style: \"Light Shading - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Light Shading - Green\", style: \"Light Shading - Accent 6\", class: \"background-color:#d9d2e9;border:1px solid #7030a0;\" },\r\n\r\n    // // Light List\r\n    // { name: \"Light List - Blue\", style: \"Light List - Accent 1\", class: \"background-color:#c6d9f0;border:1px solid #4f81bd;\" },\r\n    // { name: \"Light List - Orange\", style: \"Light List - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Light List - Gray\", style: \"Light List - Accent 3\", class: \"background-color:#e7e6e6;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Light List - Yellow\", style: \"Light List - Accent 4\", class: \"background-color:#fff2ca;border:1px solid #ffbf00;\" },\r\n    // { name: \"Light List - Teal\", style: \"Light List - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Light List - Green\", style: \"Light List - Accent 6\", class: \"background-color:#d9d2e9;border:1px solid #7030a0;\" },\r\n\r\n    // // Light Grid\r\n    // { name: \"Light Grid - Blue\", style: \"Light Grid - Accent 1\", class: \"background-color:#c6d9f0;border:1px solid #4f81bd;\" },\r\n    // { name: \"Light Grid - Orange\", style: \"Light Grid - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Light Grid - Gray\", style: \"Light Grid - Accent 3\", class: \"background-color:#e7e6e6;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Light Grid - Yellow\", style: \"Light Grid - Accent 4\", class: \"background-color:#fff2ca;border:1px solid #ffbf00;\" },\r\n    // { name: \"Light Grid - Teal\", style: \"Light Grid - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Light Grid - Green\", style: \"Light Grid - Accent 6\", class: \"background-color:#d9d2e9;border:1px solid #7030a0;\" },\r\n\r\n    // // Medium Shading 1\r\n    // { name: \"Medium Shading 1 - Blue\", style: \"Medium Shading 1 - Accent 1\", class: \"background-color:#8ea9db;border:1px solid #4f81bd;\" },\r\n    // { name: \"Medium Shading 1 - Orange\", style: \"Medium Shading 1 - Accent 2\", class: \"background-color:#f9cb9c;border:1px solid #f79646;\" },\r\n    // { name: \"Medium Shading 1 - Gray\", style: \"Medium Shading 1 - Accent 3\", class: \"background-color:#d9d9d9;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Medium Shading 1 - Yellow\", style: \"Medium Shading 1 - Accent 4\", class: \"background-color:#ffe699;border:1px solid #ffbf00;\" },\r\n    // { name: \"Medium Shading 1 - Teal\", style: \"Medium Shading 1 - Accent 5\", class: \"background-color:#b6d7a8;border:1px solid #00b050;\" },\r\n    // { name: \"Medium Shading 1 - Green\", style: \"Medium Shading 1 - Accent 6\", class: \"background-color:#b4a7d6;border:1px solid #7030a0;\" },\r\n\r\n    // // Medium Shading 2\r\n    // { name: \"Medium Shading 2 - Blue\", style: \"Medium Shading 2 - Accent 1\", class: \"background-color:#bdd7ee;border:1px solid #4f81bd;\" },\r\n    // { name: \"Medium Shading 2 - Orange\", style: \"Medium Shading 2 - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Medium Shading 2 - Gray\", style: \"Medium Shading 2 - Accent 3\", class: \"background-color:#e2e2e2;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Medium Shading 2 - Yellow\", style: \"Medium Shading 2 - Accent 4\", class: \"background-color:#fff2cc;border:1px solid #ffbf00;\" },\r\n    // { name: \"Medium Shading 2 - Teal\", style: \"Medium Shading 2 - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Medium Shading 2 - Green\", style: \"Medium Shading 2 - Accent 6\", class: \"background-color:#c9b5e3;border:1px solid #7030a0;\" },\r\n\r\n    // // Medium List 1\r\n    // { name: \"Medium List 1 - Blue\", style: \"Medium List 1 - Accent 1\", class: \"background-color:#bdd7ee;border:1px solid #4f81bd;\" },\r\n    // { name: \"Medium List 1 - Orange\", style: \"Medium List 1 - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Medium List 1 - Gray\", style: \"Medium List 1 - Accent 3\", class: \"background-color:#e2e2e2;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Medium List 1 - Yellow\", style: \"Medium List 1 - Accent 4\", class: \"background-color:#fff2cc;border:1px solid #ffbf00;\" },\r\n    // { name: \"Medium List 1 - Teal\", style: \"Medium List 1 - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Medium List 1 - Green\", style: \"Medium List 1 - Accent 6\", class: \"background-color:#c9b5e3;border:1px solid #7030a0;\" },\r\n\r\n    // // Medium List 2\r\n    // { name: \"Medium List 2 - Blue\", style: \"Medium List 2 - Accent 1\", class: \"background-color:#bdd7ee;border:1px solid #4f81bd;\" },\r\n    // { name: \"Medium List 2 - Orange\", style: \"Medium List 2 - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Medium List 2 - Gray\", style: \"Medium List 2 - Accent 3\", class: \"background-color:#e2e2e2;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Medium List 2 - Yellow\", style: \"Medium List 2 - Accent 4\", class: \"background-color:#fff2cc;border:1px solid #ffbf00;\" },\r\n    // { name: \"Medium List 2 - Teal\", style: \"Medium List 2 - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Medium List 2 - Green\", style: \"Medium List 2 - Accent 6\", class: \"background-color:#c9b5e3;border:1px solid #7030a0;\" },\r\n\r\n    // // Dark List\r\n    // { name: \"Dark List - Blue\", style: \"Dark List - Accent 1\", class: \"background-color:#4f81bd;border:1px solid #17365d;color:#ffffff;\" },\r\n    // { name: \"Dark List - Orange\", style: \"Dark List - Accent 2\", class: \"background-color:#f79646;border:1px solid #974806;color:#ffffff;\" },\r\n    // { name: \"Dark List - Gray\", style: \"Dark List - Accent 3\", class: \"background-color:#7f7f7f;border:1px solid #3f3f3f;color:#ffffff;\" },\r\n    // { name: \"Dark List - Yellow\", style: \"Dark List - Accent 4\", class: \"background-color:#ffbf00;border:1px solid #7f6000;color:#000000;\" },\r\n    // { name: \"Dark List - Teal\", style: \"Dark List - Accent 5\", class: \"background-color:#00b050;border:1px solid #006000;color:#ffffff;\" },\r\n    // { name: \"Dark List - Green\", style: \"Dark List - Accent 6\", class: \"background-color:#7030a0;border:1px solid #401860;color:#ffffff;\" },\r\n\r\n    // // Dark Grid\r\n    // { name: \"Dark Grid - Blue\", style: \"Dark Grid - Accent 1\", class: \"background-color:#4f81bd;border:1px solid #17365d;color:#ffffff;\" },\r\n    // { name: \"Dark Grid - Orange\", style: \"Dark Grid - Accent 2\", class: \"background-color:#f79646;border:1px solid #974806;color:#ffffff;\" },\r\n    // { name: \"Dark Grid - Gray\", style: \"Dark Grid - Accent 3\", class: \"background-color:#7f7f7f;border:1px solid #3f3f3f;color:#ffffff;\" },\r\n    // { name: \"Dark Grid - Yellow\", style: \"Dark Grid - Accent 4\", class: \"background-color:#ffbf00;border:1px solid #7f6000;color:#000000;\" },\r\n    // { name: \"Dark Grid - Teal\", style: \"Dark Grid - Accent 5\", class: \"background-color:#00b050;border:1px solid #006000;color:#ffffff;\" },\r\n    // { name: \"Dark Grid - Green\", style: \"Dark Grid - Accent 6\", class: \"background-color:#7030a0;border:1px solid #401860;color:#ffffff;\" },\r\n\r\n    // Grid Table 1 Light\r\n    // { name: \"Grid Table 1 Light - Blue\", style: \"Grid Table 1 Light - Accent 1\", class: \"background-color:#ffffff;border:1px solid #4f81bd;\" },\r\n    // { name: \"Grid Table 1 Light - Orange\", style: \"Grid Table 1 Light - Accent 2\", class: \"background-color:#ffffff;border:1px solid #E5B8B7;\" },\r\n    // { name: \"Grid Table 1 Light - Gray\", style: \"Grid Table 1 Light - Accent 3\", class: \"background-color:#ffffff;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Grid Table 1 Light - Yellow\", style: \"Grid Table 1 Light - Accent 4\", class: \"background-color:#ffffff;border:1px solid #ffbf00;\" },\r\n    // { name: \"Grid Table 1 Light - Teal\", style: \"Grid Table 1 Light - Accent 5\", class: \"background-color:#ffffff;border:1px solid #00b050;\" },\r\n    // { name: \"Grid Table 1 Light - Green\", style: \"Grid Table 1 Light - Accent 6\", class: \"background-color:#ffffff;border:1px solid #7030a0;\" },\r\n\r\n    // // Grid Table 2\r\n    { name: \"Grid Table 2 - Blue\", style: \"Grid Table 2 - Accent 1\", tableClass: \"background-color:#ffffff;border:1px solid #95B3D7;\", rowClass: \"background-color:#dbe5f1;color:#000000;\" },\r\n    { name: \"Grid Table 2 - Orange\", style: \"Grid Table 2 - Accent 2\", tableClass: \"background-color:#ffffff;border:1px solid #f2dbdb;\", rowClass: \"background-color:#f2dbdb;color:#000000;\" },\r\n    { name: \"Grid Table 2 - Gray\", style: \"Grid Table 2 - Accent 3\", tableClass: \"background-color:#ffffff;border:1px solid #9bbb59;\", rowClass: \"background-color:#eaf1dd;color:#000000;\" },\r\n    { name: \"Grid Table 2 - Yellow\", style: \"Grid Table 2 - Accent 4\", tableClass: \"background-color:#ffffff;border:1px solid #8064a2;\", rowClass: \"background-color:#e5dfec;color:#000000;\" },\r\n    { name: \"Grid Table 2 - Teal\", style: \"Grid Table 2 - Accent 5\", tableClass: \"background-color:#ffffff;border:1px solid #4bacc6;\", rowClass: \"background-color:#daeef3;color:#000000;\" },\r\n    { name: \"Grid Table 2 - Green\", style: \"Grid Table 2 - Accent 6\", tableClass: \"background-color:#ffffff;border:1px solid #f79646;\", rowClass: \"background-color:#fde9d9;color:#000000;\" },\r\n\r\n\r\n    // // Grid Table 3\r\n    // { name: \"Grid Table 3 - Blue\", style: \"Grid Table 3 - Accent 1\", class: \"background-color:#bdd7ee;border:1px solid #4f81bd;\" },\r\n    // { name: \"Grid Table 3 - Orange\", style: \"Grid Table 3 - Accent 2\", class: \"background-color:#fcd5b4;border:1px solid #f79646;\" },\r\n    // { name: \"Grid Table 3 - Gray\", style: \"Grid Table 3 - Accent 3\", class: \"background-color:#e2e2e2;border:1px solid #7f7f7f;\" },\r\n    // { name: \"Grid Table 3 - Yellow\", style: \"Grid Table 3 - Accent 4\", class: \"background-color:#fff2cc;border:1px solid #ffbf00;\" },\r\n    // { name: \"Grid Table 3 - Teal\", style: \"Grid Table 3 - Accent 5\", class: \"background-color:#d9ead3;border:1px solid #00b050;\" },\r\n    // { name: \"Grid Table 3 - Green\", style: \"Grid Table 3 - Accent 6\", class: \"background-color:#c9b5e3;border:1px solid #7030a0;\" },\r\n\r\n    // Grid Table 4\r\n    // Grid Table 4 - Light\r\n    { name: \"Grid Table 4 - Blue\", style: \"Grid Table 4 - Accent 1\", tableClass: \"background-color:#4F81BD;border:1px solid #95B3D7;color:#ffffff;\", rowClass: \"background-color:#dbe5f1;color:#000000;\" },\r\n    { name: \"Grid Table 4 - Orange\", style: \"Grid Table 4 - Accent 2\", tableClass: \"background-color:#c0504d;border:1px solid #f2dbdb;color:#ffffff;\", rowClass: \"background-color:#f2dbdb;color:#000000;\" },\r\n    { name: \"Grid Table 4 - Gray\", style: \"Grid Table 4 - Accent 3\", tableClass: \"background-color:#9bbb59;border:1px solid #9bbb59;color:#ffffff;\", rowClass: \"background-color:#eaf1dd;color:#000000;\" },\r\n    { name: \"Grid Table 4 - Yellow\", style: \"Grid Table 4 - Accent 4\", tableClass: \"background-color:#8064a2;border:1px solid #8064a2;color:#ffffff;\", rowClass: \"background-color:#e5dfec;color:#000000;\" },\r\n    { name: \"Grid Table 4 - Teal\", style: \"Grid Table 4 - Accent 5\", tableClass: \"background-color:#4bacc6;border:1px solid #4bacc6;color:#ffffff;\", rowClass: \"background-color:#daeef3;color:#000000;\" },\r\n    { name: \"Grid Table 4 - Green\", style: \"Grid Table 4 - Accent 6\", tableClass: \"background-color:#f79646;border:1px solid #f79646;color:#ffffff;\", rowClass: \"background-color:#fde9d9;color:#000000;\" },\r\n\r\n\r\n];\r\n","import { theme } from \"../taskpane\";\r\nimport { wordTableStyles } from \"./tablestyles\";\r\n\r\nfunction addtagbody(sponsorOptions) {\r\n  const body = `<div class=\"modal-dialog\">\r\n  <div class=\"modal-content\">\r\n    <div class=\"modal-body p-3 pt-0\">\r\n      <form id=\"genai-form\" autocomplete=\"off\" novalidate>\r\n        <!-- Name Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"name\" class=\"form-label\"><span class=\"text-danger\">*</span> Name</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"name\" required>\r\n          <div class=\"invalid-feedback\">Name is required.</div>\r\n          <div id=\"submition-error\" class=\"invalid-feedback\" style=\"display: none;\"></div>\r\n\r\n        </div>\r\n\r\n        <!-- Description Field -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"description\" class=\"form-label\">Description</label>\r\n          <textarea class=\"form-control\" id=\"description\" rows=\"6\"></textarea>\r\n        </div>\r\n\r\n        <!-- Prompt Field -->\r\n        <div class=\"mb-3 prompt-box\">\r\n          <label for=\"prompt\" class=\"form-label\"><span class=\"text-danger\">*</span> Prompt \r\n            <small class=\"text-secondary\">(Note: Use # tag for content suggestions)</small>\r\n          </label>\r\n          <textarea class=\"form-control\" id=\"prompt\" rows=\"6\"  required></textarea>\r\n          <div class=\"invalid-feedback\">Prompt is required.</div>\r\n          <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n        </div>\r\n\r\n        <!-- Save Globally Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"saveGlobally\">\r\n          <label class=\"form-check-label\" for=\"saveGlobally\">Save Globally</label>\r\n        </div>\r\n\r\n        <!-- Available to All Sponsors Checkbox -->\r\n        <div class=\"form-check mb-3\">\r\n          <input type=\"checkbox\" class=\"form-check-input\" id=\"isAvailableForAll\" disabled>\r\n          <label class=\"form-check-label\" for=\"isAvailableForAll\">Available to All Sponsors</label>\r\n        </div>\r\n\r\n        <!-- Sponsor Dropdown -->\r\n        <div class=\"mb-3\">\r\n          <label for=\"sponsor\" class=\"form-label\"><span class=\"text-danger\">*</span> Sponsor</label>\r\n          <div class=\"dropdown w-100\">\r\n            <button \r\n              class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n              type=\"button\" \r\n              id=\"sponsorDropdown\" \r\n              data-bs-toggle=\"dropdown\" \r\n              aria-expanded=\"false\" \r\n              disabled>\r\n              <span id=\"sponsorDropdownLabel\">Select Sponsors</span>\r\n              <span class=\"dropdown-toggle-icon\"></span>\r\n            </button>\r\n            <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sponsorDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n              <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\r\n                  <label class=\"form-check-label\" for=\"selectAll\">Select All</label>\r\n                </div>\r\n              </li>\r\n              ${sponsorOptions}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Action Buttons -->\r\n        <div class=\"mt-3 d-flex justify-content-between\">\r\n          <span id=\"cancel-btn-gen-ai\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n          <button type=\"submit\" class=\"btn btn-primary\" id=\"text-gen-save\">Save</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>`\r\n\r\n  return body\r\n}\r\n\r\n\r\nfunction Confirmationpopup(content: string) {\r\n  const isDark = theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  const body = `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header border-0\">\r\n        <h5 class=\"fw-bold\">Confirmation</h5>\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        <p>${content}</p>\r\n      </div>\r\n\r\n      <div class=\"modal-footer border-0\">\r\n        <button type=\"button\" class=\"btn btn-link ${isDark ? 'text-info' : 'text-primary'}\" id=\"confirmation-popup-cancel\">Cancel</button>\r\n        <button type=\"button\" class=\"btn btn-primary text-white\" id=\"confirmation-popup-confirm\">Ok</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>`;\r\n  return body;\r\n}\r\n\r\n\r\nfunction customizeTablePopup(selectedValue: string) {\r\n  const isDark = theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  const dropdown = `\r\n  \r\n    <select class=\"form-select mb-3 ${popupClass}\" id=\"confirmation-popup-dropdown\">\r\n      ${wordTableStyles\r\n      .map(\r\n        opt =>\r\n          `<option value=\"${opt.style}\" ${opt.style === selectedValue ? 'selected' : ''}>\r\n              ${opt.style}\r\n            </option>`\r\n      )\r\n      .join('')}\r\n    </select>\r\n  `;\r\n\r\n  const tablePreview = `\r\n    <div class=\"table-responsive\">\r\n      <table class=\"table table-bordered table-sm\" id=\"confirmation-popup-table-preview\">\r\n        <thead>\r\n          <tr>\r\n            <th>Header 1</th>\r\n            <th>Header 2</th>\r\n            <th>Header 3</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr style=\"color:black;\">\r\n            <td>Data 1</td>\r\n            <td>Data 2</td>\r\n            <td>Data 3</td>\r\n          </tr>\r\n          <tr style=\"background-color:white;color:black;\">\r\n            <td>Data 4</td>\r\n            <td>Data 5</td>\r\n            <td>Data 6</td>\r\n          </tr>\r\n          <tr style=\"color:black;\" >\r\n            <td>Data 7</td>\r\n            <td>Data 8</td>\r\n            <td>Data 9</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  `;\r\n\r\n  return `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header border-0\">\r\n        <h5 class=\"fw-bold\">Customize Table</h5>\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        ${dropdown}\r\n        ${tablePreview}\r\n      </div>\r\n\r\n      <div class=\"modal-footer border-0\">\r\n        <button type=\"button\" class=\"btn btn-link ${isDark ? 'text-info' : 'text-primary'}\" id=\"confirmation-popup-cancel\">Cancel</button>\r\n        <button type=\"button\" class=\"btn btn-primary text-white\" id=\"confirmation-popup-confirm\">Ok</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n  `;\r\n}\r\n\r\n\r\nfunction DataModalPopup(selectedData) {\r\n  const isDark = theme === 'Dark';\r\n  const popupClass = isDark ? 'bg-dark text-light' : 'bg-light text-dark';\r\n\r\n  return `\r\n<div class=\"modal show d-block\" tabindex=\"-1\">\r\n  <div class=\"modal-dialog modal-lg\">\r\n    <div class=\"modal-content ${popupClass}\">\r\n      <div class=\"modal-header flex-column align-items-start border-0\">\r\n        <span class=\"fw-bold mb-3\">${selectedData?.Name || ''}</span>\r\n        <span class=\"d-block list-height\">${selectedData?.UserValue || ''}</span>\r\n        ${selectedData?.Sources ? `\r\n        <hr class=\"${isDark ? 'border-light' : 'border-dark'}\">\r\n        <div class=\"d-flex align-items-start flex-wrap\">\r\n          <span class=\"fw-bold me-2\">Selected Sources :</span>\r\n          <div class=\"d-flex flex-wrap gap-1\">\r\n            ${selectedData.Sources.map(source => `\r\n              <span class=\"badge ${isDark ? 'text-bg-secondary' : 'text-bg-info'}\">${source.FileName}</span>\r\n            `).join('')}\r\n          </div>\r\n        </div>` : ''}\r\n      </div>\r\n\r\n      <div class=\"modal-body p-3 add-ai-gen\">\r\n        <div class=\"row g-2 list-height\">\r\n          ${selectedData?.Data?.map(item => `\r\n            <div class=\"col-md-12 mt-3\">\r\n              <div class=\"border rounded p-2 ${isDark ? 'bg-secondary text-light' : 'bg-light text-dark'} shadow-sm h-100\">\r\n                <div class=\"fw-bold small text-truncate\" title=\"${item.FileName}\">\r\n                  ${item.FileName}\r\n                </div>\r\n                <div class=\"text-muted small mb-1\">Page: ${item.PageNumber}</div>\r\n                <div class=\"small\" style=\"white-space: normal;\">\r\n                  ${item.Sentence}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n\r\n        <div class=\"d-flex w-100 justify-content-end mt-3 align-items-center\">\r\n          <button type=\"button\" class=\"btn btn-primary text-white\" id=\"datamodel-popup-ok\">OK</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>`;\r\n}\r\n\r\n\r\n\r\nfunction toaster(message: string, type: string) {\r\n  const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';\r\n  // const color = type === 'success' ? '#28a745' : '#dc3545';\r\n  const color = `#ffffff`\r\n  const body = `<div class=\"toast show\" style=\"position: fixed; top: 10px; right: 10px; z-index: 1050; max-width: fit-content; background-color: #808080; color: #ffffff;\">\r\n    <div class=\"toast-body\">\r\n         <i class=\"fa ${icon} me-2\" style=\"color: ${color};\"></i> ${message}\r\n    </div>\r\n  </div>`;\r\n\r\n  document.getElementById('toastr').innerHTML = body;\r\n  setTimeout(() => {\r\n    document.getElementById('toastr').innerHTML = ``;\r\n  }, 4000);\r\n}\r\n\r\nfunction logoheader(storedUrl) {\r\n  const themeicon = theme === 'Dark' ? 'fa-sun' : 'fa-moon'\r\n  const body = `\r\n    <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n    <div class=\"icon-nav me-3\">\r\n      <i class=\"fa fa-home c-pointer me-3\" title=\"Home\" id=\"home\"></i>\r\n      <div class=\"dropdown d-inline\">\r\n        <i class=\"fa fa-tools c-pointer me-3\" id=\"settingsDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Settings\"></i>\r\n        <ul class=\"dropdown-menu\" aria-labelledby=\"settingsDropdown\">\r\n        <li>\r\n        <li>\r\n            <a class=\"dropdown-item\" href=\"#\" id=\"define-formatting\">\r\n              <i class=\"fa fa-sliders-h me-2\" aria-hidden=\"true\"></i> Define Formatting\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"glossary\" tabindex=\"-1\" aria-disabled=\"true\">\r\n              <i class=\"fa fa-book me-2\" aria-hidden=\"true\"></i> Apply Glossary\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a class=\"dropdown-item disabled-link\" href=\"#\" id=\"removeFormatting\" tabindex=\"-1\" aria-disabled=\"true\">\r\n              <i class=\"fa fa-eraser me-2\" aria-hidden=\"true\"></i> Remove Formatting\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n\r\n      <!-- Theme Toggle Icon -->\r\n      <span id=\"theme-toggle\"><i class=\"fa ${themeicon} c-pointer me-3\" title=\"Toggle Theme\"></i></span>\r\n\r\n      <i class=\"fa fa-sign-out c-pointer me-3\" id=\"logout\" title=\"Logout\"></i>\r\n    </div>    \r\n  `\r\n  return body;\r\n}\r\n\r\nconst navTabs = `<ul class=\"nav nav-tabs\" id=\"tabList\" role=\"tablist\">\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link active\" id=\"tag-tab\" data-bs-toggle=\"tab\" href=\"#tag\" role=\"tab\">Tag</a>\r\n  </li>\r\n  <li class=\"nav-item\">\r\n    <a class=\"nav-link\" id=\"prompt-tab\" data-bs-toggle=\"tab\" href=\"#prompt\" role=\"tab\">Prompt builder</a>\r\n  </li>\r\n</ul>\r\n\r\n<div class=\"tab-content p-3 border border-top-0\">\r\n  <div class=\"tab-pane fade show active\" id=\"add-tag-body\" role=\"tabpanel\" aria-labelledby=\"tag-tab\">\r\n  </div>\r\n  <div class=\"tab-pane fade\" id=\"add-prompt-template\" role=\"tabpanel\" aria-labelledby=\"prompt-tab\">\r\n  </div>\r\n</div>\r\n`\r\n\r\n\r\n\r\nconst promptbuilderbody = `<div>hi</div>`\r\n\r\n\r\nexport { navTabs, addtagbody, promptbuilderbody, logoheader, Confirmationpopup, toaster, DataModalPopup, customizeTablePopup };","import { toaster } from \"./components/bodyelements\";\r\nimport { generateCheckboxHistory } from \"./components/home\";\r\nimport { theme, UserRole } from \"./taskpane\";\r\n\r\nexport async function insertLineWithHeadingStyle(range: Word.Range, line: string) {\r\n  await Word.run(async (context) => {\r\n    let style = \"Normal\";\r\n    let text = line;\r\n\r\n    if (line.startsWith('###### ')) {\r\n      style = \"Heading 6\";\r\n      text = line.substring(7).trim();\r\n    } else if (line.startsWith('##### ')) {\r\n      style = \"Heading 5\";\r\n      text = line.substring(6).trim();\r\n    } else if (line.startsWith('#### ')) {\r\n      style = \"Heading 4\";\r\n      text = line.substring(5).trim();\r\n    } else if (line.startsWith('### ')) {\r\n      style = \"Heading 3\";\r\n      text = line.substring(4).trim();\r\n    } else if (line.startsWith('## ')) {\r\n      style = \"Heading 2\";\r\n      text = line.substring(3).trim();\r\n    } else if (line.startsWith('# ')) {\r\n      style = \"Heading 1\";\r\n      text = line.substring(2).trim();\r\n    }\r\n\r\n    // Create an empty paragraph with the desired style\r\n    const paragraph = range.insertParagraph(\"\", Word.InsertLocation.before);\r\n    paragraph.style = style;\r\n\r\n    // Combine all markdown patterns in a single regex\r\n    const regex = /(\\*\\*(.+?)\\*\\*)|(\\*(.+?)\\*)|(_(.+?)_)/g;\r\n    let lastIndex = 0;\r\n    let match;\r\n\r\n    while ((match = regex.exec(text)) !== null) {\r\n      // Insert plain text before the match\r\n      if (match.index > lastIndex) {\r\n        paragraph.insertText(text.substring(lastIndex, match.index), Word.InsertLocation.end);\r\n      }\r\n\r\n      // Extract the actual content and formatting\r\n      let content = \"\";\r\n      let bold = false;\r\n      let italic = false;\r\n      let underline = false;\r\n\r\n      if (match[1]) { // **bold**\r\n        content = match[2];\r\n        bold = true;\r\n      } else if (match[3]) { // *italic*\r\n        content = match[4];\r\n        italic = true;\r\n      } else if (match[5]) { // _underline_\r\n        content = match[6];\r\n        underline = true;\r\n      }\r\n\r\n      const formattedRange = paragraph.insertText(content, Word.InsertLocation.end);\r\n      formattedRange.font.bold = bold;\r\n      formattedRange.font.italic = italic;\r\n      formattedRange.font.underline = underline ? Word.UnderlineType.single : Word.UnderlineType.none;\r\n\r\n      lastIndex = regex.lastIndex;\r\n    }\r\n\r\n    // Insert any remaining text after last formatting\r\n    if (lastIndex < text.length) {\r\n      paragraph.insertText(text.substring(lastIndex), Word.InsertLocation.end);\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n}\r\n\r\nexport function removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\n\r\n\r\nexport function copyText(text: string) {\r\n  // Copy text to clipboard logic\r\n  const tempTextArea = document.createElement('textarea');\r\n  tempTextArea.value = text;\r\n  document.body.appendChild(tempTextArea);\r\n  tempTextArea.select();\r\n  document.execCommand('copy');\r\n  document.body.removeChild(tempTextArea);\r\n  toaster('Copied to clipboard successfully!', 'success')\r\n\r\n}\r\n\r\n\r\nexport function switchToPromptBuilder() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('prompt-tab').classList.add('active');\r\n  document.getElementById('add-prompt-template').classList.add('show', 'active');\r\n}\r\n\r\n\r\nexport function switchToAddTag() {\r\n  // Remove active class from current tab\r\n  document.querySelector('.nav-link.active')?.classList.remove('active');\r\n  document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');\r\n\r\n  // Add active class to Prompt Builder tab\r\n  document.getElementById('tag-tab').classList.add('active');\r\n  document.getElementById('add-tag-body').classList.add('show', 'active');\r\n}\r\n\r\nexport function updateEditorFinalTable(data) {\r\n  const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n  let match;\r\n  let tables = [];\r\n\r\n  while ((match = regex.exec(data)) !== null) {\r\n    try {\r\n      const parsedContent = JSON.parse(match[1]);\r\n      tables.push(jsonToHtmlTable(parsedContent));\r\n    } catch (error) {\r\n      console.error(\"Failed to parse JSON:\", error, match[1]);\r\n    }\r\n  }\r\n\r\n  let tableIndex = 0;\r\n  return data.replace(regex, () => tables[tableIndex++] || \"\");\r\n}\r\n\r\nfunction jsonToHtmlTable(jsonData) {\r\n  if (!jsonData || (Array.isArray(jsonData) && jsonData.length === 0)) {\r\n    return '<p>No data available</p>';\r\n  }\r\n\r\n  let headers = new Set();\r\n  let rows = [];\r\n\r\n  function flattenObject(obj, prefix = \"\", result = {}) {\r\n    Object.keys(obj).forEach(key => {\r\n      const value = obj[key];\r\n      const newKey = prefix ? `${prefix} > ${key}` : key;\r\n\r\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n        flattenObject(value, newKey, result);\r\n      } else if (Array.isArray(value)) {\r\n        result[newKey] = value.map(item => {\r\n          return typeof item === 'object'\r\n            ? Object.entries(item).map(([k, v]) => `<strong>${k}:</strong> ${v}`).join('<br>')\r\n            : item;\r\n        }).join('<br>');\r\n      } else {\r\n        result[newKey] = value;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  if (!Array.isArray(jsonData)) {\r\n    jsonData = Object.entries(jsonData).map(([key, value]) => ({ [key]: value }));\r\n  }\r\n\r\n  jsonData.forEach(item => {\r\n    let flattenedItem = flattenObject(item);\r\n    Object.keys(flattenedItem).forEach(key => headers.add(key));\r\n    rows.push(flattenedItem);\r\n  });\r\n\r\n  let table = '<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">';\r\n  table += '<tr>' + [...headers].map(header => `<th>${header}</th>`).join('') + '</tr>';\r\n  rows.forEach(row => {\r\n    table += '<tr>' + [...headers].map(header => `<td>${row[header]}</td>`).join('') + '</tr>';\r\n  });\r\n\r\n  table += '</table>';\r\n  return table;\r\n}\r\n\r\n\r\n\r\nexport function generateChatHistoryHtml(chatList: any[]): string {\r\n  const promptclass = theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n  const globalPromptUpdate = UserRole.UserRoleEntityAccessList.find(\r\n    (item: any) => item.UserRoleEntity === 'Global Prompt Update'\r\n  );\r\n\r\n  return chatList.map((chat, index) => {\r\n    const includeSaveIcon = globalPromptUpdate?.UserRoleAccessID === 3;\r\n\r\n    return `\r\n      <div class=\"row chat-entry m-0 p-0\">\r\n        <div class=\"col-md-12 mt-2 p-2\">\r\n          <div class=\"d-flex justify-content-between align-items-start\">\r\n            <!-- Prompt Box -->\r\n            <div class=\"form-control h-34 d-flex align-items-center dynamic-height prompt-text ${promptclass}\" style=\"width: 95%;\">\r\n              ${chat.Prompt}\r\n            </div>\r\n\r\n            <!-- Icons Stack -->\r\n            <div class=\"d-flex flex-column align-items-center ms-2\">\r\n              <i class=\"fa fa-copy text-secondary c-pointer mb-2\" title=\"Copy Prompt\" id=\"copyPrompt-${index}\"></i>\r\n              ${includeSaveIcon ? `<i class=\"fa fa-save text-secondary c-pointer\" title=\"Save Prompt\" id=\"savePrompt-${index}\"></i>` : ''}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-12 mb-2 p-2 d-flex\">\r\n          <span class=\"d-flex align-items-baseline w-100\">\r\n            <div class=\"flex-grow-1 c-pointer ai-response-container px-2 pe-3 pt-3 ai-selected-response\" id=\"responseContainer-${index}\">\r\n              <input\r\n                class=\"form-check-input c-pointer me-2 response-checkbox\"\r\n                type=\"checkbox\"\r\n                id=\"checkbox-${index}\"\r\n                ${chat.Selected === 1 ? 'checked' : ''}>\r\n              <span id=\"responseText-${index}\">${chat.Response}</span>\r\n              <i class=\"fa fa-copy text-secondary c-pointer ms-2\"\r\n                title=\"Copy Response\"\r\n                id=\"copyResponse-${index}\"></i>\r\n\r\n              <i class=\"fa fa-folder-gear text-secondary c-pointer ms-2\"\r\n                title=\"Open Reference\"\r\n                id=\"openRefferance-${index}\"></i>\r\n            </div>\r\n          </span>\r\n        </div>\r\n      </div>`;\r\n  }).join('');\r\n}\r\n\r\n\r\n\r\nexport function chatfooter(tag: any) {\r\n  const promptclass = theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n  const tooltipButton = tag.Sources && tag.Sources.length > 0\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n  return ` <textarea class=\"form-control ${promptclass}\"\r\n                      rows=\"5\"\r\n                      id=\"chatInput\"\r\n                      ></textarea>\r\n            <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n            <div class=\"d-flex flex-column align-self-end me-3\">\r\n              <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insertTagButton\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\"></i>\r\n              </button>\r\n             <div class=\"ngb-tooltip d-inline-block\">\r\n                 ${tooltipButton}\r\n                <button class=\"btn btn-secondary ms-2 mb-2 text-white\" id=\"changeSourceButton\">\r\n                  <i class=\"fa fa-file-lines text-white\"></i>\r\n                </button>\r\n              </div>\r\n\r\n              <button type=\"submit\" class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\" id=\"sendPromptButton\">\r\n                <span class=\"tooltiptext\">Send</span>\r\n                <i class=\"fa fa-paper-plane text-white\"></i>\r\n              </button>\r\n            </div>`\r\n}\r\n\r\nexport function renderSelectedTags(selectedNames, availableKeys) {\r\n  const badgeWrapper = document.getElementById('tag-badge-wrapper');\r\n  badgeWrapper.innerHTML = '';\r\n  // Filter out duplicates (case-insensitive)\r\n  const uniqueNames = [...new Set(\r\n    selectedNames.map(name => name.toLowerCase())\r\n  )].map(lowerName =>\r\n    selectedNames.find(name => name.toLowerCase() === lowerName)\r\n  );\r\n\r\n\r\n  uniqueNames.forEach(name => {\r\n    let aiTag;\r\n\r\n    if (/^ID\\d+$/i.test(name)) {\r\n      aiTag = availableKeys.find(\r\n        mention => mention.AIFlag === 1 && `id${mention.ID}`.toLowerCase() === name.toLowerCase()\r\n      );\r\n    } else {\r\n      aiTag = availableKeys.find(\r\n        mention => mention.AIFlag === 1 && mention.DisplayName.toLowerCase() === name.toLowerCase()\r\n      );\r\n    }\r\n    const badge = document.createElement('span');\r\n    badge.className = 'badge rounded-pill border bg-white text-dark px-3 py-2 shadow-sm d-flex align-items-center badge-clickable';\r\n    badge.style.cursor = 'pointer';\r\n    badge.innerHTML = `${aiTag.DisplayName} <i class=\"fa-solid fa-microchip-ai ms-2 text-muted\" aria-label=\"AI Suggested\"></i>`;\r\n\r\n    badge.addEventListener('click', async () => {\r\n      await selectMatchingBookmarkFromSelection(name);\r\n\r\n      if (aiTag) {\r\n        const appBody = document.getElementById('app-body');\r\n        appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n\r\n        generateCheckboxHistory(aiTag).then(html => {\r\n          appBody.innerHTML = html;\r\n        });\r\n      }\r\n    });\r\n\r\n\r\n    badgeWrapper.appendChild(badge);\r\n  });\r\n}\r\n\r\n\r\n\r\nexport function applyThemeClasses(theme) {\r\n  const isDark = theme === 'Dark';\r\n  const isLight = theme === 'Light';\r\n\r\n  const safeApplyClass = (selector, darkClasses, lightClasses) => {\r\n    const elements = document.querySelectorAll(selector);\r\n    const darkClassList = darkClasses.split(' ');\r\n    const lightClassList = lightClasses.split(' ');\r\n\r\n    elements.forEach(elem => {\r\n      if (!elem) return;\r\n      // Remove all related theme classes\r\n      elem.classList.remove(...darkClassList);\r\n      elem.classList.remove(...lightClassList);\r\n      // Add only the relevant set\r\n      if (isDark) elem.classList.add(...darkClassList);\r\n      if (isLight) elem.classList.add(...lightClassList);\r\n    });\r\n  };\r\n\r\n  // Now use it for different elements\r\n  safeApplyClass('#app-body', 'bg-dark text-light', 'bg-white text-dark');\r\n  safeApplyClass('#search-box', 'bg-secondary text-light border-0', 'bg-white text-dark border');\r\n  safeApplyClass('.dropdown-menu', 'bg-dark text-light border-light', 'bg-white text-dark border');\r\n  safeApplyClass('.list-group-item', 'bg-dark text-light', 'bg-white text-dark');\r\n  safeApplyClass('.dropdown-toggle', 'bg-dark text-light border-0', 'bg-white text-dark border');\r\n  safeApplyClass('.dropdown-item', 'bg-dark text-light', 'bg-white text-dark');\r\n  // container for the suggestion list\r\n  safeApplyClass(\r\n    '.list-group-item-action',\r\n    'bg-dark text-light list-hover-dark',\r\n    'bg-light text-dark list-hover-light'\r\n  );\r\n\r\n  safeApplyClass('#close-ai-window', 'fa-solid fa-circle-xmark bg-dark text-light', 'fa-solid fa-circle-xmark bg-light text-dark');\r\n  safeApplyClass('#chatInput', 'bg-secondary text-light', 'bg-white text-dark');\r\n  safeApplyClass('.prompt-text', 'bg-secondary text-light', 'bg-white text-dark');\r\n\r\n\r\n}\r\n\r\nexport function swicthThemeIcon() {\r\n  const themeToggle = document.getElementById('theme-toggle');\r\n  const icon = themeToggle.querySelector('i');\r\n\r\n  if (theme === 'Dark') {\r\n    icon.classList.remove('fa-moon');\r\n    icon.classList.add('fa-sun');\r\n    sessionStorage.setItem('theme', 'Dark');\r\n  } else if (theme === 'Light') {\r\n    icon.classList.remove('fa-sun');\r\n    icon.classList.add('fa-moon');\r\n    sessionStorage.setItem('theme', 'Light');\r\n  }\r\n}\r\n\r\nasync function selectMatchingBookmarkFromSelection(displayName) {\r\n  return Word.run(async (context) => {\r\n    const selection = context.document.getSelection();\r\n    const bookmarks = selection.getBookmarks(); // ClientResult<string[]>\r\n    await context.sync();\r\n\r\n    const targetBookmarkName = bookmarks.value.find(bookmark => {\r\n      const cleanName = bookmark.split('_Split_')[0].replace(/_/g, ' ');\r\n      return cleanName.toLowerCase() === displayName.toLowerCase();\r\n    });\r\n\r\n    if (targetBookmarkName) {\r\n      const range = context.document.getBookmarkRangeOrNullObject(targetBookmarkName);\r\n      range.load('isNullObject');\r\n      await context.sync();\r\n\r\n      if (!range.isNullObject) {\r\n        range.select(); // Select the entire bookmark\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n","import { getPromptTemplateById, updateGroupKey, updateAiHistory, updatePromptTemplate } from \"../api\";\r\nimport { chatfooter, copyText, generateChatHistoryHtml, insertLineWithHeadingStyle, removeQuotes, renderSelectedTags, switchToAddTag, updateEditorFinalTable } from \"../functions\";\r\nimport { addGenAITags, aiTagList, applyAITagFn, availableKeys, createMultiSelectDropdown, customizeTable, fetchAIHistory, isPendingResponse, jwt, mentionDropdownFn, selectedNames, sendPrompt, sourceList, tableStyle, theme } from \"../taskpane\";\r\nimport { Confirmationpopup, DataModalPopup, toaster } from \"./bodyelements\";\r\n\r\nlet preview = '';\r\n\r\n\r\nexport function loadHomepage(availableKeys) {\r\n    const searchBoxClass = theme === 'Dark' ? 'bg-secondary text-light' : 'bg-white text-dark';\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-3\">\r\n        <div class=\"d-flex justify-content-end px-2\">\r\n            <div class=\"dropdown\">\r\n                <button class=\"btn btn-default dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                    Action\r\n                </button>\r\n                <ul class=\"dropdown-menu\">\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"add-btn-tag\">\r\n                            <i class=\"fa fa-plus me-2\" aria-hidden=\"true\"></i> Add\r\n                        </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"apply-btn-tag\">\r\n                            <i class=\"fa-solid fa-circle-check me-2\"></i> Apply\r\n                        </a>\r\n                    </li>\r\n                    <li>\r\n                        <a class=\"dropdown-item\" href=\"#\" id=\"customize-table\">\r\n                            <i class=\"fa fa-brush me-2\" aria-hidden=\"true\"></i> Customize Table\r\n                        </a>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"form-group px-2 pt-2\">\r\n            <input type=\"text\" id=\"search-box\" class=\"form-control ${searchBoxClass}\" placeholder=\"Search Tags...\" autocomplete=\"off\" />\r\n        </div>\r\n\r\n        <ul id=\"suggestion-list\" class=\"list-group mt-2 px-2\"></ul>\r\n        \r\n        <div id=\"tags-in-selected-text\" class=\"mt-2 px-2 selected-text-box d-none\">\r\n            <label class=\"form-label mb-2 fw-bold\">Tags in Selected Text</label>\r\n            <div class=\"tag-panel d-flex flex-wrap gap-2\" id=\"tag-badge-wrapper\"></div>\r\n        </div>\r\n    </div>`;\r\n\r\n    const searchBox = document.getElementById('search-box');\r\n    const suggestionList = document.getElementById('suggestion-list');\r\n\r\n    function updateSuggestions() {\r\n        const searchTerm = searchBox.value.trim().toLowerCase();\r\n        suggestionList.replaceChildren(); // Clear previous results\r\n        if (searchTerm === '') {\r\n            suggestionList.innerHTML = ''\r\n            return;\r\n        }\r\n\r\n        const filteredMentions = availableKeys.filter(mention =>\r\n            mention.DisplayName.toLowerCase().includes(searchTerm)\r\n        );\r\n\r\n        const nonAITags = filteredMentions.filter(m => m.AIFlag === 0);\r\n        const aiTags = filteredMentions.filter(m => m.AIFlag === 1);\r\n\r\n        const createSection = (labelText, mentions, isAISection = false) => {\r\n            if (mentions.length === 0) return;\r\n\r\n            // Define the theme classes based on the current theme\r\n            const themeClasses = theme === 'Dark'\r\n                ? { itemClass: 'bg-dark text-light list-hover-dark', labelClass: 'bg-dark text-light' }\r\n                : { itemClass: 'bg-light text-dark list-hover-light', labelClass: 'bg-light text-dark' };\r\n\r\n\r\n            // Create the section label\r\n            const label = document.createElement('li');\r\n            label.className = `list-group-item fw-bold text-secondary ${themeClasses.labelClass}`;\r\n            label.textContent = labelText;\r\n            suggestionList.appendChild(label);\r\n\r\n            // Loop through mentions and create the list items\r\n            mentions.forEach(mention => {\r\n                const listItem = document.createElement('li');\r\n                listItem.className = `list-group-item list-group-item-action ${themeClasses.itemClass}`; // Apply the theme classes\r\n\r\n                // Create the icon for AI or non-AI tags\r\n                const icon = isAISection\r\n                    ? `<i class=\"fa-solid fa-microchip-ai text-muted me-2\"></i>`\r\n                    : `<i class=\"fa-solid fa-layer-group text-muted me-2\"></i>`;\r\n\r\n                listItem.innerHTML = `${icon} ${mention.DisplayName}`;\r\n\r\n                listItem.onclick = () => {\r\n                    if (isAISection) {\r\n                        const appBody = document.getElementById('app-body');\r\n                        appBody.innerHTML = '<div class=\"text-muted p-2\">Loading...</div>';\r\n                        generateCheckboxHistory(mention).catch(error => {\r\n                            appBody.innerHTML = '<div class=\"text-danger p-2\">Error loading data</div>';\r\n                        }).then(html => {\r\n                            appBody.innerHTML = html;\r\n                        });\r\n                    } else {\r\n                        replaceMention(mention, mention.ComponentKeyDataType);\r\n                        suggestionList.replaceChildren();\r\n                    }\r\n                };\r\n\r\n                suggestionList.appendChild(listItem);\r\n            });\r\n        };\r\n\r\n        // Call the function for each section\r\n        createSection('Properties', nonAITags, false);\r\n        createSection('AI Tags', aiTags, true);\r\n\r\n    }\r\n    if (selectedNames.length > 0) {\r\n        const badgeWrapper = document.getElementById('tags-in-selected-text');\r\n        badgeWrapper.classList.remove('d-none');\r\n        badgeWrapper.classList.add('d-block');\r\n        renderSelectedTags(selectedNames, availableKeys);\r\n    }\r\n\r\n    // Add input event listener to the search box\r\n    let debounceTimeout;\r\n    searchBox.addEventListener('input', () => {\r\n        clearTimeout(debounceTimeout);\r\n        debounceTimeout = setTimeout(updateSuggestions, 300); // Delay input handling by 300ms\r\n    });\r\n\r\n    document.getElementById('add-btn-tag').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            addGenAITags();\r\n        }\r\n    });\r\n\r\n    document.getElementById('customize-table').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            customizeTable();\r\n        }\r\n    })\r\n\r\n    document.getElementById('apply-btn-tag').addEventListener('click', () => {\r\n        if (!isPendingResponse) {\r\n            applyAITagFn();\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) {\r\n                throw new Error('Selection is invalid or not found.');\r\n            }\r\n\r\n            let newSelection = selection;\r\n\r\n            if (type === 'TABLE') {\r\n                const parser = new DOMParser();\r\n                const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n                const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                await context.sync();\r\n\r\n                for (const node of bodyNodes) {\r\n                    if (node.nodeType === Node.TEXT_NODE) {\r\n                        const textContent = node.textContent?.trim();\r\n                        if (textContent) {\r\n                            textContent.split('\\n').forEach(line => {\r\n                                if (line.trim()) {\r\n                                    insertLineWithHeadingStyle(selection, line);\r\n                                }\r\n                            });\r\n                        }\r\n                    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        const element = node as HTMLElement;\r\n\r\n                        if (element.tagName.toLowerCase() === 'table') {\r\n                            const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                            if (rows.length === 0) {\r\n                                selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                                continue;\r\n                            }\r\n\r\n                            const maxCols = Math.max(...rows.map(row => {\r\n                                return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                                }, 0);\r\n                            }));\r\n\r\n                            const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                            await context.sync();\r\n\r\n                            const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                            table.style = tableStyle;  // Apply built-in Word table style\r\n\r\n                            await context.sync();\r\n\r\n                            const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                            rows.forEach((row, rowIndex) => {\r\n                                const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                let cellIndex = 0;\r\n\r\n                                cells.forEach((cell) => {\r\n                                    while (rowspanTracker[cellIndex] > 0) {\r\n                                        rowspanTracker[cellIndex]--;\r\n                                        cellIndex++;\r\n                                    }\r\n\r\n                                    const cellText = Array.from(cell.childNodes)\r\n                                        .map(node => {\r\n                                            if (node.nodeType === Node.TEXT_NODE) {\r\n                                                return node.textContent?.trim() || '';\r\n                                            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                return (node as HTMLElement).innerText.trim();\r\n                                            }\r\n                                            return '';\r\n                                        })\r\n                                        .filter(text => text.length > 0)\r\n                                        .join(' ');\r\n\r\n                                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                    for (let i = 1; i < colspan; i++) {\r\n                                        if (cellIndex + i < maxCols) {\r\n                                            table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                        }\r\n                                    }\r\n\r\n                                    if (rowspan > 1) {\r\n                                        for (let i = 0; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    cellIndex += colspan;\r\n                                });\r\n                            });\r\n\r\n                            newSelection = table.getCell(0, 0); // Set the cursor to the start of the table\r\n                        } else {\r\n                            const elementText = element.innerText.trim();\r\n                            if (elementText) {\r\n                                elementText.split('\\n').forEach(line => {\r\n                                    if (line.trim()) {\r\n                                        insertLineWithHeadingStyle(selection, line);\r\n                                    }\r\n                                });\r\n                            }\r\n                            newSelection = selection; // If it's not a table, just use the existing selection.\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                if (word.EditorValue === '' || word.IsApplied) {\r\n                    selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n                } else {\r\n                    let content = removeQuotes(word.EditorValue);\r\n                    let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n                    lines.forEach(line => {\r\n                        selection.insertParagraph(line, Word.InsertLocation.before);\r\n                    });\r\n                }\r\n                newSelection = selection; // After inserting the text, set selection to it.\r\n            }\r\n\r\n            // Move the cursor to the next line after content insertion\r\n            const nextLineParagraph = selection.insertParagraph(\"\", Word.InsertLocation.after);\r\n            await context.sync();\r\n\r\n            // Set the new cursor position after content\r\n            newSelection = nextLineParagraph;\r\n            selection.select(); // Select the new paragraph where the cursor will be\r\n            await context.sync();\r\n\r\n        } catch (error) {\r\n            console.error('Detailed error:', error);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport async function openAITag(tag) {\r\n    tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n    });\r\n\r\n\r\n}\r\n\r\nexport async function generateCheckboxHistory(tag) {\r\n    if (!tag.FilteredReportHeadAIHistoryList || tag.FilteredReportHeadAIHistoryList.length === 0) {\r\n        await fetchAIHistory(tag);\r\n    }\r\n\r\n    const history = tag.FilteredReportHeadAIHistoryList;\r\n\r\n    if (history.length === 0) {\r\n        return '<div>No AI history available.</div>';\r\n    }\r\n\r\n    // Check current theme\r\n    const isDark = theme === 'Dark';\r\n    const closeBtnClass = isDark\r\n        ? 'fa-solid fa-circle-xmark bg-dark text-light'\r\n        : 'fa-solid fa-circle-xmark bg-light text-dark';\r\n\r\n    const closeBar = `\r\n        <div class=\"d-flex justify-content-between align-items-center px-2 pt-3\">\r\n            <div class=\"d-flex align-items-center ms-3\">\r\n                <i class=\"fa fa-microchip-ai text-muted me-2\"></i>\r\n                <span class=\"fw-bold\">${tag.DisplayName}</span>\r\n            </div>\r\n            <div class=\"d-flex justify-content-center align-items-center me-3 c-pointer\" id=\"close-btn-tag\">\r\n                <i class=\"${closeBtnClass}\" id=\"close-ai-window\"></i>\r\n            </div>\r\n        </div>\r\n        <hr class=\"mt-2 mb-1 mx-3\">\r\n    `;\r\n\r\n    const chatBody = `\r\n        <div class=\"chat-body\">\r\n            ${generateChatHistoryHtml(history)}\r\n        </div>\r\n    `;\r\n\r\n    const chatFooterHtml = `\r\n        <div class=\"d-flex align-items-end justify-content-end chatbox p-2\" id=\"chatFooter\">\r\n            ${chatfooter(tag)}\r\n        </div>\r\n    `;\r\n\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n\r\n    return `${closeBar}${chatBody}${chatFooterHtml}`;\r\n}\r\n\r\n\r\n\r\n\r\nexport async function setupPromptBuilderUI(container, promptBuilderList) {\r\n\r\n    // Static template and field definitions\r\n    let preview = '';\r\n    let templateText = '';\r\n\r\n    // Field configs (can be extended)\r\n    let fieldsList = [];\r\n\r\n    // Create the form container\r\n    // Create the form container\r\n    container.innerHTML = `\r\n  <div class=\"form-group mb-3 p-3 pt-0\">\r\n    <label class='form-label'><span class=\"text-danger\">*</span> Prompt Builder Template</label>\r\n    <select id=\"promptBuilderTemplate\" class=\"form-control\">\r\n      <option value=\"\" disabled selected>Select a template</option>\r\n    </select>\r\n    <div id=\"templateError\" class=\"invalid-feedback d-none\">Type is required.</div>\r\n  </div>\r\n\r\n  <div id=\"fieldsContainer\"></div>\r\n\r\n  <div class=\"form-group mb-3 p-3 pt-0\" id=\"previewContainer\" style=\"display: none;\">\r\n    <label class=\"mb-2\">Preview</label>\r\n    <div id=\"preview\" class=\"form-control\"></div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-between px-3 align-items-center mt-3\">\r\n    <span id=\"resetBtn\" class=\"text-primary fw-bold\" style=\"cursor: pointer;\">Reset</span>\r\n    <button id=\"applyBtn\" class=\"btn btn-primary text-white\" disabled>Apply Prompt</button>\r\n  </div>\r\n`;\r\n\r\n    // Element references\r\n    const templateSelect = container.querySelector('#promptBuilderTemplate') as HTMLSelectElement;\r\n    const applyBtn = container.querySelector('#applyBtn') as HTMLButtonElement;\r\n    const resetBtn = container.querySelector('#resetBtn') as HTMLSpanElement;\r\n    const previewDiv = container.querySelector('#preview') as HTMLDivElement;\r\n    const fieldsContainer = container.querySelector('#fieldsContainer') as HTMLDivElement;\r\n    const previewContainer = container.querySelector('#previewContainer') as HTMLDivElement;\r\n    const templateError = container.querySelector('#templateError') as HTMLDivElement;\r\n\r\n    // Populate template dropdown\r\n    promptBuilderList.forEach((item) => {\r\n        const option = document.createElement('option');\r\n        option.value = item.ID.toString();\r\n        option.textContent = item.Name;\r\n        templateSelect.appendChild(option);\r\n    });\r\n\r\n    templateSelect.addEventListener('change', async () => {\r\n        const templateId = templateSelect.value;\r\n        const jwt = sessionStorage.getItem('token') || '';\r\n\r\n        const data = await getPromptTemplateById(templateId, jwt);\r\n        if (data.Status && data.Data) {\r\n            fieldsList = data.Data;\r\n            preview = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n\r\n            templateText = promptBuilderList.find((item) => item.ID.toString() === templateId).Template;\r\n        }\r\n        if (!templateId) {\r\n            templateError.classList.remove('d-none');\r\n            return;\r\n        }\r\n\r\n        templateError.classList.add('d-none');\r\n\r\n        renderFields();\r\n        updatePreview();\r\n    });\r\n\r\n    function renderFields() {\r\n        fieldsContainer.innerHTML = '';\r\n\r\n        fieldsList.forEach((field) => {\r\n            const div = document.createElement('div');\r\n            div.className = 'form-group mb-3 p-3 pt-0';\r\n\r\n            const label = document.createElement('label');\r\n            label.textContent = field.Label;\r\n            div.appendChild(label);\r\n\r\n            if (field.Type === 1) {\r\n                const input = document.createElement('input');\r\n                input.type = 'text';\r\n                input.className = 'form-control';\r\n                input.id = field.Label;\r\n                input.addEventListener('input', replaceKeywordsManually);\r\n                div.appendChild(input);\r\n            } else if (field.Type === 2) {\r\n                const select = document.createElement('select');\r\n                select.className = 'form-control';\r\n                select.id = field.Label;\r\n                field.PromptTemplateOptionList.forEach((opt: any) => {\r\n                    const option = document.createElement('option');\r\n                    option.value = opt.Text;\r\n                    option.textContent = opt.Option;\r\n                    select.appendChild(option);\r\n                });\r\n                select.addEventListener('change', replaceKeywordsManually);\r\n                div.appendChild(select);\r\n            }\r\n\r\n            fieldsContainer.appendChild(div);\r\n        });\r\n    }\r\n\r\n    function replaceKeywordsManually() {\r\n        const keywordMap: { [key: string]: string } = {};\r\n\r\n        fieldsList.forEach((field) => {\r\n            const id = field.Label;\r\n            const keyword = `#${id}#`;\r\n\r\n            let value = '';\r\n            const element = document.getElementById(id) as HTMLInputElement | HTMLSelectElement;\r\n\r\n            if (element) {\r\n                value = (element instanceof HTMLInputElement || element instanceof HTMLSelectElement)\r\n                    ? element.value\r\n                    : '';\r\n            }\r\n\r\n            keywordMap[keyword] = value ? value : keyword;\r\n        });\r\n\r\n        let insertValue = templateText;\r\n        for (const [keyword, value] of Object.entries(keywordMap)) {\r\n            insertValue = insertValue.replace(new RegExp(keyword, 'g'), value);\r\n        }\r\n\r\n        preview = insertValue;\r\n        previewDiv.textContent = preview;\r\n        previewContainer.style.display = preview ? 'block' : 'none';\r\n        applyBtn.disabled = preview === '';\r\n    }\r\n\r\n    function updatePreview() {\r\n        replaceKeywordsManually();\r\n    }\r\n\r\n    function resetForm() {\r\n        // Reset only the dynamic field values\r\n        fieldsList.forEach((field) => {\r\n            const element = document.getElementById(field.Label) as HTMLInputElement | HTMLSelectElement;\r\n            if (element) {\r\n                if (element instanceof HTMLInputElement) {\r\n                    element.value = '';\r\n                } else if (element instanceof HTMLSelectElement) {\r\n                    element.selectedIndex = 0; // optional: reset to first option\r\n                }\r\n            }\r\n        });\r\n\r\n        // Clear preview\r\n        previewDiv.textContent = templateText;\r\n        preview = templateText;\r\n    }\r\n\r\n\r\n    function applyPrompt() {\r\n        if (!preview) return;\r\n\r\n        const promptTextarea = document.getElementById('prompt') as HTMLTextAreaElement;\r\n        if (promptTextarea) {\r\n            promptTextarea.value = preview;\r\n            switchToAddTag()\r\n        }\r\n\r\n    }\r\n\r\n    resetBtn.addEventListener('click', resetForm);\r\n    applyBtn.addEventListener('click', applyPrompt);\r\n}\r\n\r\n\r\nasync function insertTagPrompt(tag: any) {\r\n    return Word.run(async (context) => {\r\n        try {\r\n            const selection = context.document.getSelection();\r\n            await context.sync();\r\n\r\n            if (!selection) {\r\n                throw new Error('Selection is invalid or not found.');\r\n            }\r\n\r\n\r\n            const cleanDisplayName = tag.ID;\r\n            const uniqueStr = new Date().getTime();\r\n            const bookmarkName = `ID${cleanDisplayName}_Split_${uniqueStr}`;\r\n\r\n            const startMarker = selection.insertParagraph(\"[[BOOKMARK_START]]\", Word.InsertLocation.before);\r\n            await context.sync();\r\n\r\n            if (tag.EditorValue === '') {\r\n                selection.insertParagraph(`#${tag.DisplayName}#`, Word.InsertLocation.before);\r\n            } else {\r\n                if (tag.ComponentKeyDataType === 'TABLE') {\r\n                    const parser = new DOMParser();\r\n                    const doc = parser.parseFromString(tag.EditorValue, 'text/html');\r\n                    const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n                    for (const node of bodyNodes) {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                            const textContent = node.textContent?.trim();\r\n                            if (textContent) {\r\n                                textContent.split('\\n').forEach(line => {\r\n                                    if (line.trim()) {\r\n                                        insertLineWithHeadingStyle(selection, line);\r\n                                    }\r\n                                });\r\n                            }\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                            const element = node as HTMLElement;\r\n\r\n                            if (element.tagName.toLowerCase() === 'table') {\r\n                                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                                if (rows.length === 0) {\r\n                                    selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                                    continue;\r\n                                }\r\n\r\n                                const maxCols = Math.max(...rows.map(row => {\r\n                                    return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                                        return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                                    }, 0);\r\n                                }));\r\n\r\n                                const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                                await context.sync();\r\n\r\n                                const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                                table.style = tableStyle;\r\n                                await context.sync();\r\n\r\n                                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                                rows.forEach((row, rowIndex) => {\r\n                                    const cells = Array.from(row.querySelectorAll('td, th'));\r\n                                    let cellIndex = 0;\r\n\r\n                                    cells.forEach((cell) => {\r\n                                        while (rowspanTracker[cellIndex] > 0) {\r\n                                            rowspanTracker[cellIndex]--;\r\n                                            cellIndex++;\r\n                                        }\r\n\r\n                                        const cellText = Array.from(cell.childNodes)\r\n                                            .map(node => {\r\n                                                if (node.nodeType === Node.TEXT_NODE) {\r\n                                                    return node.textContent?.trim() || '';\r\n                                                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                                                    return (node as HTMLElement).innerText.trim();\r\n                                                }\r\n                                                return '';\r\n                                            })\r\n                                            .filter(text => text.length > 0)\r\n                                            .join(' ');\r\n\r\n                                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                                        for (let i = 1; i < colspan; i++) {\r\n                                            if (cellIndex + i < maxCols) {\r\n                                                table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                                            }\r\n                                        }\r\n\r\n                                        if (rowspan > 1) {\r\n                                            for (let i = 0; i < colspan; i++) {\r\n                                                if (cellIndex + i < maxCols) {\r\n                                                    rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                                                }\r\n                                            }\r\n                                        }\r\n\r\n                                        cellIndex += colspan;\r\n                                    });\r\n                                });\r\n                            } else {\r\n                                const elementText = element.innerText.trim();\r\n                                if (elementText) {\r\n                                    elementText.split('\\n').forEach(line => {\r\n                                        if (line.trim()) {\r\n                                            insertLineWithHeadingStyle(selection, line);\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    let content = removeQuotes(tag.EditorValue);\r\n                    let lines = content.split(/\\r?\\n/);\r\n                    lines.forEach(line => {\r\n                        insertLineWithHeadingStyle(selection, line)\r\n                        // selection.insertParagraph(line, Word.InsertLocation.before);\r\n                    });\r\n                }\r\n            }\r\n\r\n            const endMarker = selection.insertParagraph(\"[[BOOKMARK_END]]\", Word.InsertLocation.after);\r\n            await context.sync();\r\n\r\n            const markers = context.document.body.paragraphs;\r\n            context.load(markers, 'text');\r\n            await context.sync();\r\n\r\n            const start = markers.items.find(p => p.text === '[[BOOKMARK_START]]');\r\n            const end = markers.items.find(p => p.text === '[[BOOKMARK_END]]');\r\n\r\n            if (start && end) {\r\n                const bookmarkRange = start.getRange('Start').expandTo(end.getRange('End'));\r\n                bookmarkRange.insertBookmark(bookmarkName);\r\n                console.log(`Bookmark added: ${bookmarkName}`);\r\n                const afterBookmark = end.insertParagraph(\"\", Word.InsertLocation.after);\r\n\r\n                afterBookmark.select();\r\n                start.delete()\r\n                end.delete();\r\n                afterBookmark.delete();\r\n                await context.sync();\r\n\r\n            }\r\n            toaster('Inserted successfully', 'success');\r\n\r\n        } catch (error) {\r\n            toaster('Something went wrong', 'error');\r\n\r\n            console.error('Detailed error:', error);\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\nexport function initializeAIHistoryEvents(tag: any, jwt: string, availableKeys: any) {\r\n    setTimeout(() => {\r\n        tag.FilteredReportHeadAIHistoryList.forEach((chat: any, index: number) => {\r\n            // Copy buttons\r\n            if (tag.textareavalue) {\r\n                (document.getElementById(`chatInput`) as HTMLTextAreaElement).value = tag.textareavalue;\r\n                delete (tag.textareavalue)\r\n            }\r\n\r\n\r\n            // After initializing buttons inside setTimeout\r\n            const chatInput = document.getElementById(\"chatInput\") as HTMLTextAreaElement;\r\n            const changeSourceButton = document.getElementById(\"changeSourceButton\") as HTMLButtonElement;\r\n\r\n            if (chatInput && changeSourceButton) {\r\n                // Run once on load\r\n                changeSourceButton.disabled = chatInput.value.trim().length === 0;\r\n\r\n                // Listen for changes in textarea\r\n                chatInput.addEventListener(\"input\", () => {\r\n                    if (chatInput.value.trim().length > 0) {\r\n                        changeSourceButton.disabled = false;\r\n                    } else {\r\n                        changeSourceButton.disabled = true;\r\n                    }\r\n                });\r\n            };\r\n            document.getElementById(`copyPrompt-${index}`)?.addEventListener('click', () => copyText(chat.Prompt));\r\n            const savePromptele = document.getElementById(`savePrompt-${index}`);\r\n            if (savePromptele) {\r\n                document.getElementById(`savePrompt-${index}`)?.addEventListener('click', () => {\r\n                    const container = document.getElementById('confirmation-popup');\r\n                    if (container) {\r\n                        container.innerHTML = Confirmationpopup('Do you want to save the current prompt as a global default?');\r\n\r\n                        // Wait for DOM to update and then attach cancel button listener\r\n                        setTimeout(() => {\r\n                            document.getElementById('confirmation-popup-cancel')?.addEventListener('click', () => {\r\n                                container.innerHTML = '';\r\n                            });\r\n\r\n                            document.getElementById('confirmation-popup-confirm')?.addEventListener('click', async () => {\r\n                                try {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'true');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'true');\r\n                                    let updatedTag = JSON.parse(JSON.stringify(tag));\r\n                                    updatedTag.Prompt = chat.Prompt;\r\n                                    const data = await updatePromptTemplate(updatedTag, jwt);\r\n                                    if (data['Status']) {\r\n                                        toaster('Updated Succesfully', 'success');\r\n                                        container.innerHTML = '';\r\n                                    } else {\r\n                                        document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                        document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                        toaster('Something went wrong', 'error');\r\n\r\n\r\n                                    }\r\n                                } catch (error) {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                    toaster('Something went wrong', 'error');\r\n                                }\r\n                            });\r\n                        }, 0);\r\n                    }\r\n                });\r\n            }\r\n\r\n            const openRefferance = document.getElementById(`openRefferance-${index}`);\r\n            if (openRefferance) {\r\n                document.getElementById(`openRefferance-${index}`)?.addEventListener('click', () => {\r\n                    const container = document.getElementById('confirmation-popup');\r\n                    if (container) {\r\n                        const chatSources = chat.SourceValue.map((item: any) => {\r\n                            return sourceList.find(\r\n                                (source: any) => Number(item) === source.VectorID\r\n                            );\r\n                        });\r\n\r\n                        const sources = chatSources.filter((src: any) => !!src);\r\n                        const popupData = {\r\n                            Data: chat.Evidences,\r\n                            Name: tag.DisplayName,\r\n                            UserValue: chat.Response,\r\n                            Sources: sources\r\n                        }\r\n\r\n                        container.innerHTML = DataModalPopup(popupData);\r\n\r\n                        // Wait for DOM to update and then attach cancel button listener\r\n                        setTimeout(() => {\r\n                            document.getElementById('confirmation-popup-cancel')?.addEventListener('click', () => {\r\n                                container.innerHTML = '';\r\n                            });\r\n\r\n                            document.getElementById('confirmation-popup-confirm')?.addEventListener('click', async () => {\r\n                                try {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'true');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'true');\r\n                                    let updatedTag = JSON.parse(JSON.stringify(tag));\r\n                                    updatedTag.Prompt = chat.Prompt;\r\n                                    const data = await updatePromptTemplate(updatedTag, jwt);\r\n                                    if (data['Status']) {\r\n                                        toaster('Updated Succesfully', 'success');\r\n                                        container.innerHTML = '';\r\n                                    } else {\r\n                                        document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                        document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                        toaster('Something went wrong', 'error');\r\n\r\n\r\n                                    }\r\n                                } catch (error) {\r\n                                    document.getElementById('confirmation-popup-cancel')?.setAttribute('disabled', 'false');\r\n                                    document.getElementById('confirmation-popup-confirm')?.setAttribute('disabled', 'false');\r\n                                    toaster('Something went wrong', 'error');\r\n                                }\r\n                            });\r\n\r\n                            document.getElementById('datamodel-popup-ok')?.addEventListener('click', async () => {\r\n                                container.innerHTML = ''\r\n                            })\r\n                        }, 0);\r\n                    }\r\n                });\r\n            }\r\n\r\n\r\n            document.getElementById(`copyResponse-${index}`)?.addEventListener('click', () => copyText(chat.Response));\r\n\r\n            // Close button\r\n            document.getElementById(`close-btn-tag`)?.addEventListener('click', () => loadHomepage(availableKeys));\r\n\r\n            // Checkbox logic\r\n            const checkbox = document.getElementById(`checkbox-${index}`) as HTMLInputElement;\r\n            if (checkbox) {\r\n                checkbox.addEventListener('change', async (event: Event) => {\r\n                    const isChecked = (event.target as HTMLInputElement).checked;\r\n\r\n                    // Reset all\r\n                    tag.FilteredReportHeadAIHistoryList.forEach((_: any, otherIndex: number) => {\r\n                        const otherCheckbox = document.getElementById(`checkbox-${otherIndex}`) as HTMLInputElement;\r\n                        const responseContainer = document.getElementById(`responseContainer-${otherIndex}`);\r\n                        if (otherCheckbox) otherCheckbox.checked = false;\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.remove('ai-selected-response');\r\n                            responseContainer.classList.add('bg-light');\r\n                        }\r\n                        tag.FilteredReportHeadAIHistoryList[otherIndex].Selected = 0;\r\n                    });\r\n\r\n                    // Set selected\r\n                    if (isChecked) {\r\n                        checkbox.checked = true;\r\n                        const responseContainer = document.getElementById(`responseContainer-${index}`);\r\n                        if (responseContainer) {\r\n                            responseContainer.classList.add('ai-selected-response');\r\n                            responseContainer.classList.remove('bg-light');\r\n                        }\r\n                        chat.Selected = 1;\r\n                    } else {\r\n                        chat.Selected = 0;\r\n                    }\r\n\r\n                    try {\r\n                        const data = await updateAiHistory(chat, jwt);\r\n                        if (data['Data']) {\r\n                            tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n                            tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n                            tag.ReportHeadAIHistoryList.forEach((historyList: any) => {\r\n                                historyList.Response = removeQuotes(historyList.Response);\r\n                                tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n                            });\r\n\r\n                            const finalResponse = chat.FormattedResponse\r\n                                ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                : chat.Response;\r\n\r\n                            tag.ComponentKeyDataType = chat.FormattedResponse ? 'TABLE' : 'TEXT';\r\n                            tag.UserValue = finalResponse;\r\n                            tag.EditorValue = finalResponse;\r\n                            tag.text = finalResponse;\r\n\r\n                            const currentlySelected = tag.FilteredReportHeadAIHistoryList.some((item: any) => item.Selected === 1);\r\n                            tag.IsApplied = !currentlySelected;\r\n                            availableKeys.forEach(currentTag => {\r\n                                if (currentTag.ID === tag.ID) {\r\n                                    const isTable = chat.FormattedResponse !== '';\r\n                                    const finalResponse = chat.FormattedResponse\r\n                                        ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                        : chat.Response;\r\n                                    currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n                                    currentTag.UserValue = finalResponse;\r\n                                    currentTag.EditorValue = finalResponse;\r\n                                    currentTag.text = finalResponse;\r\n                                    currentTag.IsApplied = tag.IsApplied;\r\n                                }\r\n                            })\r\n\r\n                            aiTagList.forEach(currentTag => {\r\n                                if (currentTag.ID === tag.ID) {\r\n                                    const isTable = chat.FormattedResponse !== '';\r\n                                    const finalResponse = chat.FormattedResponse\r\n                                        ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n                                        : chat.Response;\r\n\r\n\r\n                                    currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n                                    currentTag.UserValue = finalResponse;\r\n                                    currentTag.EditorValue = finalResponse;\r\n                                    currentTag.text = finalResponse;\r\n                                    currentTag.IsApplied = tag.IsApplied;\r\n                                }\r\n                            });\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('Failed to update AI history:', err);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        // Button: Insert Tag\r\n        document.getElementById(`insertTagButton`)?.addEventListener('click', () => {\r\n            if (!tag.IsApplied) {\r\n                insertTagPrompt(tag);\r\n            }\r\n        });\r\n\r\n        // Button: Send Prompt\r\n        document.getElementById(`sendPromptButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            sendPrompt(tag, textareaValue);\r\n        });\r\n\r\n        // Button: Change Source\r\n        document.getElementById(`changeSourceButton`)?.addEventListener('click', () => {\r\n            const textareaValue = (document.getElementById(`chatInput`) as HTMLTextAreaElement).value;\r\n            tag.textareavalue = textareaValue;\r\n            createMultiSelectDropdown(tag);\r\n        });\r\n\r\n        // Mention dropdown\r\n        mentionDropdownFn(`chatInput`, `mention-dropdown`, 'edit');\r\n    }, 0);\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\nimport { dataUrl, storeUrl, versionLink } from \"./data\";\r\nimport { generateCheckboxHistory, initializeAIHistoryEvents, loadHomepage, setupPromptBuilderUI } from \"./components/home\";\r\nimport { applyThemeClasses, chatfooter, renderSelectedTags, swicthThemeIcon, switchToAddTag, switchToPromptBuilder, updateEditorFinalTable } from \"./functions\";\r\nimport { addtagbody, customizeTablePopup, logoheader, navTabs, toaster } from \"./components/bodyelements\";\r\nimport { addAiHistory, addGroupKey, fetchGlossaryTemplate, getAiHistory, getAllClients, getAllPromptTemplates, getReportById, loginUser, updateGroupKey } from \"./api\";\r\nimport { wordTableStyles } from \"./components/tablestyles\";\r\nexport let jwt = '';\r\nexport let UserRole: any = {};\r\nlet storedUrl = storeUrl\r\nlet documentID = ''\r\nlet organizationName = ''\r\nexport let aiTagList = [];\r\nlet initialised = true;\r\nexport let availableKeys = [];\r\nlet promptBuilderList = [];\r\nlet glossaryName = ''\r\nlet isGlossaryActive: boolean = false;\r\nlet GroupName: string = '';\r\nlet layTerms = [];\r\nlet dataList: any = []\r\nlet isTagUpdating: boolean = false;\r\nlet capturedFormatting: any = {};\r\nlet emptyFormat: boolean = false;\r\nlet isNoFormatTextAvailable: boolean = false;\r\nlet clientId = '0';\r\nlet userId = 0;\r\nlet clientList = [];\r\nlet version = versionLink;\r\nlet currentYear = new Date().getFullYear();\r\nexport let sourceList;\r\nlet filteredGlossaryTerm;\r\nexport let selectedNames = [];\r\nexport let isPendingResponse = false;\r\nexport let theme = 'Light';\r\nexport let tableStyle = 'Grid Table 4 - Accent 1';\r\n\r\n\r\n/* global document, Office, Word */\r\n\r\nwindow.addEventListener('hashchange', () => {\r\n  const hash = window.location.hash;\r\n  if (hash === '#/dashboard' && initialised) {\r\n    initialised = false;\r\n    displayMenu();\r\n\r\n  }\r\n});\r\n\r\n\r\nOffice.onReady((info) => {\r\n  if (info.host === Office.HostType.Word) {\r\n    document.getElementById(\"app-body\").style.display = \"flex\";\r\n    document.getElementById(\"footer\").innerText = `© ${currentYear} - TrialAssure LINK AI Assistant ${version}`\r\n    const editor = document.getElementById('editor');\r\n\r\n    window.location.hash = '#/login';\r\n    retrieveDocumentProperties()\r\n\r\n    Office.context.document.addHandlerAsync(\r\n      Office.EventType.DocumentSelectionChanged,\r\n      () => {\r\n        logBookmarksInSelection();\r\n      }\r\n    );\r\n  }\r\n});\r\n\r\n\r\n// Example usage:\r\n\r\n\r\n\r\nasync function retrieveDocumentProperties() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const properties = context.document.properties.customProperties;\r\n      properties.load(\"items\");\r\n\r\n      await context.sync();\r\n      const property = properties.items.find(prop => prop.key === 'DocumentID');\r\n      const orgName = properties.items.find(prop => prop.key === 'Organization');\r\n      if (property && orgName) {\r\n        documentID = property.value;\r\n        organizationName = orgName.value;\r\n        login()\r\n      } else {\r\n        document.getElementById('app-body').innerHTML = `\r\n        <p class=\"px-3 text-center\">Export a document from the LINK AI application to use this functionality.</p>`\r\n        console.log(`Custom property \"documentID\" not found.`);\r\n        return null;\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error retrieving custom property:\", error);\r\n  }\r\n\r\n}\r\n\r\nasync function login() {\r\n  // document.getElementById('header').innerHTML = ``\r\n  const sessionToken = sessionStorage.getItem('token');\r\n  if (sessionToken) {\r\n    UserRole = JSON.parse(sessionStorage.getItem('userRole')) || ''\r\n    jwt = sessionToken;\r\n    window.location.hash = '#/dashboard';\r\n  } else {\r\n    loadLoginPage();\r\n  }\r\n}\r\n\r\nfunction loadLoginPage() {\r\n\r\n  document.getElementById('logo-header').innerHTML = `\r\n  <img id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\">\r\n  <div class=\"icon-nav me-3\">\r\n    <span id=\"theme-toggle\"><i class=\"fa fa-moon c-pointer me-3\"  title=\"Toggle Theme\"></i><span>\r\n  </div>\r\n`;\r\n\r\n  document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container pt-2\">\r\n      <form id=\"login-form\" class=\"p-4 border rounded\">\r\n        <div class=\"mb-3\">\r\n          <label for=\"organization\" class=\"form-label fw-bold\">Organization</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"organization\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"username\" class=\"form-label fw-bold\">Username</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"username\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"password\" class=\"form-label fw-bold\">Password</label>\r\n          <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n        </div>\r\n        <div class=\"d-grid\">\r\n          <button type=\"submit\" class=\"btn btn-primary bg-primary-clr\">Login</button>\r\n        </div>\r\n      <div id=\"login-error\" class=\"mt-3 text-danger\" style=\"display: none;\"></div>\r\n\r\n      </form>\r\n    </div>\r\n  `;\r\n  document.getElementById('theme-toggle').addEventListener('click', () => {\r\n    theme = theme === 'Light' ? 'Dark' : 'Light';\r\n    applyThemeClasses(theme)\r\n\r\n    document.body.classList.toggle('dark-theme', theme === 'Dark');\r\n    document.body.classList.toggle('light-theme', theme === 'Light');\r\n    swicthThemeIcon()\r\n  }\r\n  );\r\n  document.getElementById('login-form').addEventListener('submit', handleLogin);\r\n}\r\n\r\nasync function handleLogin(event) {\r\n  event.preventDefault();\r\n\r\n  // Get the values from the form fields\r\n  const organization = (document.getElementById('organization') as HTMLInputElement).value;\r\n  const username = (document.getElementById('username') as HTMLInputElement).value;\r\n  const password = (document.getElementById('password') as HTMLInputElement).value;\r\n  if (organization.toLowerCase().trim() === organizationName.toLocaleLowerCase().trim()) {\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n          </div\r\n`\r\n    try {\r\n      const data = await loginUser(organization, username, password);\r\n      if (data.Status === true && data['Data']) {\r\n        if (data['Data'].ResponseStatus) {\r\n          jwt = data.Data.Token;\r\n          UserRole = data.Data.UserRole;\r\n          sessionStorage.setItem('userRole', JSON.stringify(data.Data.UserRole));\r\n          sessionStorage.setItem('token', jwt)\r\n          sessionStorage.setItem('userId', data.Data.ID);\r\n          toaster('You are successfully logged in', 'success');\r\n          window.location.hash = '#/dashboard';\r\n        } else {\r\n          showLoginError(\"An error occurred during login. Please try again.\")\r\n        }\r\n      } else {\r\n        showLoginError(\"An error occurred during login. Please try again.\")\r\n      }\r\n    } catch (error) {\r\n      showLoginError(\"An error occurred during login. Please try again.\")\r\n      console.error('Error during login:', error);\r\n      // Handle login error (e.g., show an error message)\r\n    }\r\n  } else {\r\n    showLoginError(\"The organization specified is not associated with this document\")\r\n  }\r\n}\r\n\r\nfunction showLoginError(message) {\r\n  loadLoginPage();  // Reload the form UI\r\n  const errorDiv = document.getElementById('login-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction displayMenu() {\r\n  userId = Number(sessionStorage.getItem('userId'))\r\n  // document.getElementById('aitag').addEventListener('click', redirectAI);\r\n  fetchDocument('Init');\r\n\r\n}\r\n\r\nasync function fetchDocument(action) {\r\n  try {\r\n\r\n    const data = await getReportById(documentID, jwt);\r\n    document.getElementById('app-body').innerHTML = ``\r\n    document.getElementById('logo-header').innerHTML = logoheader(storedUrl);\r\n\r\n    dataList = data['Data'];\r\n    sourceList = dataList?.SourceTypeList?.filter(\r\n      (item) => item.SourceValue !== ''\r\n        && item.AIFlag === 1\r\n    ) // Filter items with an extension\r\n      .map((item) => ({\r\n        ...item, // Spread the existing properties\r\n        SourceName: decodeURIComponent(transformDocumentName(item.SourceValue))\r\n      }));\r\n    clientId = dataList.ClientID;\r\n    const aiGroup = data['Data'].Group.find(element => element.DisplayName === 'AIGroup');\r\n    GroupName = aiGroup ? aiGroup.Name : '';\r\n    aiTagList = aiGroup ? aiGroup.GroupKey : [];\r\n\r\n    availableKeys = data['Data'].GroupKeyAll.filter(element => element.ComponentKeyDataType === 'TABLE' || element.ComponentKeyDataType === 'TEXT');\r\n    availableKeys.forEach((key) => {\r\n      if (key.AIFlag === 1) {\r\n        const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n        let match;\r\n        if ((match = regex.exec(key.EditorValue) !== null)) {\r\n          {\r\n            key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n            key.UserValue = key.EditorValue;\r\n            key.InitialTable = true;\r\n            key.ComponentKeyDataType = 'TABLE';\r\n          }\r\n\r\n        }\r\n      }\r\n    });\r\n\r\n    aiTagList.forEach((key, i) => {\r\n      const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n      let match;\r\n      if ((match = regex.exec(key.EditorValue) !== null)) {\r\n        {\r\n          key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n          key.UserValue = key.EditorValue;\r\n          key.InitialTable = true;\r\n          key.ComponentKeyDataType = 'TABLE';\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    );\r\n    fetchClients();\r\n    loadPromptTemplates();\r\n    loadHomepage(availableKeys);\r\n    document.getElementById('home').addEventListener('click', async () => {\r\n      if (!isPendingResponse) {\r\n        if (isGlossaryActive) {\r\n          await removeMatchingContentControls();\r\n        }\r\n\r\n        loadHomepage(availableKeys);\r\n      }\r\n    });\r\n\r\n    document.getElementById('glossary').addEventListener('click', () => {\r\n      if (emptyFormat) {\r\n        fetchGlossary();\r\n      }\r\n    });\r\n\r\n    document.getElementById('define-formatting').addEventListener('click', () => {\r\n      if (!isPendingResponse) {\r\n        formatOptionsDisplay()\r\n      }\r\n    }\r\n    );\r\n\r\n\r\n    document.getElementById('removeFormatting').addEventListener('click', () => {\r\n      if (Object.keys(capturedFormatting).length > 0) {\r\n        removeOptionsConfirmation();\r\n      }\r\n    });\r\n\r\n\r\n    document.getElementById('theme-toggle').addEventListener('click', () => {\r\n      theme = theme === 'Light' ? 'Dark' : 'Light';\r\n      applyThemeClasses(theme)\r\n\r\n      document.body.classList.toggle('dark-theme', theme === 'Dark');\r\n      document.body.classList.toggle('light-theme', theme === 'Light');\r\n      swicthThemeIcon()\r\n    }\r\n    );\r\n\r\n    document.getElementById('logout').addEventListener('click', async () => {\r\n      if (!isPendingResponse) {\r\n        if (isGlossaryActive) {\r\n          await removeMatchingContentControls();\r\n        }\r\n\r\n        logout()\r\n      }\r\n    }\r\n    );\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching glossary data:', error);\r\n  }\r\n}\r\n\r\nasync function fetchClients() {\r\n  try {\r\n    const userId = sessionStorage.getItem('userId') || '';\r\n\r\n\r\n    const data = await getAllClients(userId, jwt);\r\n\r\n    if (data.Status && data.Data) {\r\n      clientList = data['Data'];\r\n    } else {\r\n      console.warn(\"Failed to load clients or no clients found.\");\r\n    }\r\n  } catch (error) {\r\n  }\r\n}\r\n\r\n\r\n\r\nexport async function formatOptionsDisplay() {\r\n  if (!isTagUpdating) { // Check if isTagUpdating is false\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n    const htmlBody = `\r\n      <div class=\"container pt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n               <!-- Buttons for Capture and Empty Format -->\r\n            <div class=\"d-flex justify-content-end\">\r\n              <button id=\"capture-format-btn\" class=\"btn btn-primary bg-primary-clr\"><i class=\"fa fa-border-style me-1\"></i>  Capture Format</button>\r\n            </div>\r\n            <!-- <h5 class=\"card-title\">Formatting Options</h5> -->\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div class=\"formating-checkbox\">\r\n               <input type=\"checkbox\" id=\"empty-format-checkbox\" class=\"form-check-input\">\r\n              <label for=\"empty-format-checkbox\" class=\"form-check-label empty-format-checkbox-label\" style=\"flex: 1;\">\r\n                   Skip ignoring and removing format-based text\r\n              </label>\r\n            </div>\r\n\r\n            <!-- Section to display captured formatting -->\r\n            <div id=\"format-details\">\r\n              <h5 class=\"my-3\">Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled\"></ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    if (Object.keys(capturedFormatting).length === 0) {\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // The object is not empty\r\n    }\r\n\r\n    const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n    if (!glossaryBtn.classList.contains('disabled-link')) {\r\n      glossaryBtn.classList.add('disabled-link');\r\n    }\r\n\r\n    if (emptyFormat) {\r\n      clearCapturedFormatting();\r\n    }\r\n    else {\r\n      if (capturedFormatting.Bold === null || capturedFormatting.Bold === undefined ||\r\n        capturedFormatting.Underline === 'Mixed' || capturedFormatting.Underline === undefined ||\r\n        capturedFormatting.Size === null || capturedFormatting.Size === undefined ||\r\n        capturedFormatting[\"Font Name\"] === null || capturedFormatting[\"Font Name\"] === undefined ||\r\n        capturedFormatting[\"Background Color\"] === '' || capturedFormatting[\"Background Color\"] === undefined ||\r\n        capturedFormatting[\"Text Color\"] === '' || capturedFormatting[\"Text Color\"] === undefined) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n\r\n\r\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n          removeFormatBtn.classList.add('disabled-link');\r\n        }\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.classList.remove('disabled-link');\r\n        displayCapturedFormatting();\r\n      }\r\n    }\r\n    // Event listeners for the buttons\r\n\r\n    document.getElementById(\"capture-format-btn\").addEventListener(\"click\", captureFormatting);\r\n\r\n    const emptyFormatCheckbox = document.getElementById(\"empty-format-checkbox\") as HTMLInputElement;\r\n    if (isNoFormatTextAvailable) {\r\n      emptyFormatCheckbox.checked = true;\r\n      clearCapturedFormatting();\r\n    }\r\n\r\n    emptyFormatCheckbox.addEventListener(\"change\", () => {\r\n      if (emptyFormatCheckbox.checked) {\r\n        isNoFormatTextAvailable = true;\r\n        clearCapturedFormatting();\r\n      } else {\r\n        const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n        CaptureBtn.disabled = false;\r\n        isNoFormatTextAvailable = false;\r\n        emptyFormat = false;\r\n        const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n        if (!glossaryBtn.classList.contains('disabled-link')) {\r\n          glossaryBtn.classList.add('disabled-link');\r\n        }\r\n      }\r\n    });\r\n\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayCapturedFormatting() {\r\n  emptyFormat = false;\r\n  const formatList = document.getElementById(\"format-list\");\r\n  formatList.innerHTML = \"\"; // Clear the list before adding new items\r\n\r\n  for (const [key, value] of Object.entries(capturedFormatting)) {\r\n    if ((key === \"Text Color\" || key === \"Background Color\") && value) {\r\n      formatList.innerHTML += `\r\n        <li><strong>${key}:</strong>${value}\r\n          <span style=\"display:inline-block;width:15px;height:15px;background-color:${value};border:1px solid black;\"></span>\r\n        </li>\r\n      `;\r\n    } else {\r\n      formatList.innerHTML += `<li><strong>${key}:</strong> ${value}</li>`;\r\n    }\r\n  }\r\n}\r\n\r\nfunction clearCapturedFormatting() {\r\n  capturedFormatting = {}; // Clear the captured formatting object\r\n  const formatDetails = document.getElementById(\"format-details\");\r\n  formatDetails.style.display = 'none';\r\n  // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n  emptyFormat = true;\r\n  const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n  glossaryBtn.classList.remove('disabled-link');\r\n  const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n  CaptureBtn.disabled = true;\r\n\r\n\r\n  const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n  if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n    removeFormatBtn.classList.add('disabled-link');\r\n  }\r\n  console.log(\"Captured formatting cleared.\");\r\n}\r\n\r\nasync function captureFormatting() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n      const font = selection.font;\r\n      font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n\r\n      await context.sync();\r\n\r\n      capturedFormatting = {\r\n        Bold: font.bold,\r\n        Italic: font.italic,\r\n        Underline: font.underline,\r\n        Size: font.size,\r\n        \"Background Color\": font.highlightColor,\r\n        \"Font Name\": font.name,\r\n        'Text Color': font.color\r\n      };\r\n\r\n\r\n\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'block';\r\n\r\n      if (capturedFormatting.Bold === null ||\r\n        capturedFormatting.Underline === 'Mixed' ||\r\n        capturedFormatting.Size === null ||\r\n        capturedFormatting[\"Font Name\"] === null ||\r\n        capturedFormatting[\"Background Color\"] === '' ||\r\n        capturedFormatting[\"Text Color\"] === ''\r\n\r\n      ) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        if (!removeFormatBtn.classList.contains('disabled-link')) {\r\n          removeFormatBtn.classList.add('disabled-link');\r\n        }\r\n\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.classList.remove('disabled-link');\r\n        displayCapturedFormatting();\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error capturing formatting:\", error);\r\n  }\r\n}\r\n\r\n\r\n\r\nasync function removeOptionsConfirmation() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    } // Check if isTagUpdating is false\r\n    const htmlBody = `\r\n      <div class=\"container pt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n            <h5 class=\"card-title\">Are you sure you want to remove formatted text ?</h5>\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div id=\"format-details\">\r\n              <h5>Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled mb-3\"></ul>\r\n              <small class=\"text-secondary font-italic\" id=\"warning-rem-fmt\"></small>\r\n             \r\n            </div>\r\n               <!-- Buttons for Capture and Empty Format -->\r\n\r\n            <div class=\"mt-3 d-flex justify-content-between\">\r\n              <span id=\"change-ft-btn\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n              <button id=\"clear-ft-btn\" class=\"btn btn-primary px-3\"><i class=\"fa fa-check-circle me-2\"></i>Yes</button>\r\n\r\n            </div>\r\n\r\n            \r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    displayCapturedFormatting();\r\n\r\n    if (capturedFormatting['Background Color'] === null &&\r\n      capturedFormatting['Text Color'] === '#000000') {\r\n      const warningEle = document.getElementById('warning-rem-fmt').innerHTML = 'Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?'\r\n    }\r\n\r\n    // Event listeners for the buttons\r\n    document.getElementById(\"clear-ft-btn\").addEventListener(\"click\", removeFormattedText);\r\n    document.getElementById(\"change-ft-btn\").addEventListener(\"click\", formatOptionsDisplay);\r\n\r\n  }\r\n}\r\n\r\nasync function removeFormattedText() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n\r\n      const iconelement = document.getElementById(`clear-ft-btn`);\r\n      iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Yes`;\r\n      const clrBtn = document.getElementById('clear-ft-btn') as HTMLButtonElement;\r\n      clrBtn.disabled = true;\r\n\r\n      const changeBtn = document.getElementById('change-ft-btn') as HTMLButtonElement;\r\n      changeBtn.disabled = true;\r\n      const paragraphs = context.document.body.paragraphs;\r\n      paragraphs.load(\"items\"); // Load paragraphs from the body\r\n\r\n      await context.sync();\r\n\r\n      // Iterate through each paragraph in the document body\r\n      for (const paragraph of paragraphs.items) {\r\n\r\n        // Check if the paragraph contains text\r\n        if (paragraph.text.trim() !== \"\") {\r\n          const textRanges = paragraph.split([\" \"]); // Split paragraph into individual words/segments\r\n          textRanges.load(\"items, font\");\r\n\r\n          await context.sync();\r\n\r\n          for (const range of textRanges.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n\r\n            // Check if the text range matches the captured formatting\r\n            if (\r\n              font.highlightColor === capturedFormatting['Background Color'] &&\r\n              font.color === capturedFormatting['Text Color'] &&\r\n              font.bold === capturedFormatting['Bold'] &&\r\n              font.italic === capturedFormatting['Italic'] &&\r\n              font.size === capturedFormatting['Size'] &&\r\n              font.underline === capturedFormatting['Underline'] &&\r\n              font.name === capturedFormatting['Font Name']\r\n            ) {\r\n              // Clear the range whether it's a full word or part of a word\r\n              font.highlightColor = \"#FFFFFF\"; // Set new background color\r\n              font.color = \"#000000\"; // Set new text color\r\n              font.bold = false; // Reset bold if needed\r\n              font.italic = false; // Reset italic if needed\r\n              font.underline = \"None\";\r\n              paragraph.insertText(\" \", Word.InsertLocation.replace);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n      capturedFormatting = {}; // Clear the captured formatting object\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n      emptyFormat = true;\r\n      isNoFormatTextAvailable = true;\r\n      const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n      glossaryBtn.classList.remove('disabled-link');\r\n      formatOptionsDisplay()\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing formatted text:\", error);\r\n  }\r\n}\r\n\r\n\r\nexport async function fetchAIHistory(tag) {\r\n  try {\r\n\r\n    const data = await getAiHistory(tag.ID, jwt);\r\n\r\n\r\n    if (data.Status && data.Data) {\r\n      tag.ReportHeadAIHistoryList = data['Data'] || [];\r\n      tag.FilteredReportHeadAIHistoryList = [];\r\n      tag.SourceValueID = tag.ReportHeadAIHistoryList[0].SourceValue;\r\n      const selectedSources = sourceList.filter((list) =>\r\n        tag.SourceValueID.includes(String(list.VectorID))\r\n      );\r\n\r\n      tag.SourceName = selectedSources.map((item) => {\r\n        return item.SourceName;\r\n      });\r\n      tag.Sources = tag.SourceName.join(',');\r\n      tag.TempSourceValue = selectedSources.map((item) => {\r\n        return item.VectorID ? String(item.VectorID) : item.SourceValue;\r\n      });\r\n\r\n\r\n      tag.ReportHeadAIHistoryList.forEach((historyList, i) => {\r\n        historyList.Response = removeQuotes(historyList.Response);\r\n        tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n\r\n      });\r\n      return tag.FilteredReportHeadAIHistoryList;\r\n      // Use the data here\r\n    } else {\r\n      console.warn(\"No AI history available.\");\r\n    }\r\n\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching AI history:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function sendPrompt(tag, prompt) {\r\n  if (prompt !== '' && !isTagUpdating) {\r\n\r\n    isTagUpdating = true;\r\n\r\n    const iconelement = document.getElementById(`sendPromptButton`);\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`;\r\n\r\n    const payload = {\r\n      ReportHeadID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadID,\r\n      DocumentID: dataList.NCTID,\r\n      DocumentType: dataList.DocumentType,\r\n      TextSetting: dataList.TextSetting,\r\n      DocumentTemplate: dataList.ReportTemplate,\r\n      ReportHeadGroupKeyID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,\r\n      ThreadID: tag.ThreadID,\r\n      AssistantID: dataList.AssistantID,\r\n      Container: dataList.Container,\r\n      GroupName: GroupName,\r\n      Prompt: prompt,\r\n      PromptType: 1,\r\n      Response: '',\r\n      VectorID: dataList.VectorID,\r\n      Selected: 0,\r\n      ID: 0,\r\n      SourceValue: tag.TempSourceValue ? tag.TempSourceValue : []\r\n    };\r\n\r\n    try {\r\n      isPendingResponse = true;\r\n      const data = await addAiHistory(payload, jwt);\r\n\r\n      if (data['Data'] && data['Data'] !== 'false') {\r\n        tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n        tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n        tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n          historyList.Response = removeQuotes(historyList.Response);\r\n          tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n        });\r\n        const chat = tag.ReportHeadAIHistoryList[0];\r\n        aiTagList.forEach(currentTag => {\r\n          if (currentTag.ID === tag.ID) {\r\n            const isTable = chat.FormattedResponse !== '';\r\n            const finalResponse = chat.FormattedResponse\r\n              ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n              : chat.Response;\r\n\r\n\r\n            currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n            currentTag.UserValue = finalResponse;\r\n            currentTag.EditorValue = finalResponse;\r\n            currentTag.text = finalResponse;\r\n            currentTag.IsApplied = tag.IsApplied;\r\n\r\n          }\r\n        });\r\n\r\n        availableKeys.forEach(currentTag => {\r\n          if (currentTag.ID === tag.ID) {\r\n            const isTable = chat.FormattedResponse !== '';\r\n            const finalResponse = chat.FormattedResponse\r\n              ? '\\n' + updateEditorFinalTable(chat.FormattedResponse)\r\n              : chat.Response;\r\n            currentTag.ComponentKeyDataType = isTable ? 'TABLE' : 'TEXT';\r\n            currentTag.UserValue = finalResponse;\r\n            currentTag.EditorValue = finalResponse;\r\n            currentTag.text = finalResponse;\r\n            currentTag.IsApplied = tag.IsApplied;\r\n\r\n          }\r\n        })\r\n\r\n\r\n\r\n        const appbody = document.getElementById('app-body')\r\n        appbody.innerHTML = await generateCheckboxHistory(tag);\r\n        isPendingResponse = false;\r\n\r\n      }\r\n\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      document.getElementById(`chatInput`).value = '';\r\n      isTagUpdating = false;\r\n      isPendingResponse = false;\r\n      // sourceListBtn.disabled = false;\r\n\r\n    } catch (error) {\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      isTagUpdating = false;\r\n      isPendingResponse = false;\r\n      console.error('Error sending AI prompt:', error);\r\n    }\r\n  } else {\r\n    console.error('No empty prompt allowed');\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n// Your existing copyText function\r\n\r\n\r\n\r\nasync function logout() {\r\n  if (isGlossaryActive) {\r\n    await removeMatchingContentControls();\r\n  }\r\n  sessionStorage.clear();\r\n  window.location.hash = '#/new';\r\n  initialised = true;\r\n  document.getElementById('logo-header').innerHTML = ``;\r\n  login();\r\n}\r\n\r\nfunction addAccordionListeners() {\r\n  const accordionButtons = document.querySelectorAll('.accordion-button');\r\n\r\n  accordionButtons.forEach(button => {\r\n    button.addEventListener('click', function () {\r\n      const collapseElement = this.nextElementSibling;\r\n\r\n      // Check if the element exists before accessing its classList\r\n      if (collapseElement && collapseElement.classList) {\r\n        collapseElement.classList.toggle('show');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction addCopyListeners() {\r\n  const copyIcons = document.querySelectorAll('.fa-copy');\r\n  copyIcons.forEach(icon => {\r\n    icon.addEventListener('click', function () {\r\n      const textToCopy = this.closest('.p-2').querySelector('.form-control').textContent;\r\n    });\r\n  });\r\n}\r\n\r\nexport async function applyAITagFn() {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const body = context.document.body;\r\n\r\n      context.load(body, 'text');\r\n      await context.sync();\r\n\r\n      for (let i = 0; i < aiTagList.length; i++) {\r\n        const tag = aiTagList[i];\r\n        tag.EditorValue = removeQuotes(tag.EditorValue);\r\n\r\n        const searchResults = body.search(`#${tag.DisplayName}#`, {\r\n          matchCase: false,\r\n          matchWholeWord: false,\r\n        });\r\n        context.load(searchResults, 'items');\r\n        await context.sync();\r\n\r\n        console.log(`Found ${searchResults.items.length} instances of #${tag.DisplayName}#`);\r\n\r\n        for (const item of searchResults.items) {\r\n          if (tag.EditorValue !== \"\" && !tag.IsApplied) {\r\n            const cleanDisplayName = tag.ID;\r\n            const uniqueStr = new Date().getTime();\r\n            const bookmarkName = `ID${cleanDisplayName}_Split_${uniqueStr}`;\r\n\r\n            const startMarker = item.insertParagraph(\"[[BOOKMARK_START]]\", Word.InsertLocation.before);\r\n            await context.sync();\r\n\r\n            if (tag.ComponentKeyDataType === 'TABLE') {\r\n              const range = item.getRange();\r\n              const parser = new DOMParser();\r\n              const doc = parser.parseFromString(tag.EditorValue, 'text/html');\r\n              const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n              range.delete();\r\n\r\n              for (const node of bodyNodes) {\r\n                if (node.nodeType === Node.TEXT_NODE) {\r\n                  const textContent = node.textContent?.trim();\r\n                  if (textContent) {\r\n                    textContent.split('\\n').forEach(line => {\r\n                      if (line.trim()) {\r\n                        insertLineWithHeadingStyle(range, line);\r\n                      }\r\n                    });\r\n                  }\r\n                } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                  const element = node as HTMLElement;\r\n\r\n                  if (element.tagName.toLowerCase() === 'table') {\r\n                    const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                    if (rows.length === 0) {\r\n                      range.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                      continue;\r\n                    }\r\n\r\n                    const maxCols = Math.max(...rows.map(row => {\r\n                      return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                        return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                      }, 0);\r\n                    }));\r\n\r\n                    const paragraph = range.insertParagraph(\"\", Word.InsertLocation.before);\r\n                    await context.sync();\r\n\r\n                    const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                    table.style = tableStyle;\r\n                    await context.sync();\r\n                    const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                    rows.forEach((row, rowIndex) => {\r\n                      const cells = Array.from(row.querySelectorAll('td, th'));\r\n                      let cellIndex = 0;\r\n\r\n                      cells.forEach((cell) => {\r\n                        while (rowspanTracker[cellIndex] > 0) {\r\n                          rowspanTracker[cellIndex]--;\r\n                          cellIndex++;\r\n                        }\r\n\r\n                        const cellText = Array.from(cell.childNodes)\r\n                          .map(node => {\r\n                            if (node.nodeType === Node.TEXT_NODE) {\r\n                              return node.textContent?.trim() || '';\r\n                            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                              return (node as HTMLElement).innerText.trim();\r\n                            }\r\n                            return '';\r\n                          })\r\n                          .filter(text => text.length > 0)\r\n                          .join(' ');\r\n\r\n                        const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                        const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                        table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                        for (let i = 1; i < colspan; i++) {\r\n                          if (cellIndex + i < maxCols) {\r\n                            table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                          }\r\n                        }\r\n\r\n                        if (rowspan > 1) {\r\n                          for (let i = 0; i < colspan; i++) {\r\n                            if (cellIndex + i < maxCols) {\r\n                              rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                            }\r\n                          }\r\n                        }\r\n\r\n                        cellIndex += colspan;\r\n                      });\r\n                    });\r\n                  } else {\r\n                    const elementText = element.innerText.trim();\r\n                    if (elementText) {\r\n                      elementText.split('\\n').forEach(line => {\r\n                        if (line.trim()) {\r\n                          insertLineWithHeadingStyle(range, line);\r\n                        }\r\n                      });\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n\r\n              await context.sync();\r\n            } else {\r\n              item.insertText(tag.EditorValue, Word.InsertLocation.replace);\r\n              await context.sync();\r\n            }\r\n\r\n            const endMarker = item.insertParagraph(\"[[BOOKMARK_END]]\", Word.InsertLocation.after);\r\n            await context.sync();\r\n\r\n            const markers = context.document.body.paragraphs;\r\n            context.load(markers, 'text');\r\n            await context.sync();\r\n\r\n            const start = markers.items.find(p => p.text === '[[BOOKMARK_START]]');\r\n            const end = markers.items.find(p => p.text === '[[BOOKMARK_END]]');\r\n\r\n            if (start && end) {\r\n              const bookmarkRange = start.getRange('Start').expandTo(end.getRange('End'));\r\n              bookmarkRange.insertBookmark(bookmarkName);\r\n              console.log(`Bookmark added: ${bookmarkName}`);\r\n              const afterBookmark = end.insertParagraph(\"\", Word.InsertLocation.after);\r\n\r\n              afterBookmark.select();\r\n              start.delete();\r\n              end.delete();\r\n              afterBookmark.delete();\r\n              await context.sync();\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n    } catch (err) {\r\n      console.error(\"Error during tag application:\", err);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nfunction selectResponse(tagIndex, chatIndex) {\r\n  // Handle the response selection logic here\r\n  console.log(`Response selected for tagIndex ${tagIndex}, chatIndex ${chatIndex}`);\r\n}\r\n\r\n\r\nasync function fetchGlossary() {\r\n  if (!isTagUpdating) {\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n    loadGlossary()\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction loadGlossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n        <div id=\"button-container\">\r\n          <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n        </div>\r\n  `\r\n  document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport async function applyglossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n  try {\r\n\r\n    await Word.run(async (context) => {\r\n\r\n\r\n      const body = context.document.body;\r\n      body.load(\"text\");\r\n      await context.sync(); // Sync to get the text content\r\n\r\n      const bodyText = {\r\n        \"Content\": body.text.replace(/[\\n\\r]/g, ' ')\r\n      };\r\n      try {\r\n\r\n        const data = await fetchGlossaryTemplate(dataList?.ClientID, bodyText, jwt);\r\n\r\n        layTerms = data.Data;\r\n\r\n        if (data.Data.length > 0) {\r\n          glossaryName = data.Data[0].GlossaryTemplate;\r\n          loadGlossary();\r\n        } else {\r\n          document.getElementById('app-body').innerHTML = `\r\n            <p class=\"text-center\">Data not available</p>\r\n          `;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching glossary data:', error);\r\n      }\r\n      // Sort terms by length (longest first)\r\n      layTerms.sort((a, b) => b.ClinicalTerm.length - a.ClinicalTerm.length);\r\n\r\n      const processedTerms = new Set(); // Track added larger terms\r\n\r\n      // Filter out smaller terms if they are included in a larger term\r\n      const filteredTerms = layTerms.filter(term => {\r\n        for (const biggerTerm of processedTerms) {\r\n          if (typeof biggerTerm === 'string' && biggerTerm.includes(term.ClinicalTerm.toLowerCase())) {\r\n            console.log(`Skipping \"${term.ClinicalTerm}\" because it's part of \"${biggerTerm}\"`);\r\n            return false; // Exclude this smaller term\r\n          }\r\n        }\r\n        processedTerms.add(term.ClinicalTerm.toLowerCase());\r\n        return true;\r\n      });\r\n\r\n      filteredGlossaryTerm = filteredTerms;\r\n      await removeMatchingContentControls();\r\n\r\n      const foundRanges = new Map(); // Track words already processed\r\n\r\n      const searchPromises = filteredGlossaryTerm.map(term => {\r\n        const searchResults = body.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load(\"items\");\r\n        return searchResults;\r\n      });\r\n\r\n      await context.sync();\r\n\r\n      for (const searchResults of searchPromises) {\r\n\r\n        for (const range of searchResults.items) {\r\n\r\n          if (!range || !range.text) {\r\n            console.log(\"Invalid range. Skipping...\");\r\n            continue;\r\n          }\r\n\r\n          // Load existing content controls inside this range\r\n          const font = range.font;\r\n          font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n          range.load(\"contentControls\");\r\n          await context.sync();\r\n\r\n          const existingControl = range.contentControls.items.length > 0;\r\n\r\n          if (existingControl) {\r\n            console.log(`Skipping \"${range.text}\" because it already has a content control.`);\r\n            continue; // Skip if content control is already present\r\n          }\r\n          // Check if we've already processed this term at this range\r\n          if (foundRanges.has(range.text)) {\r\n            console.log(`Skipping duplicate occurrence of \"${range.text}\"`);\r\n            continue;\r\n          }\r\n          // Mark this word as processed\r\n          foundRanges.set(range.text, true);\r\n          // Remove existing content controls if any\r\n          if (range.contentControls && range.contentControls.items.length > 0) {\r\n            console.log(`Removing existing content control from: \"${range.text}\"`);\r\n            for (const control of range.contentControls.items) {\r\n              control.delete(false); // 'false' keeps the text, only removes the control\r\n            }\r\n            await context.sync(); // Ensure deletion is applied before adding a new one\r\n          }\r\n\r\n          try {\r\n            // Insert a new content control\r\n            const contentControl = range.insertContentControl();\r\n            contentControl.title = `${range.text}`;\r\n            if (font.highlightColor !== null) {\r\n              contentControl.tag = `${font.highlightColor}`;\r\n            }\r\n            contentControl.font.highlightColor = \"yellow\"; // Highlight the control\r\n            contentControl.appearance = Word.ContentControlAppearance.boundingBox;\r\n            await context.sync();\r\n          } catch (error) {\r\n            console.error(`Error inserting content control for term \"${range.text}\":`, error);\r\n          }\r\n        }\r\n      }\r\n      // document.getElementById('glossarycheck').style.display='block';\r\n      isGlossaryActive = true;\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 clear-glossary btn-sm\" id=\"clearGlossary\">Clear Glossary</button>\r\n      </div>\r\n\r\n      <div id=\"highlighted-text\"></div>\r\n      <div class=\"d-flex justify-content-center box-loader\">\r\n       <div class=\"loader\" id=\"loader\"></div></div>\r\n      \r\n`\r\n      const displayElement = document.getElementById('loader');\r\n      displayElement.style.display = 'none';\r\n      await context.sync();\r\n      document.getElementById('clearGlossary').addEventListener('click', removeMatchingContentControls);\r\n      Office.context.document.addHandlerAsync(\r\n        Office.EventType.DocumentSelectionChanged,\r\n        handleSelectionChange\r\n      );\r\n\r\n\r\n    });\r\n\r\n    // Optional: Notify user of completion\r\n    console.log('Glossary applied successfully');\r\n  } catch (error) {\r\n    console.error('Error applying glossary:', error);\r\n    // Optional: Notify user of error\r\n    console.log('Error applying glossary. Please try again.');\r\n  }\r\n}\r\n\r\n\r\nasync function handleSelectionChange() {\r\n  await checkGlossary();\r\n}\r\n\r\nexport async function checkGlossary() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n\r\n      selection.load(\"text, font.highlightColor\");\r\n\r\n      await context.sync();\r\n\r\n\r\n\r\n      if (selection.text) {\r\n        const loader = document.getElementById('loader');\r\n        if (loader) {\r\n          loader.style.display = 'block';\r\n        }\r\n        const searchPromises = layTerms.map(term => {\r\n          const searchResults = selection.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n          searchResults.load(\"items\");\r\n          return searchResults;\r\n        });\r\n\r\n        await context.sync();\r\n        const selectedWords = []\r\n        for (const searchResults of searchPromises) {\r\n\r\n          for (const range of searchResults.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n            if (\r\n              font.highlightColor !== capturedFormatting['Background Color'] ||\r\n              font.color !== capturedFormatting['Text Color'] ||\r\n              font.bold !== capturedFormatting['Bold'] ||\r\n              font.italic !== capturedFormatting['Italic'] ||\r\n              font.size !== capturedFormatting['Size'] ||\r\n              font.underline !== capturedFormatting['Underline'] ||\r\n              font.name !== capturedFormatting['Font Name']\r\n            ) {\r\n              selectedWords.push(range.text);\r\n            }\r\n\r\n          }\r\n        }\r\n        // searchPromises.forEach(searchResults => {\r\n        //   searchResults.items.forEach(item => {\r\n        //   });\r\n        // });\r\n        displayHighlightedText(selectedWords)\r\n\r\n        await context.sync();\r\n\r\n\r\n\r\n\r\n        // const highlightColor = selection.font.highlightColor;\r\n\r\n        // if (highlightColor === \"red\") {\r\n        //   displayHighlightedText(selection.text);\r\n        // } else {\r\n        //   console.log('Selected text is not highlighted.');\r\n        // }\r\n      } else {\r\n        console.log('No text is selected.');\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error displaying glossary:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayHighlightedText(words: string[]) {\r\n\r\n  const displayElement = document.getElementById('highlighted-text');\r\n\r\n  if (displayElement) {\r\n    displayElement.innerHTML = ''; // Clear previous content\r\n    const loader = document.getElementById('loader');\r\n    loader.style.display = 'block';\r\n    // Group lay terms by their clinical term\r\n    const groupedTerms: { [clinicalTerm: string]: string[] } = {};\r\n\r\n    words.forEach(word => {\r\n      layTerms.forEach(term => {\r\n        if (term.ClinicalTerm.toLowerCase() === word.toLowerCase()) {\r\n          if (!groupedTerms[term.ClinicalTerm]) {\r\n            groupedTerms[term.ClinicalTerm] = [];\r\n          }\r\n          if (!groupedTerms[term.ClinicalTerm].includes(term.LayTerm)) {\r\n            groupedTerms[term.ClinicalTerm].push(term.LayTerm);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // Create a box for each clinical term\r\n    Object.keys(groupedTerms).forEach(clinicalTerm => {\r\n      // Create the main box for the clinical term\r\n      const mainBox = document.createElement('div');\r\n      mainBox.className = 'box'; // Add box class for styling\r\n\r\n      // Create a heading for the clinical term\r\n      const heading = document.createElement('h3');\r\n      heading.textContent = `${clinicalTerm} (${glossaryName})`;\r\n      mainBox.appendChild(heading);\r\n\r\n      // Create sub-boxes for each lay term\r\n      groupedTerms[clinicalTerm].forEach(layTerm => {\r\n        const subBox = document.createElement('div');\r\n        subBox.className = 'sub-box'; // Add class for sub-box styling\r\n        subBox.textContent = layTerm;\r\n\r\n        // Add click event listener to replace ClinicalTerm with LayTerm\r\n        subBox.addEventListener('click', async () => {\r\n          await replaceClinicalTerm(clinicalTerm, layTerm);\r\n\r\n          // Remove the main box containing the clicked sub-box\r\n          mainBox.remove();\r\n        });\r\n\r\n        mainBox.appendChild(subBox);\r\n      });\r\n\r\n      displayElement.appendChild(mainBox);\r\n    });\r\n    loader.style.display = 'none';\r\n\r\n  }\r\n}\r\nasync function replaceClinicalTerm(clinicalTerm: string, layTerm: string) {\r\n  const displayElement = document.getElementById('loader');\r\n  displayElement.style.display = 'block';\r\n\r\n  try {\r\n    await Word.run(async (context) => {\r\n      // Get the current selection\r\n      const selection = context.document.getSelection();\r\n      selection.load('text');\r\n      await context.sync();\r\n\r\n      if (selection.text.toLowerCase().includes(clinicalTerm.toLowerCase())) {\r\n        // Search for the clinicalTerm in the document\r\n        const searchResults = selection.search(clinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load('items');\r\n\r\n        await context.sync();\r\n\r\n        // Replace each occurrence of the clinicalTerm with the layTerm\r\n        for (const item of searchResults.items) {\r\n          // Load the font properties\r\n          item.font.load(['bold', 'italic', 'underline', 'color', 'highlightColor', 'size', 'name']);\r\n          await context.sync();  // Ensure the properties are loaded before accessing them\r\n\r\n          // Insert the layTerm while keeping the formatting\r\n          item.insertText(layTerm, 'replace');\r\n\r\n          // Apply the original formatting to the new text\r\n          item.font.bold = item.font.bold;\r\n          item.font.italic = item.font.italic;\r\n          item.font.underline = item.font.underline;\r\n          item.font.color = item.font.color;\r\n          item.font.highlightColor = '#c7c7c7';\r\n          item.font.size = item.font.size;\r\n          item.font.name = item.font.name;\r\n        }\r\n\r\n        await context.sync();\r\n        displayElement.style.display = 'none';\r\n        console.log(`Replaced '${clinicalTerm}' with '${layTerm}' and preserved the original formatting.`);\r\n      } else {\r\n        displayElement.style.display = 'none';\r\n        console.log(`Selected text does not contain '${clinicalTerm}'.`);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    displayElement.style.display = 'none';\r\n    console.error('Error replacing term:', error);\r\n  }\r\n}\r\n\r\n\r\nexport async function removeMatchingContentControls() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <div class=\"loader\" id=\"loader\"></div>\r\n        <div id=\"highlighted-text\"></div>`;\r\n      const body = context.document.body;\r\n\r\n      // Load all content controls\r\n      const contentControls = body.contentControls;\r\n      contentControls.load(\"items\");\r\n      await context.sync();\r\n\r\n      if (contentControls.items.length === 0) {\r\n        console.log(\"No content controls found.\");\r\n        return;\r\n      }\r\n\r\n      for (const control of contentControls.items) {\r\n        if (control.title && filteredGlossaryTerm.some(term => term.ClinicalTerm.toLowerCase() === control.title.toLowerCase())) {\r\n          const range = control.getRange();\r\n          range.load(\"text\");\r\n          await context.sync();\r\n          if (control.tag && /^#[0-9A-Fa-f]{6}$/.test(control.tag)) {\r\n            range.font.highlightColor = control.tag;\r\n          } else {\r\n            range.font.highlightColor = null\r\n          }\r\n          await context.sync();\r\n          control.delete(true);\r\n        }\r\n      }\r\n\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n      </div>\r\n      `;\r\n\r\n      await context.sync();\r\n      isGlossaryActive = false;\r\n      document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing content controls:\", error);\r\n  }\r\n}\r\n\r\n\r\nasync function displayMentions() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n\r\n  }\r\n}\r\n\r\nexport async function addGenAITags() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n    let selectedClient = clientList.filter((item) => item.ID === clientId);\r\n\r\n    let sponsorOptions = clientList.map(client => {\r\n      const isSelectedClient = selectedClient.some(selected => selected.ID === client.ID);\r\n      return ` \r\n        <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\">\r\n          <div class=\"form-check\">\r\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${client.ID}\" id=\"sponsor${client.ID}\" ${isSelectedClient ? 'checked disabled' : ''}>\r\n            <label class=\"form-check-label text-prewrap\" for=\"sponsor${client.ID}\">${client.Name}</label>\r\n          </div>\r\n        </li>\r\n      `;\r\n    }).join('');\r\n\r\n    document.getElementById('app-body').innerHTML = navTabs;\r\n    // Add modal HTML to the DOM \r\n    document.getElementById('add-tag-body').innerHTML = addtagbody(sponsorOptions);\r\n    const promptTemplateElement = document.getElementById('add-prompt-template')\r\n    setupPromptBuilderUI(promptTemplateElement, promptBuilderList)\r\n\r\n\r\n    document.getElementById('tag-tab').addEventListener('click', () => {\r\n      switchToAddTag()\r\n    });\r\n\r\n\r\n    document.getElementById('prompt-tab').addEventListener('click', () => {\r\n      switchToPromptBuilder()\r\n    });\r\n\r\n    //prompt starting\r\n    mentionDropdownFn('prompt', 'mention-dropdown', 'add');\r\n    //prompt end\r\n    const form = document.getElementById('genai-form');\r\n    const promptField = document.getElementById('prompt');\r\n\r\n    const nameField = document.getElementById('name');\r\n    const descriptionField = document.getElementById('description');\r\n    const saveGloballyCheckbox = document.getElementById('saveGlobally');\r\n    const availableForAllCheckbox = document.getElementById('isAvailableForAll');\r\n    const sponsorDropdownButton = document.getElementById('sponsorDropdown');\r\n    const sponsorDropdownItems = document.querySelectorAll('.dropdown-item .form-check-input');\r\n\r\n    document.getElementById('cancel-btn-gen-ai').addEventListener('click', () => {\r\n      if (!isPendingResponse) {\r\n        loadHomepage(availableKeys)\r\n      }\r\n    });\r\n\r\n    // Check if elements exist\r\n    if (form && nameField && promptField && sponsorDropdownItems.length > 0) {\r\n      const updateDropdownLabel = () => {\r\n        if (availableForAllCheckbox.checked) {\r\n          sponsorDropdownButton.textContent = clientList.map(client => client.Name).join(\", \");\r\n        } else {\r\n          const selectedOptions = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'selectAll')\r\n            .map(cb => cb.parentElement.textContent.trim());\r\n          sponsorDropdownButton.textContent = selectedOptions.length ? selectedOptions.join(\", \") : \"Select Sponsors\";\r\n        }\r\n      };\r\n      // Form validation logic on submit\r\n      form.addEventListener('submit', async function (e) {\r\n        e.preventDefault();\r\n\r\n        // Reset previous validation errors\r\n        form.querySelectorAll('.is-invalid').forEach(input => input.classList.remove('is-invalid'));\r\n\r\n        let valid = true;\r\n\r\n        if (!(nameField as HTMLInputElement).value.trim()) {\r\n          nameField.classList.add('is-invalid');\r\n          valid = false;\r\n        }\r\n\r\n        if (!(promptField as HTMLInputElement).value.trim()) {\r\n          promptField.classList.add('is-invalid');\r\n          valid = false;\r\n        }\r\n\r\n        if (valid) {\r\n          // Prepare object to pass to createTextGenTag\r\n          const selectedSponsors = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'selectAll')\r\n            .map(cb => {\r\n              const client = clientList.find(client => client.ID == cb.value);\r\n              return client; // Collect the entire client object\r\n            });\r\n\r\n          const isAvailableForAll = availableForAllCheckbox.checked;\r\n          const isSaveGlobally = saveGloballyCheckbox.checked;\r\n          const aigroup = dataList.Group.find(element => element.DisplayName === 'AIGroup');\r\n          const formData = {\r\n            DisplayName: nameField.value.trim(),\r\n            Prompt: promptField.value.trim(),\r\n            Description: descriptionField.value.trim(),\r\n            GroupKeyClient: selectedSponsors, // Array of selected sponsor objects\r\n            AllClient: isAvailableForAll ? 1 : 0,\r\n            SaveGlobally: isSaveGlobally,\r\n            UserDefined: '1',\r\n            ComponentKeyDataTypeID: '1',\r\n            ComponentKeyDataAccessID: '3',\r\n            AIFlag: 1,\r\n            DocumentTypeID: dataList.DocumentTypeID,\r\n            ReportHeadID: dataList.ID,\r\n            SourceTypeID: '',\r\n            ReportHeadGroupID: aigroup.ID,\r\n            ReportHeadSourceID: ''\r\n          };\r\n\r\n          await createTextGenTag(formData);\r\n        }\r\n      });\r\n\r\n\r\n      const checkAndDisableSponsors = () => {\r\n        sponsorDropdownItems.forEach(checkbox => {\r\n          if (!checkbox.disabled) {\r\n            checkbox.checked = true;\r\n            checkbox.disabled = true;\r\n          }\r\n        });\r\n        updateDropdownLabel();\r\n      };\r\n\r\n      // Function to enable sponsors without unchecking them\r\n      const enableSponsors = () => {\r\n        sponsorDropdownItems.forEach(checkbox => {\r\n          const isSelectedClient = selectedClient.some(selected => selected.ID === parseInt(checkbox.value));\r\n          if (!isSelectedClient) {\r\n            checkbox.disabled = false;\r\n          }\r\n        });\r\n        updateDropdownLabel();\r\n      };\r\n\r\n      // Event listener for \"Save Globally\" checkbox\r\n\r\n\r\n      // Event listener for \"Available to All Sponsors\" checkbox\r\n\r\n      saveGloballyCheckbox.addEventListener('change', function () {\r\n        if (!isPendingResponse) {\r\n          if (this.checked) {\r\n            availableForAllCheckbox.disabled = false;\r\n            sponsorDropdownButton.disabled = false;\r\n          } else {\r\n            enableSponsors();\r\n            availableForAllCheckbox.checked = false;\r\n            availableForAllCheckbox.disabled = true;\r\n            sponsorDropdownButton.disabled = true;\r\n            sponsorDropdownItems.forEach(checkbox => {\r\n              if (!checkbox.disabled) {\r\n                checkbox.checked = false;\r\n                checkbox.disabled = false;\r\n              }\r\n            });\r\n            updateDropdownLabel();\r\n          }\r\n        }\r\n      });\r\n\r\n      // Event listener for \"Available to All Sponsors\" checkbox\r\n      availableForAllCheckbox.addEventListener('change', function () {\r\n        if (!isPendingResponse) {\r\n\r\n          if (this.checked) {\r\n            checkAndDisableSponsors();\r\n          } else {\r\n            enableSponsors();\r\n          }\r\n        }\r\n      });\r\n\r\n      // Add event listener to prevent dropdown close on item selection\r\n      document.querySelectorAll('.dropdown-item').forEach(item => {\r\n        item.addEventListener('click', function (event) {\r\n          {\r\n            event.stopPropagation(); // Prevent dropdown from closing\r\n            const checkbox = this.querySelector('.form-check-input');\r\n            if (checkbox) {\r\n\r\n\r\n              if (checkbox.id === 'selectAll') {\r\n                const isChecked = checkbox.checked;\r\n                sponsorDropdownItems.forEach(cb => {\r\n                  if (!cb.disabled) cb.checked = isChecked;\r\n                });\r\n              }\r\n              updateDropdownLabel();\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n      // Initial label update\r\n      updateDropdownLabel();\r\n\r\n\r\n      // Clear validation errors when user types\r\n      [nameField, promptField].forEach(field => {\r\n        field.addEventListener('input', function () {\r\n          if (this.classList.contains('is-invalid') && this.value.trim()) {\r\n            this.classList.remove('is-invalid');\r\n          }\r\n          if (nameField) {\r\n            const errorDiv = document.getElementById('submition-error');\r\n            errorDiv.style.display = 'none';\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      console.error('Required elements are missing or not rendered yet.');\r\n    }\r\n  }\r\n}\r\n\r\nexport async function customizeTable() {\r\n  const container = document.getElementById('confirmation-popup');\r\n  if (!container) return;\r\n\r\n  container.innerHTML = customizeTablePopup(tableStyle);\r\n\r\n  const cancelBtn = document.getElementById('confirmation-popup-cancel');\r\n  const okBtn = document.getElementById('confirmation-popup-confirm');\r\n  const dropdown = document.getElementById('confirmation-popup-dropdown') as HTMLSelectElement;\r\n  const tablePreview = document.getElementById('confirmation-popup-table-preview') as HTMLTableElement;\r\n\r\n  const applyStyle = () => {\r\n    if (!dropdown || !tablePreview) return;\r\n\r\n    const selectedStyle = dropdown.value;\r\n    const styleObj = wordTableStyles.find(s => s.style === selectedStyle);\r\n\r\n    if (styleObj) {\r\n      // Apply main table style\r\n      if (styleObj.tableClass) {\r\n        tablePreview.style.cssText = styleObj.tableClass;\r\n      }\r\n\r\n      // Apply row style to odd rows (1,3,5...)\r\n      if (styleObj.rowClass) {\r\n        Array.from(tablePreview.rows).forEach((row, index) => {\r\n          if (index % 2 === 1) { // 0-based index => 0,2,4 = 1st,3rd,5th row\r\n            (row as HTMLTableRowElement).style.cssText = styleObj.rowClass!;\r\n          }\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  // Initial preview\r\n  applyStyle();\r\n\r\n  // Live preview on dropdown change\r\n  dropdown?.addEventListener('change', applyStyle);\r\n\r\n  if (cancelBtn) cancelBtn.addEventListener('click', () => (container.innerHTML = ''));\r\n\r\n  if (okBtn && dropdown) {\r\n    okBtn.addEventListener('click', () => {\r\n      tableStyle = dropdown.value; // update current style\r\n      container.innerHTML = '';\r\n    });\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nasync function createTextGenTag(payload) {\r\n  try {\r\n    const iconelement = document.getElementById(`text-gen-save`);\r\n    const cancelBtnGenAi = document.getElementById('cancel-btn-gen-ai');\r\n\r\n\r\n    (cancelBtnGenAi as HTMLButtonElement).disabled = true;\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Save`;\r\n    (iconelement as HTMLButtonElement).disabled = true;\r\n    isPendingResponse = true;\r\n\r\n    const data = await addGroupKey(payload, jwt);\r\n    isPendingResponse = false;\r\n\r\n    if (data['Data'] && data['Status']) {\r\n      fetchDocument('AIpanel');\r\n      toaster('Saved successfully', 'success');\r\n    } else {\r\n      (cancelBtnGenAi as HTMLButtonElement).disabled = false;\r\n      (iconelement as HTMLButtonElement).disabled = false;\r\n      iconelement.innerHTML = `<i class=\"fa fa-check-circle me-2\"></i>Save`;\r\n      toaster('Something went wrong', 'error');\r\n      // showAddTagError(data['Data']);\r\n    }\r\n\r\n  } catch (error) {\r\n    toaster('Something went wrong', 'error');\r\n    console.error('Error creating text generation tag:', error);\r\n  }\r\n}\r\n\r\n\r\nexport function mentionDropdownFn(textareaId, DropdownId, action) {\r\n  const filterMentions = (query) => {\r\n    // Assuming availableKeys is an array of objects with DisplayName and EditorValue properties\r\n    const filtered = availableKeys.filter(item => item.AIFlag === 0).filter(item =>\r\n      item.DisplayName.toLowerCase().includes(query.toLowerCase())\r\n    );\r\n    return filtered;\r\n  };\r\n  let highlightedIndex = -1;\r\n\r\n  const promptField = document.getElementById(`${textareaId}`);\r\n  const mentionDropdown = document.getElementById(`${DropdownId}`);\r\n  if (promptField) {\r\n\r\n    // Handle input events on prompt field for mentions\r\n    promptField.addEventListener('input', (e) => {\r\n      const cursorPosition = promptField.selectionStart;\r\n      const textBeforeCursor = promptField.value.slice(0, cursorPosition);\r\n      const lastHashtag = textBeforeCursor.lastIndexOf('#');\r\n      if (lastHashtag !== -1) {\r\n        const query = textBeforeCursor.slice(lastHashtag + 1).trim();\r\n        if (query.length > 0) {\r\n          const mentions = filterMentions(query);\r\n\r\n          if (mentions.length > 0) {\r\n            mentionDropdown.innerHTML = mentions.map(item => {\r\n              let editorValue = '';\r\n              if (action === 'add') {\r\n                editorValue = `#${item.DisplayName}#`;\r\n              } else {\r\n                editorValue = item.EditorValue || `#${item.DisplayName}#`;\r\n              }\r\n\r\n              return `<li class=\"dropdown-item\" data-editor-value=\"${editorValue}\">${item.DisplayName}</li>`;\r\n            }).join('');\r\n\r\n            // Get the position of the textarea and place the dropdown above it\r\n            const textareaRect = promptField.getBoundingClientRect();\r\n            mentionDropdown.style.left = `${textareaRect.left}px`;\r\n            mentionDropdown.style.bottom = `75px`; // Position above the textarea\r\n            mentionDropdown.style.display = 'block';\r\n          } else {\r\n            mentionDropdown.style.display = 'none';\r\n          }\r\n        } else {\r\n          mentionDropdown.style.display = 'none';\r\n        }\r\n      } else {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n\r\n    });\r\n\r\n    // Handle keyboard navigation in the dropdown\r\n    promptField.addEventListener('keydown', (e) => {\r\n      const items = document.querySelectorAll(`#${DropdownId} .dropdown-item`);\r\n      const totalItems = items.length;\r\n\r\n      if (e.key === 'ArrowDown') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight down and wrap around to the top if at the end\r\n        if (highlightedIndex < totalItems - 1) {\r\n          highlightedIndex++;\r\n        } else {\r\n          highlightedIndex = 0; // Wrap to the first item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'ArrowUp') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight up and wrap around to the bottom if at the top\r\n        if (highlightedIndex > 0) {\r\n          highlightedIndex--;\r\n        } else {\r\n          highlightedIndex = totalItems - 1; // Wrap to the last item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'Enter' && highlightedIndex !== -1) {\r\n        // Select the highlighted item\r\n        const selectedItem = items[highlightedIndex];\r\n        if (selectedItem) {\r\n          selectMention(selectedItem.getAttribute('data-editor-value'));\r\n          mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n          e.preventDefault();  // Prevent form submission on Enter key\r\n        }\r\n      }\r\n    });\r\n\r\n    // Function to highlight the selected item\r\n    function updateHighlightedItem(id) {\r\n      const items = document.querySelectorAll(`#${id} .dropdown-item`);\r\n      const dropdown = document.getElementById(`${id}`);\r\n      const totalItems = items.length;\r\n\r\n      // Remove the 'active' class from all items\r\n      items.forEach(item => item.classList.remove('active'));\r\n\r\n      // Add the 'active' class to the currently highlighted item\r\n      if (highlightedIndex >= 0 && highlightedIndex < totalItems) {\r\n        const highlightedItem = items[highlightedIndex];\r\n        highlightedItem.classList.add('active');\r\n\r\n        // Ensure the highlighted item is visible within the dropdown\r\n        highlightedItem.scrollIntoView({\r\n          behavior: 'smooth',    // Smooth scroll\r\n          block: 'nearest'      // Scroll only if necessary\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n\r\n    // Handle selecting an item from the dropdown via mouse click\r\n    mentionDropdown.addEventListener('click', (e) => {\r\n      if (e.target && e.target.matches('li')) {\r\n        const editorValue = e.target.getAttribute('data-editor-value');\r\n        selectMention(editorValue);\r\n        mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n      }\r\n    });\r\n\r\n    // Function to insert the selected mention into the prompt field\r\n    const selectMention = (editorValue) => {\r\n      const textarea = document.getElementById(`${textareaId}`);\r\n      const currentValue = textarea.value;\r\n      const cursorPosition = textarea.selectionStart;\r\n\r\n      const textBefore = currentValue.slice(0, cursorPosition);\r\n      const textAfter = currentValue.slice(cursorPosition);\r\n\r\n      const lastHashPosition = textBefore.lastIndexOf('#');\r\n      const updatedTextBefore = textBefore.slice(0, lastHashPosition); // Removing '#' symbol\r\n\r\n      textarea.value = `${updatedTextBefore}${editorValue}${textAfter}`;\r\n      const newCursorPosition = updatedTextBefore.length + editorValue.length;\r\n      textarea.setSelectionRange(newCursorPosition, newCursorPosition);\r\n    };\r\n\r\n    // Hide the dropdown if clicked outside\r\n    document.addEventListener('click', (e) => {\r\n      if (!mentionDropdown.contains(e.target) && e.target !== promptField) {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const selection = context.document.getSelection();\r\n      await context.sync();\r\n\r\n      if (!selection) {\r\n        throw new Error('Selection is invalid or not found.');\r\n      }\r\n\r\n      if (type === 'TABLE') {\r\n        const parser = new DOMParser();\r\n        const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n\r\n        const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n        for (const node of bodyNodes) {\r\n          if (node.nodeType === Node.TEXT_NODE) {\r\n            const textContent = node.textContent?.trim();\r\n            if (textContent) {\r\n              textContent.split('\\n').forEach(line => {\r\n                if (line.trim()) {\r\n                  insertLineWithHeadingStyle(selection, line);\r\n                }\r\n              });\r\n            }\r\n          } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n            const element = node as HTMLElement;\r\n\r\n            if (element.tagName.toLowerCase() === 'table') {\r\n              const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n              if (rows.length === 0) {\r\n                selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                continue;\r\n              }\r\n\r\n              const maxCols = Math.max(...rows.map(row => {\r\n                return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                  return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                }, 0);\r\n              }));\r\n\r\n              const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n              await context.sync();\r\n\r\n              const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n              table.style = tableStyle;  // Apply built-in Word table style\r\n\r\n              await context.sync();\r\n\r\n              const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n              rows.forEach((row, rowIndex) => {\r\n                const cells = Array.from(row.querySelectorAll('td, th'));\r\n                let cellIndex = 0;\r\n\r\n                cells.forEach((cell) => {\r\n                  while (rowspanTracker[cellIndex] > 0) {\r\n                    rowspanTracker[cellIndex]--;\r\n                    cellIndex++;\r\n                  }\r\n\r\n                  const cellText = Array.from(cell.childNodes)\r\n                    .map(node => {\r\n                      if (node.nodeType === Node.TEXT_NODE) {\r\n                        return node.textContent?.trim() || '';\r\n                      } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                        return (node as HTMLElement).innerText.trim();\r\n                      }\r\n                      return '';\r\n                    })\r\n                    .filter(text => text.length > 0)\r\n                    .join(' ');\r\n\r\n                  const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                  const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                  // if (rowIndex === 0) {\r\n                  //   const cell = table.getCell(rowIndex, cellIndex);\r\n                  //   const paragraph = cell.body.paragraphs.getFirst();\r\n                  //   paragraph.font.bold = true;\r\n                  //   paragraph.font.highlightColor = \"lightGray\";  // This works!\r\n                  // }\r\n                  table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                  for (let i = 1; i < colspan; i++) {\r\n                    if (cellIndex + i < maxCols) {\r\n                      table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                    }\r\n                  }\r\n\r\n                  if (rowspan > 1) {\r\n                    for (let i = 0; i < colspan; i++) {\r\n                      if (cellIndex + i < maxCols) {\r\n                        rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                      }\r\n                    }\r\n                  }\r\n\r\n                  cellIndex += colspan;\r\n                });\r\n              });\r\n            } else {\r\n              const elementText = element.innerText.trim();\r\n              if (elementText) {\r\n                elementText.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    insertLineWithHeadingStyle(selection, line);\r\n                  }\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      else {\r\n        if (word.EditorValue === '' || word.IsApplied) {\r\n          selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n        } else {\r\n          let content = removeQuotes(word.EditorValue);\r\n          let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n\r\n          lines.forEach(line => {\r\n            selection.insertParagraph(line, Word.InsertLocation.before);\r\n          });\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n    } catch (error) {\r\n      console.error('Detailed error:', error);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nfunction insertLineWithHeadingStyle(range: Word.Range, line: string) {\r\n  let style = \"Normal\";\r\n  let text = line;\r\n\r\n  if (line.startsWith('###### ')) {\r\n    style = \"Heading 6\";\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith('##### ')) {\r\n    style = \"Heading 5\";\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith('#### ')) {\r\n    style = \"Heading 4\";\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith('### ')) {\r\n    style = \"Heading 3\";\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith('## ')) {\r\n    style = \"Heading 2\";\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith('# ')) {\r\n    style = \"Heading 1\";\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  const paragraph = range.insertParagraph(text, Word.InsertLocation.before);\r\n  paragraph.style = style;\r\n}\r\n\r\n\r\n\r\nfunction removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\nfunction showAddTagError(message) {\r\n  const errorDiv = document.getElementById('submition-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction transformDocumentName(value: string): string {\r\n  if (!value || value.trim() === '') {\r\n    return value; // Return the input value unchanged\r\n  }\r\n\r\n  const parts = value.split('_');\r\n  if (parts.length <= 1) {\r\n    return value; // Return the input value unchanged if no underscores are present\r\n  }\r\n\r\n  return parts.slice(1).join('_').replace(/%20/g, ' ').replace(/%25/g, '%');\r\n}\r\n\r\n\r\n\r\nexport function createMultiSelectDropdown(tag) {\r\n  const isDark = theme === 'Dark';\r\n  const btnClass = isDark ? 'btn-dark text-light border-0' : 'btn-light text-dark border';\r\n  const dropdownMenuClass = isDark ? 'bg-dark text-light border-light' : 'bg-white text-dark border';\r\n  const itemClass = isDark ? 'bg-dark text-light' : 'bg-white text-dark';\r\n\r\n  // Group sources by SourceType\r\n  const groupedSources = sourceList.reduce((groups, source) => {\r\n    if (!groups[source.SourceType]) groups[source.SourceType] = [];\r\n    groups[source.SourceType].push(source);\r\n    return groups;\r\n  }, {});\r\n\r\n  const multiSelectHTML = `\r\n  <div class='p-3 w-100'>\r\n    <div class=\"mb-3\">\r\n      <label for=\"source-select\" class=\"form-label\"><span class=\"text-danger\">*</span> Select Sources</label>\r\n      <div class=\"dropdown w-100\">\r\n        <button \r\n          class=\"btn ${btnClass} w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources\" \r\n          type=\"button\" \r\n          id=\"sourceDropdown\" \r\n          data-bs-toggle=\"dropdown\" \r\n          aria-expanded=\"false\">\r\n          <span id=\"sourceDropdownLabel\" class='sourceDropdownLabel'></span>\r\n          <span class=\"dropdown-toggle-icon dropdown-toggle-icon-s\"></span>\r\n        </button>\r\n        <ul class=\"dropdown-menu ${dropdownMenuClass} w-100 p-2\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000; max-height: 300px; overflow-y: auto;\">\r\n          \r\n          <!-- Select All -->\r\n          <li class=\"dropdown-item p-2 ${itemClass}\" data-checkbox-id=\"selectAll\">\r\n            <div class=\"form-check\">\r\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\r\n              <label class=\"form-check-label w-100\" for=\"selectAll\">Select All</label>\r\n            </div>\r\n          </li>\r\n\r\n          <!-- Grouped Sources -->\r\n          ${Object.keys(groupedSources)\r\n      .map((group, groupIndex) => {\r\n        const groupItems = groupedSources[group]\r\n          .map(\r\n            (source, index) => `\r\n                  <li class=\"dropdown-item ps-4 ${itemClass}\" style=\"cursor: pointer;\" data-checkbox-id=\"source-${groupIndex}-${index}\">\r\n                    <div class=\"form-check\">\r\n                      <input class=\"form-check-input source-checkbox\" type=\"checkbox\" value=\"${source.SourceName}\" id=\"source-${groupIndex}-${index}\">\r\n                      <label class=\"form-check-label w-100 text-prewrap\" for=\"source-${groupIndex}-${index}\">${source.SourceName}</label>\r\n                    </div>\r\n                  </li>\r\n                `\r\n          )\r\n          .join('');\r\n\r\n        return `\r\n                <!-- Group Header -->\r\n                <li class=\"dropdown-item p-2 ${itemClass}\" data-group-id=\"group-${groupIndex}\">\r\n                  <div class=\"form-check\">\r\n                    <input class=\"form-check-input group-checkbox\" type=\"checkbox\" value=\"${group}\" id=\"group-${groupIndex}\">\r\n                    <label class=\"form-check-label fw-bold\" for=\"group-${groupIndex}\">${group}</label>\r\n                  </div>\r\n                </li>\r\n                ${groupItems}\r\n              `;\r\n      })\r\n      .join('')}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n    <div class=\"mt-3 d-flex justify-content-between\">\r\n      <span id=\"cancel-src-btn\" class=\"fw-bold text-primary my-auto c-pointer\">Cancel</span>\r\n      <button id=\"ok-src-btn\" class=\"btn btn-primary\">Save</button>\r\n    </div>\r\n  </div>\r\n  `;\r\n\r\n  const accordionBody = document.getElementById(`chatFooter`);\r\n  accordionBody.innerHTML = multiSelectHTML;\r\n\r\n  let selectedSources = [];\r\n\r\n  const selectAllCheckbox = document.getElementById(`selectAll`);\r\n  const groupCheckboxes = document.querySelectorAll(`.group-checkbox`);\r\n  const individualCheckboxes = document.querySelectorAll(`.source-checkbox`);\r\n  const sourceDropdownLabel = document.getElementById(`sourceDropdownLabel`);\r\n\r\n  function updateLabel() {\r\n    sourceDropdownLabel.innerText = selectedSources.length > 0 ? selectedSources.join(', ') : ' ';\r\n  }\r\n\r\n  // Select All logic\r\n  selectAllCheckbox.addEventListener(\"change\", function () {\r\n    const checked = this.checked;\r\n    groupCheckboxes.forEach(cb => cb.checked = checked);\r\n    individualCheckboxes.forEach(cb => {\r\n      cb.checked = checked;\r\n      if (checked && !selectedSources.includes(cb.value)) {\r\n        selectedSources.push(cb.value);\r\n      }\r\n      if (!checked) {\r\n        selectedSources = [];\r\n      }\r\n    });\r\n    updateLabel();\r\n  });\r\n\r\n  // Group checkbox logic\r\n  groupCheckboxes.forEach(groupCb => {\r\n    groupCb.addEventListener(\"change\", function () {\r\n      const groupIndex = this.id.split('-')[1];\r\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\r\n\r\n      groupItems.forEach(cb => {\r\n        cb.checked = this.checked;\r\n        if (this.checked && !selectedSources.includes(cb.value)) {\r\n          selectedSources.push(cb.value);\r\n        }\r\n        if (!this.checked) {\r\n          selectedSources = selectedSources.filter(s => s !== cb.value);\r\n        }\r\n      });\r\n\r\n      // Update Select All state\r\n      selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => child.checked);\r\n      updateLabel();\r\n    });\r\n  });\r\n\r\n  // Individual checkbox logic\r\n  individualCheckboxes.forEach(cb => {\r\n    cb.addEventListener(\"change\", function () {\r\n      if (cb.checked) {\r\n        if (!selectedSources.includes(cb.value)) selectedSources.push(cb.value);\r\n      } else {\r\n        selectedSources = selectedSources.filter(s => s !== cb.value);\r\n      }\r\n\r\n      // Update parent group checkbox\r\n      const groupIndex = cb.id.split(\"-\")[1];\r\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\r\n      const groupCheckbox = document.getElementById(`group-${groupIndex}`);\r\n      groupCheckbox.checked = Array.from(groupItems).every(child => child.checked);\r\n\r\n      // Update Select All checkbox\r\n      selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => child.checked);\r\n\r\n      updateLabel();\r\n    });\r\n  });\r\n\r\n  // Initialize with pre-selected sources\r\n  if (tag.Sources && tag.Sources.length > 0) {\r\n    individualCheckboxes.forEach(cb => {\r\n      if (tag.Sources.includes(cb.value)) {\r\n        cb.checked = true;\r\n        selectedSources.push(cb.value);\r\n      }\r\n    });\r\n\r\n    // Update group checkboxes\r\n    groupCheckboxes.forEach(groupCb => {\r\n      const groupIndex = groupCb.id.split(\"-\")[1];\r\n      const groupItems = document.querySelectorAll(`[data-checkbox-id^=\"source-${groupIndex}-\"] .source-checkbox`);\r\n      groupCb.checked = Array.from(groupItems).every(child => child.checked);\r\n    });\r\n\r\n    // Update Select All\r\n    selectAllCheckbox.checked = Array.from(individualCheckboxes).every(child => child.checked);\r\n    updateLabel();\r\n  }\r\n\r\n  // Save\r\n  document.getElementById(`ok-src-btn`).addEventListener(\"click\", function () {\r\n    tag.Sources = [...selectedSources];\r\n    const receivedEntry = sourceList.filter(source => selectedSources.includes(source.SourceName));\r\n    tag.TempSourceValue = receivedEntry.map((item) => {\r\n      return item.VectorID ? String(item.VectorID) : item.SourceValue;\r\n    });\r\n\r\n    tag.SourceName = receivedEntry.map((item) => {\r\n      return item.SourceName;\r\n    });\r\n\r\n    tag.SourceValueID = receivedEntry.map((item) => {\r\n      return String(item.VectorID);\r\n    });\r\n\r\n    tag.SourceValue = receivedEntry\r\n      .map(source => source.SourceValue);\r\n    accordionBody.innerHTML = chatfooter(tag);\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n  });\r\n\r\n  // Cancel\r\n  document.getElementById(`cancel-src-btn`).addEventListener(\"click\", function () {\r\n    accordionBody.innerHTML = chatfooter(tag);\r\n    initializeAIHistoryEvents(tag, jwt, availableKeys);\r\n  });\r\n}\r\n\r\n\r\n\r\nasync function loadPromptTemplates() {\r\n  try {\r\n    const data = await getAllPromptTemplates(jwt);\r\n    if (data.Status && data.Data) {\r\n      promptBuilderList = data.Data;\r\n    }\r\n    // Do something with the data\r\n  } catch (error) {\r\n    console.error('Error fetching prompt templates:', error);\r\n  }\r\n}\r\n\r\n\r\nasync function logBookmarksInSelection() {\r\n  return Word.run(async (context) => {\r\n    let range = context.document.getSelection();\r\n    await context.sync(); // Ensure selection is ready\r\n\r\n\r\n    // Get bookmarks in the selection\r\n    let bookmarks = range.getBookmarks(); // Returns ClientResult<string[]>\r\n\r\n    await context.sync(); // Ensure bookmarks are retrieved\r\n    if (bookmarks.value.length > 0) {\r\n      selectedNames = []\r\n      const badgeWrapper = document.getElementById('tags-in-selected-text');\r\n      if (badgeWrapper) {\r\n        badgeWrapper.classList.remove('d-none');\r\n        badgeWrapper.classList.add('d-block');\r\n      }\r\n      bookmarks.value.forEach((bookmarkName) => {\r\n        let processedName = bookmarkName.split(\"_Split_\")[0];\r\n        processedName = processedName.replace(/_/g, \" \");\r\n        selectedNames.push(processedName)\r\n        const container = document.getElementById('tags-in-selected-text');\r\n        if (container) {\r\n          renderSelectedTags(selectedNames, availableKeys)// Trigger function when selection changes\r\n        }\r\n      });\r\n    } else {\r\n      const badgeWrapper = document.getElementById('tags-in-selected-text');\r\n      if (badgeWrapper) {\r\n        badgeWrapper.classList.remove('d-block');\r\n        badgeWrapper.classList.add('d-none');\r\n      }\r\n    }\r\n  });\r\n}\r\n"],"names":["___HTML_LOADER_IMPORT_0___","___HTML_LOADER_IMPORT_1___","module","exports","url","options","String","__esModule","default","hash","maybeNeedQuotes","test","concat","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","m","n","getter","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","b","baseURI","self","href","baseUrl","async","updatePromptTemplate","payload","jwt","response","fetch","method","headers","body","JSON","stringify","ok","json","wordTableStyles","name","style","tableClass","rowClass","toaster","message","type","getElementById","innerHTML","setTimeout","navTabs","insertLineWithHeadingStyle","range","line","Word","run","text","startsWith","substring","trim","paragraph","insertParagraph","InsertLocation","before","regex","match","lastIndex","exec","index","insertText","end","content","bold","italic","underline","formattedRange","font","UnderlineType","single","none","context","sync","removeQuotes","value","copyText","tempTextArea","createElement","appendChild","select","execCommand","removeChild","switchToAddTag","querySelector","classList","remove","add","updateEditorFinalTable","data","tables","parsedContent","parse","push","jsonToHtmlTable","error","console","tableIndex","jsonData","Array","isArray","Set","rows","flattenObject","prefix","result","keys","forEach","newKey","map","item","entries","k","v","join","flattenedItem","table","header","row","chatfooter","tag","theme","Sources","renderSelectedTags","selectedNames","availableKeys","badgeWrapper","toLowerCase","lowerName","find","aiTag","mention","AIFlag","ID","DisplayName","badge","className","cursor","addEventListener","displayName","bookmarks","getSelection","getBookmarks","targetBookmarkName","bookmark","split","getBookmarkRangeOrNullObject","load","isNullObject","selectMatchingBookmarkFromSelection","appBody","generateCheckboxHistory","then","html","applyThemeClasses","isDark","isLight","safeApplyClass","selector","darkClasses","lightClasses","elements","querySelectorAll","darkClassList","lightClassList","elem","swicthThemeIcon","icon","sessionStorage","setItem","loadHomepage","searchBoxClass","searchBox","suggestionList","updateSuggestions","searchTerm","replaceChildren","filteredMentions","filter","includes","nonAITags","aiTags","createSection","labelText","mentions","isAISection","themeClasses","itemClass","labelClass","label","textContent","listItem","onclick","catch","word","selection","newSelection","doc","DOMParser","parseFromString","EditorValue","bodyNodes","from","childNodes","node","nodeType","Node","TEXT_NODE","ELEMENT_NODE","element","tagName","maxCols","Math","max","reduce","sum","cell","parseInt","getAttribute","insertTable","after","tableStyle","rowspanTracker","fill","rowIndex","cells","cellIndex","cellText","innerText","colspan","rowspan","getCell","elementText","IsApplied","nextLineParagraph","replaceMention","ComponentKeyDataType","debounceTimeout","clearTimeout","isPendingResponse","addGenAITags","customizeTable","applyAITagFn","FilteredReportHeadAIHistoryList","fetchAIHistory","history","closeBtnClass","closeBar","chatBody","chatList","promptclass","globalPromptUpdate","UserRole","UserRoleEntityAccessList","UserRoleEntity","chat","includeSaveIcon","UserRoleAccessID","Prompt","Selected","Response","generateChatHistoryHtml","chatFooterHtml","initializeAIHistoryEvents","textareavalue","chatInput","changeSourceButton","disabled","container","Confirmationpopup","setAttribute","updatedTag","sources","SourceValue","sourceList","source","Number","VectorID","popupData","Data","Evidences","Name","UserValue","selectedData","FileName","PageNumber","Sentence","DataModalPopup","checkbox","isChecked","event","target","checked","_","otherIndex","otherCheckbox","responseContainer","updateAiHistory","ReportHeadAIHistoryList","historyList","unshift","finalResponse","FormattedResponse","currentlySelected","some","currentTag","isTable","aiTagList","err","bookmarkName","Date","getTime","markers","paragraphs","start","items","getRange","expandTo","insertBookmark","log","afterBookmark","delete","insertTagPrompt","textareaValue","sendPrompt","createMultiSelectDropdown","mentionDropdownFn","filteredGlossaryTerm","storedUrl","documentID","organizationName","initialised","promptBuilderList","glossaryName","isGlossaryActive","GroupName","layTerms","dataList","isTagUpdating","capturedFormatting","emptyFormat","isNoFormatTextAvailable","clientId","userId","clientList","currentYear","getFullYear","login","sessionToken","getItem","loadLoginPage","toggle","handleLogin","preventDefault","organization","username","password","toLocaleLowerCase","ClientName","Username","Password","loginUser","Status","ResponseStatus","Token","showLoginError","errorDiv","display","fetchDocument","action","getReportById","logoheader","SourceTypeList","SourceName","decodeURIComponent","transformDocumentName","ClientID","aiGroup","Group","GroupKey","GroupKeyAll","InitialTable","getAllClients","warn","fetchClients","getAllPromptTemplates","loadPromptTemplates","removeMatchingContentControls","loadGlossary","fetchGlossary","formatOptionsDisplay","htmlBody","displayCapturedFormatting","removeFormattedText","removeOptionsConfirmation","clear","logout","glossaryBtn","contains","clearCapturedFormatting","Bold","Underline","Size","removeFormatBtn","captureFormatting","emptyFormatCheckbox","formatList","Italic","size","highlightColor","color","textRanges","tagId","getAiHistory","SourceValueID","selectedSources","list","TempSourceValue","prompt","iconelement","ReportHeadID","DocumentID","NCTID","DocumentType","TextSetting","DocumentTemplate","ReportTemplate","ReportHeadGroupKeyID","ThreadID","AssistantID","Container","PromptType","addAiHistory","searchResults","search","matchCase","matchWholeWord","applyglossary","bodyText","fetchGlossaryTemplate","GlossaryTemplate","sort","ClinicalTerm","processedTerms","filteredTerms","term","biggerTerm","foundRanges","Map","searchPromises","contentControls","has","set","control","contentControl","insertContentControl","title","appearance","ContentControlAppearance","boundingBox","Office","addHandlerAsync","EventType","DocumentSelectionChanged","handleSelectionChange","loader","selectedWords","words","displayElement","groupedTerms","LayTerm","clinicalTerm","mainBox","heading","layTerm","subBox","replaceClinicalTerm","displayHighlightedText","checkGlossary","selectedClient","sponsorOptions","client","isSelectedClient","selected","addtagbody","preview","templateText","fieldsList","templateSelect","applyBtn","resetBtn","previewDiv","fieldsContainer","previewContainer","templateError","replaceKeywordsManually","keywordMap","field","id","Label","keyword","HTMLInputElement","HTMLSelectElement","insertValue","RegExp","option","toString","templateId","getPromptTemplateById","Template","div","Type","input","PromptTemplateOptionList","opt","Text","Option","selectedIndex","promptTextarea","setupPromptBuilderUI","form","promptField","nameField","descriptionField","saveGloballyCheckbox","availableForAllCheckbox","sponsorDropdownButton","sponsorDropdownItems","updateDropdownLabel","selectedOptions","cb","parentElement","valid","selectedSponsors","isAvailableForAll","isSaveGlobally","aigroup","formData","Description","GroupKeyClient","AllClient","SaveGlobally","UserDefined","ComponentKeyDataTypeID","ComponentKeyDataAccessID","DocumentTypeID","SourceTypeID","ReportHeadGroupID","ReportHeadSourceID","cancelBtnGenAi","addGroupKey","createTextGenTag","checkAndDisableSponsors","enableSponsors","stopPropagation","selectedValue","popupClass","customizeTablePopup","cancelBtn","okBtn","dropdown","tablePreview","applyStyle","selectedStyle","styleObj","s","cssText","textareaId","DropdownId","highlightedIndex","mentionDropdown","updateHighlightedItem","totalItems","highlightedItem","scrollIntoView","behavior","block","cursorPosition","selectionStart","textBeforeCursor","slice","lastHashtag","lastIndexOf","query","filterMentions","editorValue","textareaRect","getBoundingClientRect","left","bottom","selectedItem","selectMention","matches","textarea","currentValue","textBefore","textAfter","lastHashPosition","updatedTextBefore","newCursorPosition","setSelectionRange","parts","btnClass","dropdownMenuClass","groupedSources","groups","SourceType","multiSelectHTML","group","groupIndex","groupItems","accordionBody","selectAllCheckbox","groupCheckboxes","individualCheckboxes","sourceDropdownLabel","updateLabel","groupCb","every","child","receivedEntry","onReady","info","host","HostType","properties","customProperties","property","orgName","retrieveDocumentProperties","processedName","logBookmarksInSelection","URL"],"sourceRoot":""}