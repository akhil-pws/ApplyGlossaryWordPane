{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane/./src/taskpane/index.html","webpack://office-addin-taskpane/./node_modules/html-loader/dist/runtime/getUrl.js","webpack://office-addin-taskpane/webpack/bootstrap","webpack://office-addin-taskpane/webpack/runtime/compat get default export","webpack://office-addin-taskpane/webpack/runtime/define property getters","webpack://office-addin-taskpane/webpack/runtime/global","webpack://office-addin-taskpane/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane/webpack/runtime/publicPath","webpack://office-addin-taskpane/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane/./src/taskpane/taskpane.ts","webpack://office-addin-taskpane/./src/taskpane/data.ts"],"sourcesContent":["// Imports\nimport ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___ from \"../../node_modules/html-loader/dist/runtime/getUrl.js\";\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\n// Module\nvar ___HTML_LOADER_REPLACEMENT_0___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_0___);\nvar code = \" <!DOCTYPE html> <html> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>Link addin</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js\\\"><\" + \"/script> <link rel=\\\"stylesheet\\\" href=\\\"https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css\\\"/> <link href=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\\\" rel=\\\"stylesheet\\\" integrity=\\\"sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65\\\" crossorigin=\\\"anonymous\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\\\"> <link href=\\\"\" + ___HTML_LOADER_REPLACEMENT_0___ + \"\\\" rel=\\\"stylesheet\\\"/> </head> <body class=\\\"ms-font-m ms-welcome ms-Fabric\\\"> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\\\" integrity=\\\"sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4\\\" crossorigin=\\\"anonymous\\\"><\" + \"/script> <div id=\\\"header-nav\\\"> <div class=\\\"logo-header d-flex w-100 justify-content-between align-items-center bg-light\\\" id=\\\"logo-header\\\"> </div> <div class=\\\"header bg-dark mb-2\\\" id=\\\"header\\\"> </div> </div> <main id=\\\"app-body\\\" class=\\\"d-block mh-34\\\"> <div id=\\\"ai-tag-list-container\\\" class=\\\"accordion\\\"></div> </main> <div id=\\\"footer\\\" class=\\\"py-2 text-center footer\\\"> </div> </body> </html>\";\n// Exports\nexport default code;","\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    // eslint-disable-next-line no-param-reassign\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n  url = String(url.__esModule ? url.default : url);\n  if (options.hash) {\n    // eslint-disable-next-line no-param-reassign\n    url += options.hash;\n  }\n  if (options.maybeNeedQuotes && /[\\t\\n\\f\\r \"'=<>`]/.test(url)) {\n    return \"\\\"\".concat(url, \"\\\"\");\n  }\n  return url;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\n\r\nimport { dataUrl, storeUrl, versionLink } from \"./data\";\r\nlet jwt = '';\r\nlet baseUrl = dataUrl\r\nlet storedUrl = storeUrl\r\nlet documentID = ''\r\nlet organizationName = ''\r\nlet aiTagList = [];\r\nlet initialised = true;\r\nlet availableKeys = [];\r\nlet glossaryName = ''\r\nlet isGlossaryActive: boolean = false;\r\nlet imageList = [];\r\nlet GroupName: string = '';\r\nlet layTerms = [];\r\nlet dataList: any = []\r\nlet isTagUpdating: boolean = false;\r\nlet capturedFormatting: any = {};\r\nlet emptyFormat: boolean = false;\r\nlet isNoFormatTextAvailable: boolean = false;\r\nlet clientId = '0';\r\nlet userId = 0;\r\nlet clientList = [];\r\nlet version = versionLink;\r\nlet currentYear = new Date().getFullYear();\r\nlet sourceList;\r\nlet filteredGlossaryTerm;\r\nlet currentlyHighlightedElement: HTMLElement | null = null;\r\n\r\n\r\n\r\n/* global document, Office, Word */\r\n\r\nwindow.addEventListener('hashchange', () => {\r\n  const hash = window.location.hash;\r\n  if (hash === '#/dashboard' && initialised) {\r\n    initialised = false;\r\n    displayMenu();\r\n\r\n  }\r\n});\r\n\r\n\r\nOffice.onReady((info) => {\r\n  if (info.host === Office.HostType.Word) {\r\n    registerSelectionChangedHandler();\r\n    document.getElementById(\"app-body\").style.display = \"flex\";\r\n    document.getElementById(\"footer\").innerText = `© ${currentYear} - TrialAssure LINK AI Assistant ${version}`\r\n    const editor = document.getElementById('editor');\r\n\r\n    window.location.hash = '#/login';\r\n    retrieveDocumentProperties()\r\n  }\r\n\r\n});\r\n\r\n\r\n// Example usage:\r\n\r\n\r\n\r\nasync function retrieveDocumentProperties() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const properties = context.document.properties.customProperties;\r\n      properties.load(\"items\");\r\n\r\n      await context.sync();\r\n      const property = properties.items.find(prop => prop.key === 'DocumentID');\r\n      const orgName = properties.items.find(prop => prop.key === 'Organization');\r\n      if (property && orgName) {\r\n        documentID = property.value;\r\n        organizationName = orgName.value;\r\n        login()\r\n      } else {\r\n        document.getElementById('app-body').innerHTML = `\r\n        <p class=\"px-3 text-center\">Export a document from the LINK AI application to use this functionality.</p>`\r\n        console.log(`Custom property \"documentID\" not found.`);\r\n        return null;\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error retrieving custom property:\", error);\r\n  }\r\n\r\n}\r\n\r\nasync function login() {\r\n  // document.getElementById('header').innerHTML = ``\r\n  const sessionToken = sessionStorage.getItem('token');\r\n  console.log(sessionToken)\r\n  if (sessionToken) {\r\n    jwt = sessionToken;\r\n    window.location.hash = '#/dashboard';\r\n  } else {\r\n    loadLoginPage();\r\n  }\r\n}\r\n\r\nfunction loadLoginPage() {\r\n\r\n\r\n  document.getElementById('app-body').innerHTML = `\r\n    <div class=\"container mt-5\">\r\n      <form id=\"login-form\" class=\"p-4 border rounded\">\r\n        <div class=\"mb-3\">\r\n          <label for=\"organization\" class=\"form-label fw-bold\">Organization</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"organization\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"username\" class=\"form-label fw-bold\">Username</label>\r\n          <input type=\"text\" class=\"form-control\" id=\"username\" required>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n          <label for=\"password\" class=\"form-label fw-bold\">Password</label>\r\n          <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n        </div>\r\n        <div class=\"d-grid\">\r\n          <button type=\"submit\" class=\"btn btn-primary bg-primary-clr\">Login</button>\r\n        </div>\r\n      <div id=\"login-error\" class=\"mt-3 text-danger\" style=\"display: none;\"></div>\r\n\r\n      </form>\r\n    </div>\r\n  `;\r\n\r\n  document.getElementById('login-form').addEventListener('submit', handleLogin);\r\n}\r\n\r\nasync function handleLogin(event) {\r\n  event.preventDefault();\r\n\r\n  // Get the values from the form fields\r\n  const organization = (document.getElementById('organization') as HTMLInputElement).value;\r\n  const username = (document.getElementById('username') as HTMLInputElement).value;\r\n  const password = (document.getElementById('password') as HTMLInputElement).value;\r\n  if (organization.toLowerCase().trim() === organizationName.toLocaleLowerCase().trim()) {\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n          </div\r\n`\r\n    try {\r\n      const response = await fetch(`${baseUrl}/api/user/login`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          ClientName: organization,\r\n          Username: username,\r\n          Password: password\r\n        })\r\n      });\r\n\r\n\r\n      if (!response.ok) {\r\n        showLoginError(\"An error occurred during login. Please try again.\")\r\n        throw new Error('Network response was not ok.');\r\n      }\r\n\r\n      const data = await response.json();\r\n      if (data.Status === true && data['Data']) {\r\n        if (data['Data'].ResponseStatus) {\r\n          jwt = data.Data.Token;\r\n          sessionStorage.setItem('token', jwt)\r\n          sessionStorage.setItem('userId', data.Data.ID);\r\n          window.location.hash = '#/dashboard';\r\n\r\n        } else {\r\n          showLoginError(\"An error occurred during login. Please try again.\")\r\n        }\r\n      } else {\r\n        showLoginError(\"An error occurred during login. Please try again.\")\r\n      }\r\n\r\n\r\n      // Handle successful login (e.g., navigate to the next page or show a success message)\r\n\r\n    } catch (error) {\r\n      showLoginError(\"An error occurred during login. Please try again.\")\r\n      console.error('Error during login:', error);\r\n      // Handle login error (e.g., show an error message)\r\n    }\r\n  } else {\r\n    showLoginError(\"The organization specified is not associated with this document\")\r\n  }\r\n}\r\n\r\nfunction showLoginError(message) {\r\n  loadLoginPage();  // Reload the form UI\r\n  const errorDiv = document.getElementById('login-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction displayMenu() {\r\n  userId = Number(sessionStorage.getItem('userId'))\r\n  // document.getElementById('aitag').addEventListener('click', redirectAI);\r\n  fetchDocument('Init');\r\n\r\n}\r\n\r\nasync function fetchDocument(action) {\r\n  try {\r\n    const response = await fetch(`${baseUrl}/api/report/id/${documentID}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${jwt}`\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n\r\n    const data = await response.json();\r\n    document.getElementById('app-body').innerHTML = ``\r\n    document.getElementById('logo-header').innerHTML = `\r\n        <img  id=\"main-logo\" src=\"${storedUrl}/assets/logo.png\" alt=\"\" class=\"logo\"> <i class=\"fa fa-sign-out me-5 c-pointer ngb-tooltip\" aria-hidden=\"true\" id=\"logout\"><span class=\"tooltiptext\">Logout</span></i>\r\n`\r\n    document.getElementById('header').innerHTML = `\r\n    <div class=\"d-flex justify-content-around\">\r\n        <button class=\"btn btn-dark\" id=\"mention\">Insert</button>\r\n        <button class=\"btn btn-dark\" id=\"aitag\">Refine</button>\r\n\r\n        <!-- Dropdown for Formatting -->\r\n        <div class=\"dropdown\">\r\n            <button class=\"btn btn-dark dropdown-toggle\" type=\"button\" id=\"formatDropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                Actions\r\n            </button>\r\n            <ul class=\"dropdown-menu\" aria-labelledby=\"formatDropdown\" style=\"z-index: 100000;\">\r\n                <li><button class=\"dropdown-item\" id=\"selectFormat\">Define Formatting</button></li>\r\n                <li><button class=\"dropdown-item\" id=\"glossary\" disabled>Glossary</button></li>\r\n                <li><button class=\"dropdown-item\" id=\"removeFormatting\" disabled>Remove Formatted Text</button></li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n`\r\n    document.getElementById('mention').addEventListener('click', () => {\r\n      setActiveButton('mention');\r\n      displayMentions();\r\n    });\r\n\r\n    document.getElementById('glossary').addEventListener('click', () => {\r\n      setActiveButton('formatDropdown');\r\n      fetchGlossary()\r\n    });\r\n\r\n    document.getElementById('aitag').addEventListener('click', () => {\r\n      setActiveButton('aitag');\r\n      displayAiTagList();\r\n    });\r\n    document.getElementById('selectFormat').addEventListener('click', () => {\r\n      setActiveButton('formatDropdown');\r\n      formatOptionsDisplay();\r\n    });\r\n    document.getElementById('removeFormatting').addEventListener('click', () => {\r\n      setActiveButton('formatDropdown');\r\n      removeOptionsConfirmation();\r\n    });\r\n\r\n    document.getElementById('logout').addEventListener('click', logout);\r\n\r\n    dataList = data['Data'];\r\n    sourceList = dataList.SourceTypeList.filter(\r\n      (item) => item.SourceValue !== ''\r\n        && item.AIFlag === 1\r\n    ) // Filter items with an extension\r\n      .map((item) => ({\r\n        ...item, // Spread the existing properties\r\n        SourceName: transformDocumentName(item.SourceValue)\r\n      }));\r\n    clientId = dataList.ClientID;\r\n    const aiGroup = data['Data'].Group.find(element => element.DisplayName === 'AIGroup');\r\n    GroupName = aiGroup ? aiGroup.Name : '';\r\n    aiTagList = aiGroup ? aiGroup.GroupKey : [];\r\n\r\n    availableKeys = data['Data'].GroupKeyAll.filter(element => element.ComponentKeyDataType === 'TABLE' || element.ComponentKeyDataType === 'TEXT');\r\n    availableKeys.forEach((key) => {\r\n      if (key.AIFlag === 1) {\r\n        const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n        let match;\r\n        if ((match = regex.exec(key.EditorValue) !== null)) {\r\n          {\r\n            key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n            key.UserValue = key.EditorValue;\r\n            key.InitialTable = true;\r\n            key.ComponentKeyDataType = 'TABLE';\r\n          }\r\n\r\n        }\r\n      }\r\n    });\r\n\r\n    aiTagList.forEach((key, i) => {\r\n      const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n\r\n      let match;\r\n      if ((match = regex.exec(key.EditorValue) !== null)) {\r\n        {\r\n          key.EditorValue = updateEditorFinalTable(key.EditorValue);\r\n          key.UserValue = key.EditorValue;\r\n          key.InitialTable = true;\r\n          key.ComponentKeyDataType = 'TABLE';\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    );\r\n\r\n    fetchClients();\r\n\r\n    if (action === 'Init') {\r\n      setActiveButton('aitag');\r\n      displayAiTagList();\r\n    } else {\r\n      setActiveButton('aitag');\r\n    }\r\n\r\n\r\n    if (action === 'AIpanel') {\r\n      displayAiTagList();\r\n    }\r\n\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching glossary data:', error);\r\n  }\r\n}\r\n\r\nfunction setActiveButton(buttonId) {\r\n  const buttons = ['mention', 'aitag', 'selectFormat', 'removeFormatting', 'formatDropdown'];\r\n  buttons.forEach(id => {\r\n    const button = document.getElementById(id);\r\n    if (button) {\r\n      if (id === buttonId) {\r\n        button.classList.add('active');\r\n      } else {\r\n        button.classList.remove('active');\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nasync function fetchClients() {\r\n  try {\r\n    const response = await fetch(`${baseUrl}/api/client/all/${userId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${jwt}`\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n\r\n\r\n\r\n    const data = await response.json();\r\n    clientList = data['Data'];\r\n  } catch (error) {\r\n  }\r\n}\r\n\r\n\r\n\r\nasync function formatOptionsDisplay() {\r\n  if (!isTagUpdating) { // Check if isTagUpdating is false\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n    const htmlBody = `\r\n      <div class=\"container mt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n               <!-- Buttons for Capture and Empty Format -->\r\n            <div class=\"d-flex justify-content-end\">\r\n              <button id=\"capture-format-btn\" class=\"btn btn-primary bg-primary-clr\"><i class=\"fa fa-border-style me-1\"></i>  Capture Format</button>\r\n            </div>\r\n            <!-- <h5 class=\"card-title\">Formatting Options</h5> -->\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div class=\"formating-checkbox\">\r\n               <input type=\"checkbox\" id=\"empty-format-checkbox\" class=\"form-check-input\">\r\n              <label for=\"empty-format-checkbox\" class=\"form-check-label empty-format-checkbox-label\" style=\"flex: 1;\">\r\n                   Skip ignoring and removing format-based text\r\n              </label>\r\n            </div>\r\n\r\n            <!-- Section to display captured formatting -->\r\n            <div id=\"format-details\">\r\n              <h5 class=\"my-3\">Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled\"></ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    if (Object.keys(capturedFormatting).length === 0) {\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // The object is not empty\r\n    }\r\n\r\n    const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n    glossaryBtn.disabled = true;\r\n    if (emptyFormat) {\r\n      clearCapturedFormatting();\r\n    }\r\n    else {\r\n      if (capturedFormatting.Bold === null || capturedFormatting.Bold === undefined ||\r\n        capturedFormatting.Underline === 'Mixed' || capturedFormatting.Underline === undefined ||\r\n        capturedFormatting.Size === null || capturedFormatting.Size === undefined ||\r\n        capturedFormatting[\"Font Name\"] === null || capturedFormatting[\"Font Name\"] === undefined ||\r\n        capturedFormatting[\"Background Color\"] === '' || capturedFormatting[\"Background Color\"] === undefined ||\r\n        capturedFormatting[\"Text Color\"] === '' || capturedFormatting[\"Text Color\"] === undefined) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.disabled = true;\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.disabled = false;\r\n        displayCapturedFormatting();\r\n      }\r\n    }\r\n    // Event listeners for the buttons\r\n\r\n    document.getElementById(\"capture-format-btn\").addEventListener(\"click\", captureFormatting);\r\n\r\n    const emptyFormatCheckbox = document.getElementById(\"empty-format-checkbox\") as HTMLInputElement;\r\n    if (isNoFormatTextAvailable) {\r\n      emptyFormatCheckbox.checked = true;\r\n      clearCapturedFormatting();\r\n    }\r\n\r\n    emptyFormatCheckbox.addEventListener(\"change\", () => {\r\n      if (emptyFormatCheckbox.checked) {\r\n        isNoFormatTextAvailable = true;\r\n        clearCapturedFormatting();\r\n      } else {\r\n        const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n        CaptureBtn.disabled = false;\r\n        isNoFormatTextAvailable = false;\r\n        emptyFormat = false;\r\n        const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n        glossaryBtn.disabled = true;\r\n      }\r\n    });\r\n\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayCapturedFormatting() {\r\n  emptyFormat = false;\r\n  const formatList = document.getElementById(\"format-list\");\r\n  formatList.innerHTML = \"\"; // Clear the list before adding new items\r\n\r\n  for (const [key, value] of Object.entries(capturedFormatting)) {\r\n    if ((key === \"Text Color\" || key === \"Background Color\") && value) {\r\n      formatList.innerHTML += `\r\n        <li><strong>${key}:</strong>${value}\r\n          <span style=\"display:inline-block;width:15px;height:15px;background-color:${value};border:1px solid black;\"></span>\r\n        </li>\r\n      `;\r\n    } else {\r\n      formatList.innerHTML += `<li><strong>${key}:</strong> ${value}</li>`;\r\n    }\r\n  }\r\n}\r\n\r\nfunction clearCapturedFormatting() {\r\n  capturedFormatting = {}; // Clear the captured formatting object\r\n  const formatDetails = document.getElementById(\"format-details\");\r\n  formatDetails.style.display = 'none';\r\n  // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n  emptyFormat = true;\r\n  const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n  glossaryBtn.disabled = false;\r\n  const CaptureBtn = document.getElementById('capture-format-btn') as HTMLButtonElement;\r\n  CaptureBtn.disabled = true;\r\n\r\n  const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n  removeFormatBtn.disabled = true;\r\n\r\n  console.log(\"Captured formatting cleared.\");\r\n}\r\n\r\nasync function captureFormatting() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n      const font = selection.font;\r\n      font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n\r\n      await context.sync();\r\n\r\n      capturedFormatting = {\r\n        Bold: font.bold,\r\n        Italic: font.italic,\r\n        Underline: font.underline,\r\n        Size: font.size,\r\n        \"Background Color\": font.highlightColor,\r\n        \"Font Name\": font.name,\r\n        'Text Color': font.color\r\n      };\r\n\r\n\r\n\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'block';\r\n\r\n      if (capturedFormatting.Bold === null ||\r\n        capturedFormatting.Underline === 'Mixed' ||\r\n        capturedFormatting.Size === null ||\r\n        capturedFormatting[\"Font Name\"] === null ||\r\n        capturedFormatting[\"Background Color\"] === '' ||\r\n        capturedFormatting[\"Text Color\"] === ''\r\n\r\n      ) {\r\n        const formatList = document.getElementById(\"format-list\");\r\n        formatList.innerHTML = \"<p>Multiple style values found. Try again</p>\";\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.disabled = true;\r\n      } else {\r\n        const removeFormatBtn = document.getElementById('removeFormatting') as HTMLButtonElement;\r\n        removeFormatBtn.disabled = false;\r\n        displayCapturedFormatting();\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error capturing formatting:\", error);\r\n  }\r\n}\r\n\r\n\r\n\r\nasync function removeOptionsConfirmation() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    } // Check if isTagUpdating is false\r\n    const htmlBody = `\r\n      <div class=\"container mt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n            <h5 class=\"card-title\">Are you sure you want to remove formatted text ?</h5>\r\n          </div>\r\n          <div class=\"card-body\">\r\n          <div id=\"format-details\">\r\n              <h5>Selected Formatting:</h5>\r\n              <ul id=\"format-list\" class=\"list-unstyled mb-3\"></ul>\r\n              <small class=\"text-secondary font-italic\" id=\"warning-rem-fmt\"></small>\r\n             \r\n            </div>\r\n               <!-- Buttons for Capture and Empty Format -->\r\n            <div class=\"d-flex justify-content-end mt-2\">\r\n              <button id=\"change-ft-btn\" class=\"btn btn-danger bg-danger-clr px-3 me-2\"><i class=\"fa fa-reply me-2\"></i>Cancel</button>\r\n              <button id=\"clear-ft-btn\" class=\"btn btn-success bg-success-clr px-3\"><i class=\"fa fa-check-circle me-2\"></i>Yes</button>\r\n\r\n            </div>\r\n\r\n            \r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    displayCapturedFormatting();\r\n\r\n    if (capturedFormatting['Background Color'] === null &&\r\n      capturedFormatting['Text Color'] === '#000000') {\r\n      const warningEle = document.getElementById('warning-rem-fmt').innerHTML = 'Warning : The captured formatting is broad. This might result in unintended text removal throughout the document. Proceed?'\r\n    }\r\n\r\n    // Event listeners for the buttons\r\n    document.getElementById(\"clear-ft-btn\").addEventListener(\"click\", removeFormattedText);\r\n    document.getElementById(\"change-ft-btn\").addEventListener(\"click\", formatOptionsDisplay);\r\n\r\n  }\r\n}\r\n\r\nasync function removeFormattedText() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n\r\n      const iconelement = document.getElementById(`clear-ft-btn`);\r\n      iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Yes`;\r\n      const clrBtn = document.getElementById('clear-ft-btn') as HTMLButtonElement;\r\n      clrBtn.disabled = true;\r\n\r\n      const changeBtn = document.getElementById('change-ft-btn') as HTMLButtonElement;\r\n      changeBtn.disabled = true;\r\n      const paragraphs = context.document.body.paragraphs;\r\n      paragraphs.load(\"items\"); // Load paragraphs from the body\r\n\r\n      await context.sync();\r\n\r\n      // Iterate through each paragraph in the document body\r\n      for (const paragraph of paragraphs.items) {\r\n        // Check if the paragraph contains text\r\n        if (paragraph.text.trim() !== \"\") {\r\n          const textRanges = paragraph.split([\" \"]); // Split paragraph into individual words/segments\r\n          textRanges.load(\"items, font\");\r\n\r\n          await context.sync();\r\n\r\n          for (const range of textRanges.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n\r\n            // Check if the text range matches the captured formatting\r\n            if (\r\n              font.highlightColor === capturedFormatting['Background Color'] &&\r\n              font.color === capturedFormatting['Text Color'] &&\r\n              font.bold === capturedFormatting['Bold'] &&\r\n              font.italic === capturedFormatting['Italic'] &&\r\n              font.size === capturedFormatting['Size'] &&\r\n              font.underline === capturedFormatting['Underline'] &&\r\n              font.name === capturedFormatting['Font Name']\r\n            ) {\r\n              // Clear the range whether it's a full word or part of a word\r\n              font.highlightColor = \"#FFFFFF\"; // Set new background color\r\n              font.color = \"#000000\"; // Set new text color\r\n              font.bold = false; // Reset bold if needed\r\n              font.italic = false; // Reset italic if needed\r\n              font.underline = \"None\";\r\n              paragraph.insertText(\" \", Word.InsertLocation.replace);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n      capturedFormatting = {}; // Clear the captured formatting object\r\n      const formatDetails = document.getElementById(\"format-details\");\r\n      formatDetails.style.display = 'none';\r\n      // formatList.innerHTML = `<li>No formatting selected.</li>`;\r\n      emptyFormat = true;\r\n      isNoFormatTextAvailable = true;\r\n      const glossaryBtn = document.getElementById('glossary') as HTMLButtonElement;\r\n      glossaryBtn.disabled = false;\r\n      formatOptionsDisplay()\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing formatted text:\", error);\r\n  }\r\n}\r\n\r\n\r\nasync function fetchAIHistory(tag) {\r\n  try {\r\n    const response = await fetch(`${baseUrl}/api/report/ai-history/${tag.ID}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${jwt}`\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n\r\n    const data = await response.json();\r\n    tag.ReportHeadAIHistoryList = data['Data'] || [];\r\n    tag.FilteredReportHeadAIHistoryList = [];\r\n    tag.ReportHeadAIHistoryList.forEach((historyList, i) => {\r\n      historyList.Response = removeQuotes(historyList.Response);\r\n      tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n\r\n    });\r\n    return tag.FilteredReportHeadAIHistoryList;\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching AI history:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n\r\nasync function generateRadioButtons(tag: any, index: number): Promise<string> {\r\n  if (!tag.FilteredReportHeadAIHistoryList || tag.FilteredReportHeadAIHistoryList.length === 0) {\r\n    await fetchAIHistory(tag);\r\n  }\r\n\r\n  if (tag.FilteredReportHeadAIHistoryList.length > 0) {\r\n    // Generate the HTML\r\n    const html = tag.FilteredReportHeadAIHistoryList.map((chat: any, j: number) =>\r\n      `<div class=\"row chatbox m-0 p-0\">\r\n        <div class=\"col-md-12 mt-2 p-2\">\r\n          <span class=\"ms-3\">\r\n            <i class=\"fa fa-copy text-secondary c-pointer\" title=\"Copy Response\" id=\"copyPrompt-${index}-${j}\"></i>\r\n          </span>\r\n          <span class=\"float-end w-75 me-3\">\r\n            <div class=\"form-control h-34 d-flex align-items-center dynamic-height user\">\r\n              ${chat.Prompt}\r\n            </div>\r\n          </span>\r\n        </div>\r\n        <div class=\"col-md-12 mt-2 p-2 d-flex align-items-center\">\r\n          <span class=\"radio-select\">\r\n            <input class=\"form-check-input c-pointer\" type=\"radio\" name=\"flexRadioDefault-${index}\"\r\n              id=\"flexRadioDefault1-${index}-${j}\" ${chat.Selected === 1 ? 'checked' : ''}>\r\n          </span>\r\n          <span class=\"ms-2 w-75\">\r\n            <div class=\"form-control h-34 d-flex align-items-center dynamic-height ai-reply ${chat.Selected === 1 ? 'ai-selected-reply' : 'bg-light'}\" id='selected-response-${index}${j}'>\r\n              ${chat.Response}\r\n            </div>\r\n          </span>\r\n          <span class=\"ms-2\">\r\n            <i class=\"fa fa-copy text-secondary c-pointer\" title=\"Copy Response\" id=\"copyResponse-${index}-${j}\"></i>\r\n          </span>\r\n        </div>\r\n\r\n\r\n      </div>`\r\n    ).join('');\r\n\r\n    // Attach event listeners after the HTML is inserted\r\n    setTimeout(() => {\r\n      tag.FilteredReportHeadAIHistoryList.forEach((chat: any, j: number) => {\r\n        document.getElementById(`copyPrompt-${index}-${j}`)?.addEventListener('click', () => copyText(chat.Prompt));\r\n        document.getElementById(`copyResponse-${index}-${j}`)?.addEventListener('click', () => copyText(chat.Response));\r\n        document.getElementById(`flexRadioDefault1-${index}-${j}`)?.addEventListener('change', () => onRadioChange(tag, index, j));\r\n\r\n      });\r\n    }, 0);\r\n\r\n    return html;\r\n  } else {\r\n    return '<div>No AI history available.</div>';\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nfunction accordionContent(headerId, collapseId, tag, radioButtonsHTML, i) {\r\n  const textColorClass = tag.IsApplied ? 'text-secondary' : '';\r\n  const tooltipButton = tag.Sources\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n  const body = `\r\n    <div class=\"accordion-item\">\r\n      <h2 class=\"accordion-header\" id=\"${headerId}\">\r\n        <button class=\"accordion-button collapsed ${textColorClass}\"\r\n                type=\"button\"\r\n                data-bs-toggle=\"collapse\"\r\n                data-bs-target=\"#${collapseId}\"\r\n                aria-expanded=\"false\"\r\n                aria-controls=\"${collapseId}\">\r\n          <span id=\"tagname-${aiTagList[i].DisplayName}\">${tag.DisplayName}</span>\r\n        </button>\r\n      </h2>\r\n      <div id=\"${collapseId}\"\r\n           class=\"accordion-collapse collapse\"\r\n           aria-labelledby=\"${headerId}\"\r\n           data-bs-parent=\"#accordionExample\">\r\n        <div class=\"accordion-body p-0\" id=\"accordion-body-${i}\">\r\n          <div class=\"chatbox\" id=\"selected-response-parent-${i}\">\r\n            ${radioButtonsHTML}\r\n          </div>\r\n          <div class=\"form-check form-switch chatbox m-0\">\r\n            <label class=\"form-check-label pb-3\" for=\"doNotApply-${i}\">\r\n              <span class=\"fs-12\">Do not apply</span>\r\n            </label>\r\n            <input class=\"form-check-input\"\r\n                   type=\"checkbox\"\r\n                   id=\"doNotApply-${i}\"\r\n                   ${tag.IsApplied ? 'checked' : ''}>\r\n          </div>\r\n          <div class=\"d-flex align-items-end justify-content-end chatbox p-2\" id=\"box-bottom-${i}\">\r\n            <textarea class=\"form-control\"\r\n                      rows=\"5\"\r\n                      id=\"chatbox-${i}\"\r\n                      placeholder=\"Type here\"></textarea>\r\n            <div id=\"mention-dropdown-${i}\" class=\"dropdown-menu\"></div>\r\n            <div class=\"d-flex flex-column align-self-end me-3\">\r\n              <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insert-tag-${i}\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\"></i>\r\n              </button>\r\n              <button class=\"btn btn-secondary ms-2 mb-2 text-white ngb-tooltip\" id=\"changeSource-${i}\">\r\n                ${tooltipButton}\r\n                <i class=\"fa fa-file-lines text-white\"></i>\r\n              </button>\r\n              <button type=\"submit\" class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\" id=\"sendPrompt-${i}\">\r\n              <span class=\"tooltiptext\">Send</span>\r\n                <i class=\"fa fa-paper-plane text-white\"></i>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>`;\r\n  return body;\r\n}\r\n\r\nasync function onDoNotApplyChange(event, index, tag: any) {\r\n  tag.IsApplied = event.target.checked;\r\n  let sourceListBtn = document.getElementById(`changeSource-${index}`) as HTMLButtonElement;\r\n  sourceListBtn.disabled = true;\r\n  const isChecked = event.target.checked;\r\n  const tagname = document.getElementById(`tagname-${aiTagList[index].DisplayName}`);\r\n  const dnaBtn = document.getElementById(`doNotApply-${index}`) as HTMLInputElement;\r\n\r\n  try {\r\n    dnaBtn.disabled = true\r\n    const response = await fetch(`${baseUrl}/api/report/head/groupkey`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(tag)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      dnaBtn.disabled = false\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n\r\n    const data = await response.json();\r\n    if (data['Data'] && data['Status'] === true) {\r\n      sourceListBtn.disabled = false;\r\n      dnaBtn.disabled = false\r\n    } else {\r\n      sourceListBtn.disabled = false;\r\n      dnaBtn.disabled = false\r\n    }\r\n\r\n  } catch (error) {\r\n    dnaBtn.disabled = false\r\n    sourceListBtn.disabled = false;\r\n    console.error('Error updating do not apply:', error);\r\n  }\r\n\r\n  if (tagname) {\r\n    const match = availableKeys.find(item => tag.DisplayName === item.DisplayName);\r\n    if (isChecked) {\r\n      if (match) match.IsApplied = true;\r\n      tagname.classList.add('text-secondary');\r\n    } else {\r\n      if (match) match.IsApplied = false;\r\n      tagname.classList.remove('text-secondary');\r\n    }\r\n  }\r\n\r\n}\r\n\r\nasync function sendPrompt(tag, prompt, index) {\r\n  if (prompt !== '' && !isTagUpdating) {\r\n    let sourceListBtn = document.getElementById(`changeSource-${index}`) as HTMLButtonElement;\r\n    sourceListBtn.disabled = true;\r\n    isTagUpdating = true;\r\n\r\n    const iconelement = document.getElementById(`sendPrompt-${index}`);\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`;\r\n\r\n    const payload = {\r\n      ReportHeadID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadID,\r\n      DocumentID: dataList.NCTID,\r\n      DocumentType: dataList.DocumentType,\r\n      TextSetting: dataList.TextSetting,\r\n      DocumentTemplate: dataList.ReportTemplate,\r\n      ReportHeadGroupKeyID: tag.FilteredReportHeadAIHistoryList[0].ReportHeadGroupKeyID,\r\n      ThreadID: tag.ThreadID,\r\n      AssistantID: dataList.AssistantID,\r\n      Container: dataList.Container,\r\n      GroupName: GroupName,\r\n      Prompt: prompt,\r\n      PromptType: 1,\r\n      Response: '',\r\n      VectorID: dataList.VectorID,\r\n      Selected: 0,\r\n      ID: 0,\r\n      SourceValue: tag.SourceValue ? tag.SourceValue : []\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(`${baseUrl}/api/report/ai-history/add`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${jwt}`\r\n        },\r\n        body: JSON.stringify(payload)\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Network response was not ok.');\r\n      }\r\n\r\n      const data = await response.json();\r\n      if (data['Data'] && data['Data'] !== 'false') {\r\n        tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n        tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n        tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n          historyList.Response = removeQuotes(historyList.Response);\r\n          tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n        });\r\n\r\n        // Update only the inner content of the accordion body\r\n        const innerContainer = document.getElementById(`selected-response-parent-${index}`);\r\n        if (innerContainer) {\r\n          const radioButtonsHTML = await generateRadioButtons(tag, index);\r\n          innerContainer.innerHTML = radioButtonsHTML;\r\n        }\r\n\r\n        // Reapply event listeners for the new buttons and radio options\r\n        tag.FilteredReportHeadAIHistoryList.forEach((chat, j) => {\r\n          document.getElementById(`copyPrompt-${index}-${j}`)?.addEventListener('click', () => copyText(chat.Prompt));\r\n          document.getElementById(`copyResponse-${index}-${j}`)?.addEventListener('click', () => copyText(chat.Response));\r\n          document.getElementById(`flexRadioDefault1-${index}-${j}`)?.addEventListener('change', () => onRadioChange(tag, index, j));\r\n        });\r\n\r\n        iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n        document.getElementById(`chatbox-${index}`).value = '';\r\n\r\n        isTagUpdating = false;\r\n        sourceListBtn.disabled = false;\r\n      } else {\r\n        iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n        isTagUpdating = false;\r\n        sourceListBtn.disabled = false;\r\n      }\r\n    } catch (error) {\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`;\r\n      isTagUpdating = false;\r\n      sourceListBtn.disabled = false;\r\n      console.error('Error sending AI prompt:', error);\r\n    }\r\n  } else {\r\n    console.error('No empty prompt allowed');\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n// Your existing copyText function\r\nfunction copyText(text: string) {\r\n  // Copy text to clipboard logic\r\n  const tempTextArea = document.createElement('textarea');\r\n  tempTextArea.value = text;\r\n  document.body.appendChild(tempTextArea);\r\n  tempTextArea.select();\r\n  document.execCommand('copy');\r\n  document.body.removeChild(tempTextArea);\r\n\r\n}\r\n\r\n\r\nasync function logout() {\r\n  if (isGlossaryActive) {\r\n    await removeMatchingContentControls();\r\n  }\r\n  sessionStorage.clear();\r\n  window.location.hash = '#/new';\r\n  initialised = true;\r\n  document.getElementById('logo-header').innerHTML = ``;\r\n  document.getElementById('header').innerHTML = ``\r\n  login();\r\n}\r\n\r\n\r\nasync function displayAiTagList() {\r\n  if (isGlossaryActive) {\r\n    await removeMatchingContentControls()\r\n  }\r\n  const container = document.getElementById('app-body');\r\n  container.innerHTML = `\r\n  <div class=\"d-flex justify-content-between px-2\">\r\n      <button class=\"btn btn-primary btn-sm bg-primary-clr c-pointer text-white  mb-3 mt-2 px-3 py-2\" id=\"addgenaitag\">\r\n        <i class=\"fa fa-plus text-light px-1\"></i>\r\n        Add\r\n    </button>\r\n\r\n     <button class=\"btn btn-primary btn-sm bg-primary-clr c-pointer text-white mb-3 mt-2 px-3 py-2\" id=\"applyAITag\">\r\n        <i class=\"fa fa-robot text-light px-1\"></i>\r\n        Apply\r\n    </button>\r\n    </div>\r\n\r\n    <div class=\"card-container\"  id=\"card-container\">\r\n    </div>\r\n  `; // Clear any previous content\r\n  const Cardcontainer = document.getElementById('card-container');\r\n  document.getElementById('applyAITag').addEventListener('click', applyAITagFn);\r\n\r\n  document.getElementById('addgenaitag').addEventListener('click', addGenAITags);\r\n\r\n  for (let i = 0; i < aiTagList.length; i++) {\r\n    const tag = aiTagList[i];\r\n    const accordionItem = document.createElement('div');\r\n    accordionItem.classList.add('accordion');\r\n    accordionItem.id = `accordion-item-${i}`; // Replace 'yourUniqueId' with your desired ID\r\n\r\n    const headerId = `flush-headingOne-${i}`;\r\n    const collapseId = `flush-collapseOne-${i}`;\r\n\r\n    const radioButtonsHTML = await generateRadioButtons(tag, i);\r\n\r\n    accordionItem.innerHTML = accordionContent(headerId, collapseId, tag, radioButtonsHTML, i);\r\n\r\n    Cardcontainer.appendChild(accordionItem);\r\n    mentionDropdownFn(`chatbox-${i}`, `mention-dropdown-${i}`, 'edit');\r\n    document.getElementById(`doNotApply-${i}`)?.addEventListener('change', () => onDoNotApplyChange(event, i, tag));\r\n\r\n    document.getElementById(`sendPrompt-${i}`)?.addEventListener('click', () => {\r\n      const textareaValue = (document.getElementById(`chatbox-${i}`) as HTMLTextAreaElement).value;\r\n\r\n      sendPrompt(tag, textareaValue, i)\r\n    });\r\n\r\n    document.getElementById(`insert-tag-${i}`)?.addEventListener('click', () => {\r\n      insertTagPrompt(i)\r\n    })\r\n\r\n    document.getElementById(`changeSource-${i}`)?.addEventListener('click', () => {\r\n      const textareaValue = (document.getElementById(`chatbox-${i}`) as HTMLTextAreaElement).value;\r\n\r\n      // const accordionbody=document.getElementById(`accordion-body-${i}`).innerHTML=''\r\n      createMultiSelectDropdown(i, tag, radioButtonsHTML, textareaValue)\r\n    })\r\n  }\r\n\r\n  // Add event listeners after rendering\r\n  addAccordionListeners();\r\n  addCopyListeners();\r\n\r\n}\r\n\r\nasync function insertTagPrompt(index: any) {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const selection = context.document.getSelection();\r\n      await context.sync();\r\n\r\n      if (!selection) {\r\n        throw new Error('Selection is invalid or not found.');\r\n      }\r\n\r\n\r\n      if (aiTagList[index].EditorValue === '') {\r\n        selection.insertParagraph(`#${aiTagList[index].DisplayName}#`, Word.InsertLocation.before);\r\n      } else {\r\n        if (aiTagList[index].ComponentKeyDataType === 'TABLE') {\r\n\r\n          const containerParagraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n          await context.sync();\r\n\r\n          // Create content control around this paragraph (will expand as we add content)\r\n          const contentControl = containerParagraph.insertContentControl();\r\n          contentControl.title = aiTagList[index].DisplayName;\r\n          contentControl.tag = `tagname-${aiTagList[index].DisplayName}`;\r\n          await context.sync();\r\n\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(aiTagList[index].EditorValue, 'text/html');\r\n\r\n          const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n          for (const node of bodyNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n              const textContent = node.textContent?.trim();\r\n              if (textContent) {\r\n                textContent.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    const para = contentControl.insertParagraph(line, Word.InsertLocation.end);\r\n                    applyHeadingStyleIfNeeded(para, line);  // Optional if you want heading styles\r\n                  }\r\n                });\r\n              }\r\n            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n              const element = node as HTMLElement;\r\n\r\n              if (element.tagName.toLowerCase() === 'table') {\r\n                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                if (rows.length === 0) {\r\n                  contentControl.insertParagraph(\"[Empty Table]\", Word.InsertLocation.end);\r\n                  continue;\r\n                }\r\n\r\n                const table = contentControl.insertTable(rows.length, element.rows[0].cells.length, Word.InsertLocation.end);\r\n                table.style = \"Grid Table 4 - Accent 1\";\r\n                await context.sync();\r\n\r\n                const rowspanTracker: number[] = new Array(element.rows[0].cells.length).fill(0);\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < element.rows[0].cells.length) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < element.rows[0].cells.length) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n                });\r\n              } else {\r\n                const elementText = element.innerText.trim();\r\n                if (elementText) {\r\n                  elementText.split('\\n').forEach(line => {\r\n                    if (line.trim()) {\r\n                      const para = contentControl.insertParagraph(line, Word.InsertLocation.end);\r\n                      applyHeadingStyleIfNeeded(para, line);  // Optional if you want heading styles\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n        } else {\r\n          if (aiTagList[index].EditorValue === '' || aiTagList[index].IsApplied) {\r\n            selection.insertParagraph(`#${aiTagList[index].DisplayName}#`, Word.InsertLocation.before);\r\n          } else {\r\n            let content = removeQuotes(aiTagList[index].EditorValue);\r\n            let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n            let cc = selection.insertContentControl();\r\n            cc.tag = `tagname-${aiTagList[index].DisplayName}`;\r\n            cc.title = aiTagList[index].DisplayName;\r\n            cc.appearance = \"BoundingBox\";\r\n            lines.forEach(line => {\r\n              cc.insertParagraph(line, Word.InsertLocation.end);\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n\r\n      await context.sync();\r\n    } catch (error) {\r\n      console.error('Detailed error:', error);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nfunction addAccordionListeners() {\r\n  const accordionButtons = document.querySelectorAll('.accordion-button');\r\n\r\n  accordionButtons.forEach(button => {\r\n    button.addEventListener('click', function () {\r\n      const collapseElement = this.nextElementSibling;\r\n\r\n      // Check if the element exists before accessing its classList\r\n      if (collapseElement && collapseElement.classList) {\r\n        collapseElement.classList.toggle('show');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction addCopyListeners() {\r\n  const copyIcons = document.querySelectorAll('.fa-copy');\r\n  copyIcons.forEach(icon => {\r\n    icon.addEventListener('click', function () {\r\n      const textToCopy = this.closest('.p-2').querySelector('.form-control').textContent;\r\n    });\r\n  });\r\n}\r\n\r\nasync function applyAITagFn() {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const body = context.document.body;\r\n      context.load(body, 'text');\r\n      await context.sync();\r\n\r\n      // Iterate over the aiTagList to search and replace\r\n      for (let i = 0; i < aiTagList.length; i++) {\r\n        const tag = aiTagList[i];\r\n        // Clean up the EditorValue by removing quotes\r\n        tag.EditorValue = removeQuotes(tag.EditorValue);\r\n\r\n        // Search for all instances of the tag.DisplayName enclosed with `#`\r\n        const searchResults = body.search(`#${tag.DisplayName}#`, {\r\n          matchCase: false,\r\n          matchWholeWord: false,\r\n        });\r\n\r\n        // Load the search results to ensure they are available for further operations\r\n        context.load(searchResults, 'items');\r\n\r\n        await context.sync(); // Synchronize to fetch the search results\r\n\r\n        // Log the number of search results for debugging\r\n        console.log(`Found ${searchResults.items.length} instances of #${tag.DisplayName}#`);\r\n\r\n        // Replace each found instance with tag.EditorValue\r\n        const tableInsertPositions: { range: Word.Range, tag: any }[] = [];\r\n\r\n        searchResults.items.forEach(async (item: any) => {\r\n          if (tag.EditorValue !== \"\" && !tag.IsApplied && tag.ComponentKeyDataType === 'TEXT') {\r\n            // Existing TEXT handling - replace with text\r\n            item.insertText(tag.EditorValue, Word.InsertLocation.replace);\r\n            const range = item.getRange();\r\n            const contentControl = range.insertContentControl();\r\n            contentControl.title = tag.DisplayName;\r\n            contentControl.tag = `tagname-${tag.DisplayName}`;\r\n          } else if (tag.ComponentKeyDataType === 'TABLE') {\r\n            // Replace the existing tag with a table instead\r\n            const range = item.getRange();\r\n            tableInsertPositions.push({ range, tag });\r\n            range.delete(); // Store the range and tag for later\r\n          }\r\n        });\r\n        await context.sync();\r\n\r\n        for (const { range, tag } of tableInsertPositions) {\r\n\r\n          // Create an empty paragraph at the range location to anchor the content control\r\n          const containerParagraph = range.insertParagraph(\"\", Word.InsertLocation.before);\r\n          await context.sync();\r\n\r\n          // Create content control around this paragraph (will expand as we add content)\r\n          const contentControl = containerParagraph.insertContentControl();\r\n          contentControl.title = tag.DisplayName;\r\n          contentControl.tag = `tagname-${tag.DisplayName}`;\r\n          await context.sync();\r\n\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(tag.EditorValue, 'text/html');\r\n\r\n          const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n          for (const node of bodyNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n              const textContent = node.textContent?.trim();\r\n              if (textContent) {\r\n                textContent.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    const para = contentControl.insertParagraph(line, Word.InsertLocation.end);\r\n                    applyHeadingStyleIfNeeded(para, line);  // Optional if you want heading styles\r\n                  }\r\n                });\r\n              }\r\n            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n              const element = node as HTMLElement;\r\n\r\n              if (element.tagName.toLowerCase() === 'table') {\r\n                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                if (rows.length === 0) {\r\n                  contentControl.insertParagraph(\"[Empty Table]\", Word.InsertLocation.end);\r\n                  continue;\r\n                }\r\n\r\n                const table = contentControl.insertTable(rows.length, element.rows[0].cells.length, Word.InsertLocation.end);\r\n                table.style = \"Grid Table 4 - Accent 1\";\r\n                await context.sync();\r\n\r\n                const rowspanTracker: number[] = new Array(element.rows[0].cells.length).fill(0);\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < element.rows[0].cells.length) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < element.rows[0].cells.length) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n                });\r\n              } else {\r\n                const elementText = element.innerText.trim();\r\n                if (elementText) {\r\n                  elementText.split('\\n').forEach(line => {\r\n                    if (line.trim()) {\r\n                      const para = contentControl.insertParagraph(line, Word.InsertLocation.end);\r\n                      applyHeadingStyleIfNeeded(para, line);  // Optional if you want heading styles\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n\r\n      }\r\n\r\n      // Final sync to apply all changes\r\n      await context.sync();\r\n\r\n    } catch (err) {\r\n      console.error(\"Error during tag application:\", err);\r\n    }\r\n  });\r\n}\r\nfunction applyHeadingStyleIfNeeded(paragraph: Word.Paragraph, line: string) {\r\n  let style = \"Normal\";\r\n  let text = line;\r\n\r\n  if (line.startsWith('###### ')) {\r\n    style = \"Heading 6\";\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith('##### ')) {\r\n    style = \"Heading 5\";\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith('#### ')) {\r\n    style = \"Heading 4\";\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith('### ')) {\r\n    style = \"Heading 3\";\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith('## ')) {\r\n    style = \"Heading 2\";\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith('# ')) {\r\n    style = \"Heading 1\";\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  // Apply the style to the paragraph\r\n  paragraph.style = style;\r\n\r\n  // Set the actual text into the paragraph, after removing the heading symbols\r\n  paragraph.insertText(text, Word.InsertLocation.replace);\r\n}\r\n\r\n\r\n\r\n\r\nasync function onRadioChange(tag, tagIndex, chatIndex) {\r\n  if (!isTagUpdating) {\r\n    isTagUpdating = true;\r\n    const iconelement = document.getElementById(`sendPrompt-${tagIndex}`)\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white\"></i>`\r\n    const chat = tag.FilteredReportHeadAIHistoryList[chatIndex];\r\n    let payload = JSON.parse(JSON.stringify(chat));\r\n    payload.Container = dataList.Container;\r\n    payload.Selected = 1;\r\n    const matchingKey = availableKeys.find(prop => prop.DisplayName === tag.DisplayName);\r\n    if (matchingKey) {\r\n      matchingKey.EditorValue = payload.Response;\r\n    }\r\n    try {\r\n      const response = await fetch(`${baseUrl}/api/report/ai-history/update`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${jwt}`\r\n        },\r\n        body: JSON.stringify(payload)\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Network response was not ok.');\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      if (data['Data']) {\r\n        tag.ReportHeadAIHistoryList = JSON.parse(JSON.stringify(data['Data']));\r\n        tag.FilteredReportHeadAIHistoryList = [];\r\n\r\n        tag.ReportHeadAIHistoryList.forEach((historyList) => {\r\n          historyList.Response = removeQuotes(historyList.Response);\r\n          tag.FilteredReportHeadAIHistoryList.unshift(historyList);\r\n        });\r\n\r\n        // Use querySelectorAll to remove 'ai-selected-reply' from all elements\r\n        const selectedParent = document.getElementById(`selected-response-parent-${tagIndex}`)\r\n        const allSelectedDivs = selectedParent.querySelectorAll('.ai-selected-reply');\r\n        allSelectedDivs.forEach(div => {\r\n          div.classList.remove('ai-selected-reply');\r\n          div.classList.add('bg-light');\r\n        });\r\n\r\n        const selectElement = document.getElementById(`selected-response-${tagIndex}${chatIndex}`);\r\n        if (selectElement) {\r\n          selectElement.classList.remove('bg-light');\r\n          selectElement.classList.add('ai-selected-reply');\r\n        }\r\n\r\n        tag.UserValue = chat.FormattedResponse\r\n          ? '\\n' + chat.FormattedResponse\r\n          : chat.Response;\r\n\r\n        tag.EditorValue = chat.FormattedResponse\r\n          ? '\\n' + chat.FormattedResponse\r\n          : chat.Response;\r\n\r\n        tag.text = chat.FormattedResponse\r\n          ? '\\n' + chat.FormattedResponse\r\n          : chat.Response;\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error updating AI data:', error);\r\n    } finally {\r\n      const iconelement = document.getElementById(`sendPrompt-${tagIndex}`)\r\n      iconelement.innerHTML = `<i class=\"fa fa-paper-plane text-white\"></i>`\r\n      isTagUpdating = false;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nfunction selectResponse(tagIndex, chatIndex) {\r\n  // Handle the response selection logic here\r\n  console.log(`Response selected for tagIndex ${tagIndex}, chatIndex ${chatIndex}`);\r\n}\r\n\r\n\r\nasync function fetchGlossary() {\r\n  if (!isTagUpdating) {\r\n\r\n    document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n    loadGlossary()\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction loadGlossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n        <div id=\"button-container\">\r\n          <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n        </div>\r\n  `\r\n  document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport async function applyglossary() {\r\n  document.getElementById('app-body').innerHTML = `\r\n  <div id=\"button-container\">\r\n\r\n          <div class=\"loader\" id=\"loader\"></div>\r\n\r\n        <div id=\"highlighted-text\"></div>`\r\n\r\n  try {\r\n\r\n    await Word.run(async (context) => {\r\n\r\n\r\n      const body = context.document.body;\r\n      body.load(\"text\");\r\n      await context.sync(); // Sync to get the text content\r\n\r\n      const bodyText = {\r\n        \"Content\": body.text.replace(/[\\n\\r]/g, ' ')\r\n      };\r\n      try {\r\n        const response = await fetch(`${baseUrl}/api/glossary-template/client-id/${dataList?.ClientID}`, {\r\n          method: 'POST', // or 'POST', depending on your API\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n\r\n            'Authorization': `Bearer ${jwt}`\r\n          },\r\n          body: JSON.stringify(bodyText)\r\n        });\r\n        if (!response.ok) {\r\n          throw new Error('Network response was not ok.');\r\n        }\r\n\r\n\r\n        const data = await response.json();\r\n        layTerms = data.Data\r\n        if (data.Data.length > 0) {\r\n          glossaryName = data.Data[0].GlossaryTemplate\r\n          loadGlossary()\r\n        } else {\r\n          document.getElementById('app-body').innerHTML = `\r\n       <p class=\"text-center\">Data not available<p/>\r\n  `\r\n        }\r\n\r\n        // alert('Glossary data loaded successfully.');\r\n      } catch (error) {\r\n        console.error('Error fetching glossary data:', error);\r\n        // Optionally show an error message to the user\r\n        // alert('Error fetching glossary data.');\r\n      }\r\n      // Sort terms by length (longest first)\r\n      layTerms.sort((a, b) => b.ClinicalTerm.length - a.ClinicalTerm.length);\r\n\r\n      const processedTerms = new Set(); // Track added larger terms\r\n\r\n      // Filter out smaller terms if they are included in a larger term\r\n      const filteredTerms = layTerms.filter(term => {\r\n        for (const biggerTerm of processedTerms) {\r\n          if (biggerTerm.includes(term.ClinicalTerm.toLowerCase())) {\r\n            console.log(`Skipping \"${term.ClinicalTerm}\" because it's part of \"${biggerTerm}\"`);\r\n            return false; // Exclude this smaller term\r\n          }\r\n        }\r\n        processedTerms.add(term.ClinicalTerm.toLowerCase());\r\n        return true;\r\n      });\r\n\r\n      filteredGlossaryTerm = filteredTerms;\r\n      await removeMatchingContentControls();\r\n\r\n      const foundRanges = new Map(); // Track words already processed\r\n\r\n      const searchPromises = filteredGlossaryTerm.map(term => {\r\n        const searchResults = body.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load(\"items\");\r\n        return searchResults;\r\n      });\r\n\r\n      await context.sync();\r\n\r\n      for (const searchResults of searchPromises) {\r\n\r\n        for (const range of searchResults.items) {\r\n\r\n          if (!range || !range.text) {\r\n            console.log(\"Invalid range. Skipping...\");\r\n            continue;\r\n          }\r\n\r\n          // Load existing content controls inside this range\r\n          const font = range.font;\r\n          font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", 'color']);\r\n          range.load(\"contentControls\");\r\n          await context.sync();\r\n\r\n          const existingControl = range.contentControls.items.length > 0;\r\n\r\n          if (existingControl) {\r\n            console.log(`Skipping \"${range.text}\" because it already has a content control.`);\r\n            continue; // Skip if content control is already present\r\n          }\r\n          // Check if we've already processed this term at this range\r\n          if (foundRanges.has(range.text)) {\r\n            console.log(`Skipping duplicate occurrence of \"${range.text}\"`);\r\n            continue;\r\n          }\r\n          // Mark this word as processed\r\n          foundRanges.set(range.text, true);\r\n          // Remove existing content controls if any\r\n          if (range.contentControls && range.contentControls.items.length > 0) {\r\n            console.log(`Removing existing content control from: \"${range.text}\"`);\r\n            for (const control of range.contentControls.items) {\r\n              control.delete(false); // 'false' keeps the text, only removes the control\r\n            }\r\n            await context.sync(); // Ensure deletion is applied before adding a new one\r\n          }\r\n\r\n          try {\r\n            // Insert a new content control\r\n            const contentControl = range.insertContentControl();\r\n            contentControl.title = `${range.text}`;\r\n            if (font.highlightColor !== null) {\r\n              contentControl.tag = `${font.highlightColor}`;\r\n            }\r\n            contentControl.font.highlightColor = \"yellow\"; // Highlight the control\r\n            contentControl.appearance = Word.ContentControlAppearance.boundingBox;\r\n            await context.sync();\r\n          } catch (error) {\r\n            console.error(`Error inserting content control for term \"${range.text}\":`, error);\r\n          }\r\n        }\r\n      }\r\n      // document.getElementById('glossarycheck').style.display='block';\r\n      isGlossaryActive = true;\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 clear-glossary btn-sm\" id=\"clearGlossary\">Clear Glossary</button>\r\n      </div>\r\n\r\n      <div id=\"highlighted-text\"></div>\r\n      <div class=\"d-flex justify-content-center box-loader\">\r\n       <div class=\"loader\" id=\"loader\"></div></div>\r\n      \r\n`\r\n      const displayElement = document.getElementById('loader');\r\n      displayElement.style.display = 'none';\r\n      await context.sync();\r\n      document.getElementById('clearGlossary').addEventListener('click', removeMatchingContentControls);\r\n      Office.context.document.addHandlerAsync(\r\n        Office.EventType.DocumentSelectionChanged,\r\n        handleSelectionChange\r\n      );\r\n\r\n\r\n    });\r\n\r\n    // Optional: Notify user of completion\r\n    console.log('Glossary applied successfully');\r\n  } catch (error) {\r\n    console.error('Error applying glossary:', error);\r\n    // Optional: Notify user of error\r\n    console.log('Error applying glossary. Please try again.');\r\n  }\r\n}\r\n\r\n\r\nasync function handleSelectionChange() {\r\n  await checkGlossary();\r\n}\r\n\r\nexport async function checkGlossary() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      const selection = context.document.getSelection();\r\n\r\n      selection.load(\"text, font.highlightColor\");\r\n      const contentControls = selection.contentControls;\r\n\r\n      contentControls.load(\"items/title,items/tag\");\r\n      await context.sync();\r\n\r\n      if (contentControls.items.length > 0) {\r\n        const cc = contentControls.items[0];\r\n        if (cc.tag && cc.tag.startsWith(\"tagname\")) {\r\n          return;\r\n        }\r\n      }\r\n      if (selection.text) {\r\n        const loader = document.getElementById('loader');\r\n        if (loader) {\r\n          loader.style.display = 'block';\r\n        }\r\n        const searchPromises = layTerms.map(term => {\r\n          const searchResults = selection.search(term.ClinicalTerm, { matchCase: false, matchWholeWord: false });\r\n          searchResults.load(\"items\");\r\n          return searchResults;\r\n        });\r\n\r\n        await context.sync();\r\n        const selectedWords = []\r\n        for (const searchResults of searchPromises) {\r\n\r\n          for (const range of searchResults.items) {\r\n            const font = range.font;\r\n            font.load([\"bold\", \"italic\", \"underline\", \"size\", \"highlightColor\", \"name\", \"color\"]);\r\n\r\n            await context.sync();\r\n            if (\r\n              font.highlightColor !== capturedFormatting['Background Color'] ||\r\n              font.color !== capturedFormatting['Text Color'] ||\r\n              font.bold !== capturedFormatting['Bold'] ||\r\n              font.italic !== capturedFormatting['Italic'] ||\r\n              font.size !== capturedFormatting['Size'] ||\r\n              font.underline !== capturedFormatting['Underline'] ||\r\n              font.name !== capturedFormatting['Font Name']\r\n            ) {\r\n              selectedWords.push(range.text);\r\n            }\r\n\r\n          }\r\n        }\r\n        // searchPromises.forEach(searchResults => {\r\n        //   searchResults.items.forEach(item => {\r\n        //   });\r\n        // });\r\n        displayHighlightedText(selectedWords)\r\n\r\n        await context.sync();\r\n\r\n\r\n\r\n\r\n        // const highlightColor = selection.font.highlightColor;\r\n\r\n        // if (highlightColor === \"red\") {\r\n        //   displayHighlightedText(selection.text);\r\n        // } else {\r\n        //   console.log('Selected text is not highlighted.');\r\n        // }\r\n      } else {\r\n        console.log('No text is selected.');\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error displaying glossary:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction displayHighlightedText(words: string[]) {\r\n\r\n  const displayElement = document.getElementById('highlighted-text');\r\n\r\n  if (displayElement) {\r\n    displayElement.innerHTML = ''; // Clear previous content\r\n    const loader = document.getElementById('loader');\r\n    loader.style.display = 'block';\r\n    // Group lay terms by their clinical term\r\n    const groupedTerms: { [clinicalTerm: string]: string[] } = {};\r\n\r\n    words.forEach(word => {\r\n      layTerms.forEach(term => {\r\n        if (term.ClinicalTerm.toLowerCase() === word.toLowerCase()) {\r\n          if (!groupedTerms[term.ClinicalTerm]) {\r\n            groupedTerms[term.ClinicalTerm] = [];\r\n          }\r\n          if (!groupedTerms[term.ClinicalTerm].includes(term.LayTerm)) {\r\n            groupedTerms[term.ClinicalTerm].push(term.LayTerm);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // Create a box for each clinical term\r\n    Object.keys(groupedTerms).forEach(clinicalTerm => {\r\n      // Create the main box for the clinical term\r\n      const mainBox = document.createElement('div');\r\n      mainBox.className = 'box'; // Add box class for styling\r\n\r\n      // Create a heading for the clinical term\r\n      const heading = document.createElement('h3');\r\n      heading.textContent = `${clinicalTerm} (${glossaryName})`;\r\n      mainBox.appendChild(heading);\r\n\r\n      // Create sub-boxes for each lay term\r\n      groupedTerms[clinicalTerm].forEach(layTerm => {\r\n        const subBox = document.createElement('div');\r\n        subBox.className = 'sub-box'; // Add class for sub-box styling\r\n        subBox.textContent = layTerm;\r\n\r\n        // Add click event listener to replace ClinicalTerm with LayTerm\r\n        subBox.addEventListener('click', async () => {\r\n          await replaceClinicalTerm(clinicalTerm, layTerm);\r\n\r\n          // Remove the main box containing the clicked sub-box\r\n          mainBox.remove();\r\n        });\r\n\r\n        mainBox.appendChild(subBox);\r\n      });\r\n\r\n      displayElement.appendChild(mainBox);\r\n    });\r\n    loader.style.display = 'none';\r\n\r\n  }\r\n}\r\nasync function replaceClinicalTerm(clinicalTerm: string, layTerm: string) {\r\n  const displayElement = document.getElementById('loader');\r\n  displayElement.style.display = 'block';\r\n\r\n  try {\r\n    await Word.run(async (context) => {\r\n      // Get the current selection\r\n      const selection = context.document.getSelection();\r\n      selection.load('text');\r\n      await context.sync();\r\n\r\n      if (selection.text.toLowerCase().includes(clinicalTerm.toLowerCase())) {\r\n        // Search for the clinicalTerm in the document\r\n        const searchResults = selection.search(clinicalTerm, { matchCase: false, matchWholeWord: false });\r\n        searchResults.load('items');\r\n\r\n        await context.sync();\r\n\r\n        // Replace each occurrence of the clinicalTerm with the layTerm\r\n        for (const item of searchResults.items) {\r\n          // Load the font properties\r\n          item.font.load(['bold', 'italic', 'underline', 'color', 'highlightColor', 'size', 'name']);\r\n          await context.sync();  // Ensure the properties are loaded before accessing them\r\n\r\n          // Insert the layTerm while keeping the formatting\r\n          item.insertText(layTerm, 'replace');\r\n\r\n          // Apply the original formatting to the new text\r\n          item.font.bold = item.font.bold;\r\n          item.font.italic = item.font.italic;\r\n          item.font.underline = item.font.underline;\r\n          item.font.color = item.font.color;\r\n          item.font.highlightColor = '#c7c7c7';\r\n          item.font.size = item.font.size;\r\n          item.font.name = item.font.name;\r\n        }\r\n\r\n        await context.sync();\r\n        displayElement.style.display = 'none';\r\n        console.log(`Replaced '${clinicalTerm}' with '${layTerm}' and preserved the original formatting.`);\r\n      } else {\r\n        displayElement.style.display = 'none';\r\n        console.log(`Selected text does not contain '${clinicalTerm}'.`);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    displayElement.style.display = 'none';\r\n    console.error('Error replacing term:', error);\r\n  }\r\n}\r\n\r\n\r\nexport async function removeMatchingContentControls() {\r\n  try {\r\n    await Word.run(async (context) => {\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <div class=\"loader\" id=\"loader\"></div>\r\n        <div id=\"highlighted-text\"></div>`;\r\n      const body = context.document.body;\r\n\r\n      // Load all content controls\r\n      const contentControls = body.contentControls;\r\n      contentControls.load(\"items\");\r\n      await context.sync();\r\n\r\n      if (contentControls.items.length === 0) {\r\n        console.log(\"No content controls found.\");\r\n        return;\r\n      }\r\n\r\n      for (const control of contentControls.items) {\r\n        if (control.title && filteredGlossaryTerm.some(term => term.ClinicalTerm.toLowerCase() === control.title.toLowerCase())) {\r\n          const range = control.getRange();\r\n          range.load(\"text\");\r\n          await context.sync();\r\n          if (control.tag && /^#[0-9A-Fa-f]{6}$/.test(control.tag)) {\r\n            range.font.highlightColor = control.tag;\r\n          } else {\r\n            range.font.highlightColor = null\r\n          }\r\n          await context.sync();\r\n          control.delete(true);\r\n        }\r\n      }\r\n\r\n      document.getElementById('app-body').innerHTML = `\r\n      <div id=\"button-container\">\r\n        <button class=\"btn btn-secondary me-2 mark-glossary btn-sm\" id=\"applyglossary\">Apply Glossary</button>\r\n      </div>\r\n      `;\r\n\r\n      await context.sync();\r\n      isGlossaryActive = false;\r\n      document.getElementById('applyglossary').addEventListener('click', applyglossary);\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error removing content controls:\", error);\r\n  }\r\n}\r\n\r\n\r\nasync function displayMentions() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n    const htmlBody = `\r\n      <div class=\"container mt-3\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n            <h5 class=\"card-title\">Search Tags</h5>\r\n          </div>\r\n          <div class=\"card-body\">\r\n            <div class=\"form-group\">\r\n              <input type=\"text\" id=\"search-box\" class=\"form-control\" placeholder=\"Search Tags...\" autocomplete=\"off\" />\r\n            </div>\r\n            <ul id=\"suggestion-list\" class=\"list-group mt-2\"></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n\r\n    const searchBox = document.getElementById('search-box');\r\n    const suggestionList = document.getElementById('suggestion-list');\r\n\r\n    // Function to filter and display suggestions\r\n    function updateSuggestions() {\r\n      const searchTerm = searchBox.value.toLowerCase();\r\n      if (searchTerm === '') {\r\n        suggestionList.innerHTML = ``;\r\n        return;\r\n      }\r\n      suggestionList.innerHTML = '';\r\n\r\n      // Filter mention list based on search term\r\n      const filteredMentions = availableKeys.filter(mention =>\r\n        mention.DisplayName.toLowerCase().includes(searchTerm)\r\n      );\r\n\r\n      // Render filtered suggestions\r\n      filteredMentions.forEach(mention => {\r\n        const listItem = document.createElement('li');\r\n        listItem.className = 'list-group-item list-group-item-action';\r\n        listItem.textContent = mention.DisplayName;\r\n        listItem.onclick = () => {\r\n          // Replace # with the selected value (adjust as needed)\r\n          replaceMention(mention, mention.ComponentKeyDataType);\r\n          suggestionList.innerHTML = ''; // Clear suggestions after selection\r\n        };\r\n        suggestionList.appendChild(listItem);\r\n      });\r\n    }\r\n\r\n    // Add input event listener to the search box\r\n    searchBox.addEventListener('input', updateSuggestions);\r\n  }\r\n}\r\n\r\nasync function addGenAITags() {\r\n  if (!isTagUpdating) {\r\n    if (isGlossaryActive) {\r\n      await removeMatchingContentControls();\r\n    }\r\n\r\n    let selectedClient = clientList.filter((item) => item.ID === clientId);\r\n\r\n    let sponsorOptions = clientList.map(client => {\r\n      const isSelectedClient = selectedClient.some(selected => selected.ID === client.ID);\r\n      return ` \r\n        <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\">\r\n          <div class=\"form-check\">\r\n            <input class=\"form-check-input\" type=\"checkbox\" value=\"${client.ID}\" id=\"sponsor${client.ID}\" ${isSelectedClient ? 'checked disabled' : ''}>\r\n            <label class=\"form-check-label text-prewrap\" for=\"sponsor${client.ID}\">${client.Name}</label>\r\n          </div>\r\n        </li>\r\n      `;\r\n    }).join('');\r\n\r\n    const htmlBody = `\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-body p-3\">\r\n            <form id=\"genai-form\" autocomplete=\"off\" novalidate>\r\n              <!-- Name Field -->\r\n              <div class=\"mb-3\">\r\n                <label for=\"name\" class=\"form-label\"><span class=\"text-danger\">*</span> Name</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"name\" required>\r\n                <div class=\"invalid-feedback\">Name is required.</div>\r\n                <div id=\"submition-error\" class=\"invalid-feedback\" style=\"display: none;\"></div>\r\n\r\n              </div>\r\n\r\n              <!-- Description Field -->\r\n              <div class=\"mb-3\">\r\n                <label for=\"description\" class=\"form-label\">Description</label>\r\n                <textarea class=\"form-control\" id=\"description\" rows=\"6\"></textarea>\r\n              </div>\r\n\r\n              <!-- Prompt Field -->\r\n              <div class=\"mb-3\">\r\n                <label for=\"prompt\" class=\"form-label\"><span class=\"text-danger\">*</span> Prompt \r\n                  <small class=\"text-secondary\">(Note: Use # tag for content suggestions)</small>\r\n                </label>\r\n                <textarea class=\"form-control\" id=\"prompt\" rows=\"6\"  required></textarea>\r\n                <div class=\"invalid-feedback\">Prompt is required.</div>\r\n                <div id=\"mention-dropdown\" class=\"dropdown-menu\"></div>\r\n              </div>\r\n\r\n              <!-- Save Globally Checkbox -->\r\n              <div class=\"form-check mb-3\">\r\n                <input type=\"checkbox\" class=\"form-check-input\" id=\"saveGlobally\">\r\n                <label class=\"form-check-label\" for=\"saveGlobally\">Save Globally</label>\r\n              </div>\r\n\r\n              <!-- Available to All Sponsors Checkbox -->\r\n              <div class=\"form-check mb-3\">\r\n                <input type=\"checkbox\" class=\"form-check-input\" id=\"isAvailableForAll\" disabled>\r\n                <label class=\"form-check-label\" for=\"isAvailableForAll\">Available to All Sponsors</label>\r\n              </div>\r\n\r\n              <!-- Sponsor Dropdown -->\r\n              <div class=\"mb-3\">\r\n                <label for=\"sponsor\" class=\"form-label\"><span class=\"text-danger\">*</span> Sponsor</label>\r\n                <div class=\"dropdown w-100\">\r\n                  <button \r\n                    class=\"btn btn-white border w-100 text-start d-flex justify-content-between align-items-center dropdown-toggle\" \r\n                    type=\"button\" \r\n                    id=\"sponsorDropdown\" \r\n                    data-bs-toggle=\"dropdown\" \r\n                    aria-expanded=\"false\" \r\n                    disabled>\r\n                    <span id=\"sponsorDropdownLabel\">Select Sponsors</span>\r\n                    <span class=\"dropdown-toggle-icon\"></span>\r\n                  </button>\r\n                  <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sponsorDropdown\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\r\n                    <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\">\r\n                      <div class=\"form-check\">\r\n                        <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll\">\r\n                        <label class=\"form-check-label\" for=\"selectAll\">Select All</label>\r\n                      </div>\r\n                    </li>\r\n                    ${sponsorOptions}\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Action Buttons -->\r\n              <div class=\"text-end mt-3\">\r\n                <button id=\"cancel-btn-gen-ai\" class=\"btn btn-danger bg-danger-clr px-3 me-2\"><i class=\"fa fa-reply me-2\"></i>Cancel</button>\r\n                <button type=\"submit\" class=\"btn btn-success bg-success-clr\" id=\"text-gen-save\"><i class=\"fa fa-check-circle me-2\"></i>Save</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>`;\r\n\r\n    // Add modal HTML to the DOM\r\n    document.getElementById('app-body').innerHTML = htmlBody;\r\n    //prompt starting\r\n    mentionDropdownFn('prompt', 'mention-dropdown', 'add');\r\n    //prompt end\r\n    const form = document.getElementById('genai-form');\r\n    const promptField = document.getElementById('prompt');\r\n\r\n    const nameField = document.getElementById('name');\r\n    const descriptionField = document.getElementById('description');\r\n    const saveGloballyCheckbox = document.getElementById('saveGlobally');\r\n    const availableForAllCheckbox = document.getElementById('isAvailableForAll');\r\n    const sponsorDropdownButton = document.getElementById('sponsorDropdown');\r\n    const sponsorDropdownItems = document.querySelectorAll('.dropdown-item .form-check-input');\r\n\r\n    document.getElementById('cancel-btn-gen-ai').addEventListener('click', displayAiTagList);\r\n\r\n    // Check if elements exist\r\n    if (form && nameField && promptField && sponsorDropdownItems.length > 0) {\r\n      const updateDropdownLabel = () => {\r\n        if (availableForAllCheckbox.checked) {\r\n          sponsorDropdownButton.textContent = clientList.map(client => client.Name).join(\", \");\r\n        } else {\r\n          const selectedOptions = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'selectAll')\r\n            .map(cb => cb.parentElement.textContent.trim());\r\n          sponsorDropdownButton.textContent = selectedOptions.length ? selectedOptions.join(\", \") : \"Select Sponsors\";\r\n        }\r\n      };\r\n      // Form validation logic on submit\r\n      form.addEventListener('submit', function (e) {\r\n        e.preventDefault();\r\n\r\n        // Reset previous validation errors\r\n        form.querySelectorAll('.is-invalid').forEach(input => input.classList.remove('is-invalid'));\r\n\r\n        let valid = true;\r\n\r\n        if (!(nameField as HTMLInputElement).value.trim()) {\r\n          nameField.classList.add('is-invalid');\r\n          valid = false;\r\n        }\r\n\r\n        if (!(promptField as HTMLInputElement).value.trim()) {\r\n          promptField.classList.add('is-invalid');\r\n          valid = false;\r\n        }\r\n\r\n        if (valid) {\r\n          // Prepare object to pass to createTextGenTag\r\n          const selectedSponsors = Array.from(sponsorDropdownItems)\r\n            .filter(cb => cb.checked && cb.id !== 'selectAll')\r\n            .map(cb => {\r\n              const client = clientList.find(client => client.ID == cb.value);\r\n              return client; // Collect the entire client object\r\n            });\r\n\r\n          const isAvailableForAll = availableForAllCheckbox.checked;\r\n          const isSaveGlobally = saveGloballyCheckbox.checked;\r\n          const aigroup = dataList.Group.find(element => element.DisplayName === 'AIGroup');\r\n          const formData = {\r\n            DisplayName: nameField.value.trim(),\r\n            Prompt: promptField.value.trim(),\r\n            Description: descriptionField.value.trim(),\r\n            GroupKeyClient: selectedSponsors, // Array of selected sponsor objects\r\n            AllClient: isAvailableForAll ? 1 : 0,\r\n            SaveGlobally: isSaveGlobally,\r\n            UserDefined: '1',\r\n            ComponentKeyDataTypeID: '1',\r\n            ComponentKeyDataAccessID: '3',\r\n            AIFlag: 1,\r\n            DocumentTypeID: dataList.DocumentTypeID,\r\n            ReportHeadID: dataList.ID,\r\n            SourceTypeID: '',\r\n            ReportHeadGroupID: aigroup.ID,\r\n            ReportHeadSourceID: ''\r\n          };\r\n\r\n          createTextGenTag(formData);\r\n        }\r\n      });\r\n\r\n\r\n      const checkAndDisableSponsors = () => {\r\n        sponsorDropdownItems.forEach(checkbox => {\r\n          if (!checkbox.disabled) {\r\n            checkbox.checked = true;\r\n            checkbox.disabled = true;\r\n          }\r\n        });\r\n        updateDropdownLabel();\r\n      };\r\n\r\n      // Function to enable sponsors without unchecking them\r\n      const enableSponsors = () => {\r\n        sponsorDropdownItems.forEach(checkbox => {\r\n          const isSelectedClient = selectedClient.some(selected => selected.ID === parseInt(checkbox.value));\r\n          if (!isSelectedClient) {\r\n            checkbox.disabled = false;\r\n          }\r\n        });\r\n        updateDropdownLabel();\r\n      };\r\n\r\n      // Event listener for \"Save Globally\" checkbox\r\n\r\n\r\n      // Event listener for \"Available to All Sponsors\" checkbox\r\n\r\n      saveGloballyCheckbox.addEventListener('change', function () {\r\n        if (this.checked) {\r\n          availableForAllCheckbox.disabled = false;\r\n          sponsorDropdownButton.disabled = false;\r\n        } else {\r\n          enableSponsors();\r\n          availableForAllCheckbox.checked = false;\r\n          availableForAllCheckbox.disabled = true;\r\n          sponsorDropdownButton.disabled = true;\r\n          sponsorDropdownItems.forEach(checkbox => {\r\n            if (!checkbox.disabled) {\r\n              checkbox.checked = false;\r\n              checkbox.disabled = false;\r\n            }\r\n          });\r\n          updateDropdownLabel();\r\n        }\r\n      });\r\n\r\n      // Event listener for \"Available to All Sponsors\" checkbox\r\n      availableForAllCheckbox.addEventListener('change', function () {\r\n        if (this.checked) {\r\n          checkAndDisableSponsors();\r\n        } else {\r\n          enableSponsors();\r\n        }\r\n      });\r\n\r\n      // Add event listener to prevent dropdown close on item selection\r\n      document.querySelectorAll('.dropdown-item').forEach(item => {\r\n        item.addEventListener('click', function (event) {\r\n          event.stopPropagation(); // Prevent dropdown from closing\r\n          const checkbox = this.querySelector('.form-check-input');\r\n          if (checkbox) {\r\n\r\n\r\n            if (checkbox.id === 'selectAll') {\r\n              const isChecked = checkbox.checked;\r\n              sponsorDropdownItems.forEach(cb => {\r\n                if (!cb.disabled) cb.checked = isChecked;\r\n              });\r\n            }\r\n            updateDropdownLabel();\r\n          }\r\n        });\r\n      });\r\n\r\n      // Initial label update\r\n      updateDropdownLabel();\r\n\r\n\r\n      // Clear validation errors when user types\r\n      [nameField, promptField].forEach(field => {\r\n        field.addEventListener('input', function () {\r\n          if (this.classList.contains('is-invalid') && this.value.trim()) {\r\n            this.classList.remove('is-invalid');\r\n          }\r\n          if (nameField) {\r\n            const errorDiv = document.getElementById('submition-error');\r\n            errorDiv.style.display = 'none';\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      console.error('Required elements are missing or not rendered yet.');\r\n    }\r\n  }\r\n}\r\n\r\n\r\nasync function createTextGenTag(payload) {\r\n  try {\r\n    const iconelement = document.getElementById(`text-gen-save`);\r\n    const aiTagBtn = document.getElementById('aitag');\r\n    const mentionBtn = document.getElementById('mention');\r\n    const formatDropdownBtn = document.getElementById('formatDropdown');\r\n    const cancelBtnGenAi = document.getElementById('cancel-btn-gen-ai');\r\n\r\n    aiTagBtn.disabled = true;\r\n    cancelBtnGenAi.disabled = true;\r\n    mentionBtn.disabled = true;\r\n    formatDropdownBtn.disabled = true;\r\n    iconelement.innerHTML = `<i class=\"fa fa-spinner fa-spin text-white me-2\"></i>Save`;\r\n    iconelement.disabled = true;\r\n\r\n    const response = await fetch(`${baseUrl}/api/report/group-key/add`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${jwt}`\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Network response was not ok.');\r\n    }\r\n\r\n    const data = await response.json();\r\n    if (data['Data'] && data['Status']) {\r\n      fetchDocument('AIpanel');\r\n    } else {\r\n      aiTagBtn.disabled = false;\r\n      cancelBtnGenAi.disabled = false;\r\n      mentionBtn.disabled = false;\r\n      formatDropdownBtn.disabled = false;\r\n      iconelement.disabled = false;\r\n      iconelement.innerHTML = `<i class=\"fa fa-check-circle me-2\"></i>Save`;\r\n      showAddTagError(data['Data'])\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Error creating text generation tag:', error);\r\n  }\r\n}\r\n\r\n\r\nfunction mentionDropdownFn(textareaId, DropdownId, action) {\r\n  const filterMentions = (query) => {\r\n    // Assuming availableKeys is an array of objects with DisplayName and EditorValue properties\r\n    const filtered = availableKeys.filter(item => item.AIFlag === 0).filter(item =>\r\n      item.DisplayName.toLowerCase().includes(query.toLowerCase())\r\n    );\r\n    return filtered;\r\n  };\r\n  let highlightedIndex = -1;\r\n\r\n  const promptField = document.getElementById(`${textareaId}`);\r\n  const mentionDropdown = document.getElementById(`${DropdownId}`);\r\n  if (promptField) {\r\n\r\n    // Handle input events on prompt field for mentions\r\n    promptField.addEventListener('input', (e) => {\r\n      const cursorPosition = promptField.selectionStart;\r\n      const textBeforeCursor = promptField.value.slice(0, cursorPosition);\r\n      const lastHashtag = textBeforeCursor.lastIndexOf('#');\r\n\r\n      if (lastHashtag !== -1) {\r\n        const query = textBeforeCursor.slice(lastHashtag + 1).trim();\r\n        if (query.length > 0) {\r\n          const mentions = filterMentions(query);\r\n\r\n          if (mentions.length > 0) {\r\n            mentionDropdown.innerHTML = mentions.map(item => {\r\n              let editorValue = '';\r\n              if (action === 'add') {\r\n                editorValue = `#${item.DisplayName}#`;\r\n              } else {\r\n                editorValue = item.EditorValue || `#${item.DisplayName}#`;\r\n              }\r\n\r\n              return `<li class=\"dropdown-item\" data-editor-value=\"${editorValue}\">${item.DisplayName}</li>`;\r\n            }).join('');\r\n\r\n            // Get the position of the textarea and place the dropdown above it\r\n            const textareaRect = promptField.getBoundingClientRect();\r\n            mentionDropdown.style.left = `${textareaRect.left}px`;\r\n            mentionDropdown.style.bottom = `75px`; // Position above the textarea\r\n            mentionDropdown.style.display = 'block';\r\n          } else {\r\n            mentionDropdown.style.display = 'none';\r\n          }\r\n        } else {\r\n          mentionDropdown.style.display = 'none';\r\n        }\r\n      } else {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n\r\n    });\r\n\r\n    // Handle keyboard navigation in the dropdown\r\n    promptField.addEventListener('keydown', (e) => {\r\n      const items = document.querySelectorAll(`#${DropdownId} .dropdown-item`);\r\n      const totalItems = items.length;\r\n\r\n      if (e.key === 'ArrowDown') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight down and wrap around to the top if at the end\r\n        if (highlightedIndex < totalItems - 1) {\r\n          highlightedIndex++;\r\n        } else {\r\n          highlightedIndex = 0; // Wrap to the first item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'ArrowUp') {\r\n        // Prevent default behavior to stop cursor from moving\r\n        e.preventDefault();\r\n\r\n        // Move the highlight up and wrap around to the bottom if at the top\r\n        if (highlightedIndex > 0) {\r\n          highlightedIndex--;\r\n        } else {\r\n          highlightedIndex = totalItems - 1; // Wrap to the last item\r\n        }\r\n        updateHighlightedItem(`${DropdownId}`);\r\n      } else if (e.key === 'Enter' && highlightedIndex !== -1) {\r\n        // Select the highlighted item\r\n        const selectedItem = items[highlightedIndex];\r\n        if (selectedItem) {\r\n          selectMention(selectedItem.getAttribute('data-editor-value'));\r\n          mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n          e.preventDefault();  // Prevent form submission on Enter key\r\n        }\r\n      }\r\n    });\r\n\r\n    // Function to highlight the selected item\r\n    function updateHighlightedItem(id) {\r\n      const items = document.querySelectorAll(`#${id} .dropdown-item`);\r\n      const dropdown = document.getElementById(`${id}`);\r\n      const totalItems = items.length;\r\n\r\n      // Remove the 'active' class from all items\r\n      items.forEach(item => item.classList.remove('active'));\r\n\r\n      // Add the 'active' class to the currently highlighted item\r\n      if (highlightedIndex >= 0 && highlightedIndex < totalItems) {\r\n        const highlightedItem = items[highlightedIndex];\r\n        highlightedItem.classList.add('active');\r\n\r\n        // Ensure the highlighted item is visible within the dropdown\r\n        highlightedItem.scrollIntoView({\r\n          behavior: 'smooth',    // Smooth scroll\r\n          block: 'nearest'      // Scroll only if necessary\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n\r\n    // Handle selecting an item from the dropdown via mouse click\r\n    mentionDropdown.addEventListener('click', (e) => {\r\n      if (e.target && e.target.matches('li')) {\r\n        const editorValue = e.target.getAttribute('data-editor-value');\r\n        selectMention(editorValue);\r\n        mentionDropdown.style.display = 'none';  // Hide the dropdown after selection\r\n      }\r\n    });\r\n\r\n    // Function to insert the selected mention into the prompt field\r\n    const selectMention = (editorValue) => {\r\n      const textarea = document.getElementById(`${textareaId}`);\r\n      const currentValue = textarea.value;\r\n      const cursorPosition = textarea.selectionStart;\r\n\r\n      const textBefore = currentValue.slice(0, cursorPosition);\r\n      const textAfter = currentValue.slice(cursorPosition);\r\n\r\n      const lastHashPosition = textBefore.lastIndexOf('#');\r\n      const updatedTextBefore = textBefore.slice(0, lastHashPosition); // Removing '#' symbol\r\n\r\n      textarea.value = `${updatedTextBefore}${editorValue}${textAfter}`;\r\n      const newCursorPosition = updatedTextBefore.length + editorValue.length;\r\n      textarea.setSelectionRange(newCursorPosition, newCursorPosition);\r\n    };\r\n\r\n    // Hide the dropdown if clicked outside\r\n    document.addEventListener('click', (e) => {\r\n      if (!mentionDropdown.contains(e.target) && e.target !== promptField) {\r\n        mentionDropdown.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport async function replaceMention(word: any, type: any) {\r\n  return Word.run(async (context) => {\r\n    try {\r\n      const selection = context.document.getSelection();\r\n      await context.sync();\r\n\r\n      if (!selection) {\r\n        throw new Error('Selection is invalid or not found.');\r\n      }\r\n\r\n      if (type === 'TABLE') {\r\n        if (word.AIFlag === 0) {\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n\r\n          const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n          for (const node of bodyNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n              const textContent = node.textContent?.trim();\r\n              if (textContent) {\r\n                textContent.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    insertLineWithHeadingStyle(selection, line);\r\n                  }\r\n                });\r\n              }\r\n            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n              const element = node as HTMLElement;\r\n\r\n              if (element.tagName.toLowerCase() === 'table') {\r\n                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                if (rows.length === 0) {\r\n                  selection.insertParagraph(\"[Empty Table]\", Word.InsertLocation.before);\r\n                  continue;\r\n                }\r\n\r\n                const maxCols = Math.max(...rows.map(row => {\r\n                  return Array.from(row.querySelectorAll('td, th')).reduce((sum, cell) => {\r\n                    return sum + (parseInt(cell.getAttribute('colspan') || '1', 10));\r\n                  }, 0);\r\n                }));\r\n\r\n                const paragraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n                await context.sync();\r\n\r\n                const table = paragraph.insertTable(rows.length, maxCols, Word.InsertLocation.after);\r\n                table.style = \"Grid Table 4 - Accent 1\";  // Apply built-in Word table style\r\n\r\n                await context.sync();\r\n\r\n                const rowspanTracker: number[] = new Array(maxCols).fill(0);\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n                    // if (rowIndex === 0) {\r\n                    //   const cell = table.getCell(rowIndex, cellIndex);\r\n                    //   const paragraph = cell.body.paragraphs.getFirst();\r\n                    //   paragraph.font.bold = true;\r\n                    //   paragraph.font.highlightColor = \"lightGray\";  // This works!\r\n                    // }\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < maxCols) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < maxCols) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n                });\r\n              } else {\r\n                const elementText = element.innerText.trim();\r\n                if (elementText) {\r\n                  elementText.split('\\n').forEach(line => {\r\n                    if (line.trim()) {\r\n                      insertLineWithHeadingStyle(selection, line);\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          const containerParagraph = selection.insertParagraph(\"\", Word.InsertLocation.before);\r\n          await context.sync();\r\n\r\n          // Create content control around this paragraph (will expand as we add content)\r\n          const contentControl = containerParagraph.insertContentControl();\r\n          contentControl.title = word.DisplayName;\r\n          contentControl.tag = `tagname-${word.DisplayName}`;\r\n          await context.sync();\r\n\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(word.EditorValue, 'text/html');\r\n\r\n          const bodyNodes = Array.from(doc.body.childNodes);\r\n\r\n          for (const node of bodyNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n              const textContent = node.textContent?.trim();\r\n              if (textContent) {\r\n                textContent.split('\\n').forEach(line => {\r\n                  if (line.trim()) {\r\n                    const para = contentControl.insertParagraph(line, Word.InsertLocation.end);\r\n                    applyHeadingStyleIfNeeded(para, line);  // Optional if you want heading styles\r\n                  }\r\n                });\r\n              }\r\n            } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n              const element = node as HTMLElement;\r\n\r\n              if (element.tagName.toLowerCase() === 'table') {\r\n                const rows = Array.from(element.querySelectorAll('tr'));\r\n\r\n                if (rows.length === 0) {\r\n                  contentControl.insertParagraph(\"[Empty Table]\", Word.InsertLocation.end);\r\n                  continue;\r\n                }\r\n\r\n                const table = contentControl.insertTable(rows.length, element.rows[0].cells.length, Word.InsertLocation.end);\r\n                table.style = \"Grid Table 4 - Accent 1\";\r\n                await context.sync();\r\n\r\n                const rowspanTracker: number[] = new Array(element.rows[0].cells.length).fill(0);\r\n\r\n                rows.forEach((row, rowIndex) => {\r\n                  const cells = Array.from(row.querySelectorAll('td, th'));\r\n                  let cellIndex = 0;\r\n\r\n                  cells.forEach((cell) => {\r\n                    while (rowspanTracker[cellIndex] > 0) {\r\n                      rowspanTracker[cellIndex]--;\r\n                      cellIndex++;\r\n                    }\r\n\r\n                    const cellText = Array.from(cell.childNodes)\r\n                      .map(node => {\r\n                        if (node.nodeType === Node.TEXT_NODE) {\r\n                          return node.textContent?.trim() || '';\r\n                        } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                          return (node as HTMLElement).innerText.trim();\r\n                        }\r\n                        return '';\r\n                      })\r\n                      .filter(text => text.length > 0)\r\n                      .join(' ');\r\n\r\n                    const colspan = parseInt(cell.getAttribute('colspan') || '1', 10);\r\n                    const rowspan = parseInt(cell.getAttribute('rowspan') || '1', 10);\r\n\r\n                    table.getCell(rowIndex, cellIndex).value = cellText;\r\n\r\n                    for (let i = 1; i < colspan; i++) {\r\n                      if (cellIndex + i < element.rows[0].cells.length) {\r\n                        table.getCell(rowIndex, cellIndex + i).value = \"\";\r\n                      }\r\n                    }\r\n\r\n                    if (rowspan > 1) {\r\n                      for (let i = 0; i < colspan; i++) {\r\n                        if (cellIndex + i < element.rows[0].cells.length) {\r\n                          rowspanTracker[cellIndex + i] = rowspan - 1;\r\n                        }\r\n                      }\r\n                    }\r\n\r\n                    cellIndex += colspan;\r\n                  });\r\n                });\r\n              } else {\r\n                const elementText = element.innerText.trim();\r\n                if (elementText) {\r\n                  elementText.split('\\n').forEach(line => {\r\n                    if (line.trim()) {\r\n                      const para = contentControl.insertParagraph(line, Word.InsertLocation.end);\r\n                      applyHeadingStyleIfNeeded(para, line);  // Optional if you want heading styles\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        if (word.EditorValue === '' || word.IsApplied) {\r\n          selection.insertParagraph(`#${word.DisplayName}#`, Word.InsertLocation.before);\r\n        } else {\r\n          let content = removeQuotes(word.EditorValue);\r\n          let lines = content.split(/\\r?\\n/); // Handle both \\r\\n and \\n\r\n          if (word.AIFlag === 0) {\r\n            lines.forEach(line => {\r\n              selection.insertParagraph(line, Word.InsertLocation.before);\r\n            });\r\n          } else {\r\n            let cc = selection.insertContentControl();\r\n            cc.tag = `tagname-${word.DisplayName}`;\r\n            cc.title = word.DisplayName;\r\n            cc.appearance = \"BoundingBox\";\r\n            lines.forEach(line => {\r\n              cc.insertParagraph(line, Word.InsertLocation.end);\r\n            });\r\n          }\r\n\r\n        }\r\n      }\r\n\r\n      await context.sync();\r\n    } catch (error) {\r\n      console.error('Detailed error:', error);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nfunction insertLineWithHeadingStyle(range: Word.Range, line: string) {\r\n  let style = \"Normal\";\r\n  let text = line;\r\n\r\n  if (line.startsWith('###### ')) {\r\n    style = \"Heading 6\";\r\n    text = line.substring(7).trim();\r\n  } else if (line.startsWith('##### ')) {\r\n    style = \"Heading 5\";\r\n    text = line.substring(6).trim();\r\n  } else if (line.startsWith('#### ')) {\r\n    style = \"Heading 4\";\r\n    text = line.substring(5).trim();\r\n  } else if (line.startsWith('### ')) {\r\n    style = \"Heading 3\";\r\n    text = line.substring(4).trim();\r\n  } else if (line.startsWith('## ')) {\r\n    style = \"Heading 2\";\r\n    text = line.substring(3).trim();\r\n  } else if (line.startsWith('# ')) {\r\n    style = \"Heading 1\";\r\n    text = line.substring(2).trim();\r\n  }\r\n\r\n  const paragraph = range.insertParagraph(text, Word.InsertLocation.before);\r\n  paragraph.style = style;\r\n}\r\n\r\n\r\n\r\nfunction removeQuotes(value: string): string {\r\n  return value\r\n    ? value\r\n      .replace(/^\"|\"$/g, '')\r\n      .replace(/\\\\n/g, '')\r\n      .replace(/\\*\\*/g, '')\r\n      .replace(/\\\\r/g, '')\r\n    : '';\r\n}\r\n\r\nfunction showAddTagError(message) {\r\n  const errorDiv = document.getElementById('submition-error');\r\n  errorDiv.style.display = 'block';\r\n  errorDiv.textContent = message;\r\n}\r\n\r\nfunction transformDocumentName(value: string): string {\r\n  if (!value || value.trim() === '') {\r\n    return value; // Return the input value unchanged\r\n  }\r\n\r\n  const parts = value.split('_');\r\n  if (parts.length <= 1) {\r\n    return value; // Return the input value unchanged if no underscores are present\r\n  }\r\n\r\n  return parts.slice(1).join('_').replace(/%20/g, ' ').replace(/%25/g, '%');\r\n}\r\n\r\n\r\n\r\nfunction createMultiSelectDropdown(i, tag, radioButtonsHTML, textareaValue) {\r\n  const cardContainer = document.getElementById('card-container');\r\n\r\n  // Get the current scroll position\r\n  const scrollPosition = cardContainer.scrollTop;\r\n\r\n  const multiSelectHTML = `\r\n  <div class='p-3 bg-light w-100'>\r\n    <div class=\"mb-3\">\r\n      <label for=\"source-select-${i}\" class=\"form-label\"><span class=\"text-danger\">*</span> Select Sources</label>\r\n      <div class=\"dropdown w-100\">\r\n        <button \r\n          class=\"btn btn-light border w-100 text-start d-flex justify-content-between align-items-start dropdown-toggle dropdown-toggle-sources\" \r\n          type=\"button\" \r\n          id=\"sourceDropdown-${i}\" \r\n          data-bs-toggle=\"dropdown\" \r\n          aria-expanded=\"false\">\r\n          <span id=\"sourceDropdownLabel-${i}\" class='sourceDropdownLabel'></span>\r\n          <span class=\"dropdown-toggle-icon dropdown-toggle-icon-s\"></span>\r\n        </button>\r\n        <ul class=\"dropdown-menu w-100 p-2\" aria-labelledby=\"sourceDropdown-${i}\" style=\"box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10000;\">\r\n          <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\" data-checkbox-id=\"selectAll-${i}\">\r\n            <div class=\"form-check\">\r\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"selectAll\" id=\"selectAll-${i}\">\r\n              <label class=\"form-check-label\" for=\"selectAll-${i}\">Select All</label>\r\n            </div>\r\n          </li>\r\n          ${sourceList\r\n      .map(\r\n        (source, index) => `\r\n              <li class=\"dropdown-item p-2\" style=\"cursor: pointer;\" data-checkbox-id=\"source-${i}-${index}\">\r\n                <div class=\"form-check\">\r\n                  <input class=\"form-check-input source-checkbox\" type=\"checkbox\" value=\"${source.SourceName}\" id=\"source-${i}-${index}\">\r\n                  <label class=\"form-check-label text-prewrap\" for=\"source-${i}-${index}\">${source.SourceName}</label>\r\n                </div>\r\n              </li>\r\n            `\r\n      )\r\n      .join('')}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n    <div class=\"d-flex justify-content-end mt-2\">\r\n      <button id=\"cancel-src-btn-${i}\" class=\"btn btn-danger bg-danger-clr px-3 me-2\"><i class=\"fa fa-reply me-2\"></i>Cancel</button>\r\n      <button id=\"ok-src-btn-${i}\" class=\"btn btn-success bg-success-clr px-3\"><i class=\"fa fa-check-circle me-2\"></i>Save</button>\r\n    </div>\r\n  </div>\r\n  `;\r\n\r\n  // Get the accordion body element\r\n  const accordionBody = document.getElementById(`box-bottom-${i}`);\r\n\r\n  // Set height to ensure the dropdown button appears with some space\r\n\r\n  // Clear existing content and insert the dropdown\r\n  accordionBody.innerHTML = multiSelectHTML;\r\n\r\n  // Temporary array to hold the selected sources\r\n  let selectedSources = [];\r\n\r\n  // Get \"Select All\" checkbox and individual source checkboxes\r\n  const selectAllCheckbox = document.getElementById(`selectAll-${i}`);\r\n  const individualCheckboxes = document.querySelectorAll(`#accordion-body-${i} .source-checkbox`);\r\n  const sourceDropdownLabel = document.getElementById(`sourceDropdownLabel-${i}`);\r\n\r\n  // Function to update the dropdown label based on selected checkboxes\r\n  function updateLabel() {\r\n    const selectedSourceNames = selectedSources;\r\n    if (selectedSourceNames.length > 0) {\r\n      sourceDropdownLabel.innerText = selectedSourceNames.join(', ');  // Display selected sources as comma-separated\r\n    } else {\r\n      sourceDropdownLabel.innerText = ' ';  // Default text when no sources are selected\r\n    }\r\n  }\r\n\r\n  // Handle \"Select All\" functionality\r\n  selectAllCheckbox.addEventListener(\"change\", function () {\r\n    const checkboxes = document.querySelectorAll(`#accordion-body-${i} .source-checkbox`);\r\n    checkboxes.forEach((checkbox) => {\r\n      checkbox.checked = this.checked;  // If \"Select All\" is checked, all checkboxes are checked, and vice versa\r\n      // Update the temporary array based on the state of the checkboxes\r\n      if (checkbox.checked) {\r\n        if (!selectedSources.includes(checkbox.value)) {\r\n          selectedSources.push(checkbox.value);  // Add source to the array if checked\r\n        }\r\n      } else {\r\n        selectedSources = selectedSources.filter((source) => source !== checkbox.value);  // Remove unchecked sources\r\n      }\r\n    });\r\n\r\n    updateLabel();  // Update the label when \"Select All\" changes\r\n  });\r\n\r\n\r\n  const selectAllItem = document.querySelector(`#accordion-body-${i} .dropdown-item[data-checkbox-id=\"selectAll-${i}\"]`);\r\n  selectAllItem.addEventListener(\"click\", function (event) {\r\n    event.stopPropagation();  // Prevent dropdown from closing when clicking on the \"Select All\" item\r\n  });\r\n\r\n  // Handle individual checkbox state change\r\n  individualCheckboxes.forEach((checkbox) => {\r\n    checkbox.addEventListener(\"change\", function () {\r\n      if (checkbox.checked) {\r\n        if (!selectedSources.includes(checkbox.value)) {\r\n          selectedSources.push(checkbox.value);  // Add source to the array if checked\r\n        }\r\n      } else {\r\n        selectedSources = selectedSources.filter((source) => source !== checkbox.value);  // Remove unchecked sources\r\n      }\r\n\r\n      // Check if all individual checkboxes are checked\r\n      const allChecked = Array.from(individualCheckboxes).every((checkbox) => checkbox.checked);\r\n      selectAllCheckbox.checked = allChecked;  // Update \"Select All\" checkbox based on individual selections\r\n\r\n      updateLabel();  // Update the label when an individual checkbox is changed\r\n    });\r\n\r\n    // Add click event listener to the whole list item (not just the checkbox)\r\n    const listItem = checkbox.closest(\"li\");\r\n    listItem.addEventListener(\"click\", function (event) {\r\n      event.stopPropagation();  // Prevent dropdown from closing when clicking on list item\r\n    });\r\n  });\r\n\r\n  // Prevent the dropdown from closing when clicking on the \"Select All\" checkbox label\r\n\r\n  // Initialize checkboxes based on tag.Sources\r\n  if (tag.Sources && tag.Sources.length > 0) {\r\n    individualCheckboxes.forEach((checkbox) => {\r\n      if (tag.Sources.includes(checkbox.value)) {\r\n        checkbox.checked = true;  // Check the checkbox if its value is in tag.Sources\r\n        selectedSources.push(checkbox.value);  // Add the source to the temporary array\r\n      }\r\n    });\r\n\r\n    // Also check \"Select All\" if all checkboxes are selected\r\n    const allChecked = Array.from(individualCheckboxes).every((checkbox) => checkbox.checked);\r\n    selectAllCheckbox.checked = allChecked;\r\n    updateLabel();  // Update the label when \"Select All\" changes\r\n\r\n  }\r\n\r\n  // Handle \"OK\" button click\r\n  document.getElementById(`ok-src-btn-${i}`).addEventListener(\"click\", function () {\r\n    tag.Sources = [...selectedSources];  // Add selected sources to tag.Sources when \"OK\" is clicked\r\n    tag.SourceValue = sourceList\r\n      .filter(source => selectedSources.includes(source.SourceName))  // Find the sources with matching SourceNames\r\n      .map(source => source.SourceValue);\r\n    appendAccordionBody(i, tag, radioButtonsHTML, textareaValue, scrollPosition);\r\n  });\r\n\r\n  document.getElementById(`cancel-src-btn-${i}`).addEventListener(\"click\", function () {\r\n    appendAccordionBody(i, tag, radioButtonsHTML, textareaValue, scrollPosition);\r\n  });\r\n}\r\n\r\n\r\n\r\nfunction appendAccordionBody(i, tag, radioButtonsHTML, textareaValue, scrollPosition) {\r\n\r\n  const tooltipButton = tag.Sources && tag.Sources.length > 0\r\n    ? `  <span class=\"tooltiptext\">${tag.Sources}</span>`\r\n    : '<span class=\"tooltiptext\">Source</span>';\r\n\r\n\r\n  const accordionBody = document.getElementById(`box-bottom-${i}`);\r\n  // Clear existing content and insert the dropdown\r\n  accordionBody.innerHTML =\r\n    `\r\n           <textarea class=\"form-control\"\r\n                      rows=\"5\"\r\n                      id=\"chatbox-${i}\"\r\n                      placeholder=\"Type here\">${textareaValue}</textarea>\r\n              <div id=\"mention-dropdown-${i}\" class=\"dropdown-menu\"></div>\r\n              <div class=\"d-flex flex-column align-self-end me-3\">\r\n                <button class=\"btn btn-secondary text-light ms-2 mb-2 ngb-tooltip\" id=\"insert-tag-${i}\">\r\n                <span class=\"tooltiptext\">Insert</span>\r\n                <i class=\"fa fa-plus text-light c-pointer\" ></i>\r\n                </button>\r\n\r\n                <button\r\n                    class=\"btn btn-secondary ms-2 mb-2 text-white ngb-tooltip\"\r\n                    id=\"changeSource-${i}\">\r\n                    ${tooltipButton}\r\n                 <i class=\"fa fa-file-lines text-white\"></i>\r\n                </button>\r\n                <button type=\"submit\"\r\n                    class=\"btn btn-primary bg-primary-clr ms-2 text-white ngb-tooltip\"\r\n                    id=\"sendPrompt-${i}\">\r\n                    <span class=\"tooltiptext\">Send</span>\r\n                  <i class=\"fa fa-paper-plane text-white\"></i>\r\n               </button>\r\n             </div>`;\r\n\r\n  const cardContainer = document.getElementById('card-container');\r\n\r\n  cardContainer.scrollTop = scrollPosition;\r\n  mentionDropdownFn(`chatbox-${i}`, `mention-dropdown-${i}`, 'edit');\r\n  document.getElementById(`doNotApply-${i}`)?.addEventListener('change', () => onDoNotApplyChange(event, i, tag));\r\n\r\n  document.getElementById(`sendPrompt-${i}`)?.addEventListener('click', () => {\r\n    const textareaValue = (document.getElementById(`chatbox-${i}`) as HTMLTextAreaElement).value;\r\n\r\n    sendPrompt(tag, textareaValue, i)\r\n  });\r\n\r\n\r\n  document.getElementById(`insert-tag-${i}`)?.addEventListener('click', () => {\r\n    insertTagPrompt(i)\r\n  })\r\n\r\n  document.getElementById(`changeSource-${i}`)?.addEventListener('click', () => {\r\n    const textareaValue = (document.getElementById(`chatbox-${i}`) as HTMLTextAreaElement).value;\r\n\r\n    // const accordionbody=document.getElementById(`accordion-body-${i}`).innerHTML=''\r\n    createMultiSelectDropdown(i, tag, radioButtonsHTML, textareaValue)\r\n  })\r\n\r\n\r\n}\r\n\r\n\r\nfunction updateEditorFinalTable(data) {\r\n  const regex = /<TableStart>([\\s\\S]*?)<TableEnd>/gi;\r\n  const tableArrays = [];\r\n  let match;\r\n  // Extract and parse the table content from each EditorValue\r\n  while ((match = regex.exec(data)) !== null) {\r\n    try {\r\n      const parsedContent = JSON.parse(match[1]);\r\n      tableArrays.push(parsedContent);\r\n    } catch (error) {\r\n      console.error('Failed to parse JSON:', error, match[1]);\r\n    }\r\n  }\r\n\r\n  let tables = [];\r\n  // Generate HTML tables from the parsed content\r\n  tableArrays.forEach((obj, i) => {\r\n    const table = document.createElement('table');\r\n    table.className = 'table table-styling table-striped table-bordered';\r\n    table.id = `table-${i}`;\r\n\r\n    const thead = document.createElement('thead');\r\n    const headerRow = document.createElement('tr');\r\n\r\n    // Assuming obj[0] has the keys for the table columns\r\n    const keysArray = Object.keys(obj[0]);\r\n\r\n    keysArray.forEach((key) => {\r\n      const th = document.createElement('th');\r\n      th.className = 'header-text';\r\n      th.textContent = key;\r\n      headerRow.appendChild(th);\r\n    });\r\n\r\n    thead.appendChild(headerRow);\r\n    table.appendChild(thead);\r\n\r\n    const tbody = document.createElement('tbody');\r\n\r\n    // Iterate through the data and create rows\r\n    Object.entries(obj).forEach(([key, value]) => {\r\n      const row = document.createElement('tr');\r\n\r\n      keysArray.forEach((key) => {\r\n        const td = document.createElement('td');\r\n        td.textContent = value[key] || ''; // Handle empty or undefined values\r\n        row.appendChild(td);\r\n      });\r\n\r\n      tbody.appendChild(row);\r\n    });\r\n\r\n    table.appendChild(tbody);\r\n\r\n    // Add the table HTML to the tables array\r\n    tables.push(table.outerHTML);\r\n  });\r\n\r\n  // Replace <TableStart>...</TableEnd> with the generated table HTML\r\n  let tableIndex = 0;\r\n  const output = data.replace(regex, () => {\r\n    return tables[tableIndex++] || ''; // Replace with the appropriate table HTML\r\n  });\r\n  return '\\n ' + output;\r\n}\r\n\r\n\r\nfunction registerSelectionChangedHandler() {\r\n  Office.context.document.addHandlerAsync(\r\n    Office.EventType.DocumentSelectionChanged,\r\n    handleSelectionChanged\r\n  );\r\n}\r\n\r\nasync function handleSelectionChanged() {\r\n  await Word.run(async (context) => {\r\n    const selection = context.document.getSelection();\r\n    const contentControls = selection.contentControls;\r\n\r\n    contentControls.load(\"items/title,items/tag\");\r\n    await context.sync();\r\n\r\n    if (contentControls.items.length > 0) {\r\n      const cc = contentControls.items[0];\r\n      if (cc.tag && cc.tag.startsWith(\"tagname\")) {\r\n        showTagDetails(cc.tag);  // This will handle the highlighting logic\r\n      }\r\n    } else {\r\n      if (currentlyHighlightedElement) {\r\n        currentlyHighlightedElement.style.backgroundColor = \"\";\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction showTagDetails(tag: string) {\r\n  // Clear previous highlight\r\n  if (currentlyHighlightedElement) {\r\n    currentlyHighlightedElement.style.backgroundColor = \"\";\r\n  }\r\n\r\n  // Find and highlight the new element\r\n  const spanElement = document.getElementById(tag);\r\n  if (spanElement) {\r\n    spanElement.style.backgroundColor = \"yellow\";\r\n\r\n    // Store the currently highlighted element\r\n    currentlyHighlightedElement = spanElement;\r\n  } else {\r\n    // If no element found, clear the tracker\r\n    currentlyHighlightedElement = null;\r\n  }\r\n}\r\n\r\n","const dataUrl='https://plsdevapp.azurewebsites.net'\r\nconst storeUrl='https://linkwordplugin-aphgcwcgbfdqeccs.eastus-01.azurewebsites.net'\r\nconst versionLink='1.0.5'\r\nexport {dataUrl,storeUrl,versionLink};"],"names":["___HTML_LOADER_IMPORT_0___","module","exports","url","options","String","__esModule","default","hash","maybeNeedQuotes","test","concat","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","m","n","getter","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","b","baseURI","self","href","sourceList","filteredGlossaryTerm","jwt","baseUrl","storedUrl","documentID","organizationName","aiTagList","initialised","availableKeys","glossaryName","isGlossaryActive","GroupName","layTerms","dataList","isTagUpdating","capturedFormatting","emptyFormat","isNoFormatTextAvailable","clientId","userId","clientList","currentYear","Date","getFullYear","currentlyHighlightedElement","async","login","sessionToken","sessionStorage","getItem","console","log","loadLoginPage","getElementById","innerHTML","addEventListener","handleLogin","event","preventDefault","organization","value","username","password","toLowerCase","trim","toLocaleLowerCase","response","fetch","method","headers","body","JSON","stringify","ClientName","Username","Password","ok","showLoginError","data","json","Status","ResponseStatus","Data","Token","setItem","ID","error","message","errorDiv","style","display","textContent","fetchDocument","action","setActiveButton","removeMatchingContentControls","htmlBody","searchBox","suggestionList","updateSuggestions","searchTerm","filter","mention","DisplayName","includes","forEach","listItem","createElement","className","onclick","word","type","Word","run","selection","context","getSelection","sync","AIFlag","doc","DOMParser","parseFromString","EditorValue","bodyNodes","Array","from","childNodes","node","nodeType","Node","TEXT_NODE","split","line","insertLineWithHeadingStyle","ELEMENT_NODE","element","tagName","rows","querySelectorAll","insertParagraph","InsertLocation","before","maxCols","Math","max","map","row","reduce","sum","cell","parseInt","getAttribute","paragraph","table","insertTable","after","rowspanTracker","fill","rowIndex","cells","cellIndex","cellText","innerText","text","join","colspan","rowspan","getCell","elementText","containerParagraph","contentControl","insertContentControl","title","tag","applyHeadingStyleIfNeeded","end","IsApplied","lines","removeQuotes","cc","appearance","replaceMention","ComponentKeyDataType","appendChild","displayMentions","loadGlossary","fetchGlossary","displayAiTagList","formatOptionsDisplay","displayCapturedFormatting","removeFormattedText","removeOptionsConfirmation","logout","SourceTypeList","item","SourceValue","SourceName","transformDocumentName","ClientID","aiGroup","Group","find","Name","GroupKey","GroupKeyAll","match","exec","updateEditorFinalTable","UserValue","InitialTable","fetchClients","buttonId","id","button","classList","add","remove","keys","disabled","clearCapturedFormatting","Bold","Underline","Size","captureFormatting","emptyFormatCheckbox","checked","formatList","entries","font","load","bold","Italic","italic","underline","size","highlightColor","name","color","paragraphs","items","textRanges","range","insertText","generateRadioButtons","index","FilteredReportHeadAIHistoryList","ReportHeadAIHistoryList","historyList","Response","unshift","fetchAIHistory","html","chat","j","Prompt","Selected","setTimeout","copyText","onRadioChange","accordionContent","headerId","collapseId","radioButtonsHTML","textColorClass","tooltipButton","Sources","onDoNotApplyChange","target","sourceListBtn","isChecked","tagname","dnaBtn","sendPrompt","prompt","iconelement","payload","ReportHeadID","DocumentID","NCTID","DocumentType","TextSetting","DocumentTemplate","ReportTemplate","ReportHeadGroupKeyID","ThreadID","AssistantID","Container","PromptType","VectorID","parse","innerContainer","tempTextArea","select","execCommand","removeChild","clear","Cardcontainer","applyAITagFn","addGenAITags","accordionItem","mentionDropdownFn","textareaValue","insertTagPrompt","createMultiSelectDropdown","collapseElement","nextElementSibling","toggle","icon","closest","querySelector","searchResults","search","matchCase","matchWholeWord","tableInsertPositions","getRange","push","delete","err","startsWith","substring","tagIndex","chatIndex","matchingKey","div","selectElement","FormattedResponse","applyglossary","bodyText","GlossaryTemplate","sort","ClinicalTerm","processedTerms","Set","filteredTerms","term","biggerTerm","foundRanges","Map","searchPromises","contentControls","has","set","control","ContentControlAppearance","boundingBox","Office","addHandlerAsync","EventType","DocumentSelectionChanged","handleSelectionChange","loader","selectedWords","words","displayElement","groupedTerms","LayTerm","clinicalTerm","mainBox","heading","layTerm","subBox","replaceClinicalTerm","displayHighlightedText","checkGlossary","some","selectedClient","client","isSelectedClient","selected","form","promptField","nameField","descriptionField","saveGloballyCheckbox","availableForAllCheckbox","sponsorDropdownButton","sponsorDropdownItems","updateDropdownLabel","selectedOptions","cb","parentElement","input","valid","selectedSponsors","isAvailableForAll","isSaveGlobally","aigroup","aiTagBtn","mentionBtn","formatDropdownBtn","cancelBtnGenAi","showAddTagError","createTextGenTag","Description","GroupKeyClient","AllClient","SaveGlobally","UserDefined","ComponentKeyDataTypeID","ComponentKeyDataAccessID","DocumentTypeID","SourceTypeID","ReportHeadGroupID","ReportHeadSourceID","checkAndDisableSponsors","checkbox","enableSponsors","stopPropagation","field","contains","textareaId","DropdownId","highlightedIndex","mentionDropdown","updateHighlightedItem","totalItems","highlightedItem","scrollIntoView","behavior","block","cursorPosition","selectionStart","textBeforeCursor","slice","lastHashtag","lastIndexOf","query","mentions","filterMentions","editorValue","textareaRect","getBoundingClientRect","left","bottom","selectedItem","selectMention","matches","textarea","currentValue","textBefore","textAfter","lastHashPosition","updatedTextBefore","newCursorPosition","setSelectionRange","parts","scrollPosition","scrollTop","multiSelectHTML","source","selectedSources","selectAllCheckbox","individualCheckboxes","sourceDropdownLabel","updateLabel","selectedSourceNames","allChecked","every","appendAccordionBody","regex","tableArrays","parsedContent","tables","thead","headerRow","keysArray","th","tbody","td","outerHTML","tableIndex","handleSelectionChanged","backgroundColor","spanElement","showTagDetails","Number","onReady","info","host","HostType","properties","customProperties","property","orgName","retrieveDocumentProperties","URL"],"sourceRoot":""}